import{d as e,A as t,r as a,B as l,D as s,a2 as i,c as r,w as o,i as c,o as u,y as d,a as n,u as p,g as m,W as f,a0 as v,an as h,_}from"./index-CK4DGatK.js";import{N as y}from"./NavBar.DSs5OGCU.js";import{D as A}from"./listItem.CnogksUc.js";import{U as T}from"./UploadFile.BBuXxkzB.js";import{u as g}from"./useQuery.3dd8K18V.js";import{p as j}from"./index.HDA2F_3Q.js";import"./avatar.Buy0-vr1.js";import"./car_default.CyENNAub.js";import"./refuse.BEcO0WCW.js";import"./close.Dhgi5Ijg.js";import"./task.Cx6XxNwo.js";import"./isNil.aV-w2MPu.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const L=_(e({__name:"photoTo",setup(e){const _=g(),L=t(),O=a({}),R=a(),k=a([]),F=a(),I=a([]),b=a(),x=a([]),N=a(),P=a([]),E=a([]);l((()=>{w()}));const w=()=>{(new s).showLoading("加载中"),uni.$u.http.get("product/purchaseOrder/queryAllDetails",{params:{id:_.value.primaryKey}}).then((e=>{O.value=e.data;const t=e.data.carAttachmentInfo||[];k.value=t.filter((e=>"Normal"==e.carAttachmentType&&"Video"==e.attachmentType)),I.value=[...t.filter((e=>"Cover"==e.carAttachmentType)),...t.filter((e=>"APPEARANCE"==e.carAttachmentType))],x.value=t.filter((e=>"TRIM"==e.carAttachmentType)),P.value=t.filter((e=>"OTHER_PHOTOS"==e.carAttachmentType)),E.value=[...t.filter((e=>"VehicleLicense"==e.carAttachmentType)),...t.filter((e=>"VehicleLicenseBack"==e.carAttachmentType)),...t.filter((e=>"RegisterCertificate"==e.carAttachmentType)),...t.filter((e=>"Nameplate"==e.carAttachmentType)),...t.filter((e=>"CLASSIFY_OTHER_PHOTOS"==e.carAttachmentType))],i()}))},C=()=>{var e,t,a,l,i,r,o,c,u;const d=(null==(t=null==(e=R.value)?void 0:e.getFileFields())?void 0:t.video)||[],n=(null==(l=null==(a=F.value)?void 0:a.getFileFields())?void 0:l.all)||[],p=(null==(r=null==(i=b.value)?void 0:i.getFileFields())?void 0:r.all)||[],m=(null==(c=null==(o=N.value)?void 0:o.getFileFields())?void 0:c.all)||[];if(console.log(n),!(null==(u=n.filter((e=>"Cover"==e.carAttachmentType)))?void 0:u.length))return void v({title:"请至少上传一张外观图片",icon:"none"});(new s).showLoading("提交中");const f=[...d,...n,...p,...m,...E.value],y={taskId:_.value.taskId,purchaseOrderId:_.value.primaryKey,carAttachments:f};uni.$u.http.post("/product/purchaseOrder/photoGraphPending",y).then((()=>{h()})).catch((e=>{j(e.message)}))};return(e,t)=>{const a=c,l=f;return u(),r(a,{class:"page pend-page"},{default:o((()=>[p(L).needShowQw()?d("",!0):(u(),r(y,{key:0,title:"拍照"})),n(a,{class:"content"},{default:o((()=>[n(A,{item:p(O),isDetail:!0},null,8,["item"]),n(a,{class:"video-box"},{default:o((()=>[n(a,{class:"video-item"},{default:o((()=>[n(a,{class:"title"},{default:o((()=>[m("车辆视频")])),_:1}),n(a,{class:"sub-title"},{default:o((()=>[m("仅支持上传1个，视频不超过20M")])),_:1}),n(T,{ref_key:"videoUploadRef",ref:R,carAttachmentType:"Normal",accept:"video","max-count":1,uploadList:p(k),detail:p(_).status},null,8,["uploadList","detail"])])),_:1}),n(a,{class:"video-item"},{default:o((()=>[n(a,{class:"title"},{default:o((()=>[m("外观")])),_:1}),n(a,{class:"sub-title"},{default:o((()=>[m("第一张照片是首图，可拖动排序")])),_:1}),n(T,{ref_key:"appearanceRef",ref:F,carAttachmentType:"APPEARANCE",accept:"all","max-count":99,uploadList:p(I),detail:p(_).status},null,8,["uploadList","detail"])])),_:1}),n(a,{class:"video-item"},{default:o((()=>[n(a,{class:"title"},{default:o((()=>[m("内饰")])),_:1}),n(a,{class:"sub-title"},{default:o((()=>[m("可拖动排序")])),_:1}),n(T,{ref_key:"trimRef",ref:b,carAttachmentType:"TRIM",accept:"all","max-count":99,uploadList:p(x),detail:p(_).status},null,8,["uploadList","detail"])])),_:1}),n(a,{class:"video-item"},{default:o((()=>[n(a,{class:"title"},{default:o((()=>[m("其他照片")])),_:1}),n(a,{class:"sub-title"},{default:o((()=>[m("可拖动排序")])),_:1}),n(T,{ref_key:"otherImageRef",ref:N,carAttachmentType:"OTHER_PHOTOS",accept:"all","max-count":99,uploadList:p(P),detail:p(_).status},null,8,["uploadList","detail"])])),_:1})])),_:1})])),_:1}),1!=p(_).status?(u(),r(a,{key:1,class:"bottom-btn"},{default:o((()=>[n(l,{class:"save-btn",onClick:C},{default:o((()=>[m("确定")])),_:1})])),_:1})):d("",!0)])),_:1})}}}),[["__scopeId","data-v-d0281802"]]);export{L as default};
