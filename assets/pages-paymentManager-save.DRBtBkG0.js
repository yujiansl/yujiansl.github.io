import{d as a,r as e,q as n,E as t,X as l,Y as s,b as c,k as u,a as o,u as m,y as i,w as v,g as d,n as r,F as p,h as y,I as b,R as _,W as N,aq as k,K as f,M as A,o as I,t as T,Q as g,D as h,a0 as w,ar as B,bz as C,_ as P}from"./index-CK4DGatK.js";import{P as K,U as x,a as E}from"./paymentEnum.CeG4C_uX.js";import{U as L}from"./userPayment.DBrV-EDF.js";import{N as U}from"./NavBar.DSs5OGCU.js";import{u as W}from"./useQuery.3dd8K18V.js";const Y=P(a({__name:"save",setup(a){const P=W(),Y=e(!1),j=a=>{H.value.paymentType=a.name,H.value.paymentTypeNumber=a.value};n((()=>{(async()=>{const a=P.value.id;if(!a)return;const e=await L.getUserPaymentAccountById(a);console.log("获取付款账户成功",e),H.value.accountName=e.accountName,H.value.account=e.account,H.value.paymentType=e.type===x.BANK?K.BANK:e.type===x.WECHAT?K.WECHAT:K.ALIPAY,H.value.paymentTypeNumber=e.type,H.value.icon=e.icon,H.value.bankId=e.carBankInfoId,H.value.bankName=e.bankName,H.value.bankCode=e.carBankInfoId})()}));const H=e({accountName:"",bankName:"",bankCode:"",account:"",paymentType:K.BANK,icon:"",bankId:"",paymentTypeNumber:x.BANK});t((()=>{l("__select_bank_success__"),s("__select_bank_success__",(a=>{console.log("选择银行成功",a),H.value.bankName=a.bankName,H.value.bankCode=a.bankCode}))}));const V=async()=>{if(!(()=>{if(!H.value.accountName)return w({title:"请输入账户名称",icon:"none"}),!1;if(H.value.paymentTypeNumber===x.BANK&&!H.value.bankName)return w({title:"请选择银行",icon:"none"}),!1;if(console.log(H.value.account.length,"form.value.account"),H.value.account.length&&H.value.paymentTypeNumber===x.BANK&&!/^[0-9]{13,19}$/.test(H.value.account))return w({title:"请输入正确的银行卡号",icon:"none"}),!1;if(H.value.accountName.length>30)return w({title:"账户名称不超过30个字符",icon:"none"}),!1;const a=/^1[3-9]\d{9}$/,e=/^\w+(-+.\w+)*@\w+(-.\w+)*.\w+(-.\w+)*$/;return!(H.value.paymentTypeNumber===x.ALIPAY&&H.value.account&&!a.test(H.value.account)&&!e.test(H.value.account)&&(w({title:"请输入正确的支付宝账号",icon:"none"}),1))})())return;const a=new h;a.showLoading("提交中...");try{const a={type:H.value.paymentTypeNumber,account:H.value.account,accountName:H.value.accountName,icon:H.value.icon,carBankInfoId:H.value.bankId};H.value.paymentType===K.WECHAT&&(a.icon=E.WECHAT),H.value.paymentType===K.ALIPAY&&(a.icon=E.ALIPAY),H.value.paymentType!==K.BANK&&(a.carBankInfoId=""),P.value.id?(a.id=P.value.id,await L.updateUserPaymentAccount(a)):await L.addUserPaymentAccount(a),w({title:"添加成功",icon:"success"}),B("__add_payment_account_success__",{...a}),setTimeout((()=>C()),1e3)}catch(e){console.log("添加失败",e),w({title:e.message,icon:"none"})}finally{a.hideLoading()}};return t((()=>{l("__select_bank_success__"),s("__select_bank_success__",(a=>{console.log("选择银行成功",a),H.value.bankName=a.bankName,H.value.bankCode=a.bankCode,H.value.icon=a.bankIcon,H.value.bankId=a.bankId}))})),(a,e)=>{const n=y,t=b(f("up-icon"),A),l=b(f("up-action-sheet"),k),s=_,h=N;return I(),c(p,null,[u("div",null,[o(U,{title:m(P).id?"编辑付款账户":"添加付款账户"},null,8,["title"])]),u("div",{class:"container"},[u("div",{class:"form-content"},[u("div",{class:"form-item"},[u("div",{class:"label"},"账户类型"),u("div",{onClick:e[0]||(e[0]=a=>Y.value=!0),style:{display:"flex","align-items":"center","justify-content":"space-between"}},[o(n,null,{default:v((()=>[d(T(H.value.paymentType),1)])),_:1}),o(t,{name:"arrow-right"})])]),o(l,{show:Y.value,actions:[{name:m(K).BANK,value:m(x).BANK},{name:m(K).WECHAT,value:m(x).WECHAT},{name:m(K).ALIPAY,value:m(x).ALIPAY}],title:"请选择支付方式",onClose:e[1]||(e[1]=a=>Y.value=!1),onSelect:j},null,8,["show","actions"]),u("div",{class:"form-item"},[u("div",{class:"label"},[d("账户名称"),o(n,{class:"required"},{default:v((()=>[d("*")])),_:1})]),o(s,{class:"input",maxlength:"30",type:"text",modelValue:H.value.accountName,"onUpdate:modelValue":e[2]||(e[2]=a=>H.value.accountName=a),placeholder:"请输入"},null,8,["modelValue"])]),"银行卡"===H.value.paymentType?(I(),c("div",{key:0,class:"form-item"},[u("div",{class:"label"},[d("银行"),o(n,{class:"required"},{default:v((()=>[d("*")])),_:1})]),u("div",{class:"value",onClick:e[3]||(e[3]=e=>("toPage"in a?a.toPage:m(g))("./bank"))},[o(n,{class:r(H.value.bankName?"selected":"placeholder")},{default:v((()=>[d(T(H.value.bankName||"请选择"),1)])),_:1},8,["class"]),o(t,{name:"arrow-right"})])])):i("",!0),u("div",{class:"form-item"},[u("div",{class:"label"},"账号"),o(s,{class:"input",type:"text",maxlength:H.value.paymentTypeNumber===m(x).BANK?19:30,modelValue:H.value.account,"onUpdate:modelValue":e[4]||(e[4]=a=>H.value.account=a),placeholder:"请输入"},null,8,["maxlength","modelValue"])])]),u("div",{class:"bottom-btn"},[o(h,{class:"save-btn",onClick:V},{default:v((()=>[d("保存")])),_:1})])])],64)}}}),[["__scopeId","data-v-4aadfde0"]]);export{Y as default};
