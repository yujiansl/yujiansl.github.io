import{d as e,x as a,r as t,a9 as l,E as n,X as s,Y as u,B as i,C as r,c as o,w as m,Z as d,a2 as c,i as p,I as y,M as f,K as h,aq as _,N as v,o as g,a as k,y as P,g as T,h as I,t as N,u as A,f as M,P as C,O as L,R as b,n as E,b as R,F as O,e as x,aj as Y,W as j,a8 as S,Q as V,s as F,a1 as U,D as $,a0 as w,bG as B,_ as D}from"./index-CK4DGatK.js";import{_ as G}from"./camera.DDOxr1zP.js";import{_ as H}from"./card.DgxD9h_f.js";import{U as J}from"./UploadFile.BBuXxkzB.js";import{P as K}from"./purchase.B8DNaFGL.js";import{u as q}from"./useQuery.3dd8K18V.js";import{a as Q}from"./index.HDA2F_3Q.js";import{i as W}from"./isEmpty.ma15Dxmc.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";const X=D(e({__name:"addPayment",setup(e){const D=q(),X=a((()=>"retry"==D.value.editStatus)),Z=t({}),z=t("");let ee=l({paymentPrice:"",paymentType:"",paymentTypeName:"",imageList:[],paymentMethod:"1",paymentMethodName:"银行卡",isSelf:1,isSelfName:"",recipient:1,remark:""});const ae=t(!1),te=t(),le=t(),ne=t(""),se=t([{key:1,value:"是"},{key:0,value:"否"}]),ue=t([{key:1,value:"公司"},{key:2,value:"个人"}]),ie=t(),re=t(),oe=t(),me=t([]),de=a((()=>2!=+ee.paymentMethod&&2==+ee.recipient&&0==+ee.isSelf)),ce=a((()=>2!=+ee.paymentMethod&&"MORTGAGE_PAYMENT"==ee.paymentType&&2==+ee.recipient&&0==+ee.isSelf));n((()=>{s("refreshPhoto"),u("refreshPhoto",(()=>{he()}))})),i((async e=>{await r({scrollTop:0,duration:0});const a=JSON.parse(e.params||"{}");W(a)?await async function(){if(!D.value.oldPaymentId)return;d({title:"加载中",mask:!0});const e=await uni.$u.http.get(`/product/paymentOrder/paymentRecord/${D.value.oldPaymentId}`);Z.value=e.data||{},ee.paymentType=Z.value.paymentType,ee.paymentTypeName=Z.value.paymentTypeName,ee.isSelf=+Z.value.isSelf,ee.recipient=Z.value.recipient,ee.remark=Z.value.remark,ee.paymentMethod=+Z.value.paymentMethod,ee.paymentMethodName=Z.value.paymentMethodName,c()}():Z.value=a,z.value=`可申请${Z.value.unpaidPrice??""}元 在途${Z.value.paidingPrice??""}元`;const{id:t,paymentPrice:l,payee:n,bankCardNumber:s,openBank:u,purchaseId:i,isRestart:o}=Z.value;ee.purchaseId=i??t,ee.paymentPrice=l,ee.payee=n,ee.bankCardNumber=s,ee.openBank=u,o&&(ee=Object.assign(ee,Z.value),ee.purchaseId=t),Te(),he()}));const pe=t([]),ye=t([]),fe=t([]),he=()=>{uni.$u.http.get(`/product/carPricing/queryPurchaseImage/${ee.purchaseId}`).then((e=>{var a,t,l;const{violationPhotos:n,vehicleLicenseFrontPhoto:s,vehicleLicenseBackPhoto:u,registerCertificatePhotos:i,nameplatePhoto:r,idCardFrontPhoto:o,idCardBackPhoto:m,payAttachmentInfo:d,purchaseOther:c,repaymentList:p,maintenanceList:y,insuranceList:f,purchaseImageList:h,purchasseImageTagList:_,enterpriseBusinessLicenseImageList:v}=e.data,g=(e,a)=>{if(!e)return[];return(Array.isArray(e)?e:[e]).map((e=>({id:e.id,videoCover:e.videoCover,attachmentUrl:e.attachmentUrl,carAttachmentType:a,attachmentId:e.attachmentId})))};(null==(a=Z.value.attachmentList)?void 0:a.length)&&(pe.value=[...g(Z.value.attachmentList,"PRICING_PAYMENT_APPLY")]),(null==(t=Z.value.consignmentCollectionImageList)?void 0:t.length)&&(ye.value=[...g(Z.value.consignmentCollectionImageList,"PAYMENT_VOUCHER_APPLY")]),((null==(l=Z.value.settlementEepaymentImageList)?void 0:l.length)||p.length)&&(fe.value=p.length?[...g(p,"PURCHASE_REPAYMENT_APPLY")]:[...g(Z.value.settlementEepaymentImageList,"PURCHASE_REPAYMENT_APPLY")]),me.value=[...g(n,"VIOLATION"),...g(s,"VehicleLicense"),...g(u,"VehicleLicenseBack"),...g(i,"RegisterCertificate"),...g(r,"Nameplate"),...g(o,"ID_CARD_FRONT"),...g(m,"ID_CARD_BACK"),...g(d,"PRICING_PAYMENT_APPLY"),...g(c,"purchaseOther"),...g(p,"repayment"),...g(y,"maintenance"),...g(f,"insurance"),...g(v,"purchaseEnterpriseBusinessLicense"),{carAttachmentType:"carImage",imageList:[{tagName:"车辆照片",imageList:h},..._||[]]}]}))},_e=e=>{S("carAttachments",JSON.stringify(me.value)),V(`/pages/carManage/photoManage?type=${e}&detail=10&isPurchase=1&purchaseId=${ee.purchaseId}&itemType=${K["订单状态"]}`)},ve=a((()=>{var e,a,t,l;return(null==(l=null==(t=null==(a=null==(e=me.value)?void 0:e.filter((e=>["carImage"].includes(e.carAttachmentType)))[0])?void 0:a.imageList[0])?void 0:t.imageList[0])?void 0:l.attachmentUrl)||""})),ge=a((()=>{var e,a;return(null==(a=null==(e=me.value)?void 0:e.filter((e=>["RegisterCertificate"].includes(e.carAttachmentType)))[0])?void 0:a.attachmentUrl)||""})),ke=a((()=>{var e,a;return(null==(a=null==(e=me.value)?void 0:e.filter((e=>["ID_CARD_FRONT","ID_CARD_BACK"].includes(e.carAttachmentType)))[0])?void 0:a.attachmentUrl)||""})),Pe=a((()=>"paymentType"==ne.value?"款项":"paymentMethod"==ne.value?"付款方式":"")),Te=()=>{uni.$u.http.get("/admin/dict/type/purchase_payment_method").then((e=>{le.value=e.data.map((e=>({name:e.label,key:e.value})))}))},Ie=e=>{if("paymentType"===e)te.value=[{name:"定金",key:"EARNEST_MONEY"},{name:"中期款",key:"INTERIM_PAYMENT"},{name:"尾款",key:"BALANCE_PAYMENT"},{name:"全款",key:"FULL_PAYMENT"},{name:"首付款",key:"DOWN_PAYMENT"},{name:"按揭款",key:"MORTGAGE_PAYMENT"},{name:"其他",key:"OTHER"}];else if("paymentMethod"===e){if(1==ee.recipient)return;te.value=le.value}ne.value=e,ae.value=!0},Ne=()=>{U()},Ae=()=>{var e,a,t,l,n,s,u,i,r;const o=(()=>{const{paymentPrice:e,paymentType:a,payee:t,bankCardNumber:l,openBank:n,paymentMethod:s}=ee;if(!e)return"请填写申请付款金额";if(!a)return"请选择款项";if(!s)return"请选择付款方式";if(1==+s){if(!t)return"请输入户名";if(!l)return"请输入账号";if(!n)return"请输入银行"}return parseFloat(e)<=0?"申请付款金额需大于0":parseFloat(e)>Z.value.unpaidPrice?"超过可申请金额":""})();if(o)return void(new $).showToast(o);const m=(null==(t=null==(a=null==(e=ie.value)?void 0:e.getFileFields())?void 0:a.all)?void 0:t.map((e=>e.attachmentId)))||[],d=(null==(s=null==(n=null==(l=oe.value)?void 0:l.getFileFields())?void 0:n.all)?void 0:s.map((e=>e.attachmentId)))||[],c=(null==(r=null==(i=null==(u=re.value)?void 0:u.getFileFields())?void 0:i.all)?void 0:r.map((e=>e.attachmentId)))||[];!de.value||(null==d?void 0:d.length)?!ce.value||(null==c?void 0:c.length)?((new $).showLoading("提交中"),uni.$u.http.post("product/carPricingFlowable/createPayment",{...ee,imageList:m,settlementEepaymentImageList:ce.value?c:[],consignmentCollectionImageList:de.value?d:[],oldPaymentRecordId:X.value?D.value.oldPaymentId:void 0}).then((e=>{(new $).showToast("添加成功"),setTimeout((()=>{var a;B(`/pages/purchaseOrder/replyDetail?purchaseId=${ee.purchaseId}&paymentId=${null==(a=e.data)?void 0:a.paymentId}`)}),500)}))):w({title:"请上传还款结清证明",icon:"none"}):w({title:"请上传委托收款证明",icon:"none"})};return(e,a)=>{const t=I,l=p,n=C,s=b,u=y(h("up-icon"),f),i=Y,r=j,d=y(h("up-action-sheet"),_),c=v("amountUpper");return g(),o(l,{class:"page f-c-s"},{default:m((()=>[k(l,{class:"content"},{default:m((()=>[k(l,{class:"statis"},{default:m((()=>[k(l,null,{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T(N(A(Z).purchasePrice),1)])),_:1}),T("万")])),_:1}),k(l,null,{default:m((()=>[T("采购金额")])),_:1})])),_:1}),k(l,null,{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T(N(A(Z).paidPrice),1)])),_:1}),T("元")])),_:1}),k(l,null,{default:m((()=>[T("已付金额")])),_:1})])),_:1})])),_:1}),k(l,{class:"photo-box"},{default:m((()=>[k(l,{class:"title"},{default:m((()=>[T("照片资料")])),_:1}),k(l,{class:"photo-item"},{default:m((()=>[k(l,{onClick:a[0]||(a[0]=e=>_e(0)),style:M(`background-image:url(${A(ve)})`)},{default:m((()=>[k(n,{src:G}),k(t,null,{default:m((()=>[T("车辆照片")])),_:1})])),_:1},8,["style"]),k(l,{onClick:a[1]||(a[1]=e=>_e(1)),style:M(`background-image:url(${A(ge)})`)},{default:m((()=>[k(n,{src:H}),k(t,null,{default:m((()=>[T("车辆登记证")])),_:1})])),_:1},8,["style"]),k(l,{onClick:a[2]||(a[2]=e=>_e(1)),style:M(`background-image:url(${A(ke)})`)},{default:m((()=>[k(n,{src:H}),k(t,null,{default:m((()=>[T("车主身份证")])),_:1})])),_:1},8,["style"])])),_:1})])),_:1}),k(l,{class:"form-box"},{default:m((()=>[L((g(),o(l,{class:"form-item"},{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("申请付款金额")])),_:1}),k(s,{modelValue:A(ee).paymentPrice,"onUpdate:modelValue":a[3]||(a[3]=e=>A(ee).paymentPrice=e),type:"digit",placeholder:A(z),onInput:a[4]||(a[4]=e=>{return a=e.detail.value,t="paymentPrice",l="yuanFloat",void F((()=>{ee[t]=Q(a,l)}));var a,t,l})},null,8,["modelValue","placeholder"]),T(" 元 ")])),_:1})),[[c,"yuanFloat"]]),k(l,{class:"form-item"},{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("款项")])),_:1}),k(l,{class:"f-b-c",onClick:a[5]||(a[5]=e=>Ie("paymentType"))},{default:m((()=>[k(t,{class:E({placeholder:!A(ee).paymentType})},{default:m((()=>[T(N(A(ee).paymentTypeName||"请选择"),1)])),_:1},8,["class"]),k(u,{name:"arrow-right"})])),_:1})])),_:1}),k(l,{class:"form-item"},{default:m((()=>[k(l,null,{default:m((()=>[T("收款对象")])),_:1}),k(l,{class:"f-b-c"},{default:m((()=>[k(l,{class:"tab-box"},{default:m((()=>[(g(!0),R(O,null,x(A(ue),((e,a)=>(g(),o(t,{key:a,class:E({active:A(ee).recipient==e.key}),onClick:a=>(e=>{if(ee.recipient=e.key,1==e.key){ee.paymentMethod="1";const e=le.value.find((e=>"1"===e.key));ee.paymentMethodName=e?e.name:""}})(e)},{default:m((()=>[T(N(e.value),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1}),k(l,{class:"form-item"},{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("付款方式")])),_:1}),k(l,{class:"f-b-c",onClick:a[6]||(a[6]=e=>Ie("paymentMethod"))},{default:m((()=>[k(t,{class:E({placeholder:!A(ee).paymentMethod})},{default:m((()=>[T(N(A(ee).paymentMethodName||"请选择"),1)])),_:1},8,["class"]),1!=A(ee).recipient?(g(),o(u,{key:0,name:"arrow-right"})):P("",!0)])),_:1})])),_:1}),"2"!=A(ee).paymentMethod?(g(),o(l,{key:0,class:"form-item"},{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("是否本人")])),_:1}),k(l,{class:"tab-box"},{default:m((()=>[(g(!0),R(O,null,x(A(se),((e,a)=>(g(),o(t,{key:a,class:E({active:A(ee).isSelf==e.key}),onClick:a=>A(ee).isSelf=e.key},{default:m((()=>[T(N(e.value),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})):P("",!0),k(l,{class:"form-textarea"},{default:m((()=>[k(l,{class:"area-title remark"},{default:m((()=>[T("备注")])),_:1}),k(i,{modelValue:A(ee).remark,"onUpdate:modelValue":a[7]||(a[7]=e=>A(ee).remark=e),placeholder:"请输入",maxlength:"1000",class:"remark-text"},null,8,["modelValue"]),k(l,{class:"limit"},{default:m((()=>{var e;return[T(N((null==(e=A(ee).remark)?void 0:e.length)||0)+"/1000",1)]})),_:1})])),_:1}),k(l,{class:"form-item img-boxs"},{default:m((()=>[k(l,{class:"name"},{default:m((()=>[T("附件")])),_:1}),k(l,{class:"val"},{default:m((()=>[k(J,{ref_key:"imageRef",ref:ie,carAttachmentType:"PRICING_PAYMENT_APPLY",accept:"all","max-count":9,"upload-list":A(pe)},null,8,["upload-list"])])),_:1})])),_:1}),A(de)?(g(),o(l,{key:1,class:"form-item img-boxs"},{default:m((()=>[k(l,{class:"name"},{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("委托收款证明")])),_:1}),k(l,{class:"val"},{default:m((()=>[k(J,{ref_key:"receiveRef",ref:oe,carAttachmentType:"purchaseOther",accept:"all","max-count":9,"upload-list":A(ye)},null,8,["upload-list"])])),_:1})])),_:1})):P("",!0),A(ce)?(g(),o(l,{key:2,class:"form-item img-boxs"},{default:m((()=>[k(l,{class:"name"},{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("还款结清证明")])),_:1}),k(l,{class:"val"},{default:m((()=>[k(J,{ref_key:"replyRef",ref:re,carAttachmentType:"OTHER_PHOTOS",accept:"all","max-count":9,uploadList:A(fe)},null,8,["uploadList"])])),_:1})])),_:1})):P("",!0)])),_:1}),"1"==A(ee).paymentMethod?(g(),o(l,{key:0,class:"section-title"},{default:m((()=>[T("收款人")])),_:1})):P("",!0),"1"==A(ee).paymentMethod?(g(),o(l,{key:1,class:"form-box"},{default:m((()=>[k(l,{class:"form-item"},{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("户名")])),_:1}),k(s,{modelValue:A(ee).payee,"onUpdate:modelValue":a[8]||(a[8]=e=>A(ee).payee=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),k(l,{class:"form-item"},{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("账号")])),_:1}),k(s,{type:"number",modelValue:A(ee).bankCardNumber,"onUpdate:modelValue":a[9]||(a[9]=e=>A(ee).bankCardNumber=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),k(l,{class:"form-item"},{default:m((()=>[k(l,null,{default:m((()=>[k(t,null,{default:m((()=>[T("*")])),_:1}),T("银行")])),_:1}),k(s,{modelValue:A(ee).openBank,"onUpdate:modelValue":a[10]||(a[10]=e=>A(ee).openBank=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})])),_:1})):P("",!0)])),_:1}),k(l,{class:"bottom-btn"},{default:m((()=>[k(r,{onClick:Ne},{default:m((()=>[T("取消")])),_:1}),k(r,{class:"save-btn",onClick:a[11]||(a[11]=e=>Ae())},{default:m((()=>[T("确定")])),_:1})])),_:1}),k(d,{show:A(ae),onClose:a[12]||(a[12]=e=>ae.value=!1),actions:A(te),description:A(Pe),cancelText:"取消",onSelect:a[13]||(a[13]=e=>((e,a)=>{"paymentType"===a?(ee.paymentType=e.key,ee.paymentTypeName=e.name):"paymentMethod"===a?(ee.paymentMethod=e.key,ee.paymentMethodName=e.name):"isSelf"===a&&(ee.isSelf=e.key,ee.isSelfName=e.name)})(e,A(ne)))},null,8,["show","actions","description"])])),_:1})}}}),[["__scopeId","data-v-458d1c9d"]]);export{X as default};
