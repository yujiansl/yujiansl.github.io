import{g as e}from"./time._VqwKl0d.js";import{d as a,A as t,r as l,E as r,Z as o,a2 as s,$ as u,c as n,w as d,i as m,o as i,y as f,a as c,b as p,u as g,g as y,t as _,h as v,R as k,aj as C,F as A,e as I,P as T,W as h,s as N,a0 as S,a1 as b,D as j,an as F,_ as U}from"./index-CK4DGatK.js";import{_ as x}from"./avatar.Buy0-vr1.js";import{N as E}from"./NavBar.DSs5OGCU.js";import{a as R,L as D}from"./state.B277O7ET.js";import{R as V}from"./refuse.BEcO0WCW.js";import{u as w}from"./useQuery.3dd8K18V.js";import{a as G}from"./index.HDA2F_3Q.js";import"./car_default.CyENNAub.js";import"./close.Dhgi5Ijg.js";const L=U(a({__name:"mortgageDetail",setup(a){const U=w(),L=t(),M=l(),P=l(!1),K=l({}),O=l({mortgageAmount:"",mortgageCompany:"",remark:""});r((async()=>{o({title:"加载中",mask:!0});try{!async function(){var e,a;if(!U.value.orderCarCustomerId)return;const t={orderCarCustomerId:U.value.orderCarCustomerId,orderPaymentRelationsId:U.value.primaryKey||null},l=await u().post("/product//mortgagePayment/detail",t,{});P.value=0===(null==(e=null==l?void 0:l.data)?void 0:e.mortgageStatus)&&"0"===(null==(a=U.value)?void 0:a.audit),K.value=null==l?void 0:l.data,async function(){const e=await u().get(`/product//mortgagePayment/track/${U.value.orderCarCustomerId}`);$.value=(null==e?void 0:e.data)??[]}()}()}finally{s()}}));const $=l([]);const q=()=>{var e;return O.value.mortgageAmount?O.value.mortgageCompany?(o({title:"提交中",mask:!0}),void uni.$u.http.post("/product/mortgagePayment/initiateMortgage",{...O.value,orderCarCustomerId:null==(e=K.value)?void 0:e.orderCarCustomerId}).then((()=>{S({title:"操作成功",icon:"none"}),b(),s()}))):S({title:"请输入贷款公司",icon:"none"}):S({title:"请输入贷款金额",icon:"none"})},B=(e,a="")=>{(new j).showLoading("提交中");const t={taskId:U.value.taskId,taskDefinitionKey:U.value.taskDefinitionKey,primaryKey:U.value.primaryKey,orderPaymentId:U.value.orderPaymentId,orderCustomerId:U.value.orderCustomerId};""!==e&&(t.auditOpinion=e),a&&(t.comment=a),uni.$u.http.post("/product/mortgageCarSalesAudit/taskTurnover",t).then((()=>{F()}))};return(a,t)=>{const l=m,r=v,o=k,s=C,u=T,S=h;return i(),n(l,{class:"page f-c-s"},{default:d((()=>{var m;return[g(L).needShowQw()?f("",!0):(i(),n(E,{key:0},{title:d((()=>[c(l,{class:"head-drop f-r-a f-r-c"},{default:d((()=>{var e;return[y(_(+g(U).audit?"按揭审核":g(R)[null==(e=g(U))?void 0:e.mortgageStatus]),1)]})),_:1})])),_:1})),c(l,{class:"header"},{default:d((()=>[c(D,{item:g(K),page:"detail",mortgageStatusMap:g(R),query:g(U)},null,8,["item","mortgageStatusMap","query"]),1===g(K).mortgageStatus&&"0"==g(U).audit?(i(),n(l,{key:0,class:"tips"},{default:d((()=>{var e,a;return[y(" 待（"+_(null==(a=null==(e=g($))?void 0:e.find((e=>!e.operateTime&&"MORTGAGE_FINANCIAL_AUDIT_DEFAULT"===e.operationType)))?void 0:a.createUserName)+"）审核 ",1)]})),_:1})):f("",!0)])),_:1}),c(l,{class:"title"},{default:d((()=>[y("放款信息")])),_:1}),c(l,{class:"bgFff"},{default:d((()=>[c(l,{class:"form-item"},{default:d((()=>[c(l,null,{default:d((()=>[c(r,null,{default:d((()=>[y("*")])),_:1}),y("贷款金额")])),_:1}),g(P)?(i(),n(o,{key:0,modelValue:g(O).mortgageAmount,"onUpdate:modelValue":t[0]||(t[0]=e=>g(O).mortgageAmount=e),type:"number",placeholder:"请输入贷款金额",maxlength:"7",onInput:t[1]||(t[1]=e=>{return a=e.detail.value,t="mortgageAmount",l="yuan",void N((()=>{O.value[t]=G(a,l)}));var a,t,l})},null,8,["modelValue"])):f("",!0),g(P)?(i(),n(r,{key:1},{default:d((()=>[y("元")])),_:1})):(i(),n(l,{key:2},{default:d((()=>{var e;return[y(_((null==(e=g(K))?void 0:e.mortgageAmount)??"--")+"元",1)]})),_:1}))])),_:1}),c(l,{class:"form-item"},{default:d((()=>[c(l,null,{default:d((()=>[c(r,null,{default:d((()=>[y("*")])),_:1}),y("贷款公司")])),_:1}),g(P)?(i(),n(o,{key:0,modelValue:g(O).mortgageCompany,"onUpdate:modelValue":t[2]||(t[2]=e=>g(O).mortgageCompany=e),type:"text",placeholder:"请输入贷款公司"},null,8,["modelValue"])):(i(),n(l,{key:1},{default:d((()=>{var e;return[y(_((null==(e=g(K))?void 0:e.mortgageCompany)??"--"),1)]})),_:1}))])),_:1}),c(l,{class:"form-textarea",style:{display:"flex"}},{default:d((()=>[c(l,{class:"area-title",style:{marginRight:"30rpx"}},{default:d((()=>[y("备注")])),_:1}),g(P)?(i(),n(s,{key:0,modelValue:g(O).remark,"onUpdate:modelValue":t[3]||(t[3]=e=>g(O).remark=e),placeholder:"请输入",maxlength:"1000"},null,8,["modelValue"])):f("",!0),g(P)?(i(),n(l,{key:1,class:"limit"},{default:d((()=>[y(_(g(O).remark.length||0)+"/1000",1)])),_:1})):(i(),n(l,{key:2,style:{flex:"1"}},{default:d((()=>{var e;return[y(_((null==(e=g(K))?void 0:e.remark)??"--"),1)]})),_:1}))])),_:1})])),_:1}),(null==(m=g($))?void 0:m.length)?(i(),p(A,{key:1},[c(l,{class:"title"},{default:d((()=>[y("审核流程")])),_:1}),c(l,{class:"flow bgFff"},{default:d((()=>[(i(!0),p(A,null,I(g($),((t,o)=>(i(),p(A,{key:o},[c(l,{class:"personnel"},{default:d((()=>[c(l,null,{default:d((()=>[t.avatar?(i(),n(u,{key:0,src:t.avatar,mode:"scaleToFill"},null,8,["src"])):(i(),n(u,{key:1,src:x,mode:"aspectFill"})),c(l,null,{default:d((()=>[c(l,{class:"mb10"},{default:d((()=>[y(_(t.content),1)])),_:2},1024),c(l,{class:"personnel-name"},{default:d((()=>[y(_(t.createUserName)+" ",1),"MORTGAGE_FINANCIAL_AUDIT_PAS"===t.operationType?(i(),n(r,{key:0,class:"green"},{default:d((()=>[y("(已同意)")])),_:1})):f("",!0),"MORTGAGE_FINANCIAL_AUDIT_REFUSE"===t.operationType?(i(),n(r,{key:1,class:"red"},{default:d((()=>[y("(已拒绝)")])),_:1})):f("",!0),"MORTGAGE_FINANCIAL_AUDIT_CANCEL"===t.operationType?(i(),n(r,{key:2,style:{color:"rgb(153, 153, 153)"}},{default:d((()=>[y("(订单取消)")])),_:1})):f("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),c(l,{class:"personnel-name"},{default:d((()=>[y(_(("getTimeBySplitSecond"in a?a.getTimeBySplitSecond:g(e))(t.operateTime)),1)])),_:2},1024)])),_:2},1024),o!==g($).length-1?(i(),n(l,{key:0,class:"steps"},{default:d((()=>[c(l)])),_:1})):f("",!0)],64)))),128))])),_:1})],64)):f("",!0),g(P)?(i(),n(l,{key:2,class:"bottom-btn"},{default:d((()=>[c(S,{class:"save-btn",onClick:q},{default:d((()=>[y("提交")])),_:1})])),_:1})):f("",!0),0==g(U).status&&"1"==g(U).audit?(i(),n(l,{key:3,class:"bottom-btn"},{default:d((()=>[c(S,{onClick:t[4]||(t[4]=e=>g(M).open())},{default:d((()=>[y("拒绝")])),_:1}),c(S,{class:"save-btn",onClick:t[5]||(t[5]=e=>B(1))},{default:d((()=>[y("同意")])),_:1})])),_:1})):f("",!0),c(V,{ref_key:"refuseRef",ref:M,onConfirm:t[6]||(t[6]=e=>B(0,e))},null,512)]})),_:1})}}}),[["__scopeId","data-v-408ad057"]]);export{L as default};
