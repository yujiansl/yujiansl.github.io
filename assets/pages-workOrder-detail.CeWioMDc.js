import{d as a,r as e,B as l,G as t,E as u,Z as s,a2 as r,c as d,w as n,i as o,I as i,M as c,K as f,ah as p,N as _,o as m,a as v,y as g,u as h,Q as P,g as y,t as k,h as j,b as w,F as C,e as N,O,P as B,a1 as E,D as b,_ as T}from"./index-CK4DGatK.js";import{N as $}from"./NavBar.DSs5OGCU.js";import{D as x}from"./listItem.CnogksUc.js";import{U as D}from"./UploadFile.BBuXxkzB.js";import{u as M}from"./useQuery.3dd8K18V.js";import"./index.HDA2F_3Q.js";import"./avatar.Buy0-vr1.js";import"./car_default.CyENNAub.js";import"./refuse.BEcO0WCW.js";import"./close.Dhgi5Ijg.js";import"./task.Cx6XxNwo.js";import"./isNil.aV-w2MPu.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const S=T(a({__name:"detail",setup(a){const T=M(),S=e({}),I=e({}),L=e(!1),U=e([]);l((()=>{U.value=JSON.parse(t("userBtnPermission"))})),u((()=>{A()}));const A=()=>{s({title:"加载中"}),uni.$u.http.get("product/carProductPrepare/workOrderDetails",{params:{prepareId:T.value.id}}).then((a=>{S.value=a.data;const{coverUrl:e}=a.data.carProductBasic;S.value.carProductBasic={...a.data.carProductBasic,photoUrl:e},I.value=a.data.carProductPrepares[0],r()}))},R=a=>{switch(a){case"noPayment":return"待付款";case"paymentSuccess":return"付款成功";case"cancel":return"取消";default:return""}},Q=()=>{E()},F=()=>{(new b).showLoading("提交中"),uni.$u.http.delete(`/product/carProductPrepare?id=${T.value.id}`).then((()=>{(new b).showToast("删除成功"),L.value=!1,E()}))};return(a,e)=>{const l=i(f("u-icon"),c),t=o,u=j,s=B,r=i(f("u-modal"),p),E=_("permissionBtn");return m(),d(t,{class:"page"},{default:n((()=>[v($,null,{left:n((()=>[v(t,{class:"nav-left"},{default:n((()=>[v(l,{name:"arrow-left",color:"#000",size:"18",bold:"",onClick:Q}),y(k(R(h(I).paymentStatus)),1)])),_:1})])),right:n((()=>[v(t,{class:"nav-right",onClick:e[0]||(e[0]=e=>("toPage"in a?a.toPage:h(P))(`/pages/workOrder/trackList?id=${h(T).id}`))},{default:n((()=>[y("轨迹")])),_:1})])),_:1}),v(t,{class:"content"},{default:n((()=>[v(x,{item:h(S).carProductBasic,isDetail:!0,isWorkOrder:!0},null,8,["item"]),v(t,{class:"module"},{default:n((()=>[v(t,{class:"title"},{default:n((()=>[y("整备信息")])),_:1}),v(t,{class:"list"},{default:n((()=>[v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("整备专员")])),_:1}),v(u,null,{default:n((()=>[y(k(h(I).prepareUserName||"-"),1)])),_:1})])),_:1}),v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("修理厂")])),_:1}),v(u,null,{default:n((()=>[y(k(h(I).factoryName||"-"),1)])),_:1})])),_:1}),v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("整备时间")])),_:1}),v(u,null,{default:n((()=>{var a,e;return[y(k(null==(a=h(I).prepareStartTime)?void 0:a.replace(/-/g,"/"))+"-"+k(null==(e=h(I).prepareEndTime)?void 0:e.replace(/-/g,"/")),1)]})),_:1})])),_:1}),v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("付款方式")])),_:1}),v(u,null,{default:n((()=>[y(k("CORPORATE_PAYMENT"==h(I).paymentMethods?"公司付款":"EMPLOYEE_ADVANCE"==h(I).paymentMethods?"员工垫付":"-"),1)])),_:1})])),_:1}),v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("收款账户")])),_:1}),h(I).accountName?(m(),d(t,{key:0,class:"account"},{default:n((()=>[v(t,null,{default:n((()=>[y(k(h(I).accountName),1)])),_:1}),v(t,null,{default:n((()=>[y(k(h(I).account),1)])),_:1}),v(t,null,{default:n((()=>[y(k(h(I).accountTypeName),1),v(u,null,{default:n((()=>[y(k(h(I).bank),1)])),_:1})])),_:1})])),_:1})):(m(),d(u,{key:1},{default:n((()=>[y("-")])),_:1}))])),_:1}),v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("创建时间")])),_:1}),v(u,null,{default:n((()=>[y(k(h(I).createTime||"-"),1)])),_:1})])),_:1})])),_:1})])),_:1}),v(t,{class:"module"},{default:n((()=>[v(t,{class:"title"},{default:n((()=>[y("整备明细")])),_:1}),v(t,{class:"list"},{default:n((()=>[v(t,{class:"align-c"},{default:n((()=>[v(u,null,{default:n((()=>[y("总额")])),_:1}),v(u,{class:"price p-large"},{default:n((()=>[y("￥"+k(h(I).amount||0)+"元",1)])),_:1}),y("（共"),v(u,{class:"price"},{default:n((()=>{var a;return[y(k((null==(a=h(S).prepareRelations)?void 0:a.length)||0),1)]})),_:1}),y("笔）")])),_:1})])),_:1}),(m(!0),w(C,null,N(h(S).prepareRelations,((a,e)=>(m(),d(t,{class:"list bg-list",key:e},{default:n((()=>[v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("整备项")])),_:1}),v(u,null,{default:n((()=>[y(k(a.prepareName),1)])),_:2},1024)])),_:2},1024),v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("金额")])),_:1}),v(u,{class:"price"},{default:n((()=>[y("￥"+k(a.amount||0),1)])),_:2},1024)])),_:2},1024),v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("说明")])),_:1}),v(u,null,{default:n((()=>[y(k(a.description||"-"),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),v(t,{class:"module"},{default:n((()=>[v(t,{class:"title"},{default:n((()=>[y("补充信息")])),_:1}),v(t,{class:"list photo-item"},{default:n((()=>[v(t,null,{default:n((()=>{var a;return[v(u,null,{default:n((()=>[y("照片凭证")])),_:1}),(null==(a=h(S).attachments)?void 0:a.length)?(m(),d(D,{key:0,accept:"all","max-count":99,uploadList:h(S).attachments,detail:1},null,8,["uploadList"])):(m(),d(u,{key:1},{default:n((()=>[y("-")])),_:1}))]})),_:1}),v(t,null,{default:n((()=>[v(u,null,{default:n((()=>[y("补充说明")])),_:1}),v(u,null,{default:n((()=>[y(k(h(I).description||"-"),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),h(I).id&&"paymentSuccess"!=h(I).paymentStatus&&(h(U).includes("product:readyCondition:remove")||h(U).includes("product:readyCondition:edit"))?(m(),d(t,{key:0,class:"bottom-btn"},{default:n((()=>[O((m(),d(t,{onClick:e[1]||(e[1]=a=>L.value=!0)},{default:n((()=>[v(s,{src:"./static/workOrder/delete.png"}),v(t,null,{default:n((()=>[y("删除")])),_:1})])),_:1})),[[E,["product:readyCondition:remove"]]]),O((m(),d(t,{onClick:e[2]||(e[2]=e=>("toPage"in a?a.toPage:h(P))(`/pages/workOrder/addOrder?carProductId=${h(S).carProductBasic.id}&id=${h(I).id}`))},{default:n((()=>[v(s,{src:"./static/workOrder/edit2.png"}),v(t,null,{default:n((()=>[y("编辑")])),_:1})])),_:1})),[[E,["product:readyCondition:edit"]]])])),_:1})):g("",!0),v(r,{show:h(L),showCancelButton:!0,width:"500rpx",title:"提示",content:"确定执行删除操作？",confirmColor:"#ff5719",onCancel:e[3]||(e[3]=a=>L.value=!1),onConfirm:F},null,8,["show"])])),_:1})}}}),[["__scopeId","data-v-aeec9cd9"]]);export{S as default};
