import{d as e,A as a,r as t,a9 as l,x as s,E as r,X as u,Y as i,B as o,D as n,a2 as c,a3 as d,a4 as m,c as f,w as p,i as _,I as y,M as g,K as h,aP as v,aQ as k,o as w,y as T,a as x,u as P,Q as b,g as A,t as I,h as N,S as D,n as j,k as L,P as C,b as S,F as U,aj as M,z as E,e as $,W as R,an as F,_ as K}from"./index-CK4DGatK.js";import{N as Y}from"./NavBar.DSs5OGCU.js";import{L as O}from"./listItem.De6Dqo0z.js";import{U as B}from"./UploadFile.BBuXxkzB.js";import{M as Q}from"./moreImage.BBFgcmqk.js";import{U as V}from"./paymentEnum.CeG4C_uX.js";import{u as z}from"./useQuery.3dd8K18V.js";import{p as G}from"./index.HDA2F_3Q.js";import"./time._VqwKl0d.js";import"./car_default.CyENNAub.js";import"./purchase.B8DNaFGL.js";import"./fixPrice.CFXyKkhm.js";import"./base.6l0JEBJr.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const H=K(e({__name:"paymentAudit",setup(e){const K=z(),H=a(),W=t({}),X=t(),Z=t(""),q=l({drawee:"",draweeAccount:"",draweeAccountIcon:"",draweeType:0}),J=s((()=>{if("个人"!=W.value.enterpriseName)return{text:W.value.enterpriseName,canEdit:!1,isPlaceholder:!1};if(q.drawee){const e=q.drawee;let a="";return q.draweeType===V.BANK&&(a=`(${q.draweeAccount.slice(-4)})`),{isPlaceholder:!1,text:e+" "+a,canEdit:!1}}return{isPlaceholder:!0,text:1==K.value.status?"-":"请选择",canEdit:!0}}));r((()=>{u("__select_account_success__"),i("__select_account_success__",(e=>{console.log("选择付款账户成功",e),q.drawee=e.accountName,q.draweeAccount=e.account,q.draweeAccountIcon=e.icon||"",q.draweeType=e.type,W.value.draweeAccount=e.account}))}));const ee=s((()=>{var e;return(null==(e=W.value.carAttachmentInfo)?void 0:e.filter((e=>"PRICING_PAYMENT_APPLY"==e.carAttachmentType)))||[]})),ae=s((()=>{var e;return(null==(e=W.value.carAttachmentInfo)?void 0:e.filter((e=>"PAYMENT_VOUCHER_APPLY"==e.carAttachmentType)))||[]})),te=s((()=>{var e;return(null==(e=W.value.carAttachmentInfo)?void 0:e.filter((e=>"PURCHASE_REPAYMENT_APPLY"==e.carAttachmentType)))||[]})),le=s((()=>{var e;return(null==(e=W.value.enterpriseBusinessLicenseImageList)?void 0:e.map((e=>({attachmentUrl:e}))))||[]})),se=t([]);o((()=>{ue(),re()}));const re=()=>{uni.$u.http.post(`/product/purchase/paymentTrack/${K.value.primaryKey}`).then((e=>{se.value=e.data||[]}))},ue=()=>{(new n).showLoading("加载中"),uni.$u.http.get(`/product/purchaseOrder/${K.value.purchaseId}`,{params:{paymentRecordId:K.value.primaryKey}}).then((e=>{W.value={...e.data,photos:e.data.photos.map((e=>({attachmentUrl:e})))},q.drawee=e.data.drawee,q.draweeAccount=e.data.draweeAccount,q.draweeAccountIcon=e.data.draweeAccountIcon||"",q.draweeType=e.data.draweeType;const{registerCertificatePhotos:a,voucherPhotos:t,idCardFrontPhoto:l,idCardBackPhoto:s,imageList:r,imageTagList:u}=e.data,i=e=>{if(!e)return[];return(null==e?void 0:e.map((e=>({attachmentUrl:e}))))||[]};W.value.voucherPhotos=i(t),W.value.registerCertificatePhotos=i(a),W.value.idCardImageList=[],l&&W.value.idCardImageList.push({attachmentUrl:l}),s&&W.value.idCardImageList.push({attachmentUrl:s}),W.value.carImageList=i(r||[]),W.value.carImageTagList=u||[],c()}))},ie=e=>{var a,t;const l=(null==(t=null==(a=X.value)?void 0:a.getFileFields())?void 0:t.all.map((e=>e.id)))||[];if(0==e&&!Z.value)return void(new n).showToast("请填写备注");if(1==e&&"个人"==W.value.enterpriseName&&!q.drawee)return void(new n).showToast("请选择付款账户");if(1==e&&!l.length)return void(new n).showToast("请上传付款凭证");(new n).showLoading("提交中");const s={taskId:K.value.taskId,taskDefinitionKey:K.value.taskDefinitionKey,primaryKey:K.value.primaryKey,auditOpinion:e,voucherPhotos:l,comment:Z.value};uni.$u.http.post("/product/carPricingFlowable/paymentTaskTurnover",{...s,...q}).then((()=>{F("app"==K.value.pushType?"/pages/pending/paymentAudit":"")})).catch((e=>{G(e.message)})).finally((()=>{c()}))};return d((()=>{m("fixImageList")})),(e,a)=>{const t=_,l=N,s=y(h("up-icon"),g),r=C,u=M,i=y(h("up-steps-item"),v),o=y(h("up-steps"),k),n=R;return w(),f(t,{class:"page pend-page"},{default:p((()=>[P(H).needShowQw()?T("",!0):(w(),f(Y,{key:0,title:"付款审核"})),x(t,{class:"content"},{default:p((()=>[x(t,{class:"pend-head-info"},{default:p((()=>[x(O,{item:P(W),isDetail:!0,itemType:"audit"},null,8,["item"]),x(t,{class:"to-link",onClick:a[0]||(a[0]=a=>("toPage"in e?e.toPage:P(b))(`/pages/purchaseOrder/purchaseDetail?id=${P(W).pricingId}&purchaseId=${P(W).id}&token=${P(H).qwToken}`))},{default:p((()=>[A("查看采购单>")])),_:1})])),_:1}),x(t,{class:"wrap-photo-box"},{default:p((()=>[x(t,{class:"wrap-photo-box-inner"},{default:p((()=>[x(t,{class:"form-box"},{default:p((()=>[x(t,{class:"form-item"},{default:p((()=>[x(t,{class:"title"},{default:p((()=>[A("车辆照片")])),_:1}),x(Q,{imageData:P(W).carImageList,imageTagData:P(W).carImageTagList,tagName:"车辆照片",showTab:!1},null,8,["imageData","imageTagData"])])),_:1})])),_:1}),x(t,{class:"form-box"},{default:p((()=>[x(t,{class:"form-item"},{default:p((()=>[x(t,{class:"title"},{default:p((()=>[A("车辆登记证")])),_:1}),x(Q,{imageData:P(W).registerCertificatePhotos,tagName:"车辆登记证",showTab:!1},null,8,["imageData"])])),_:1})])),_:1}),x(t,{class:"form-box"},{default:p((()=>[x(t,{class:"form-item"},{default:p((()=>[x(t,{class:"title"},{default:p((()=>[A("车主身份证")])),_:1}),x(Q,{imageData:P(W).idCardImageList,tagName:"车主身份证",showTab:!1},null,8,["imageData"])])),_:1})])),_:1}),P(W).customerType&&"enterprise"==P(W).customerType?(w(),f(t,{key:0,class:"form-box"},{default:p((()=>[x(t,{class:"form-item"},{default:p((()=>[x(t,{class:"title"},{default:p((()=>[A("营业执照")])),_:1}),x(Q,{imageData:P(le),tagName:"营业执照",showTab:!1},null,8,["imageData"])])),_:1})])),_:1})):T("",!0),x(t,{class:"form-box"},{default:p((()=>["Offline"==P(W).signMethod?(w(),f(t,{key:0,class:"form-item"},{default:p((()=>[x(t,{class:"title"},{default:p((()=>[A("合同照片")])),_:1}),x(Q,{imageData:P(W).photos,tagName:"合同照片",showTab:!1},null,8,["imageData"])])),_:1})):(w(),f(t,{key:1,class:"form-item"},{default:p((()=>[x(t,{class:"title"},{default:p((()=>[A("采购合同")])),_:1}),x(t,null,{default:p((()=>[A(I(P(W).templateName||"-"),1),P(W).templateId?(w(),f(l,{key:0,class:"preview",onClick:a[1]||(a[1]=D((a=>("toPage"in e?e.toPage:P(b))(`/pages/carManage/pdf?url=${P(W).previewUrl}`)),["stop"]))},{default:p((()=>[A("预览")])),_:1})):T("",!0)])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1}),x(t,{class:"item-box"},{default:p((()=>[x(t,{class:"item-box-inner"},{default:p((()=>[x(t,{class:"section-title"},{default:p((()=>[A("付款单信息")])),_:1}),x(t,{class:"form-box"},{default:p((()=>[x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("申请付款金额")])),_:1}),A(" "+I(P(W).paymentRecordPrice||0)+"元 ",1)])),_:1}),x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("款项")])),_:1}),A(" "+I(P(W).paymentTypeName||"-"),1)])),_:1}),x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("收款对象")])),_:1}),A(" "+I(1==P(W).recipient?"公司":2==P(W).recipient?"个人":"-"),1)])),_:1}),x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("付款方式")])),_:1}),A(" "+I(P(W).purchaserPaymentMethodName||"-"),1)])),_:1}),2!=P(W).purchaserPaymentMethod?(w(),f(t,{key:0,class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("是否本人")])),_:1}),A(" "+I(1==P(W).isSelf?"是":"否"),1)])),_:1})):T("",!0),x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("备注")])),_:1}),A(" "+I(P(W).purchaseApplyRemark||"-"),1)])),_:1}),x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("附件")])),_:1}),x(t,{class:"fujian"},{default:p((()=>[P(ee).length?(w(),f(Q,{key:0,imageData:P(ee),tagName:"附件",showTab:!1},null,8,["imageData"])):(w(),f(t,{key:1,style:{"text-align":"right"}},{default:p((()=>[A("-")])),_:1}))])),_:1})])),_:1}),2==P(W).recipient&&0==P(W).isSelf?(w(),f(t,{key:1,class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("委托收款证明")])),_:1}),x(t,{class:"fujian"},{default:p((()=>[P(ae).length?(w(),f(Q,{key:0,imageData:P(ae),tagName:"委托收款证明",showTab:!1},null,8,["imageData"])):(w(),f(t,{key:1,style:{"text-align":"right"}},{default:p((()=>[A("-")])),_:1}))])),_:1})])),_:1})):T("",!0),"MORTGAGE_PAYMENT"==P(W).paymentType&&2==P(W).recipient&&0==P(W).isSelf?(w(),f(t,{key:2,class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("还款结清证明")])),_:1}),x(t,{class:"fujian"},{default:p((()=>[P(te).length?(w(),f(Q,{key:0,imageData:P(te),tagName:"还款结清证明",showTab:!1},null,8,["imageData"])):(w(),f(t,{key:1,style:{"text-align":"right"}},{default:p((()=>[A("-")])),_:1}))])),_:1})])),_:1})):T("",!0)])),_:1})])),_:1})])),_:1}),1==P(W).purchaserPaymentMethod?(w(),f(t,{key:0,class:"item-box"},{default:p((()=>[x(t,{class:"item-box-inner"},{default:p((()=>[x(t,{class:"section-title"},{default:p((()=>[A("银行卡信息")])),_:1}),x(t,{class:"form-box"},{default:p((()=>[x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("户名")])),_:1}),A(" "+I(P(W).payee||"-"),1)])),_:1}),x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("银行卡号")])),_:1}),A(" "+I(P(W).bankCardNumber||"-"),1)])),_:1}),x(t,{class:"form-item"},{default:p((()=>[x(t,null,{default:p((()=>[A("银行")])),_:1}),A(" "+I(P(W).openBank||"-"),1)])),_:1})])),_:1})])),_:1})])),_:1})):T("",!0),x(t,{class:"item-box"},{default:p((()=>[x(t,{class:"item-box-inner"},{default:p((()=>[x(t,{class:"section-title"},{default:p((()=>[A("审核信息")])),_:1}),x(t,{class:j(["form-box",{write:0==P(K).status}])},{default:p((()=>[L("div",{class:"form-item input-complete"},[x(t,null,{default:p((()=>[A("合同主体")])),_:1}),x(t,null,{default:p((()=>[A(I(P(W).enterpriseName||"-"),1)])),_:1})]),x(t,{class:"form-item",onClick:a[2]||(a[2]=()=>"个人"===P(W).enterpriseName&&0==P(K).status&&("toPage"in e?e.toPage:P(b))("/pages/paymentManager/index"))},{default:p((()=>[x(t,null,{default:p((()=>[0==P(K).status&&"个人"==P(W).enterpriseName?(w(),f(l,{key:0,style:{color:"#ff4723"}},{default:p((()=>[A("*")])),_:1})):T("",!0),A("付款账户")])),_:1}),x(t,{style:{display:"flex","align-items":"center",gap:"10rpx"},class:j({placeholder:P(J).isPlaceholder})},{default:p((()=>[P(q).draweeAccountIcon?(w(),f(s,{key:0,name:P(q).draweeAccountIcon,size:"20"},null,8,["name"])):T("",!0),A(" "+I(P(J).text),1)])),_:1},8,["class"]),"个人"===P(W).enterpriseName&&0==P(K).status?(w(),f(s,{key:0,name:"arrow-right"})):T("",!0)])),_:1}),x(t,{class:"form-item",style:{"align-items":"flex-start"}},{default:p((()=>{var e;return[x(t,null,{default:p((()=>[0==P(K).status?(w(),f(l,{key:0,style:{color:"#ff4723"}},{default:p((()=>[A("*")])),_:1})):T("",!0),A("付款凭证")])),_:1}),0==P(K).status?(w(),f(B,{key:0,class:"fkpz",ref_key:"uploadRef",ref:X,accept:"all","max-count":99,uploadList:P(W).voucherPhotos,detail:P(K).status},null,8,["uploadList","detail"])):0!=P(K).status&&(null==(e=P(W).voucherPhotos)?void 0:e.length)?(w(),f(t,{key:1,class:"fujian"},{default:p((()=>[x(Q,{imageData:P(W).voucherPhotos,tagName:"付款凭证",showTab:!1,style:{height:"80rpx"}},null,8,["imageData"])])),_:1})):(w(),f(r,{key:2,src:"./static/index/carImage_default.png",mode:"widthFix"}))]})),_:1}),x(t,{class:"form-textarea"},{default:p((()=>[x(t,{class:"area-title"},{default:p((()=>[A("备注")])),_:1}),1==P(K).status?(w(),f(t,{key:0,class:"word-warp"},{default:p((()=>[A(I(P(W).comment||"-"),1)])),_:1})):(w(),S(U,{key:1},[x(u,{modelValue:P(Z),"onUpdate:modelValue":a[3]||(a[3]=e=>E(Z)?Z.value=e:null),placeholder:"请输入",maxlength:"1000"},null,8,["modelValue"]),x(t,{class:"limit"},{default:p((()=>{var e;return[A(I((null==(e=P(Z))?void 0:e.length)||0)+"/1000",1)]})),_:1})],64))])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),x(t,{class:"item-box"},{default:p((()=>[x(t,{class:"item-box-inner"},{default:p((()=>[x(t,{class:"section-title"},{default:p((()=>[A("审核流程")])),_:1}),x(t,{class:"tracks"},{default:p((()=>[P(se).length>0?(w(),f(o,{key:0,class:"steps",activeColor:"#4177ff",direction:"column",current:P(se).length-1,dot:""},{default:p((()=>[(w(!0),S(U,null,$(P(se),((e,a)=>(w(),f(i,{key:a,class:j({"is-flex-col-center":!e.operateUser})},{icon:p((()=>{var a;return[x(r,{class:"avatar",src:(null==(a=null==e?void 0:e.operateUser)?void 0:a.avatar)||"/static/mine/avatar.png",mode:"scaleToFill"},null,8,["src"])]})),desc:p((()=>[x(t,{class:"descs"},{default:p((()=>{var a;return[x(t,{class:"d-title"},{default:p((()=>[x(l,null,{default:p((()=>[A(I(1==+e.operateType?"发起人":"revocation"===e.paymentStatus?"撤销审核":"财务审核"),1)])),_:2},1024),"cancel"===e.paymentStatus&&2==+e.operateType?(w(),f(l,{key:0,class:"cancel"},{default:p((()=>[A("已拒绝")])),_:1})):T("",!0),"paymentSuccess"!=e.paymentStatus&&"paymentAll"!=e.paymentStatus||2!=+e.operateType?T("",!0):(w(),f(l,{key:1,class:"agree"},{default:p((()=>[A("同意")])),_:1}))])),_:2},1024),"cancel"!=e.paymentStatus&&"paymentSuccess"!=e.paymentStatus&&"paymentAll"!=e.paymentStatus||2!=+e.operateType?T("",!0):(w(),f(t,{key:0,class:"comment"},{default:p((()=>["cancel"==e.paymentStatus?(w(),f(l,{key:0},{default:p((()=>[A("拒绝原因：")])),_:1})):T("",!0),A(I(e.comment||"-"),1)])),_:2},1024)),(null==(a=e.operateUser)?void 0:a.userId)?(w(),f(t,{key:1},{default:p((()=>[x(l,{class:"username"},{default:p((()=>[A(I(e.operateUser.name),1)])),_:2},1024),e.operateTime?(w(),f(l,{key:0},{default:p((()=>[A(I(e.operateTime),1)])),_:2},1024)):T("",!0)])),_:2},1024)):(w(),f(t,{key:2,style:{"min-height":"20px"}}))]})),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1},8,["current"])):(w(),f(t,{key:1,class:"no-content"},{default:p((()=>[x(t,null,{default:p((()=>[A("暂无数据")])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1})])),_:1}),1!=P(K).status?(w(),f(t,{key:1,class:"bottom-btn"},{default:p((()=>[x(n,{onClick:a[4]||(a[4]=e=>ie(0))},{default:p((()=>[A("拒绝")])),_:1}),x(n,{class:"save-btn",onClick:a[5]||(a[5]=e=>ie(1))},{default:p((()=>[A("同意")])),_:1})])),_:1})):T("",!0)])),_:1})}}}),[["__scopeId","data-v-9244a345"]]);export{H as default};
