import{d as a,A as e,r as t,B as l,D as s,a2 as r,c as u,w as o,i as d,o as n,y as i,a as c,u as m,g as p,t as f,h as _,S as h,n as v,b as y,F as g,aj as A,z as T,W as w,an as k,Q as N,_ as j}from"./index-CK4DGatK.js";import{N as O}from"./NavBar.DSs5OGCU.js";import{D}from"./detailItem.D7jJ4BsD.js";import{U as E}from"./UploadFile.BBuXxkzB.js";import{u as I}from"./useQuery.3dd8K18V.js";import{p as M}from"./index.HDA2F_3Q.js";import"./car_default.CyENNAub.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const C=j(a({__name:"receiptAudit",setup(a){const j=I(),C=e(),L=t({}),x=t(),P=t("");l((()=>{R()}));const R=()=>{(new s).showLoading("加载中"),uni.$u.http.get(`/product/orderPayment/getRelations/${j.value.orderId}`,{params:{}}).then((a=>{var e,t,l;const s=a.data,{carBrandName:u,carSeriesName:o,carModelName:d}=s;L.value={...s,orderCarDetailDTO:{...s,carModelName:`${(null==o?void 0:o.indexOf(u))<0?u:""} ${o} ${d}`},orderCarCustomerDetailDTO:s,orderCarCustomerDTO:s,recordAttachment:(null==(e=s.attachmentList)?void 0:e.filter((a=>"RECEIPT_RECORDS"==a.carAttachmentType)))||[],auditAttachment:(null==(t=s.attachmentList)?void 0:t.filter((a=>"FINANCIAL_AUDIT"==a.carAttachmentType)))||[]},L.value.attachments=null==(l=s.attachments)?void 0:l.map((a=>({attachmentUrl:a}))),r()}))},b=a=>{switch(a){case"EARNEST_MONEY":return"定金";case"INTERIM_PAYMENT":return"中期款";case"BALANCE_PAYMENT":return"尾款";case"FULL_PAYMENT":return"全款";case"DOWN_PAYMENT":return"首付款";case"MORTGAGE_PAYMENT":return"按揭款";case"OTHER":return"其他";default:return"-"}},S=t(null),$=a=>{var e,t;S.value=a;const l=(null==(t=null==(e=x.value)?void 0:e.getFileFields())?void 0:t.all.map((a=>a.id)))||[];if(1==a&&!l.length)return void(new s).showToast("请上传收款凭证");if(0==a&&!P.value)return void(new s).showToast("请填写备注");(new s).showLoading("提交中");const r={taskId:j.value.taskId,primaryKey:j.value.primaryKey,orderPaymentId:j.value.orderId,taskDefinitionKey:j.value.taskDefinitionKey,auditOpinion:a,attachments:l,comment:P.value};uni.$u.http.post("/product/carSalesAudit/taskTurnover",r).then((()=>{k()})).catch((a=>{M(a.message)}))};return(a,e)=>{const t=d,l=_,s=A,r=w;return n(),u(t,{class:"page pend-page"},{default:o((()=>[m(C).needShowQw()?i("",!0):(n(),u(O,{key:0,title:"详情"})),c(t,{class:"content"},{default:o((()=>[c(D,{detailObj:m(L),isSell:1,isToPage:!0},null,8,["detailObj"]),c(t,{class:"form-box"},{default:o((()=>[1==m(L).wayOfSigning?(n(),u(t,{key:0,class:"form-item"},{default:o((()=>[c(t,null,{default:o((()=>[p("合同照片")])),_:1}),c(E,{accept:"all",uploadList:m(L).contractAnnex,detail:1},null,8,["uploadList"])])),_:1})):i("",!0),0==m(L).wayOfSigning?(n(),u(t,{key:1,class:"form-item"},{default:o((()=>[c(t,null,{default:o((()=>[p("合同模板")])),_:1}),c(t,null,{default:o((()=>[p(f(m(L).templateName||"-"),1),c(l,{class:"preview",onClick:e[0]||(e[0]=h((a=>(a=>{if(a)N(`/pages/carManage/pdf?url=${a}`);else{const a={carProductId:L.value.orderCarDetailVO.carProductId,...L.value.orderCarDetailVO};uni.$u.http.post("/product/sign/sale/preview",a).then((a=>{N(`/pages/carManage/pdf?url=${a.data}`)}))}})(m(L).previewUrl)),["stop"]))},{default:o((()=>[p("预览>")])),_:1})])),_:1})])),_:1})):i("",!0),c(t,{class:"form-item"},{default:o((()=>[c(t,null,{default:o((()=>[p("收款金额")])),_:1}),p(" "+f(m(L).amount||0)+"元 ",1)])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,null,{default:o((()=>[p("款项")])),_:1}),p(" "+f(b(m(L).paymentType)),1)])),_:1}),c(t,{class:"form-item"},{default:o((()=>[c(t,null,{default:o((()=>[p("收款方式")])),_:1}),p(" "+f(1==m(L).payMethod?"银行卡":2==m(L).payMethod?"优惠券":"现金"),1)])),_:1}),c(t,{class:"form-item photo-item"},{default:o((()=>{var a;return[c(t,null,{default:o((()=>[p("附件")])),_:1}),(null==(a=m(L).recordAttachment)?void 0:a.length)?(n(),u(E,{key:0,accept:"all","max-count":99,uploadList:m(L).recordAttachment,detail:1},null,8,["uploadList"])):(n(),u(t,{key:1},{default:o((()=>[p("-")])),_:1}))]})),_:1})])),_:1}),c(t,{class:v(["form-box",{write:0==m(j).status}])},{default:o((()=>[c(t,{class:"form-item photo-item"},{default:o((()=>[c(t,null,{default:o((()=>[1==m(S)?(n(),u(l,{key:0},{default:o((()=>[p("*")])),_:1})):i("",!0),p("收款凭证")])),_:1}),c(E,{ref_key:"uploadRef",ref:x,accept:"all","max-count":99,uploadList:m(L).auditAttachment,detail:m(j).status},null,8,["uploadList","detail"])])),_:1}),c(t,{class:"form-textarea"},{default:o((()=>[c(t,{class:"area-title"},{default:o((()=>[0==m(S)?(n(),u(l,{key:0},{default:o((()=>[p("*")])),_:1})):i("",!0),p("备注")])),_:1}),1==m(j).status?(n(),u(t,{key:0,class:"word-warp"},{default:o((()=>[p(f(m(L).auditReason||"-"),1)])),_:1})):(n(),y(g,{key:1},[c(s,{modelValue:m(P),"onUpdate:modelValue":e[1]||(e[1]=a=>T(P)?P.value=a:null),placeholder:"请输入",maxlength:"1000"},null,8,["modelValue"]),c(t,{class:"limit"},{default:o((()=>{var a;return[p(f((null==(a=m(P))?void 0:a.length)||0)+"/1000",1)]})),_:1})],64))])),_:1})])),_:1},8,["class"])])),_:1}),1!=m(j).status?(n(),u(t,{key:1,class:"bottom-btn"},{default:o((()=>[c(r,{onClick:e[2]||(e[2]=a=>$(0))},{default:o((()=>[p("拒绝")])),_:1}),c(r,{class:"save-btn",onClick:e[3]||(e[3]=a=>$(1))},{default:o((()=>[p("同意")])),_:1})])),_:1})):i("",!0)])),_:1})}}}),[["__scopeId","data-v-290e81cc"]]);export{C as default};
