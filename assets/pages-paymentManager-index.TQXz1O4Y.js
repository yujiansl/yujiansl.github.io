import{d as e,r as a,p as s,q as t,E as l,X as n,Y as o,b as u,k as i,a as c,F as d,e as r,w as p,u as v,D as m,I as y,bO as g,W as f,b9 as b,K as _,aq as h,M as A,o as k,n as x,y as C,g as N,t as P,i as j,bP as w,h as E,Q as O,ar as U,bz as I,_ as L}from"./index-CK4DGatK.js";import{U as T}from"./userPayment.DBrV-EDF.js";import{U as W}from"./paymentEnum.CeG4C_uX.js";import{u as H}from"./useQuery.3dd8K18V.js";import{d as K}from"./debounce.BkVTat1y.js";import"./isObject.C8HfsiHw.js";import"./isSymbol.Bym6OQCA.js";const Y=L(e({__name:"index",setup(e){const L=a(""),Y=a(!1),B=a(0),S=a(""),$=a(),q=H(),M=a(!1),V=a([{name:"编辑",value:"edit",id:0},{name:"删除",value:"delete",id:0}]),z=async e=>{if(console.log("选择",e),M.value=!1,"edit"===e.value)O(`/pages/paymentManager/save?id=${e.id}`);else if("delete"===e.value)try{await T.deleteUserPaymentAccount(e.id),uni.$u.toast("删除成功"),J()}catch(a){uni.$u.toast(a.message)}},J=async()=>{const e=new m;e.showLoading("加载中...");try{T.getUserPaymentAccounts({type:W.BANK,accountName:L.value}).then((e=>{G(W.BANK,e)})),T.getUserPaymentAccounts({type:W.WECHAT,accountName:L.value}).then((e=>{G(W.WECHAT,e)})),T.getUserPaymentAccounts({type:W.ALIPAY,accountName:L.value}).then((e=>{G(W.ALIPAY,e)}))}finally{e.hideLoading()}},Q=K(J,500);s((()=>{Y.value||(console.log("搜索事件",L.value),F.value.map((e=>{e.payments=[]})),Q())}),{flush:"post"});const D=e=>{$.value=e.detail.value},F=a([{name:"微信",key:"wechat",type:W.WECHAT,payments:[]},{name:"支付宝",key:"alipay",type:W.ALIPAY,payments:[]},{name:"银行卡",key:"bank",type:W.BANK,payments:[]}]),X=a(JSON.parse(JSON.stringify(F.value[0].payments)));t((()=>{var e,a;console.log("query",q.value),(null==(e=q.value)?void 0:e.accountName)&&(L.value=null==(a=q.value)?void 0:a.accountName,J())}));const G=(e,a)=>{const s=F.value.find((a=>a.type===e));console.log("更新tabs",s,a),s&&(s.payments=a)};l((()=>{n("__add_payment_account_success__"),o("__add_payment_account_success__",(e=>{console.log("添加账户成功",e),Y.value=!0,setTimeout((()=>{const a=F.value.find((a=>a.type===e.type));B.value=e.type===W.BANK?2:e.type===W.WECHAT?0:1,a&&(a.payments=[],a.payments.push(e)),Y.value=!1}),100)})),J()}));const R=()=>{$.value?(U("__select_account_success__",v($)),I()):uni.$u.toast("请选择付款账户")},Z=e=>{B.value=e;(e=>{B.value=e.index,X.value=e.payments,S.value=""})({index:e,...F.value[e]})};return(e,a)=>{const s=y(_("up-search"),b),t=y(_("up-action-sheet"),h),l=j,n=w,o=y(_("up-icon"),A),m=E,U=g,I=f;return k(),u("div",null,[i("div",{class:"search-wrapper"},[c(s,{placeholder:"请输入账户名称",shape:"circle",modelValue:L.value,"onUpdate:modelValue":a[0]||(a[0]=e=>L.value=e),showAction:!1,"border-color":"rgb(230, 230, 230)","bg-color":"#fff"},null,8,["modelValue"])]),i("div",{class:"custom-tabs"},[i("div",{class:"tabs-header"},[(k(!0),u(d,null,r(F.value,((e,a)=>{var s;return k(),u("div",{key:e.key,class:x(["tab-item",{active:B.value===a}]),onClick:e=>Z(a)},[i("div",{class:"tab-content"},[N(P(e.name)+" ",1),(null==(s=e.payments)?void 0:s.length)?(k(),u("div",{key:0,class:"tab-badge"},P(e.payments.length),1)):C("",!0)]),B.value===a?(k(),u("div",{key:0,class:"tab-line"})):C("",!0)],10,["onClick"])})),128))])]),c(t,{actions:V.value,title:"设置",show:M.value,round:24,closeOnClickAction:!0,closeOnClickOverlay:!0,onClose:a[1]||(a[1]=e=>M.value=!1),onSelect:z},null,8,["actions","show"]),i("div",{style:{padding:"20rpx"}},[c(U,{onChange:D},{default:p((()=>[i("div",null,"共"+P(F.value[B.value].payments.length)+"个付款的账户",1),(k(!0),u(d,null,r(F.value[B.value].payments,(e=>{var a;return k(),u("div",{style:{padding:"20rpx","border-radius":"20rpx","background-color":"#fff",margin:"20rpx 0",position:"relative"},key:e.id},[i("div",{style:{position:"absolute",right:"24rpx",top:"24rpx"}},[c(l,{class:"setting-btn",onClick:a=>(e=>{V.value.forEach((a=>{a.id=e.id})),M.value=!0})(e)},{default:p((()=>[N("设置")])),_:2},1032,["onClick"])]),i("div",{style:{display:"grid","grid-template-columns":"1fr 6fr 1fr"}},[i("div",{style:{display:"flex","align-items":"center","justify-content":"center"}},[c(n,{value:e,checked:(null==(a=$.value)?void 0:a.id)===e.id},null,8,["value","checked"])]),i("div",{class:"payment-item-box"},[i("div",null,P(e.accountName),1),i("div",{class:"tips-color"},P(e.account),1),i("div",{class:"tips-color",style:{display:"flex","align-items":"center",gap:"20rpx"}},[c(o,{name:e.icon,size:"20"},null,8,["name"]),c(m,null,{default:p((()=>[N(P(e.type===v(W).WECHAT?"微信":e.type===v(W).ALIPAY?"支付宝":e.bankName),1)])),_:2},1024)])])])])})),128))])),_:1})]),i("div",{style:{height:"100rpx"}}),i("div",{class:"bottom-btn",style:{display:"grid","grid-template-columns":"1fr 2fr",gap:"10rpx"}},[c(I,{onClick:a[2]||(a[2]=a=>("toPage"in e?e.toPage:v(O))("./save")),style:{color:"#303133"}},{default:p((()=>[N("添加账户")])),_:1}),c(I,{class:"save-btn",onClick:R},{default:p((()=>[N("确定选择")])),_:1})])])}}}),[["__scopeId","data-v-fe835fb4"]]);export{Y as default};
