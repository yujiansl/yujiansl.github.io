import{a_ as a,aV as e,aW as s,Z as t,U as i,a0 as o,a1 as r,A as n,_ as c,b as l,a as d,w as m,F as u,i as p,P as g,aF as h,o as I,c as w,y,aM as k,e as f,aN as v,a$ as C,b0 as b,u as _,b1 as x,S as L}from"./index-CK4DGatK.js";import{P as N}from"./PreviewManyCard.CWPi57V4.js";import{_ as S}from"./download.4Hvs8F6H.js";import"./avatar.hGMRw2TZ.js";import"./isNil.aV-w2MPu.js";const q={components:{PreviewManyCard:N},data:()=>({type:"",imageList:[],markImg:"",currentIndex:0,qrCodeData:"",scaleRate:1}),onLoad(a){this.type=a.type,this.markImg=a.markImg,this.currentIndex=Number(a.index)||0,this.qrCodeData=a.qrCodeData,this.imageList=JSON.parse(a.imageList).map((a=>({...a})))},computed:{...a(n,{userInfo:a=>a.userInfo})},methods:{onLoadImage(a){this.imageList[a].loaded=!0},changeSwiper(a){this.currentIndex=a.detail.current,this.imageList[a.detail.current].loaded||(this.imageList[a.detail.current].loaded=!0)},toBack(){r()},async download(){t({title:"下载中",mask:!0});try{const a=this.imageList[this.currentIndex];let e="";e="qrCode"===a.imgType||"矩形"!==this.type&&!this.markImg?a.url:await this.getObsUrl();await i.download({url:e,fileName:"车源图片.jpg"})&&o({title:"下载成功",icon:"success"})}catch(a){console.error(a),o({title:"下载失败",icon:"error"})}},async getObsUrl(){const a=document.getElementById(`bigView-${this.currentIndex}`),t=await e(a,"coverItem.png");return(await s(t)).attachmentUrl},moveScale(a){this.scaleRate=a.detail.scale},onTouchMove(a){this.scaleRate>1.5&&(a.stopPropagation(),a.preventDefault())}}};const M=c(q,[["render",function(a,e,s,t,i,o){const r=h("preview-many-card"),n=b,c=C,N=v,q=k,M=g,P=p;return I(),l(u,null,[d(P,{class:"play-box",onClick:o.toBack},{default:m((()=>[d(q,{class:"swiper",current:i.currentIndex,id:"swiper",onChange:o.changeSwiper},{default:m((()=>[(I(!0),l(u,null,f(i.imageList,((e,s)=>(I(),w(N,{key:s,class:"swiper-item",onTouchmove:o.onTouchMove},{default:m((()=>[d(c,{class:"movable-area"},{default:m((()=>[d(n,{direction:"all","scale-value":"1","scale-min":"1","scale-max":"3",scale:!0,class:"movable-view",onScale:o.moveScale},{default:m((()=>[d(r,{id:`bigView-${s}`,mainType:i.type,"image-data":e,"user-info":a.userInfo,"cur-mark-img":i.markImg,"qr-code-data":i.qrCodeData},null,8,["id","mainType","image-data","user-info","cur-mark-img","qr-code-data"])])),_:2},1032,["onScale"])])),_:2},1024)])),_:2},1032,["onTouchmove"])))),128))])),_:1},8,["current","onChange"]),("isMP_WEIXIN"in a?a.isMP_WEIXIN:_(x))?y("",!0):(I(),w(M,{key:0,src:"./static/mine/close.png",class:"close",onClick:e[0]||(e[0]=L((a=>o.toBack()),["stop"]))}))])),_:1},8,["onClick"]),d(M,{src:S,class:"download",onClick:o.download},null,8,["onClick"])],64)}],["__scopeId","data-v-b5708975"]]);export{M as default};
