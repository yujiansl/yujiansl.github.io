import{d as e,A as a,r as t,B as l,D as s,a2 as r,x as i,a3 as n,a4 as c,c as u,w as o,i as m,I as d,am as p,K as f,aP as h,aQ as _,o as y,y as v,a as g,u as k,g as A,f as L,P as I,h as N,t as C,au as T,b as D,F as P,e as b,W as j,a8 as x,Q as O,bG as U,an as S,_ as w}from"./index-CK4DGatK.js";import{_ as B}from"./camera.DDOxr1zP.js";import{_ as $}from"./card.DgxD9h_f.js";import{_ as F}from"./photo.s3UpHRXl.js";import{N as K}from"./NavBar.DSs5OGCU.js";import{L as R}from"./listItem.De6Dqo0z.js";import{T as M}from"./task.Cx6XxNwo.js";import{u as V}from"./useQuery.3dd8K18V.js";import{p as E}from"./index.HDA2F_3Q.js";import{i as Y}from"./isNil.aV-w2MPu.js";import"./time._VqwKl0d.js";import"./car_default.CyENNAub.js";import"./purchase.B8DNaFGL.js";import"./fixPrice.CFXyKkhm.js";import"./base.6l0JEBJr.js";const Q=w(e({__name:"carEntry",setup(e){const w=V(),Q=a(),q=t([]),z=t([{name:"详情"},{name:"审批记录"}]),G=t({});l((()=>{J(),X()}));const J=()=>{(new s).showLoading("加载中"),uni.$u.http.get(`/product/purchaseOrder/${w.value.purchaseId}`,{params:{}}).then((e=>{G.value=e.data;const{violationPhotos:a,vehicleLicenseFrontPhoto:t,vehicleLicenseBackPhoto:l,registerCertificatePhotos:s,nameplatePhoto:i,idCardFrontPhoto:n,idCardBackPhoto:c,carAttachmentInfo:u,purchaseOther:o,repaymentList:m,maintenanceList:d,insuranceList:p,imageList:f,imageTagList:h,enterpriseBusinessLicenseImageList:_}=e.data,y=(e,a)=>{if(!e)return[];return"string"==typeof e?[{attachmentUrl:e,carAttachmentType:a}]:(null==e?void 0:e.map((e=>({attachmentUrl:e,carAttachmentType:a}))))||[]},v=(null==u?void 0:u.map((e=>({attachmentUrl:e.attachmentUrl,carAttachmentType:"PRICING_PAYMENT_APPLY"}))))||[],g=f.length||h.length?{carAttachmentType:"carImage",imageList:[{tagName:"车辆照片",imageList:(null==f?void 0:f.map((e=>({attachmentUrl:e}))))||[]},...h]}:{carAttachmentType:"carImage",imageList:[{tagName:"车辆照片",imageList:[]}]};G.value.carAttachments=[g,...y(a,"VIOLATION"),...y(t,"VehicleLicense"),...y(l,"VehicleLicenseBack"),...y(s,"RegisterCertificate"),...y(i,"Nameplate"),...y(n,"ID_CARD_FRONT"),...y(c,"ID_CARD_BACK"),...v,...((e,a)=>{if(!e)return[];return(null==e?void 0:e.map((e=>({attachmentUrl:e.attachmentUrl,carAttachmentType:a,videoCover:e.videoCover}))))||[]})(o,"purchaseOther"),...y(m,"repayment"),...y(d,"maintenance"),...y(p,"insurance"),...y(_,"purchaseEnterpriseBusinessLicense")],r()}))},W=t(0),Z=e=>{W.value=e.index},X=()=>{uni.$u.http.get("/product/carPricingFlowable/queryTrack",{params:{id:w.value.primaryKey||w.value.id}}).then((e=>{q.value=e.data}))},H=i((()=>{var e,a,t;const l=(null==(a=null==(e=G.value.carAttachments)?void 0:e.filter((e=>["carImage"].includes(e.carAttachmentType)))[0])?void 0:a.imageList)||[];let s=[];return l.forEach((e=>{s=s.concat(e.imageList||[])})),(null==(t=s[0])?void 0:t.attachmentUrl)||""})),ee=i((()=>{var e,a;return(null==(a=null==(e=G.value.carAttachments)?void 0:e.filter((e=>["VehicleLicense","VehicleLicenseBack","RegisterCertificate","Nameplate","ID_CARD_FRONT","ID_CARD_BACK"].includes(e.carAttachmentType)))[0])?void 0:a.attachmentUrl)||""})),ae=i((()=>{var e;const a=null==(e=G.value.carAttachments)?void 0:e.filter((e=>["maintenance","insurance","repayment","VIOLATION","purchaseOther"].includes(e.carAttachmentType)))[0];return(null==a?void 0:a.videoCover)||(null==a?void 0:a.attachmentUrl)||""})),te=e=>{console.log(123213,G.value.carAttachments),x("carAttachments",JSON.stringify(G.value.carAttachments)),O(`/pages/carManage/photoManage?type=${e}&detail=1&isPurchase=1`)},le=()=>{(new s).showLoading("提交中");const e={taskId:w.value.taskId,taskDefinitionKey:M["发起入库"],primaryKey:w.value.primaryKey,auditOpinion:1};uni.$u.http.post("/product/carPricingFlowable/taskTurnover",e).then((()=>{"qw"==w.value.pushType||"app"==w.value.pushType?U(`/pages/pending/carEntry?primaryKey=${w.value.primaryKey}&purchaseId=${w.value.purchaseId}&type=completeStock`):S()})).catch((e=>{E(e.message)}))};return n((()=>{c("fixImageList")})),(e,a)=>{const t=d(f("up-tabs"),p),l=m,s=I,r=N,i=d(f("up-steps-item"),h),n=d(f("up-steps"),_),c=j;return y(),u(l,{class:"page pend-page"},{default:o((()=>[k(Q).needShowQw()?v("",!0):(y(),u(K,{key:0,title:"详情"})),g(l,{class:"content"},{default:o((()=>[g(R,{item:k(G),isDetail:!0,itemType:"3"},null,8,["item"]),k(w).purchaseId?(y(),u(t,{key:0,list:k(z),lineColor:"#DD4F33",activeStyle:{color:"#20283D",fontSize:"32rpx"},inactiveStyle:{color:"#999",fontSize:"32rpx"},onClick:Z,scrollable:!1},null,8,["list"])):v("",!0),0==k(W)?(y(),u(l,{key:1,class:"details-info"},{default:o((()=>[g(l,{class:"photo-box"},{default:o((()=>[g(l,{class:"title"},{default:o((()=>[A("照片资料")])),_:1}),g(l,{class:"photo-item"},{default:o((()=>[g(l,{onClick:a[0]||(a[0]=e=>te(0)),style:L(`background-image:url(${k(H)})`)},{default:o((()=>[g(s,{src:B}),g(r,null,{default:o((()=>[A("车辆照片")])),_:1})])),_:1},8,["style"]),g(l,{onClick:a[1]||(a[1]=e=>te(1)),style:L(`background-image:url(${k(ee)})`)},{default:o((()=>[g(s,{src:$}),g(r,null,{default:o((()=>[A("证件照片")])),_:1})])),_:1},8,["style"]),g(l,{onClick:a[2]||(a[2]=e=>te(2)),style:L(`background-image:url(${k(ae)})`)},{default:o((()=>[g(s,{src:F}),g(r,null,{default:o((()=>[A("其他照片")])),_:1})])),_:1},8,["style"])])),_:1})])),_:1}),g(l,{class:"form-box"},{default:o((()=>[g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("车辆款型")])),_:1}),g(l,null,{default:o((()=>[g(r,null,{default:o((()=>[A(C(k(G).carBrandName),1)])),_:1}),A(C(k(G).carSeriesName)+C(k(G).carModelName),1)])),_:1})])),_:1}),g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("VIN码")])),_:1}),A(" "+C(k(G).vinNo),1)])),_:1}),g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("车牌号")])),_:1}),A(" "+C(k(G).plateNo||"-"),1)])),_:1}),g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("发动机号")])),_:1}),A(" "+C(k(G).engine||"-"),1)])),_:1}),g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("钥匙数量")])),_:1}),A(" "+C(k(Y)(k(G).keyNum)?"-":`${k(G).keyNum}把`),1)])),_:1}),g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("出厂日期")])),_:1}),A(" "+C(k(G).factoryDataStr||"-"),1)])),_:1}),g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("首次上牌")])),_:1}),A(" "+C(k(G).uetoDateStr?k(T)(k(G).uetoDateStr).format("YYYY-MM"):"-"),1)])),_:1}),g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("车身颜色")])),_:1}),A(" "+C(k(G).bodyColor||"-"),1)])),_:1}),g(l,{class:"form-item"},{default:o((()=>[g(l,null,{default:o((()=>[A("真实公里")])),_:1}),A(" "+C(k(G).mileage||0)+"万公里 ",1)])),_:1}),g(l,{class:"form-textarea"},{default:o((()=>[g(l,{class:"area-title"},{default:o((()=>[A("车况描述(对内)")])),_:1}),A(" "+C(k(G).remark||"-"),1)])),_:1})])),_:1})])),_:1})):v("",!0),1==k(W)?(y(),u(l,{key:2,class:"tracks"},{default:o((()=>[k(q).length>0?(y(),u(n,{key:0,class:"steps",activeColor:"#F75A1E",direction:"column",current:k(q).length-1,dot:""},{default:o((()=>[(y(!0),D(P,null,b(k(q),((e,a)=>(y(),u(i,{key:a,title:e.title},{desc:o((()=>[g(l,{class:"descs"},{default:o((()=>[g(l,{class:"d-title"},{default:o((()=>[A(C(e.approveTypeName),1)])),_:2},1024),e.nextApproveUser?(y(),u(l,{key:0},{default:o((()=>[A(C(e.nextApproveUser),1)])),_:2},1024)):v("",!0),g(l,null,{default:o((()=>[A(C(e.createTime)+" | "+C(e.createUserName),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["title"])))),128))])),_:1},8,["current"])):(y(),u(l,{key:1,class:"no-content"},{default:o((()=>[g(l,null,{default:o((()=>[A("暂无数据")])),_:1})])),_:1}))])),_:1})):v("",!0)])),_:1}),"waitStock"==k(w).type?(y(),u(l,{key:1,class:"bottom-btn"},{default:o((()=>[g(c,{class:"save-btn",onClick:le},{default:o((()=>[A("发起入库")])),_:1})])),_:1})):v("",!0)])),_:1})}}}),[["__scopeId","data-v-942f5ee8"]]);export{Q as default};
