var e=Object.defineProperty,a=(a,t,r)=>((a,t,r)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r)(a,"symbol"!=typeof t?t+"":t,r);import{d as t,r,c as l,o as i,i as s,u as n,Q as o,w as c,a as u,y as m,P as d,g as p,h as f,t as h,_ as v,a9 as g,x as y,p as _,au as N,B as b,v as T,E as I,X as k,Y as M,D as P,s as D,a2 as C,I as A,M as O,K as L,at as w,a5 as E,f as V,R as U,n as x,b as R,F as B,e as S,S as j,aj as F,a7 as $,W as J,a0 as K,C as Y,$ as Z,a1 as G,bG as H,a8 as q,G as z,b2 as X}from"./index-CK4DGatK.js";import{_ as Q}from"./camera.DDOxr1zP.js";import{_ as W}from"./card.DgxD9h_f.js";import{_ as ee}from"./photo.s3UpHRXl.js";import{z as ae}from"./image.DobRSNlT.js";import{j as te,a as re}from"./index.HDA2F_3Q.js";import{f as le}from"./time._VqwKl0d.js";import{_ as ie}from"./car_default.CyENNAub.js";import{P as se,a as ne}from"./purchase.B8DNaFGL.js";import{F as oe}from"./fixPrice.CFXyKkhm.js";import{U as ce}from"./UploadFile.BBuXxkzB.js";import{d as ue,g as me}from"./customer.BR_0pqR6.js";import{S as de,I as pe}from"./scan-upload.q-LlmoOx.js";import{T as fe}from"./task.Cx6XxNwo.js";import{i as he}from"./carVerify.BfKp_ULT.js";import{n as ve}from"./noPurchaseCarInfo.BiDwqUh1.js";import{v as ge}from"./validator.D4swjSxv.js";import{u as ye}from"./useQuery.3dd8K18V.js";import{v as _e}from"./base.6l0JEBJr.js";import{d as Ne}from"./debounce.BkVTat1y.js";import{i as be}from"./isNil.aV-w2MPu.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";import"./isObject.C8HfsiHw.js";import"./isSymbol.Bym6OQCA.js";const Te=v(t({__name:"listItem",props:{item:{type:Object,default:{}},skip:{type:Boolean,default:!0}},setup(e){const a=r(""),t=e;return(r,v)=>{const g=d,y=f,_=s;return i(),l(_,{class:"list-item",onClick:v[0]||(v[0]=a=>!!t.skip&&("toPage"in r?r.toPage:n(o))(`/pages/fixPrice/fixDetail?id=${e.item.carPricingInfo.id}`))},{default:c((()=>[u(_,{class:"list-item-t"},{default:c((()=>[e.item.coverUrl?(i(),l(g,{key:0,src:("zipImg"in r?r.zipImg:n(ae))(e.item.coverUrl,50),mode:"aspectFill"},null,8,["src"])):(i(),l(g,{key:1,src:ie,mode:"widthFix"})),u(_,null,{default:c((()=>[u(_,{class:"name"},{default:c((()=>{var a;return[(null==(a=e.item.carPricingInfo.carSeriesName)?void 0:a.indexOf(e.item.carPricingInfo.carBrandName))<0?(i(),l(y,{key:0},{default:c((()=>[p(h(e.item.carPricingInfo.carBrandName),1)])),_:1})):m("",!0),p(" "+h(e.item.carPricingInfo.carSeriesName),1)]})),_:1}),u(_,{class:"model-name"},{default:c((()=>[p(h(e.item.carPricingInfo.carModelName),1)])),_:1}),u(_,{class:"labels"},{default:c((()=>[e.item.carPricingInfo.uetoDate?(i(),l(_,{key:0},{default:c((()=>{var a;return[p(h(null==(a=e.item.carPricingInfo.uetoDate)?void 0:a.substring(0,7)),1)]})),_:1})):m("",!0),e.item.carPricingInfo.mileage?(i(),l(_,{key:1},{default:c((()=>[p(h(e.item.carPricingInfo.mileage)+"万公里",1)])),_:1})):m("",!0),e.item.carPricingInfo.bodyColor?(i(),l(_,{key:2},{default:c((()=>[p(h(e.item.carPricingInfo.bodyColor),1)])),_:1})):m("",!0)])),_:1}),u(_,null,{default:c((()=>[p("新车指导价 "+h(e.item.carPricingInfo.carModelGuidePrice)+"万元",1)])),_:1})])),_:1})])),_:1}),+n(a)===n(se)["采购状态"]&&e.item.myPricingPriceTime?(i(),l(_,{key:0,class:"eval-price red"},{default:c((()=>[u(_,{class:"red"},{default:c((()=>[p("我的预估价"),u(y,null,{default:c((()=>[p(h(("joinStr"in r?r.joinStr:n(te))([e.item.myPricingPriceMin,e.item.myPricingPriceMax],"~")),1)])),_:1}),p("万元")])),_:1})])),_:1})):m("",!0),+n(a)===n(se)["订单状态"]&&(e.item.myPricingPriceMin||e.item.myPricingPriceMax)?(i(),l(_,{key:1,class:"eval-price"},{default:c((()=>[u(_,{class:"red"},{default:c((()=>[p(" 估价"),u(y,null,{default:c((()=>[p(h(("joinStr"in r?r.joinStr:n(te))([e.item.myPricingPriceMin,e.item.myPricingPriceMax],"~")),1)])),_:1}),p("万元 ")])),_:1}),u(_,null,{default:c((()=>[p(h(("formatCardTime"in r?r.formatCardTime:n(le))(e.item.myPricingPriceTime)),1)])),_:1})])),_:1})):m("",!0),+n(a)===n(oe)["评估定价"]?(i(),l(_,{key:2,class:"eval-price"},{default:c((()=>[e.item.pricingPriceMin||e.item.pricingPriceMax?(i(),l(_,{key:0,class:"red"},{default:c((()=>[p(" 定价"),u(y,null,{default:c((()=>[p(h(("joinStr"in r?r.joinStr:n(te))([e.item.pricingPriceMin,e.item.pricingPriceMax],"~")),1)])),_:1}),p("万元 ")])),_:1})):m("",!0),u(_,null,{default:c((()=>[p("定价师："+h(e.item.pricingRaterUserName||"-"),1)])),_:1})])),_:1})):m("",!0),+n(a)===n(se)["采购状态"]||+n(a)===n(se)["入库状态"]?(i(),l(_,{key:3,class:"list-item-b"},{default:c((()=>[u(_,null,{default:c((()=>[p("评估师："+h(e.item.pricingCreateUserName)+" 发起",1)])),_:1}),u(_,null,{default:c((()=>[p(h(("formatCardTime"in r?r.formatCardTime:n(le))(e.item.carPricingInfo.createTime)),1)])),_:1})])),_:1})):m("",!0)])),_:1})}}}),[["__scopeId","data-v-d440b709"]]),Ie=class e{constructor(e,t){a(this,"DB_NAME","DraftDB"),a(this,"DB_VERSION",4),a(this,"MAX_COUNT",200),a(this,"STORE_NAME"),a(this,"UPGRADE_DB"),this.STORE_NAME=e,this.UPGRADE_DB=t}static async getInstance(a,t){return e.instance||(e.instance=new e(a,t),await e.instance.initDB()),e.instance}initDB(){return new Promise(((a,t)=>{const r=indexedDB.open(this.DB_NAME,this.DB_VERSION);r.onerror=e=>{t(`Database error: ${e.target.error}`)},r.onsuccess=t=>{e.db=t.target.result,a()},r.onupgradeneeded=e=>{var a;console.log("onupgradeneeded",e);const t=e.target.result;if(t.version<this.DB_VERSION&&(null==(a=this.UPGRADE_DB)||a.call(this,t)),!t.objectStoreNames.contains(this.STORE_NAME)){t.createObjectStore(this.STORE_NAME,{keyPath:"key"}).createIndex("createdAt","createdAt",{unique:!1})}}}))}async checkAndRemoveOldest(a){return new Promise(((t,r)=>{const l=a.count();l.onsuccess=()=>{if(l.result>this.MAX_COUNT){const l=a.index("createdAt").getAll();l.onsuccess=()=>{const a=l.result,i=a.length-this.MAX_COUNT;if(i>0){const l=e.db.transaction([this.STORE_NAME],"readwrite"),s=l.objectStore(this.STORE_NAME);for(let e=0;e<i;e++)s.delete(a[e].key);l.oncomplete=()=>t(),l.onerror=()=>r(l.error)}else t()},l.onerror=()=>r(l.error)}else t()},l.onerror=()=>r(l.error)}))}async add(a,t){return new Promise(((r,l)=>{const i=e.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME);this.checkAndRemoveOldest(i).then((()=>{const e=i.add({key:a,value:t,createdAt:Date.now()});e.onsuccess=()=>r(),e.onerror=()=>l(e.error)})).catch(l)}))}async delete(a){return new Promise(((t,r)=>{const l=e.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).delete(a);l.onsuccess=()=>t(),l.onerror=()=>r(l.error)}))}async save(a,t){return new Promise(((r,l)=>{const i=e.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME);this.checkAndRemoveOldest(i).then((()=>{const e=i.put({key:a,value:t,createdAt:Date.now()});e.onsuccess=()=>r(),e.onerror=()=>l(e.error)})).catch(l)}))}async get(a){return new Promise(((t,r)=>{const l=e.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(a);l.onsuccess=()=>{const e=l.result;t(e?e.value:null)},l.onerror=()=>r(l.error)}))}async getAll(){return new Promise(((a,t)=>{const r=e.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).index("createdAt").getAll();r.onsuccess=()=>a(r.result),r.onerror=()=>t(r.error)}))}};a(Ie,"db"),a(Ie,"instance");let ke=Ie;const Me=v(t({__name:"addPurchase",setup(e){const a=g([{label:"个人",value:"person"},{label:"企业",value:"enterprise"}]),t=y((()=>!("enterprise"!=le.customerType||!le.customerEnterpriseTaxNumber||!le.customerEnterpriseTaxNumber.length)&&!ge(le.customerEnterpriseTaxNumber))),v=ye(),ae=r(""),te=r(!1),le=g({purchasePrice:"",purchaseType:"",deposit:"",paymentMethod:"",purchaseTime:"",vinNo:y({get:()=>ae.value,set:e=>{te.value||(ae.value=e)}}),plateNo:"",transferTime:"",customerId:"",customer:"",customerMobile:"",customerName:"",idNumber:"",payee:"",openBank:"",bankCardNumber:"",isBack:0,signMethod:null,photoIds:[],enterpriseId:"",templateId:"",address:"",bearParty:"",supplement:"",keyNum:"",engine:"",remark:"",carDelivery:!0,carDeliveryTime:"",customerType:"person",customerEnterpriseName:"",customerEnterpriseMobile:"",customerEnterpriseTaxNumber:""}),ie=y((()=>v.value.status)),oe=y((()=>"auditRejection"===ie.value)),Ie=y((()=>oe.value?"重新采购":"新增采购"));_((()=>{X({title:Ie.value})}));const Me=r([]),Pe=r({}),De=r({}),Ce=r([{key:"Full",value:"一次性付款"},{key:"Mortgage",value:"先付定金后付尾款"}]),Ae=r([]),Oe=r([]),Le=r(),we=r(),Ee=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领][A-HJ-NP-Z][A-HJ-NP-Z0-9]{4,5}[A-HJ-NP-Z0-9挂学警港澳]$/,Ve=/^[A-Z0-9]{17}$/,Ue=r(!1),xe=r([{label:"是",value:1},{label:"否",value:0}]),Re=r([]),Be=r([]),Se=r([{label:"是",value:!0},{label:"否",value:!1}]),je=r(N().add(1,"day").format("YYYY-MM-DD")),Fe=Ne((async()=>{var e,a,t,r;const l=await ke.getInstance("addPurchase");console.log("saveDarft-form",le),console.log("contractUploadRes",null==(a=null==(e=Le.value)?void 0:e.getFileFields())?void 0:a.all),l.save(v.value.id,JSON.stringify({_form:le,_carAttachments:Me.value,_contractImage:(null==(r=null==(t=Le.value)?void 0:t.getFileFields())?void 0:r.all)||[]}))}),500),$e=async e=>{(await ke.getInstance("addPurchase")).delete(e)};b((async()=>{var e;const a=N();le.purchaseTime=a.valueOf(),sa(),await oa(),await Je(),await(async()=>{const e=await ke.getInstance("addPurchase"),a=await e.get(v.value.id);if(!a)return;const{_form:t,_carAttachments:r,_contractImage:l}=JSON.parse(a);null==t||delete t.photoIds,Object.assign(le,t),Me.value=r,console.log("-getDarft-carAttachments",l),l&&l.length>0&&(console.log("replace photoIds"),le.photoIds=l.map((e=>{const a=e.attachmentUrl||e.url||e.name;if((e.id||e.attachmentId)&&a)return{url:e.attachmentUrl,attachmentUrl:e.attachmentUrl,name:e.attachmentUrl.split("/").pop(),status:"success",message:"",id:e.id,carAttachmentType:"contract",attachmentId:e.id};$e(v.value.id)})))})(),console.log("getDarftSuccess"),setTimeout((()=>{T([le,Me.value],(()=>{console.log("formChanged"),le.customerEnterpriseMobile&&(le.customerEnterpriseMobile=le.customerEnterpriseMobile.replace(/[^0-9]/g,"")),le.customerMobile&&(le.customerMobile=le.customerMobile.replace(/[^0-9]/g,"")),"Full"===le.paymentMethod&&(le.deposit=""),Fe()}))}),0),oe.value||(le.purchasePrice=null==(e=Pe.value)?void 0:e.pricingPriceMax)})),I((()=>{k("pickData"),M("pickData",(e=>{const{key:a,subKey:t}=e;le[t]=a})),k("sellData"),M("sellData",(e=>{const{name:a,realPhone:t,id:r,idNumber:l,member:i}=e;le.customer=a,le.customerName=a,le.customerMobile=t,le.customerId=r,le.idNumber=l||le.idNumber,le.member=i,ze.value=!1,Xe.value=!1,Qe.value=!1,We.value=[],r&&uni.$u.http.get(`/product/carPricing/getPayeeByCustomerId/${r}`).then((e=>{const{payee:a,openBank:t,bankCardNumber:r}=e.data;le.payee=a,le.openBank=t,le.bankCardNumber=r}))})),k("addPhoto"),M("addPhoto",(async e=>{var a,t,r,l;Me.value=e;const i=[];let s=null==(a=e.filter((e=>"VehicleLicense"==e.carAttachmentType))[0])?void 0:a.attachmentUrl;s||(s=null==(t=e.filter((e=>"VehicleLicenseBack"==e.carAttachmentType))[0])?void 0:t.attachmentUrl),i.push((async(e,a="front")=>{if(!e)return;const t=await uni.$u.http.get("/product/ocr/getVehicleLicense",{params:{image:e,side:a}});le.vinNo=t.data.vin||le.vinNo,le.plateNo=t.data.plateNo||le.plateNo,le.engine=t.data.engineNo||le.engine})(s));const n=null==(r=e.filter((e=>"ID_CARD_FRONT"==e.carAttachmentType))[0])?void 0:r.attachmentUrl;n&&i.push(wa(n));const o=null==(l=e.filter((e=>"purchaseEnterpriseBusinessLicense"==e.carAttachmentType))[0])?void 0:l.attachmentUrl;o&&i.push(Ze(o));const c=new P;c.showLoading("识别中...");try{await Promise.all(i).finally((()=>{c.hideLoading()}))}catch(u){c.hideLoading()}})),k("saveContract"),M("saveContract",(e=>{Object.assign(le,e)}))}));const Je=()=>((new P).showLoading("加载中"),uni.$u.http.get(`/product/carPricing/querySimpleById?id=${v.value.id}`).then((e=>{Pe.value=e.data,le.customerName=le.customerName||e.data.carPricingInfo.pricingCustomerName,le.customerMobile=le.customerMobile||e.data.carPricingInfo.pricingCustomerPhone,le.keyNum=le.keyNum||e.data.carPricingInfo.keyNum,le.engine=le.engine||e.data.carPricingInfo.engine,le.vinNo=le.vinNo||e.data.carPricingInfo.vinNo,le.vinNo&&17===le.vinNo.length&&(te.value=!0),console.log("form.vinNo",e.data.carPricingInfo.vinNo),le.paymentMethod=le.paymentMethod||e.data.paymentMethod,le.purchaseType=le.purchaseType||e.data.purchaseType,le.plateNo=le.plateNo||e.data.plateNo,le.transferTime=le.transferTime||e.data.transferTime,le.remark=le.remark||e.data.remark,le.carDelivery=le.carDelivery||(e.data.carDelivery??1),le.signMethod=le.signMethod||e.data.signMethod,!+le.carDelivery&&le.carDeliveryTime&&(le.carDeliveryTime=le.carDeliveryTime||e.data.carDeliveryTime),"Offline"===le.signMethod?le.photoIds||(le.photoIds=(e.data.photos||[]).map((e=>{var a;return{url:e.name,attachmentUrl:e.name,name:null==(a=e.name)?void 0:a.split("/").pop(),status:"success",message:"",id:e.id,carAttachmentType:"contract",attachmentId:e.id}}))):"Online"===le.signMethod&&(le.templateId||(le.templateId=e.data.templateId,le.address=e.data.address,le.bearParty=e.data.bearParty,le.supplement=e.data.supplement)),D((()=>{"Deposit"===le.paymentMethod&&(le.deposit=le.deposit||e.data.deposit)})),le.customerMobile&&ia(le.customerMobile),C()}))),Ke=r(),Ye=async e=>{var a,t;null==(a=Ke.value)||a.close();const r=(null==(t=null==e?void 0:e.image)?void 0:t[0])||{};if(null==r?void 0:r.attachmentUrl)try{await Ze(r.attachmentUrl,r)}catch(l){console.log(l)}},Ze=async(e,a)=>{if(e){(new P).showLoading("识别中...");try{uni.$u.http.get("/product/ocr/getEnterprise",{params:{image:e}}).then((e=>{const{enterpriseName:t,enterpriseTaxNumber:r}=e.data||{};if(le.customerEnterpriseTaxNumber=r,le.customerEnterpriseName=t,a){const e=Me.value.find((e=>e.carAttachmentType===a.carAttachmentType)),t=Me.value.findIndex((e=>e.carAttachmentType===a.carAttachmentType));e?Me.value.splice(t,1,a):Me.value.push({...a})}})).finally((()=>{(new P).hideLoading()}))}catch(t){(new P).hideLoading()}}},Ge=r(),He=r(),qe=r(),ze=r(!1),Xe=r(!1),Qe=r(!1),We=r([]),ea=e=>{le.customerName=e.name,le.customerMobile=e.realPhone,le.idNumber=e.idNumber,ze.value=!1,Xe.value=!1,Qe.value=!1,We.value=[]},aa=()=>{setTimeout((()=>{ze.value=!1,Xe.value=!1,Qe.value=!1,We.value=[]}),100)},ta=Ne((()=>{Xe.value=!1,Qe.value=!1,ue({value:le.customerName,elRef:Ge,visible:ze,list:We,subKey:"phone",length:1,requestFn:me})}),300),ra=()=>{setTimeout((()=>{le.customerMobile=le.customerMobile.replace(/[^0-9]/g,"")})),console.log(le.customerMobile),ze.value=!1,Qe.value=!1,console.log("triggerInput"),ue({value:le.customerMobile,elRef:He,visible:Xe,list:We,subKey:"phone",length:11,requestFn:me})},la=()=>{ze.value=!1,Xe.value=!1,ue({value:le.idNumber,elRef:qe,visible:Qe,list:We,subKey:"idNumber",length:4,searchKey:"idNumber",requestFn:me})},ia=e=>{(new P).showLoading("加载中"),uni.$u.http.get(`/product/member/getAllUser?search=${e}`).then((e=>{if(e.data.length>0){const{name:a,realPhone:t,userId:r,idNumber:l,member:i}=e.data[0];le.customer=a,le.customerName=a,le.customerMobile=t,le.customerId=r,le.idNumber=l||le.idNumber,le.member=i,r&&uni.$u.http.get(`/product/carPricing/getPayeeByCustomerId/${r}`).then((e=>{const{payee:a,openBank:t,bankCardNumber:r}=e.data;le.payee=a,le.openBank=t,le.bankCardNumber=r}))}C()}))},sa=()=>{uni.$u.http.get("product/purchaseOrder/getPurchaseDict").then((e=>{const a=e.data;Ce.value=a.paymentMethod,Ae.value=a.purchaseType,Oe.value=a.signMethod})),uni.$u.http.get("admin/dict/type/transferTime").then((e=>{we.value=e.data}))},na=y((()=>le.signMethod?(Re.value||[]).filter((e=>((null==e?void 0:e.signMethodList)||[]).includes(le.signMethod))):[])),oa=()=>uni.$u.http.get(`/product/carPricing/getBaseInfo/${v.value.id}`).then((e=>{const a=e.data||{};le.purchasePrice=a.purchasePrice,le.purchasePrice=a.purchasePrice,De.value={...a,...a.stockInfoVo},Re.value=a.enterpriseVOList.map((e=>({...e,label:e.corpName,value:e.id}))),Be.value=a.contractTemplateList.map((e=>({label:e.templateName,value:e.id,remarks:e.remarks}))),ua(a)})),ca=(e,a)=>(be(e)?[]:Array.isArray(e)?e:[e]).map((e=>{var t;return{id:e.id,attachmentId:e.id,url:e.name,attachmentUrl:e.name,name:null==(t=e.name)?void 0:t.split("/").pop(),status:"success",message:"",carAttachmentType:a,attachmentType:"Picture",videoCover:e.videoCover||null}})),ua=e=>{ie.value===ne["待采购"]?(Me.value=[...ca(e.vehicleLicenseFront,"VehicleLicense"),...ca(e.vehicleLicenseBack,"VehicleLicenseBack"),...ca(e.nameplatePhotoImage,"Nameplate"),...ca(e.registerCertificateimageList,"RegisterCertificate"),...ca(e.idCardFrontId,"ID_CARD_FRONT"),...ca(e.idCardBackId,"ID_CARD_BACK"),...ca(e.violationImageList,"VIOLATION"),...ca(e.repaymentList,"repayment"),...ca(e.maintenanceList,"maintenance"),...ca(e.insuranceList,"insurance"),...ca(e.purchaseOther,"purchaseOther"),...ca(e.enterpriseBusinessLicenseImageList,"purchaseEnterpriseBusinessLicense"),{carAttachmentType:"carImage",imageList:[{tagName:"车辆照片",imageList:ca(e.purchaseImageList,"carImage")},...e.purchaseImageTagList]}].filter(Boolean),le.paymentMethod=e.paymentMethod,le.purchaseType=e.purchaseType,le.plateNo=e.plateNo,le.transferTime=e.transferTime,le.remark=e.remark,le.enterpriseId=e.enterpriseId,le.carDelivery=e.carDelivery??1,le.signMethod=e.signMethod,!+le.carDelivery&&le.carDeliveryTime&&(le.carDeliveryTime=e.carDeliveryTime),le.vinNo=e.vinNo,le.customerName=e.customerName??"",le.customerMobile=e.customerMobile??"",le.idNumber=e.idNumber??"",le.customerType=e.customerType||"person",le.customerEnterpriseName=e.customerEnterpriseName,le.customerEnterpriseMobile=e.customerEnterpriseMobile,le.customerEnterpriseTaxNumber=e.customerEnterpriseTaxNumber,"Offline"===le.signMethod?le.photoIds=(e.photos||[]).map((e=>{var a;return{url:e.name,attachmentUrl:e.name,name:null==(a=e.name)?void 0:a.split("/").pop(),status:"success",message:"",id:e.id,carAttachmentType:"contract",attachmentId:e.id}})):"Online"===le.signMethod&&(le.templateId=e.templateId,le.address=e.address,le.bearParty=e.bearParty,le.supplement=e.supplement),D((()=>{"Deposit"===e.paymentMethod&&(le.deposit=e.deposit)}))):ie.value===ne["审核拒绝"]&&(Me.value=[...ca(e.vehicleLicenseFront,"VehicleLicense"),...ca(e.vehicleLicenseBack,"VehicleLicenseBack"),...ca(e.nameplatePhotoImage,"Nameplate"),...ca(e.registerCertificateimageList,"RegisterCertificate"),...ca(e.idCardFrontId,"ID_CARD_FRONT"),...ca(e.idCardBackId,"ID_CARD_BACK"),...ca(e.violationImageList,"VIOLATION"),...ca(e.repaymentList,"repayment"),...ca(e.maintenanceList,"maintenance"),...ca(e.insuranceList,"insurance"),...ca(e.purchaseOther,"purchaseOther"),...ca(e.enterpriseBusinessLicenseImageList,"purchaseEnterpriseBusinessLicense"),{carAttachmentType:"carImage",imageList:[{tagName:"车辆照片",imageList:ca(e.purchaseImageList,"carImage")},...e.purchaseImageTagList]}].filter(Boolean),le.purchasePrice=e.purchasePrice,le.paymentMethod=e.paymentMethod,le.purchaseType=e.purchaseType,le.vinNo=e.vinNo,le.plateNo=e.plateNo,le.customerName=e.customerName??"",le.customerMobile=e.customerMobile??"",le.idNumber=e.idNumber??"",le.engine=e.engine,le.transferTime=e.transferTime,le.keyNum=e.keyNum,le.signMethod=e.signMethod,le.enterpriseId=e.enterpriseId,le.customerType=e.customerType||"person",le.customerEnterpriseName=e.customerEnterpriseName,le.customerEnterpriseMobile=e.customerEnterpriseMobile,le.customerEnterpriseTaxNumber=e.customerEnterpriseTaxNumber,"Offline"===le.signMethod?le.photoIds=(e.photos||[]).map((e=>({url:e.name,attachmentUrl:e.name,name:e.name.split("/").pop(),status:"success",message:"",id:e.id,carAttachmentType:"contract",attachmentId:e.id}))):"Online"===le.signMethod&&(le.templateId=e.templateId,le.address=e.address,le.bearParty=e.bearParty,le.supplement=e.supplement),le.remark=e.remark,le.carDelivery=e.carDelivery??1,!+le.carDelivery&&le.carDeliveryTime&&(le.carDeliveryTime=e.carDeliveryTime),D((()=>{"Deposit"===e.paymentMethod&&(le.deposit=e.deposit)})))},ma=y((()=>va(Ce.value,le.paymentMethod))),da=y((()=>va(Ae.value,le.purchaseType))),pa=y((()=>va(Re.value,le.enterpriseId))),fa=y((()=>va(Be.value,le.templateId))),ha=y((()=>va(we.value,le.transferTime))),va=(e,a,t="")=>{const r=null==e?void 0:e.filter((e=>e.value==a));return(null==r?void 0:r.length)?r[0].label+t:"请选择"},ga=(e,a,t,r)=>{o(`/pages/carManage/pagePicker?title=${e}&list=${JSON.stringify(a)}&key=${t}&subKey=${r}&pageKey=purchase`)};const ya=e=>{D((()=>{le.purchaseTime=N(e.value).valueOf(),Ue.value=!1}))};function _a(e){return e?N(e).format("YYYY-MM-DD HH:mm"):""}const Na=(e=!0)=>{var a,r,l;const i=(null==(l=null==(r=null==(a=Le.value)?void 0:a.getFileFields())?void 0:r.all)?void 0:l.map((e=>e.attachmentId)))||[],{purchasePrice:s,deposit:n,paymentMethod:o,purchaseType:c,purchaseTime:u,vinNo:m,plateNo:d,customerMobile:p,customerName:f,idNumber:h,signMethod:v,enterpriseId:g,templateId:y,bearParty:_,carDelivery:N,carDeliveryTime:b,keyNum:T,transferTime:I,customerType:k,customerEnterpriseName:M,customerEnterpriseMobile:P,customerEnterpriseTaxNumber:D}=le,C=e=>{var a,t;return null==(t=null==(a=Me.value)?void 0:a.filter((a=>a.carAttachmentType==e)))?void 0:t.length};if(e&&!C("VehicleLicense")&&!C("VehicleLicenseBack"))return"请上传行驶证照片";if(e&&!C("purchaseEnterpriseBusinessLicense")&&"enterprise"==k)return"请上传营业执照";if(be(T)||""===T)return"请输入钥匙数量";if(be(I)||""===I)return"请选择过户次数";if(!s)return"请输入采购价";if(!o)return"请选择付款方式";if("Deposit"==o&&!n)return"请输入定金";if("Deposit"==o&&n&&+n>1e4*+s)return"定金不能大于采购价";if(!c)return"请选择采购类型";if(!u)return"请选择采购日期";if(!m)return"请输入VIN码";if(Da.value)return"VIN码不正确";if("person"==k){if(!p)return"请输入手机号";if(!f)return"请输入客户姓名";if(!h)return"请输入身份证号"}else if("enterprise"==k){if(!M)return"请输入企业名称";if(!P)return"请输入企业联系人手机号";if(!D)return"请输入企业税号";if(t.value)return"请输入正确的税号"}return e&&!v?"请选择签约方式":e&&"Offline"==v&&!i.length?"请上传合同照片":g?"Online"!=v||y?"Online"!=v||1!=y||_?Ve.test(m.toUpperCase().replace(" ",""))?d&&!Ee.test(d.toUpperCase().replace(" ",""))?"车牌号格式错误":!e||N||b?"":"请选择交车时间":"车架号格式错误":"请补充合同信息":"请选择合同模板":"请选择主体"},ba=async()=>{var e,a,t,r,l,i;const s=Na();if(s)return void(new P).showToast(s);const n=(e,a)=>{var t,r,l,i;const s=null==(t=Me.value)?void 0:t.filter((a=>a.carAttachmentType==e));return 1==a?null==(l=null==(r=s[0])?void 0:r.imageList[0])?void 0:l.imageList.map((e=>e.id)):null==(i=s[0].imageList.slice(1))?void 0:i.map((e=>({tagName:e.tagName,imageList:e.imageList.map((e=>e.id))})))},o=e=>{var a,t;return(null==(t=null==(a=Me.value)?void 0:a.filter((a=>a.carAttachmentType==e)))?void 0:t.map((e=>e.id)))||[]},c=(null==(t=null==(a=null==(e=Le.value)?void 0:e.getFileFields())?void 0:a.all)?void 0:t.map((e=>e.attachmentId)))||[];"Offline"!=le.signMethod&&(le.photoIds=[]);const u=JSON.parse(JSON.stringify(le||{})),m=await _e(le.vinNo);if(m.hasVin)return void(null==(r=Pa.value)||r.open(m.orderList||[]));(new P).showLoading("提交中");const d={pricingId:v.value.id,...u,customer:le.customerName,customerId:void 0,vinNo:null==(l=le.vinNo)?void 0:l.toUpperCase(),plateNo:null==(i=le.plateNo)?void 0:i.toUpperCase(),purchaseTime:_a(le.purchaseTime)+":00",photoIds:c.filter(Boolean),violationImageList:o("VIOLATION"),vehicleLicenseFront:o("VehicleLicense")[0]||"",vehicleLicenseBack:o("VehicleLicenseBack")[0]||"",registerCertificateimageList:o("RegisterCertificate"),nameplatePhotoImage:o("Nameplate"),idCardFrontId:o("ID_CARD_FRONT")[0]||"",idCardBackId:o("ID_CARD_BACK")[0]||"",purchaseOther:o("purchaseOther"),repaymentList:o("repayment"),maintenanceList:o("maintenance"),insuranceList:o("insurance"),enterpriseBusinessLicenseImageIdList:o("purchaseEnterpriseBusinessLicense"),purchaseImageList:n("carImage",1),purchaseImageTagList:n("carImage",2),backData:le.isBack};d.carDelivery&&delete d.carDeliveryTime;const p={primaryKey:v.value.id,taskDefinitionKey:fe["发起采购"],auditOpinion:1,purchaseOrderAddDTO:d};await Z().post("/product/carPricingFlowable/taskTurnover",p),(new P).showToast("提交成功"),setTimeout((()=>{$e(v.value.id),G({delta:v.value.source?1:2,complete:function(){setTimeout((()=>{H(`/pages/purchaseOrder/purchaseList?type=auditPricing&itemType=${se["采购状态"]}`)}),10)}})}),1500)},Ta=(e,a,t)=>{D((()=>{le[a]=re(e,t)}))},Ia=e=>{const a=e.detail.value;a&&!Ee.test(a.toUpperCase().replace(" ",""))&&(new P).showToast("车牌号格式错误")},ka=e=>{D((()=>{le.vinNo=e.detail.value.replace(/[^a-zA-Z0-9]/g,"")}))},Ma=e=>{D((()=>{le.customerEnterpriseTaxNumber=e.detail.value.replace(/[^a-zA-Z0-9]/g,"")}))},Pa=r(),Da=r(!1);_((()=>{le.vinNo,le.vinNo?Da.value=!he(le.vinNo):Da.value=!1,le.vinNo&&le.vinNo.length&&!Da.value&&(async()=>{var e;const a=await _e(le.vinNo);a.hasVin&&(null==(e=Pa.value)||e.open(a.orderList||[]))})()}));const Ca=r(),Aa=e=>{var a,t;null==(a=Ca.value)||a.close();const r=(null==(t=null==e?void 0:e.image)?void 0:t[0])||{};if(!(null==r?void 0:r.attachmentUrl))return;(new P).showLoading("识别中");uni.$u.http.get("/product/ocr/getVehicleLicense",{params:{image:r.attachmentUrl,side:"front"}}).then((e=>{le.vinNo=e.data.vin,le.plateNo=e.data.plateNo,le.engine=e.data.engineNo})).finally((()=>{C(),Me.value=Me.value.filter((e=>!["VehicleLicense"].includes(e.carAttachmentType))),Me.value.push({id:r.id,attachmentId:r.id,url:r.attachmentUrl,attachmentUrl:r.attachmentUrl,name:r.attachmentUrl.split("/").pop(),status:"success",message:"",carAttachmentType:"VehicleLicense",attachmentType:"Picture"})}))},Oa=r(),La=async e=>{var a,t;null==(a=Oa.value)||a.close();const r=(null==(t=null==e?void 0:e.image)?void 0:t[0])||{};if(null==r?void 0:r.attachmentUrl){(new P).showLoading("识别中");try{(async(e,a)=>{const t=JSON.parse(z("carAttachments")||"[]");console.log("imageurl",e);{const a=t.filter((e=>"ID_CARD_FRONT"!==e.carAttachmentType)),r={attachmentId:e.attachmentId,id:e.id,attachmentUrl:e.attachmentUrl,carAttachmentType:"ID_CARD_FRONT",attachmentType:"Picture"};Me.value=Me.value.filter((e=>"ID_CARD_FRONT"!==e.carAttachmentType)),Me.value.push(r),a.push(r),q("carAttachments",JSON.stringify(a))}})(r),await wa(r.attachmentUrl)}catch(l){console.log("error",l)}finally{C()}}},wa=async e=>{if(!e)return;(new P).showLoading("识别中");const a=(await uni.$u.http.get("/product/ocr/idCard/info",{params:{image:e,side:"front"}})).data,{customerName:t,idNumber:r}=le;le.customerName=a.name||t,le.idNumber=a.number||r,await(async e=>{if(!/^\d{17}(\d|x)$/.test(e))return void ta();const a=await uni.$u.http.get("/product/userRealNameInfo/getPhoneByIdCard/"+e);a.data?le.customerMobile=a.data:ta()})(le.idNumber),C()},Ea=e=>{q("carAttachments",JSON.stringify(Me.value)),o(`/pages/carManage/photoManage?type=${e}&detail=0&isPurchase=1&paymentMethod=${le.paymentMethod}&customerType=${le.customerType}`)},Va=y((()=>{var e,a,t;const r=(null==(a=null==(e=Me.value)?void 0:e.filter((e=>["carImage"].includes(e.carAttachmentType)))[0])?void 0:a.imageList)||[];let l=[];return r.forEach((e=>{l=l.concat(e.imageList||[])})),(null==(t=l[0])?void 0:t.attachmentUrl)||""})),Ua=y((()=>{var e,a;return(null==(a=null==(e=Me.value)?void 0:e.filter((e=>["VehicleLicense","VehicleLicenseBack","RegisterCertificate","Nameplate","ID_CARD_FRONT","ID_CARD_BACK"].includes(e.carAttachmentType)))[0])?void 0:a.attachmentUrl)||""})),xa=y((()=>{var e;const a=null==(e=Me.value)?void 0:e.filter((e=>["maintenance","insurance","repayment","VIOLATION","purchaseOther"].includes(e.carAttachmentType)))[0];return(null==a?void 0:a.videoCover)||(null==a?void 0:a.attachmentUrl)||""})),Ra=()=>{var e,a;const t=Na(!1);if(t)return void(new P).showToast(t);const r={pricingId:v.value.id,...JSON.parse(JSON.stringify(le||{})),vinNo:null==(e=le.vinNo)?void 0:e.toUpperCase(),plateNo:null==(a=le.plateNo)?void 0:a.toUpperCase(),purchaseTime:_a(le.purchaseTime)+":00"};uni.$u.http.post("/product/purchaseOrder/purchasePreview",r).then((e=>{o(`/pages/carManage/pdf?url=${e.data}`)}))};return(e,r)=>{const v=s,g=d,y=f,_=U,b=A(L("up-icon"),O),T=F,I=$,k=J,M=E,P=A(L("up-datetime-picker"),w);return i(),l(v,{class:"page pend-page f-c-s"},{default:c((()=>[u(M,{"scroll-y":"",class:"scroll-view-box","enable-flex":"",style:{height:"100%"}},{default:c((()=>[u(v,{class:"content scroll-view-box"},{default:c((()=>{var s;return[(null==(s=n(Pe))?void 0:s.carPricingInfo)?(i(),l(Te,{key:0,item:n(Pe)},null,8,["item"])):m("",!0),u(v,{class:"photo-box"},{default:c((()=>[u(v,{class:"title"},{default:c((()=>[p("照片资料")])),_:1}),u(v,{class:"photo-item"},{default:c((()=>[u(v,{onClick:r[0]||(r[0]=e=>Ea(0)),style:V(`background-image:url(${Va.value})`)},{default:c((()=>[u(g,{src:Q}),u(y,null,{default:c((()=>[p("车辆照片")])),_:1})])),_:1},8,["style"]),u(v,{onClick:r[1]||(r[1]=e=>Ea(1)),style:V(`background-image:url(${Ua.value})`)},{default:c((()=>[u(v,{class:"must"},{default:c((()=>[p("*")])),_:1}),u(g,{src:W}),u(y,null,{default:c((()=>[p("证件照片")])),_:1})])),_:1},8,["style"]),u(v,{onClick:r[2]||(r[2]=e=>Ea(2)),style:V(`background-image:url(${xa.value})`)},{default:c((()=>[u(g,{src:ee}),u(y,null,{default:c((()=>[p("其他照片")])),_:1})])),_:1},8,["style"])])),_:1})])),_:1}),u(v,{class:"section-title"},{default:c((()=>[p("销售信息")])),_:1}),u(v,{class:"form-box write"},{default:c((()=>[u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("采购价")])),_:1}),u(_,{modelValue:n(le).purchasePrice,"onUpdate:modelValue":r[3]||(r[3]=e=>n(le).purchasePrice=e),type:"digit",placeholder:"请输入",onInput:r[4]||(r[4]=e=>Ta(e.detail.value,"purchasePrice","wanFloat"))},null,8,["modelValue"]),p(" 万元 ")])),_:1}),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("付款方式")])),_:1}),u(v,{class:"f-b-c",onClick:r[5]||(r[5]=e=>ga("付款方式",n(Ce),n(le).paymentMethod,"paymentMethod"))},{default:c((()=>[u(y,{class:x({placeholder:"请选择"==ma.value})},{default:c((()=>[p(h(ma.value),1)])),_:1},8,["class"]),u(b,{name:"arrow-right"})])),_:1})])),_:1}),"Deposit"==n(le).paymentMethod?(i(),l(v,{key:0,class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("定金")])),_:1}),u(_,{modelValue:n(le).deposit,"onUpdate:modelValue":r[6]||(r[6]=e=>n(le).deposit=e),type:"digit",placeholder:"请输入",onInput:r[7]||(r[7]=e=>Ta(e.detail.value,"deposit","yuanFloat"))},null,8,["modelValue"]),p(" 元 ")])),_:1})):m("",!0),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("采购类型")])),_:1}),u(v,{class:"f-b-c",onClick:r[8]||(r[8]=e=>ga("采购类型",n(Ae),n(le).purchaseType,"purchaseType"))},{default:c((()=>[u(y,{class:x({placeholder:"请选择"==da.value})},{default:c((()=>[p(h(da.value),1)])),_:1},8,["class"]),u(b,{name:"arrow-right"})])),_:1})])),_:1}),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("采购日期")])),_:1}),u(v,{class:"f-b-c",onClick:r[9]||(r[9]=e=>Ue.value=!0)},{default:c((()=>[u(v,{class:x({placeholder:!n(le).purchaseTime})},{default:c((()=>[p(h(_a(n(le).purchaseTime)||"请选择"),1)])),_:1},8,["class"]),u(b,{name:"arrow-right"})])),_:1})])),_:1}),u(v,{class:"form-item"},{default:c((()=>{var e;return[u(v,null,{default:c((()=>[p("评估师")])),_:1}),p(" "+h(null==(e=n(Pe))?void 0:e.pricingCreateUserName),1)]})),_:1})])),_:1}),u(v,{class:"section-title"},{default:c((()=>[p("车辆信息")])),_:1}),u(v,{class:"form-box write"},{default:c((()=>[u(v,{class:"form-item error-item","data-error-msg":n(Da)?"VIN码不正确":""},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("VIN码")])),_:1}),u(_,{modelValue:n(le).vinNo,"onUpdate:modelValue":r[10]||(r[10]=e=>n(le).vinNo=e),modelModifiers:{trim:!0},placeholder:"请输入",style:{"text-transform":"uppercase"},maxlength:"17",disabled:n(te),onInput:ka},null,8,["modelValue","disabled"]),n(te)?m("",!0):(i(),l(de,{key:0,ref_key:"vinUploadRef",ref:Ca,maxCount:1,onSuccess:Aa},null,512))])),_:1},8,["data-error-msg"]),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[p("车牌号")])),_:1}),u(_,{modelValue:n(le).plateNo,"onUpdate:modelValue":r[11]||(r[11]=e=>n(le).plateNo=e),placeholder:"请输入",maxlength:8,style:{"text-transform":"uppercase"},onBlur:Ia},null,8,["modelValue"])])),_:1}),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[p("发动机号")])),_:1}),u(_,{modelValue:n(le).engine,"onUpdate:modelValue":r[12]||(r[12]=e=>n(le).engine=e),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])])),_:1}),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("过户次数")])),_:1}),u(v,{class:"f-b-c",onClick:r[13]||(r[13]=e=>ga("过户次数",n(we),n(le).transferTime,"transferTime"))},{default:c((()=>[u(y,{class:x({placeholder:"请选择"==ha.value})},{default:c((()=>[p(h(ha.value),1)])),_:1},8,["class"]),u(b,{name:"arrow-right"})])),_:1})])),_:1}),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("钥匙数量")])),_:1}),u(_,{modelValue:n(le).keyNum,"onUpdate:modelValue":r[14]||(r[14]=e=>n(le).keyNum=e),type:"number",placeholder:"请输入"},null,8,["modelValue"]),p(" 把 ")])),_:1})])),_:1}),u(v,{class:"section-title"},{default:c((()=>[p("客户信息")])),_:1}),u(v,{class:"form-box write"},{default:c((()=>[u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[p("客户类型")])),_:1}),u(v,{class:"tab-box"},{default:c((()=>[(i(!0),R(B,null,S(n(a),((e,a)=>(i(),l(y,{key:a,class:x({active:n(le).customerType==e.value}),onClick:a=>(e=>{le.customerType=e.value,"enterprise"==le.customerType&&"Offline"!=le.signMethod&&(le.signMethod="Offline")})(e)},{default:c((()=>[p(h(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),"person"==n(le).customerType?(i(),R("div",{key:0,class:"form-item input-complete",ref_key:"customerNameFormItemRef",ref:Ge},[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("客户姓名")])),_:1}),u(_,{onInput:n(ta),ignoreCompositionEvent:!1,modelValue:n(le).customerName,"onUpdate:modelValue":r[15]||(r[15]=e=>n(le).customerName=e),placeholder:"请输入",onBlur:aa},null,8,["onInput","modelValue"]),u(b,{onClick:r[16]||(r[16]=a=>("toPage"in e?e.toPage:n(o))(`/pages/carManage/sellUserList?keyword=${n(le).customerName??""}&title=选择客户&isCustomer=1`)),name:"arrow-right"}),n(ze)?(i(),l(pe,{key:0,list:n(We),onItemClick:ea},null,8,["list"])):m("",!0)],512)):m("",!0),"person"==n(le).customerType?(i(),R("div",{key:1,class:"form-item input-complete",ref_key:"customerPhoneFormItemRef",ref:He},[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("手机号")])),_:1}),u(_,{onInput:ra,modelValue:n(le).customerMobile,"onUpdate:modelValue":r[17]||(r[17]=e=>n(le).customerMobile=e),placeholder:"请输入",border:"none",maxlength:"13",onBlur:aa},null,8,["modelValue"]),n(Xe)?(i(),l(pe,{key:0,list:n(We),onItemClick:ea},null,8,["list"])):m("",!0)],512)):m("",!0),"person"==n(le).customerType?(i(),R("div",{key:2,class:"form-item input-complete",ref_key:"customerIdNumberFormItemRef",ref:qe},[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("身份证号")])),_:1}),u(_,{onInput:la,modelValue:n(le).idNumber,"onUpdate:modelValue":r[18]||(r[18]=e=>n(le).idNumber=e),placeholder:"请输入",onBlur:aa},null,8,["modelValue"]),n(Qe)?(i(),l(pe,{key:0,list:n(We),onItemClick:ea},null,8,["list"])):m("",!0),u(de,{ref_key:"idCardUploadRef",ref:Oa,maxCount:1,onSuccess:La},null,512)],512)):m("",!0),"enterprise"==n(le).customerType?(i(),l(v,{key:3,class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("企业名称")])),_:1}),u(_,{modelValue:n(le).customerEnterpriseName,"onUpdate:modelValue":r[19]||(r[19]=e=>n(le).customerEnterpriseName=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1})):m("",!0),"enterprise"==n(le).customerType?(i(),l(v,{key:4,class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("手机号")])),_:1}),u(_,{modelValue:n(le).customerEnterpriseMobile,"onUpdate:modelValue":r[20]||(r[20]=e=>n(le).customerEnterpriseMobile=e),maxlength:"13",placeholder:"请输入"},null,8,["modelValue"])])),_:1})):m("",!0),"enterprise"==n(le).customerType?(i(),l(v,{key:5,class:"form-item error-item","data-error-msg":t.value?"税号不正确":""},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("税号")])),_:1}),u(_,{modelValue:n(le).customerEnterpriseTaxNumber,"onUpdate:modelValue":r[21]||(r[21]=e=>n(le).customerEnterpriseTaxNumber=e),placeholder:"请输入",style:{"text-transform":"uppercase"},maxlength:"18",onInput:Ma},null,8,["modelValue"]),u(de,{ref_key:"customerEnterpriseTaxNoRef",ref:Ke,maxCount:1,cameraType:"purchaseEnterpriseBusinessLicense",onSuccess:Ye},null,512)])),_:1},8,["data-error-msg"])):m("",!0),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("是否需要回传资料")])),_:1}),u(v,{class:"tab-box"},{default:c((()=>[(i(!0),R(B,null,S(n(xe),((e,a)=>(i(),l(y,{key:a,class:x({active:n(le).isBack==e.value}),onClick:a=>n(le).isBack=e.value},{default:c((()=>[p(h(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1}),u(v,{class:"section-title"},{default:c((()=>[p("合同信息")])),_:1}),u(v,{class:"form-box write"},{default:c((()=>[u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("签约方式")])),_:1}),u(v,{class:"tab-box"},{default:c((()=>[(i(!0),R(B,null,S(n(Oe),((e,a)=>(i(),l(y,{key:a,class:x({active:n(le).signMethod==e.value,disabled:"enterprise"==n(le).customerType&&"Online"==e.value}),onClick:a=>function(e){"enterprise"==le.customerType&&"Online"==e.value||(le.signMethod=e.value,le.enterpriseId="")}(e)},{default:c((()=>[p(h(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),n(le).signMethod?(i(),l(v,{key:0,class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("主体")])),_:1}),u(v,{class:"f-b-c",onClick:r[22]||(r[22]=e=>ga("主体",na.value,n(le).enterpriseId,"enterpriseId"))},{default:c((()=>[u(y,{class:x({placeholder:"请选择"==pa.value})},{default:c((()=>[p(h(pa.value),1)])),_:1},8,["class"]),u(b,{name:"arrow-right"})])),_:1})])),_:1})):m("",!0),"Offline"==n(le).signMethod?(i(),l(v,{key:1,class:"form-item photo-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("合同照片")])),_:1}),u(ce,{ref_key:"contractUploadRef",ref:Le,carAttachmentType:"contract",accept:"all","max-count":99,uploadList:n(le).photoIds,onSuccess:n(Fe),onDelete:n(Fe)},null,8,["uploadList","onSuccess","onDelete"])])),_:1})):m("",!0),"Online"==n(le).signMethod?(i(),l(v,{key:2,class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("合同模板")])),_:1}),u(v,{class:"f-b-c",onClick:r[24]||(r[24]=e=>ga("合同模板",n(Be),n(le).templateId,"templateId"))},{default:c((()=>[u(v,{class:x([{placeholder:"请选择"==fa.value},"contract-text"])},{default:c((()=>[p(h(fa.value)+" ",1),n(le).templateId?(i(),l(y,{key:0,class:"preview",onClick:j(Ra,["stop"])},{default:c((()=>[p("预览>")])),_:1})):m("",!0),1==+n(le).templateId?(i(),l(y,{key:1,class:"preview",onClick:r[23]||(r[23]=j((a=>("toPage"in e?e.toPage:n(o))(`/pages/purchaseOrder/contractInfo?params=${JSON.stringify({address:n(le).address,bearParty:n(le).bearParty,supplement:n(le).supplement})}`)),["stop"]))},{default:c((()=>[p("补充合同信息>")])),_:1})):m("",!0)])),_:1},8,["class"]),u(b,{name:"arrow-right"})])),_:1})])),_:1})):m("",!0)])),_:1}),u(v,{class:"section-title"},{default:c((()=>[p("其他信息")])),_:1}),u(v,{class:"form-box write"},{default:c((()=>[u(v,{class:"form-textarea"},{default:c((()=>[u(v,{class:"area-title"},{default:c((()=>[p("备注")])),_:1}),u(T,{modelValue:n(le).remark,"onUpdate:modelValue":r[25]||(r[25]=e=>n(le).remark=e),placeholder:"请输入",maxlength:"512"},null,8,["modelValue"]),u(v,{class:"limit"},{default:c((()=>{var e;return[p(h((null==(e=n(le).remark)?void 0:e.length)||0)+"/512",1)]})),_:1})])),_:1}),u(v,{class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("是否交车")])),_:1}),u(v,{class:"tab-box"},{default:c((()=>[(i(!0),R(B,null,S(n(Se),((e,a)=>(i(),l(y,{key:a,class:x({active:n(le).carDelivery==e.value}),onClick:()=>{n(le).carDelivery=e.value,D((()=>{Y({scrollTop:2e3,duration:100})}))}},{default:c((()=>[p(h(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),n(le).carDelivery?m("",!0):(i(),l(v,{key:0,class:"form-item"},{default:c((()=>[u(v,null,{default:c((()=>[u(y,null,{default:c((()=>[p("*")])),_:1}),p("交车时间")])),_:1}),u(I,{mode:"date",value:n(le).carDeliveryTime,onChange:r[26]||(r[26]=e=>((e,a)=>{const t=new Date(e.detail.value).getTime()<new Date(je.value).getTime();le[a]=t?je.value:e.detail.value,t&&K({title:"只能选择当前之后",icon:"none"})})(e,"carDeliveryTime"))},{default:c((()=>[u(v,{class:x({placeholder:!n(le).carDeliveryTime})},{default:c((()=>[p(h(n(le).carDeliveryTime||"请选择"),1)])),_:1},8,["class"])])),_:1},8,["value"]),u(b,{name:"arrow-right"})])),_:1}))])),_:1})]})),_:1}),u(v,{class:"bottom-btn"},{default:c((()=>[u(k,{class:"save-btn w_100",onClick:ba},{default:c((()=>[p("确定")])),_:1})])),_:1})])),_:1}),n(Ue)?(i(),l(P,{key:0,show:n(Ue),modelValue:n(le).purchaseTime,"onUpdate:modelValue":r[27]||(r[27]=e=>n(le).purchaseTime=e),title:"采购日期",mode:"datetime",confirmColor:"#ff5719",maxDate:n(N)().valueOf(),onCancel:r[28]||(r[28]=e=>Ue.value=!1),onConfirm:ya},null,8,["show","modelValue","maxDate"])):m("",!0),u(ve,{ref_key:"noPurchaseCarInfoRef",ref:Pa,type:"purchase"},null,512)])),_:1})}}}),[["__scopeId","data-v-feda64fb"]]);export{Me as default};
