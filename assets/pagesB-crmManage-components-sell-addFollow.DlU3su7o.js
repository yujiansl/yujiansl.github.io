import{d as e,r as l,B as a,E as t,Z as s,a2 as u,$ as n,x as o,b as d,a as i,w as c,u as r,z as m,F as v,i as f,I as _,M as p,K as x,b8 as b,o as y,c as g,y as k,h as I,g as h,t as T,n as C,Q as j,aU as w,e as N,aj as V,W as $,a0 as U,a1 as P,_ as B}from"./index-CK4DGatK.js";import{c as F}from"./crm.-ZWUD7KR.js";import{N as M}from"./NextFollowUpTimePicker.B9FsksyN.js";import{u as S}from"./useQuery.3dd8K18V.js";import"./isNil.aV-w2MPu.js";const q=B(e({__name:"addFollow",setup(e){const B=S(),q=l(!1),z=l(),Q=l({result:"",content:"",nextTime:""});a((()=>{E()})),t((async()=>{s({title:"加载中",mask:!0});try{!async function(){var e;const l={clueId:B.value.clueId},a=await n().get(F.getClueByPurchase,{params:l});z.value=null==(e=null==a?void 0:a.data)?void 0:e[0]}()}finally{u()}}));const A=e=>{if(e){const{result:e,content:l}=Q.value;if(!("成交"===e||e&&l))return U({title:"请完善必填字段",icon:"none"});s({title:"提交中",mask:!0});const a={crmClueId:B.value.clueId,clueType:B.value.clueType,crmCustomerId:B.value.customerId,...Q.value,nextTime:Q.value.nextTime?`${Q.value.nextTime}:00`:""};uni.$u.http.post(F.followLog,a).then((e=>{U({title:"操作成功",icon:"none"}),P(),u()}))}else P()},D=l([]),E=()=>{uni.$u.http.get(F.intentionInfolist,{data:{current:1,size:-1}}).then((e=>{var l,a,t;D.value=null==(t=null==(a=null==(l=e.data)?void 0:l.results)?void 0:a.filter((e=>"成交"!==e.code)))?void 0:t.map((e=>({label:e.code,value:e.code})))}))},K=o((()=>{const e=Q.value.nextTime;return null===e?"不跟进":e||"请选择"})),L=o((()=>{var e,l;return["3"].includes(null==(e=z.value)?void 0:e.status)?"order-success":["4","5"].includes(null==(l=z.value)?void 0:l.status)?"invalid":"intention"})),W=o((()=>{var e,l,a,t;return["3"].includes(null==(e=z.value)?void 0:e.status)?"成":["4"].includes(null==(l=z.value)?void 0:l.status)?"败":["5"].includes(null==(a=z.value)?void 0:a.status)?"无":null==(t=z.value)?void 0:t.intentionCode}));return(e,l)=>{const a=I,t=f,s=_(x("up-icon"),p),u=_(x("u-empty"),b),n=V,o=$;return y(),d(v,null,[i(t,{class:"page f-c-s"},{default:c((()=>[i(t,{class:"content",id:"page-box"},{default:c((()=>{var o;return[i(t,{class:"content-title"},{default:c((()=>[i(a,{class:"mr20"},{default:c((()=>[h(T("0"===r(B).clueType?"销售":"评估")+"机会",1)])),_:1}),r(W)?(y(),g(a,{key:0,class:C(["status",[r(L)]])},{default:c((()=>[h(T(r(W)),1)])),_:1},8,["class"])):k("",!0)])),_:1}),(null==(o=r(z))?void 0:o.modelName)?(y(),g(t,{key:0,class:"section"},{default:c((()=>[i(t,{class:"series"},{default:c((()=>{var e;return[h(T(null==(e=r(z))?void 0:e.modelName),1)]})),_:1}),i(t,{class:"desc"},{default:c((()=>{var e,l,a;return[h(T((null==(e=r(z))?void 0:e.registrationTime)||"--")+"上牌 | "+T((null==(l=r(z))?void 0:l.kilometres)||"--")+"万公里 | "+T((null==(a=r(z))?void 0:a.colorSource)||"--"),1)]})),_:1})])),_:1})):(y(),g(t,{key:1,class:"section"},{default:c((()=>[i(t,{class:"edit-btn text-color",onClick:l[0]||(l[0]=l=>("toPage"in e?e.toPage:r(j))(`/pagesB/crmManage/addCustom?${("qsStr"in e?e.qsStr:r(w))({clueId:r(B).clueId,customerId:r(B).customerId,type:"purchaseAddDto",title:"编辑卖车意向"})}`))},{default:c((()=>[i(s,{name:"edit-pen",color:"#ff5719"}),h("编辑意向 ")])),_:1}),i(u,{mode:"list",text:"暂无意向"})])),_:1})),i(t,{class:"form-box"},{default:c((()=>[i(t,{class:"form-textarea"},{default:c((()=>[i(t,{class:"area-title"},{default:c((()=>[i(a,null,{default:c((()=>[h("*")])),_:1}),h("跟进结果")])),_:1}),i(t,{class:"sub-content"},{default:c((()=>[(y(!0),d(v,null,N(r(D),(e=>(y(),g(t,{onClick:l=>((e,l)=>{Q.value[e]=Q.value[e]==l.value?"":l.value})("result",e),class:C({active:r(Q).result==e.value}),key:e.label},{default:c((()=>[h(T(e.label),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})])),_:1}),i(t,{class:"form-box"},{default:c((()=>[i(t,{class:"form-textarea"},{default:c((()=>[i(t,{class:"area-title"},{default:c((()=>[i(a,null,{default:c((()=>[h("*")])),_:1}),h(" "+T(["战败","无效"].includes(r(Q).result)?`${r(Q).result}原因`:"跟进内容"),1)])),_:1}),i(n,{modelValue:r(Q).content,"onUpdate:modelValue":l[1]||(l[1]=e=>r(Q).content=e),placeholder:"请输入",maxlength:"1000"},null,8,["modelValue"]),i(t,{class:"limit"},{default:c((()=>{var e;return[h(T((null==(e=r(Q).content)?void 0:e.length)||0)+"/1000",1)]})),_:1})])),_:1}),["战败","无效"].includes(r(Q).result)?k("",!0):(y(),g(t,{key:0,class:"form-item",onClick:l[2]||(l[2]=e=>q.value=!0)},{default:c((()=>[i(t,null,{default:c((()=>[h("下次跟进时间")])),_:1}),i(t,{class:"f-b-c"},{default:c((()=>[i(a,{class:C({placeholder:"请选择"==r(K)})},{default:c((()=>[h(T(r(K)),1)])),_:1},8,["class"]),i(s,{name:"arrow-right"})])),_:1})])),_:1}))])),_:1})]})),_:1}),i(t,{class:"bottom-btn"},{default:c((()=>[i(o,{onClick:l[3]||(l[3]=e=>A(!1))},{default:c((()=>[h("取消")])),_:1}),i(o,{class:"save-btn",onClick:l[4]||(l[4]=e=>A(!0))},{default:c((()=>[h("确定")])),_:1})])),_:1})])),_:1}),i(M,{title:"下次跟进时间",visible:r(q),"onUpdate:visible":l[5]||(l[5]=e=>m(q)?q.value=e:null),modelValue:r(Q).nextTime,"onUpdate:modelValue":l[6]||(l[6]=e=>r(Q).nextTime=e)},null,8,["visible","modelValue"])],64)}}}),[["__scopeId","data-v-3320d40d"]]);export{q as default};
