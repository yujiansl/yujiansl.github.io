import{d as a,r as e,B as s,Z as l,a2 as t,c as n,w as c,$ as u,i as o,I as i,b9 as d,K as r,o as f,a as m,b as v,u as g,z as p,h as _,g as y,F as h,e as b,t as k,n as w,W as C,a0 as I,a1 as T,ar as x,_ as j}from"./index-CK4DGatK.js";import{c as V}from"./crm.-ZWUD7KR.js";import{u as R}from"./useQuery.3dd8K18V.js";const U=j(a({__name:"setTags",setup(a){const j=R(),U=e(""),z=async()=>{const a=await u().get(V.getTagSearch,{params:{keyword:U.value}});D.value=(null==a?void 0:a.data)||[]},A=async()=>{if(B.value.length>9)I({title:"最多添加9个",icon:"none"});else{l({title:"提交中",mask:!0});try{const a={crmCustomerId:j.value.id,type:j.value.clueType,tagId:B.value};await u().post(V.addRelationTag,a),I({title:"添加成功",icon:"none"}),T(),x("refreshDetail")}finally{t()}}},B=e([]),D=e([]);return s((async()=>{l({title:"加载中",mask:!0});try{await async function(){const a=await u().get(V.getAllTag,{});D.value=(null==a?void 0:a.data)||[]}(),await async function(){var a;const e=await u().get(V.getRelationTag,{params:{crmUserId:j.value.id}});B.value=(null==(a=null==e?void 0:e.data)?void 0:a.map((a=>a.tagId)))||[]}()}finally{t()}})),(a,e)=>{const s=i(r("u-search"),d),l=_,t=o,u=C;return f(),n(t,{class:"page f-c-s"},{default:c((()=>[m(t,{class:"content"},{default:c((()=>[m(t,{class:"search-input f-r-s"},{default:c((()=>[m(s,{modelValue:g(U),"onUpdate:modelValue":e[0]||(e[0]=a=>p(U)?U.value=a:null),bgColor:"transparent",clearabled:!1,placeholder:"请输入关键词","show-action":!1},null,8,["modelValue"]),m(t,{class:"search-btn",onClick:z},{default:c((()=>[m(l,null,{default:c((()=>[y("搜索")])),_:1})])),_:1})])),_:1}),(f(!0),v(h,null,b(g(D),(a=>(f(),n(t,{class:"tag-box",key:a.id},{default:c((()=>[m(t,{class:"title"},{default:c((()=>[y(k(a.name),1)])),_:2},1024),m(t,{class:"type-box"},{default:c((()=>[(f(!0),v(h,null,b(a.children,(a=>(f(),n(t,{onClick:e=>function(a){const e=B.value.indexOf(a);e>-1?B.value.splice(e,1):B.value.push(a)}(a.id),class:w(["tag-item",{active:g(B).includes(a.id)}]),key:a.id},{default:c((()=>[y(k(a.name),1)])),_:2},1032,["onClick","class"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1}),m(t,{class:"bottom-btn"},{default:c((()=>[m(t,{class:"check-btn"},{default:c((()=>{var a;return[y("已选："+k(null==(a=g(B))?void 0:a.length),1)]})),_:1}),m(u,{class:"save-btn",onClick:A},{default:c((()=>[y("确定")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-cc406fcd"]]);export{U as default};
