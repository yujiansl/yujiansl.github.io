import{_ as e,b as s,a as o,w as a,F as i,U as l,a0 as t,a1 as n,aZ as r,i as d,I as c,ag as u,K as h,o as p,c as m,y as w,aM as y,e as v,aN as g,a$ as f,b0 as k,ax as _,S as x,P as I,u as C,b1 as V}from"./index-CK4DGatK.js";import{d as T}from"./downloads.DhIyBNWk.js";import{_ as L}from"./play.dJbs8fP_.js";import{_ as b}from"./download.4Hvs8F6H.js";const N=e({data:()=>({showType:null,videoUrl:null,imageArr:[],isNeedDownload:0,filename:null,currentIndex:0,scaleRate:1,paused:!0}),mounted(){this.videoContext=r("myVideo",this)},onLoad(e){this.showType=e.type,1==e.type?(this.currentIndex=Number(e.index)||0,this.imageArr=JSON.parse(e.imageList).map((e=>{if(e.startsWith("_is_video=")){const s=e.slice(10,e.length).split("_videoCover_");return{url:s[0],loaded:!1,videoCover:s[1]}}return{url:e,loaded:!1}})),this.isNeedDownload=e.isNeedDownload,this.filename=e.filename):(this.videoUrl=e.attachmentUrl,this.$nextTick((()=>{this.videoContext.play()})))},methods:{onLoadImage(e){this.imageArr[e].loaded=!0},isVideoURL(e){var s;const o=null==(s=null==e?void 0:e.split(".").pop())?void 0:s.toLowerCase();return[".mp4",".avi",".mov",".webm"].includes(`.${o}`)},videoTap(e){const s=r(`swiperVideo_${e}`,this);this.paused?s&&s.play():s&&s.pause()},palyVideo(e){const s=r(`swiperVideo_${e}`,this);s&&s.play()},setVideoStatus(e){this.paused=!e},pauseVideo(e){const s=this.imageArr[e];if(this.isVideoURL(s.url)){const s=r(`swiperVideo_${e}`,this);s&&s.pause()}},changeSwiper(e){this.pauseVideo(this.currentIndex),this.currentIndex=e.detail.current,this.imageArr[e.detail.current].loaded||(this.imageArr[e.detail.current].loaded=!0)},toBack(){n()},handleDownloadImg(e){l.download({url:e,fileName:this.filename,showProgress:!1}).then((e=>{e&&t({title:"下载成功",icon:"none"})}))},async download(){var e,s;const o={1:{url:null==(e=this.imageArr[this.currentIndex])?void 0:e.url,name:this.isVideoURL(null==(s=this.imageArr[this.currentIndex])?void 0:s.url)?"视频.mp4":"图片.jpg"},2:{url:this.videoUrl,name:"视频.mp4"}};if(l.isReady()){console.log("视频下载",o,this.showType,l.download);try{await l.download({url:o[this.showType].url,fileName:o[this.showType].name})&&t({title:"下载成功",icon:"none"})}catch(a){t({title:"下载失败",icon:"error"})}}else T(o[this.showType].url,o[this.showType].name)},moveScale(e){this.scaleRate=e.detail.scale},onTouchMove(e){this.scaleRate>1.5&&(e.stopPropagation(),e.preventDefault())}}},[["render",function(e,l,t,n,r,T){const N=_,S=I,U=c(h("up-loading-icon"),u),A=k,D=f,R=g,P=y,$=d;return p(),s(i,null,[o($,{class:"play-box",onClick:T.toBack},{default:a((()=>[1==r.showType?(p(),m(P,{key:0,class:"swiper",current:r.currentIndex,id:"swiper",onChange:T.changeSwiper},{default:a((()=>[(p(!0),s(i,null,v(r.imageArr,((e,t)=>(p(),m(R,{key:t,class:"swiper-item",onTouchmove:T.onTouchMove},{default:a((()=>[o(D,{class:"movable-area"},{default:a((()=>[o(A,{direction:"all","scale-value":"1","scale-min":"1","scale-max":"3",scale:!0,class:"movable-view",onScale:T.moveScale},{default:a((()=>[T.isVideoURL(e.url)?(p(),s(i,{key:0},[o(N,{controls:"",id:`swiperVideo_${t}`,src:e.url,"show-fullscreen-btn":!1,"enable-progress-gesture":!1,"show-center-play-btn":!1,poster:e.videoCover,onPlay:l[0]||(l[0]=e=>T.setVideoStatus(1)),onPause:l[1]||(l[1]=e=>T.setVideoStatus(0)),onEnded:l[2]||(l[2]=e=>T.setVideoStatus(0)),onClick:x((e=>T.videoTap(t)),["stop"])},null,8,["id","src","poster","onClick"]),r.paused?(p(),m(S,{key:0,class:"playBtn",src:L,onClick:x((e=>T.palyVideo(t)),["stop"]),mode:"scaleToFill"},null,8,["onClick"])):w("",!0)],64)):(p(),s(i,{key:1},[r.isNeedDownload&&(e.loaded||r.currentIndex===t)?(p(),m(S,{key:0,onLongpress:s=>T.handleDownloadImg(e.url),src:e.url,mode:"widthFix",onLoad:e=>T.onLoadImage(t)},null,8,["onLongpress","src","onLoad"])):r.isNeedDownload||!e.loaded&&r.currentIndex!==t?(p(),m(U,{key:2,size:"30"})):(p(),m(S,{key:1,src:e.url,mode:"widthFix",onLoad:e=>T.onLoadImage(t)},null,8,["src","onLoad"]))],64))])),_:2},1032,["onScale"])])),_:2},1024)])),_:2},1032,["onTouchmove"])))),128))])),_:1},8,["current","onChange"])):w("",!0),2==r.showType?(p(),m(N,{key:1,controls:"",id:"myVideo",src:r.videoUrl,"show-fullscreen-btn":!1},null,8,["src"])):w("",!0),("isMP_WEIXIN"in e?e.isMP_WEIXIN:C(V))?w("",!0):(p(),m(S,{key:2,src:"./static/base/close.png",class:"close"}))])),_:1},8,["onClick"]),o($,{class:"download",onClick:T.download},{default:a((()=>[o(S,{src:b})])),_:1},8,["onClick"]),o($,{class:"exit",onClick:T.toBack},{default:a((()=>[o(S,{src:"./static/index/icon_close.png"})])),_:1},8,["onClick"])],64)}],["__scopeId","data-v-ad3cf51a"]]);export{N as default};
