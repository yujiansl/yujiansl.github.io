import{d as e,r as a,v as l,q as u,s as t,I as s,b9 as i,K as n,M as v,c as r,o,i as d,w as c,a as p,u as f,z as m,b as h,y as g,a5 as y,F as b,e as T,k,t as _,S as w,n as M,g as S,P as x,h as A,ak as B,_ as C}from"./index-CK4DGatK.js";const I=C(e({__name:"brandDrop",props:{pBrand:{type:[String||Array]},pSeries:{type:[String||Array]},carType:{type:String},isMultiple:{type:Boolean,default:!1},typeMethod:{type:String,default:"common"},isModelAll:{type:Boolean,default:!1}},emits:["search"],setup(e,{expose:C,emit:I}){const P=a(""),z=I,$=e;l((()=>[$.pBrand,$.pSeries]),(async e=>{$.isMultiple?e[0].length||e[1].length||(R.value=j.value[0].list[0].id,L.value=[]):(V.value=e[0]||"",F.value=e[1]||"",""==V.value&&""==F.value&&(R.value=j.value[0].list[0].id,ee(j.value[0].list[0].id)))}),{deep:!0});const H=a(""),V=a(""),F=a(""),L=a([]),j=a([]),q=a([]),D=a([]),E=a(0),K=a(0),R=a(0),U=a(0),G=a(0);u((async()=>{Z()}));const J=e=>{Z(e)};l((()=>L.value),(async e=>{await Z(P.value,!1)}),{deep:!0});const N=async e=>{if(!e){const a=await Z(e);Q.value=a?j.value[0].title:""}},O=e=>{W.value.map((a=>{e.detail.scrollTop>=a.offsetTop-W.value[0].offsetTop-4&&(Q.value=a.getAttribute("data-title"))}))},Q=a(""),W=a([]),X=a(),Y=a(!1),Z=(e="",a=!0)=>new Promise((l=>{const u="common"==$.typeMethod?"/product/common/simpleListByBrand":"/product/carProductApp/getBrand",s="common"==$.typeMethod?{params:{type:0,name:e}}:{params:{vehicleStatus:$.carType,name:e}};$.isModelAll&&(s.params.containsAll=!0),uni.$u.http.get(u,s).then((e=>{Y.value=!0;const u=e.data.map((e=>e.initial));q.value=Array.from(new Set(u)),j.value=q.value.map((a=>{const l=e.data.filter((e=>e.initial==a)).map((e=>{const a=L.value.filter((a=>a.brandTag==e.id&&"-1"!==a.seriesTag));return{...e,count:$.isMultiple&&a.length||0}}));return{title:a,list:l}})),j.value&&j.value.length&&a&&(R.value=j.value[0].list[0].id,E.value=20,ee(j.value[0].list[0].id),t((async()=>{E.value=0,await new Promise((e=>{W.value=X.value,e(W.value)}))})),l(!0)),a||l(!0)}))})),ee=e=>{const a="common"==$.typeMethod?"/product/common/simpleListBySeries":"/product/carProductApp/getSeries",l="common"==$.typeMethod?{params:{type:0,brandId:e,containsAll:!0}}:{params:{vehicleStatus:$.carType,brandId:e,containsAll:!0}};uni.$u.http.get(a,l).then((e=>{D.value=e.data})),$.isMultiple||(V.value=e,F.value=D.value.some((e=>e.id==$.pSeries))?$.pSeries:""),K.value=20,t((async()=>{K.value=0}))},ae=(e,a)=>{new Promise(((l,u)=>{B().select("."+e).fields({size:!0},(u=>{if(!u)return void setTimeout((()=>{ae(e)}),10);l();const t=u.height;"menuHeight"==a?U.value=t:G.value=t})).exec()}))},le=async()=>{$.isMultiple?(V.value=[],F.value=[],L.value=[],P.value="",await Z()):(V.value="",F.value="",P.value=""),j.value.length>0&&($.isMultiple?(R.value=j.value[0].list[0].id,ee(j.value[0].list[0].id),L.value=[],z("search",V.value,F.value,L.value)):z("search",V.value,F.value))},ue=()=>{if(j.value.length||P.value||(V.value=$.isMultiple?[]:"",F.value=$.isMultiple?[]:"",L.value=[]),$.isMultiple){const e=L.value.map((e=>e.brandTag)),a=L.value.map((e=>e.seriesTag));z("search",e,a,L.value)}else F.value="-1"==F.value?"":F.value,z("search",V.value||"",F.value||"")};return C({open:()=>{if($.isMultiple){if(P.value="",V.value=$.pBrand||[],F.value=$.pSeries||[],!V.value.length)return R.value=j.value[0].list[0].id,V.value=[R.value],ee(R.value),E.value=20,t((async()=>{E.value=0})),!1;V.value.length>0&&(V.value.includes(R.value)||(R.value=V.value[0]),ee(R.value))}else V.value=$.pBrand||"",F.value=$.pSeries||"",V.value||(V.value=R.value),V.value&&V.value!=R.value&&(R.value=V.value,ee(V.value));H.value="",t((()=>{H.value=`scroll${V.value}`}))},handleClearSearch:()=>{P.value=""}}),(a,l)=>{const u=s(n("up-search"),i),t=d,B=x,C=A,I=y,z=s(n("up-icon"),v);return o(),r(t,null,{default:c((()=>[p(u,{modelValue:f(P),"onUpdate:modelValue":l[0]||(l[0]=e=>m(P)?P.value=e:null),placeholder:"请输入品牌搜索",onSearch:J,onCustom:J,onChange:N,"show-action":!0,actionText:"搜索"},null,8,["modelValue"]),p(t,{class:"u-menu-wrap"},{default:c((()=>[f(Y)&&f(j).length?(o(),h(b,{key:0},[p(t,{class:"left-box"},{default:c((()=>[p(I,{"scroll-y":"","scroll-with-animation":"",class:"u-tab-view menu-scroll-view","scroll-top":f(E),onScroll:O,"scroll-into-view":f(H)},{default:c((()=>[(o(!0),h(b,null,T(f(j),((e,a)=>(o(),r(t,{key:a},{default:c((()=>[k("div",{"data-title":e.title,ref_for:!0,ref_key:"subTitleRef",ref:X,class:"sub-title"},_(e.title),9,["data-title"]),(o(!0),h(b,null,T(e.list,((e,a)=>(o(),r(t,{key:a,class:M(["u-tab-item",[f(R)==e.id?"u-tab-item-active":""]]),"data-current":e.id,onClick:w((a=>(async e=>{e.id!=R.value&&(R.value=e.id,0!=U.value&&0!=G.value||(await ae("menu-scroll-view","menuHeight"),await ae("u-tab-item","menuItemHeight")),ee(e.id))})(e)),["stop"]),id:`scroll${e.id}`},{default:c((()=>[p(t,null,{default:c((()=>[S(_(e.title),1)])),_:2},1024),p(B,{src:e.icon,mode:"widthFix"},null,8,["src"]),p(C,{class:"u-line-1"},{default:c((()=>[S(_(e.name),1)])),_:2},1024),e.count?(o(),r(t,{key:0,class:"brand-count"},{default:c((()=>[S(_(e.count),1)])),_:2},1024)):g("",!0)])),_:2},1032,["class","data-current","onClick","id"])))),128))])),_:2},1024)))),128))])),_:1},8,["scroll-top","scroll-into-view"]),p(I,{"scroll-y":"",class:"index-list"},{default:c((()=>[(o(!0),h(b,null,T(f(q),((e,a)=>(o(),r(t,{onClick:a=>(e=>{if(e==Q.value)return;let a=0;Q.value=e,W.value.map((l=>{e!=l.getAttribute("data-title")||(a=l.offsetTop)})),E.value=a-W.value[0].offsetTop})(e),key:a,class:M([{active:f(Q)==e},"index-item"])},{default:c((()=>[S(_(e),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1}),(o(!0),h(b,null,T(f(j),((a,l)=>(o(),h(b,{key:l},[(o(!0),h(b,null,T(a.list,((a,l)=>(o(),h(b,{key:l},[f(R)==a.id?(o(),r(I,{key:0,"scroll-y":"","scroll-top":f(K),class:"right-box"},{default:c((()=>[(o(!0),h(b,null,T(f(D),((l,u)=>(o(),r(t,{class:"page-view",key:u,onClick:e=>(async(e,a)=>{var l,u;if($.isMultiple){if("-1"===a.id){const l=F.value.includes(a.id);return L.value=[],F.value=[],void(l||D.value.forEach((a=>{L.value.push({brandTag:e.id,seriesTag:a.id}),F.value.push(a.id)})))}if(L.value.filter((l=>l.brandTag==e.id&&l.seriesTag==a.id)).length>0){F.value=F.value.filter((e=>e!=a.id));const l=L.value.findIndex((l=>l.seriesTag==a.id&&l.brandTag==e.id));L.value.splice(l,1)}else null==(l=F.value)||l.push(a.id),null==(u=L.value)||u.push({brandTag:e.id,seriesTag:a.id});if(L.value.filter((e=>-1!=+e.seriesTag)).length===D.value.filter((e=>-1!=+e.id)).length)F.value.includes("-1")||(F.value.push("-1"),L.value.push({brandTag:e.id,seriesTag:"-1"}));else if(F.value.includes("-1")){const e=F.value.findIndex((e=>"-1"==e));e>-1&&F.value.splice(e,1);const a=L.value.findIndex((e=>"-1"==e.seriesTag));a>-1&&L.value.splice(a,1)}}else V.value=e.id,F.value=a.id})(a,l)},{default:c((()=>[p(C,{class:"u-line-1"},{default:c((()=>[S(_(l.name),1)])),_:2},1024),e.isMultiple||a.id!=f(V)||l.id!=f(F)?g("",!0):(o(),r(z,{key:0,name:"checkbox-mark",color:"#ff5719",size:"20"})),e.isMultiple&&f(L).filter((e=>e.brandTag==a.id&&e.seriesTag==l.id)).length>0?(o(),r(z,{key:1,name:"checkbox-mark",color:"#ff5719",size:"20"})):g("",!0)])),_:2},1032,["onClick"])))),128))])),_:2},1032,["scroll-top"])):g("",!0)],64)))),128))],64)))),128))],64)):g("",!0),f(Y)&&0==f(j).length?(o(),r(t,{key:1,class:"no-brand"},{default:c((()=>[S("暂无数据")])),_:1})):g("",!0)])),_:1}),p(t,{class:"brand-btn"},{default:c((()=>[p(t,{class:"clear",onClick:le},{default:c((()=>[S("清空")])),_:1}),p(t,{class:"sure",onClick:ue},{default:c((()=>[S("确定")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-9b16d9be"]]);export{I as B};
