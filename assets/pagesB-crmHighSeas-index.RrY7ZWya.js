import{d as e,v as a,r as l,x as t,q as s,b as u,o as i,a as o,a5 as n,w as c,i as r,g as d,R as v,u as h,F as m,e as f,c as p,n as g,t as _,aT as b,z as k,_ as y,a9 as S,I,M as C,K as T,y as j,S as R,P as O,h as x,A as B,B as D,$ as w,E as L,X as $,Y as M,Z as V,a2 as z,a0 as U,bX as N,b8 as Y,ac as F,ad as q,O as H,T as A,Q as P}from"./index-CK4DGatK.js";import{_ as J}from"./add.BenfLO0n.js";import{N as Q}from"./NavBar.DSs5OGCU.js";import{U as X,a as E}from"./u-dropdown-item.B66HFyYv.js";import{c as G}from"./crm.-ZWUD7KR.js";import{u as K}from"./useDict.DwAUsZFY.js";import{R as Z}from"./RecentlyFollowUpTimePicker.CjeN9RbF.js";import{L as W}from"./ListLoadRefreshView.CnNC2lkG.js";import{o as ee}from"./omit.DzeQdT5l.js";import"./_baseGet.CmhOSbYr.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";import"./isSymbol.Bym6OQCA.js";import"./_Uint8Array.B4mhORiM.js";import"./_baseClone.Cc-Y92km.js";const ae=y(e({__name:"allDrop",props:{obj:{type:Object,default:()=>{}},sellData:{type:Object,default:()=>{}}},emits:["search"],setup(e,{emit:y}){const S=y,I=e;a((()=>I.obj),(e=>{j.value=e}),{deep:!0});const C=l(!1),T=l({startTime:"",endTime:""}),j=l({search:"",source:"",startTime:"",endTime:""}),R=t((()=>{var e,a;return[null==(e=T.value)?void 0:e.startTime,null==(a=T.value)?void 0:a.endTime].filter(Boolean).join(" - ")}));s((async()=>{B()}));const{customer_source:O}=K("customer_source"),x=l([]),B=()=>{uni.$u.http.get(G.intentionInfolist,{data:{current:1,size:-1,type:"0"}}).then((e=>{var a,l;x.value=null==(l=null==(a=e.data)?void 0:a.results)?void 0:l.map((e=>({label:e.code,value:e.code})))}))},D=()=>{for(const e in j.value)j.value[e]="";T.value.startTime="",T.value.endTime="",S("search",j.value,!1,"clear")},w=()=>{if(T.value.startTime){const{startTime:e,endTime:a}=T.value;j.value.startTime=e?`${e} 00:00:00`:"",j.value.endTime=a?`${a} 23:59:59`:""}const e=Object.values(j.value).every((e=>[null,void 0,""].includes(e)));S("search",j.value,!e)};return(e,a)=>{const l=r,t=v,s=n;return i(),u(m,null,[o(s,{class:"u-menu-wrap","scroll-y":""},{default:c((()=>[o(l,{class:"models"},{default:c((()=>[o(l,{class:"sub-title"},{default:c((()=>[d("联系人名称/联系电话")])),_:1}),o(t,{modelValue:h(j).search,"onUpdate:modelValue":a[0]||(a[0]=e=>h(j).search=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),o(l,{class:"models"},{default:c((()=>[o(l,{class:"sub-title"},{default:c((()=>[d("客户来源")])),_:1}),o(l,{class:"sub-content"},{default:c((()=>[(i(!0),u(m,null,f(h(O),(e=>(i(),p(l,{onClick:a=>((e,a)=>{j.value[e]=j.value[e]==a.value?"":a.value})("source",e),class:g({active:h(j).source==e.value}),key:e.label},{default:c((()=>[d(_(e.label),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1}),o(l,{class:"models"},{default:c((()=>[o(l,{class:"sub-title"},{default:c((()=>[d("创建时间")])),_:1}),o(t,{modelValue:h(R),readonly:"",placeholder:"请选择",onClick:a[1]||(a[1]=e=>C.value=!0)},null,8,["modelValue"]),(i(),p(b,{to:"body"},[o(Z,{title:"创建时间",format:"YYYY-MM-DD",visible:h(C),"onUpdate:visible":a[2]||(a[2]=e=>k(C)?C.value=e:null),modelValue:h(T),"onUpdate:modelValue":a[3]||(a[3]=e=>k(T)?T.value=e:null)},null,8,["visible","modelValue"])]))])),_:1})])),_:1}),o(l,{class:"brand-btn"},{default:c((()=>[o(l,{class:"clear",onClick:D},{default:c((()=>[d("重置")])),_:1}),o(l,{class:"sure",onClick:w},{default:c((()=>[d("查询")])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-a7ef76d4"]]),le=y(e({__name:"filter",props:{status:{type:Number,default:null},sellData:{type:Object,default:()=>{}}},emits:["search"],setup(e,{expose:a,emit:t}){const{inbound_type:n}=K("inbound_type"),v=t,b=l(),k=S({inboundOrderBy:"1",inboundType:"",source:"",startTime:"",endTime:"",search:""}),y=[{label:"入库时间正序",value:"1"},{label:"入库时间倒序",value:"2"}];s((()=>{b.value.highlight(0,k.inboundOrderBy)}));const R=()=>{},O=()=>{var e;null==(e=b.value)||e.close()},x=()=>{v("search",k),O()},B=(e,a,l)=>{b.value.highlight(l,a.value),k[e]=a.value,x()},D=(e,a,l)=>{Object.assign(k,e),b.value.highlight(2,a),"clear"==l&&(b.value.highlight(2,""),b.value.highlight(1,""),k.source="",k.search="",k.inboundType="",k.startTime="",k.endTime=""),x()};return a({close:O}),(a,l)=>{const t=r,s=I(T("up-icon"),C);return i(),p(X,{ref_key:"uDropdownRef",ref:b,class:"drop",borderRadius:"20rpx",onOpen:R},{default:c((()=>[o(E,{title:"排序"},{default:c((()=>[o(t,{class:"item-list"},{default:c((()=>[(i(),u(m,null,f(y,((e,a)=>o(t,{key:a,class:g({active:h(k).inboundOrderBy==e.value}),onClick:a=>B("inboundOrderBy",e,0)},{default:c((()=>[o(t,null,{default:c((()=>[d(_(e.label),1)])),_:2},1024),h(k).inboundOrderBy==e.value?(i(),p(s,{key:0,name:"checkbox-mark",color:"#ff5719",size:"20"})):j("",!0)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),o(E,{title:"入库类型"},{default:c((()=>[o(t,{class:"item-list"},{default:c((()=>[(i(!0),u(m,null,f(h(n),((e,a)=>(i(),p(t,{key:a,class:g({active:h(k).inboundType==e.value}),onClick:a=>B("inboundType",e,1)},{default:c((()=>[o(t,null,{default:c((()=>[d(_(e.label),1)])),_:2},1024),h(k).inboundType==e.value?(i(),p(s,{key:0,name:"checkbox-mark",color:"#ff5719",size:"20"})):j("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),o(E,{title:"筛选"},{default:c((()=>[o(ae,{onSearch:D,obj:{search:h(k).search,source:h(k).source,startTime:h(k).startTime,endTime:h(k).endTime},sellData:e.sellData},null,8,["obj","sellData"])])),_:1})])),_:1},512)}}}),[["__scopeId","data-v-a5b368cd"]]),te=y(e({__name:"listItem",props:{item:{},isBatch:{type:Boolean,default:!1},allocateOrReceive:{default:2},isReceive:{type:Boolean,default:!1}},emits:["checked","allot","receive"],setup(e,{emit:a}){const l=a;return(e,a)=>{const t=O,s=r,u=x;return i(),p(s,{class:"list-item"},{default:c((()=>[e.isBatch?(i(),p(s,{key:0,onClick:a[0]||(a[0]=R((a=>{return(t=e.item).checked=!t.checked,void l("checked",t,t.checked);var t}),["stop"]))},{default:c((()=>[o(t,{class:"img",src:e.item.checked?"/static/carManage/checked.png":"/static/carManage/check.png"},null,8,["src"])])),_:1})):j("",!0),o(s,{class:"right"},{default:c((()=>[o(s,{class:"title-box"},{default:c((()=>[o(s,{class:"name"},{default:c((()=>[d(_(e.item.customerName),1)])),_:1}),o(s,{class:"tag"},{default:c((()=>[d(_(e.item.highSeasTypeLabel),1)])),_:1})])),_:1}),o(s,{class:"info-box"},{default:c((()=>[d(_(e.item.sourceLabel||"来源未知")+" | ",1),3==e.item.inboundType?(i(),p(u,{key:0},{default:c((()=>[d(_(e.item.lastFollowUserName),1)])),_:1})):j("",!0),d(_(e.item.inboundTypeLabel||"入库类型未知"),1)])),_:1}),o(s,{class:"footer-box"},{default:c((()=>[o(s,null,{default:c((()=>[d("入库时间："+_(e.item.inboundTime||"未知"),1)])),_:1}),e.isBatch||2==e.allocateOrReceive?j("",!0):(i(),p(s,{key:0,class:"btn-box"},{default:c((()=>[0===e.allocateOrReceive?(i(),p(s,{key:0,class:"allot",onClick:a[1]||(a[1]=R((a=>{return t=e.item,void l("allot",t);var t}),["stop"]))},{default:c((()=>[d("分配")])),_:1})):j("",!0),e.isReceive?(i(),p(s,{key:1,class:"allot",onClick:a[2]||(a[2]=R((a=>{return t=e.item,void l("receive",t);var t}),["stop"]))},{default:c((()=>[d("领取")])),_:1})):j("",!0)])),_:1}))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-7c03017f"]]),se=y(e({__name:"index",setup(e){N((e=>({"38958e86":h(ke)})));const a=B(),s=l([]),n=l(),v=l(),b=l([]),k=l(),y=S({current:1,size:10,total:0,highSeasId:"",inboundType:"",inboundOrderBy:"1",clueType:"0"}),x=l(2),K=l(!1);async function Z(){var e,a;V({title:"加载中",mask:!0});try{const e={...ee(y,"total"),highSeasId:y.highSeasId?[y.highSeasId]:[]},a=await w().post(G.getHighSeasCustomerPage,e);y.total=a.data.count;const l=a.data.results.map((e=>({...e,checked:ce.value})));b.value=1===y.current?l:[...b.value,...l]}finally{1==y.current&&(null==(e=k.value)||e.initTop()),null==(a=k.value)||a.loadFinish(),z()}}D((async()=>{var e,a,l,t,u,i;const o=await w().get(G.getHighSeasList);s.value=(null==o?void 0:o.data)||[],y.highSeasId=(null==(e=s.value)?void 0:e.length)?null==(a=s.value)?void 0:a[0].id:"",x.value=(null==(l=s.value)?void 0:l.length)?null==(t=s.value)?void 0:t[0].allocateOrReceive:2,K.value=!!(null==(u=s.value)?void 0:u.length)&&(null==(i=s.value)?void 0:i[0].isReceive),y.highSeasId&&Z()})),L((()=>{$("refreshList"),M("refreshList",(()=>{ae()})),$("sellData"),M("sellData",(e=>{pe(e)}))}));const ae=()=>{y.current=1,Z()},se=()=>{y.current++,Z()},ue=e=>{Object.assign(y,e),ae()},ie=l([]),oe=l(!1),ne=l(!1),ce=l(!1),re=()=>{ne.value=!0,oe.value=!oe.value},de=()=>{ne.value=!1,oe.value=!oe.value,ce.value=!1,ie.value=[],b.value=b.value.map((e=>({...e,checked:ce.value})))},ve=()=>{ce.value=!ce.value,b.value=b.value.map((e=>({...e,checked:ce.value}))),ie.value=ce.value?b.value:[]},he=(e,a)=>{a?ie.value.push(e):ie.value=ie.value.filter((a=>a.clueId!==e.clueId)),ce.value=ie.value.length===b.value.length},me=()=>{var e;if(!(null==(e=ie.value)?void 0:e.length))return U({title:"请先勾选数据",icon:"none"});fe()},fe=e=>{const a=`?title=分配&id=''&sureBtn=1&queryData=${JSON.stringify({highSeasCustomerId:null==e?void 0:e.highSeasCustomerId})}&highSeasId=${y.highSeasId}`;P(`/pages/carManage/sellUserList${a}`)},pe=e=>{var a;const l=JSON.parse(e.queryData),t=(null==l?void 0:l.highSeasCustomerId)?[l.highSeasCustomerId]:null==(a=ie.value)?void 0:a.map((e=>e.highSeasCustomerId)),s=[{userId:e.id,highSeasId:y.highSeasId,highSeasCustomerId:t}];uni.$u.http.post(G.assignHighSeasTask,s).then((()=>{U({title:"分配成功",icon:"none"}),ie.value=[],ce.value=!1,ae()}))},ge=()=>{var e;if(!(null==(e=ie.value)?void 0:e.length))return U({title:"请先勾选数据",icon:"none"});_e()},_e=e=>{var l;const t=a.userInfo.userId,s=(null==e?void 0:e.highSeasCustomerId)?[e.highSeasCustomerId]:null==(l=ie.value)?void 0:l.map((e=>e.highSeasCustomerId)),u={userId:t,highSeasId:y.highSeasId,highSeasCustomerId:s};uni.$u.http.post(G.highSeasReceiveCustomer,u).then((()=>{U({title:"领取成功",icon:"none"}),ie.value=[],ce.value=!1,ae()}))},be=()=>{var e,a;const l=null==(a=null==(e=s.value)?void 0:e.find((e=>e.id===y.highSeasId)))?void 0:a.type,t=`?highSeasId=${y.highSeasId}&highSeasType=${l}`;P(`/pagesB/crmHighSeas/addCustom${t}`)},ke=t((()=>oe.value?"100rpx":"32rpx"));return(e,a)=>{const l=r,t=I(T("up-icon"),C),S=O,B=I(T("u-empty"),Y),D=I(T("u-popup"),F);return i(),p(l,{class:"page f-c-s"},{default:c((()=>[o(Q,null,{title:c((()=>{var e;return[(null==(e=h(s))?void 0:e.length)?(i(),p(l,{key:0,class:"head-drop f-r-a f-r-c"},{default:c((()=>[o(X,{ref_key:"uDropdownRef",ref:n,class:"drop",borderRadius:"20rpx"},{default:c((()=>{var e;return[o(E,{title:null==(e=h(s).find((e=>e.id==h(y).highSeasId)))?void 0:e.name},{default:c((()=>[o(l,{class:"item-list"},{default:c((()=>[(i(!0),u(m,null,f(h(s),((e,a)=>(i(),p(l,{key:a,class:g({active:h(y).highSeasId==e.id}),onClick:a=>(e=>{var a;y.highSeasId=e.id,x.value=e.allocateOrReceive,K.value=e.isReceive,n.value.close(),null==(a=v.value)||a.close(),ae()})(e)},{default:c((()=>[o(l,null,{default:c((()=>[d(_(e.name),1)])),_:2},1024),h(y).highSeasId==e.id?(i(),p(t,{key:0,name:"checkbox-mark",color:"#DD4F33",size:"20"})):j("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["title"])]})),_:1},512)])),_:1})):(i(),p(l,{key:1},{default:c((()=>[d("客户公海")])),_:1}))]})),right:c((()=>{var e;return[(null==(e=h(s))?void 0:e.length)?(i(),p(l,{key:0,class:"nav-right"},{default:c((()=>[o(S,{src:J,onClick:be})])),_:1})):j("",!0)]})),_:1}),o(le,{ref_key:"filterRef",ref:v,onSearch:ue},null,512),o(l,{class:"total"},{default:c((()=>[o(l,null,{default:c((()=>[d("共找到"+_(h(y).total)+"条线索",1)])),_:1}),h(oe)||2==h(x)?j("",!0):(i(),p(l,{key:0,class:"handle-btn"},{default:c((()=>[o(l,{onClick:re},{default:c((()=>[d("批量操作")])),_:1})])),_:1}))])),_:1}),h(oe)?(i(),p(l,{key:0,class:"total"},{default:c((()=>[o(l,{class:"checked",onClick:R(ve,["stop"])},{default:c((()=>[o(S,{class:"img",src:h(ie).length===h(y).total?"/static/carManage/checked.png":h(ie).length?"/static/carManage/halfcheck.png":"/static/carManage/check.png"},null,8,["src"]),d(" 全选 ( "+_(h(ie).length)+"/"+_(h(y).total)+" ) ",1)])),_:1}),o(l,{class:"handle-btn"},{default:c((()=>[o(l,{onClick:de},{default:c((()=>[d("取消操作")])),_:1})])),_:1})])),_:1})):j("",!0),h(y).total?(i(),p(W,q({key:1,ref_key:"listLoadRef",ref:k,class:"scroll-view-box"},h(y),{istop:!1,onLoadMore:se,onLoadRefresh:ae}),{default:c((()=>[H(o(l,{class:"list-box"},{default:c((()=>[(i(!0),u(m,null,f(h(b),((e,a)=>(i(),p(te,{key:a,item:e,isBatch:h(oe),allocateOrReceive:h(x),isReceive:h(K),onChecked:he,onAllot:fe,onReceive:_e,onClick:e=>{}},null,8,["item","isBatch","allocateOrReceive","isReceive","onClick"])))),128))])),_:1},512),[[A,h(b).length]])])),_:1},16)):(i(),p(B,{key:2,mode:"list",text:"暂无数据"})),o(D,{overlay:!1,mode:"bottom",round:20,closeOnClickOverlay:!0,show:h(ne),onClose:a[0]||(a[0]=e=>ne.value=!1)},{default:c((()=>[o(l,{class:"action-box"},{default:c((()=>[0===h(x)?(i(),p(l,{key:0,onClick:R(me,["stop"])},{default:c((()=>[o(t,{name:"plus-square-fill",size:"22"}),o(l,null,{default:c((()=>[d("批量分配")])),_:1})])),_:1})):j("",!0),h(K)?(i(),p(l,{key:1,onClick:R(ge,["stop"])},{default:c((()=>[o(t,{name:"plus-people-fill",size:"22"}),o(l,null,{default:c((()=>[d("批量领取")])),_:1})])),_:1})):j("",!0)])),_:1})])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-145b1b92"]]);export{se as default};
