import{d as a,r as e,B as l,aa as s,a3 as t,X as u,c as r,w as o,i as c,I as d,ag as n,K as i,ah as A,o as v,a as g,y as p,a5 as f,b as m,g as h,P as k,F as w,e as _,ai as S,D as y,U as I,a0 as C,a1 as x,_ as E}from"./index-CK4DGatK.js";import{_ as F,a as Q,b as B}from"./icon_right.CReGUlPS.js";import{_ as J}from"./checked.CRtZb0Og.js";import{_ as T,a as z}from"./album.BQJzdOdy.js";const K=E(a({__name:"index",setup(a){const E=e(""),K=e(""),P=e(0),b=e([]),G=e(),D=e(),M=e(!1),O=e(!1);l((a=>{G.value=a.carProductId,U(),R(),s("updateData",(({content:a,id:e,posterId:l})=>{a&&(E.value=a),e&&(K.value=e),l&&X({id:e})}))}));const U=()=>{uni.$u.http.get("product/contentManagement/list",{params:{current:1,size:1,carProductId:G.value,status:1}}).then((a=>{var e,l;E.value=null==(e=a.data.results[0])?void 0:e.content,K.value=null==(l=a.data.results[0])?void 0:l.id}))},R=()=>{uni.$u.http.get("product/posterOperating/pageList",{params:{current:1,size:4,status:1}}).then((a=>{var e,l;if(b.value=a.data.results,!b.value.length)return O.value=!0,!1;P.value=null==(e=a.data.results[0])?void 0:e.id,q(null==(l=a.data.results[0])?void 0:l.id)}))},q=a=>{M.value=!0,uni.$u.http.post("product/posterOperating/generate",{posterId:a,carProductId:G.value}).then((a=>{D.value=a.data,M.value=!1}))},L=async()=>{var a;await S({data:(a=E.value,a.replace(/(<!--)([\s\S]*?)(-->)/g,"").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/(<style)([\s\S]*?)(\/style scoped>)/g,"").replace(/(<textarea)([\s\S]*?)(\/>)/g,"").replace(/(<input)([\s\S]*?)(\/>)/g,"").replace(/&([\s\S]*?);/g,"").replace(/(?=\<[\s\S]*?)([\s\S]*?)(?=\>)/g,"").replace(/\>/g," ").replace(/\s+/g," "))}),(new y).showToast("复制成功")},X=a=>{P.value=a.id,q(a.id)},Y=()=>{uni.$u.route({url:`pagesA/share/documentList?carProductId=${G.value}&documentTextId=${K.value}`})},H=()=>{uni.$u.route({url:`pagesA/share/posterList?moduleIndexId=${P.value}`})},Z=async a=>{if(!D.value)return(new y).showToast("海报生成中..."),!1;await L(),I.share({category:a,contentType:"image",title:"",msg:"",images:[D.value],thumbData:D.value})},j=async()=>{if(!D.value)return(new y).showToast("海报生成中..."),!1;await L(),I.download({url:D.value,fileName:"车源海报.jpg",showProgress:!1}).then((a=>{a&&C({title:"下载成功",icon:"none"})}))},V=()=>{x()};return t((()=>{u("updateData")})),(a,e)=>{const l=c,s=k,t=d(i("u-loading-icon"),n),u=f,S=d(i("u-modal"),A);return v(),r(l,{class:"page"},{default:o((()=>[g(u,{"scroll-y":"",class:"scroll-view"},{default:o((()=>[E.value?(v(),r(l,{key:0,class:"module"},{default:o((()=>[g(l,{class:"module-title"},{default:o((()=>[g(l,null,{default:o((()=>[h("文案推荐")])),_:1}),g(l,{onClick:Y},{default:o((()=>[h(" 更多 "),g(s,{src:F})])),_:1})])),_:1}),g(l,{class:"document"},{default:o((()=>[g(l,{innerHTML:E.value},null,8,["innerHTML"]),g(s,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAkJJREFUWEftl0FrE0EUx/9vNtGKFHrooccePPgRIhTszVyE9hto2J1sySn0CywoeMzFuLtpKX4AoQqCikopIvgB9ObBQlta8FAx0pSmebKJgXW62Zk0uxTEuS3vvXk//jPz3lvCJS/S5fdbG3eIMKXzG9oFd79KKb+Y+qcC+P7aIlm0ZbrZH7+OgChLWdk2iUsFeBKGS4KsTWYcEPBJuyFhqe/D3BZULEl5T6uEEQCA5660l3UAQWudYz67BYEF27Z30uLyAWB+DaIyGN8swSXHcQ5HQeQCcHZ6Mi2KV94SqATG57Puya1ardZOgsgFwJU2NZvNOVG8+oGAGwx+d7i/d9fzvI4KkRtAlMj3/XkSxS0Q5gF+ebC/t+x5XjcOkQsASAxeQ/9F9G4y80MiKgB46kr7fv4AKdeeIcorsvJm6JKpAmG4tsqghaT8DJSIMBep4zqVF4kAYRjOMokHEPTMte33w0I0rAORvQfrEQGz/Q0IR8e/ftbr9fqRtkaE65uIClUagJpQ/W4GQdkShVfxZAJi0aTsBlkARIlbrY3bPcLMoOKiEz/PNBUyA9BJPcr+7wCYzAfUO/1YrVa/x9XIRAHz+YADVzormQM0Go2Za9enG+DBJRy5LDyOnnHmABe9gFFcJkfwH+DSFDAeSlO7oEEzMqn9k6gQxaq94692rAKotX/S5Em9QwswaVJdfCLAhc6cqAvBgVqAxgJI6ve6DRT7uZlPF39uJIv3e12waj9u/9g2mY7icdq/43EhxvX/DYpUuDC76w0yAAAAAElFTkSuQmCC",onClick:L})])),_:1})])),_:1})):p("",!0),b.value.length?(v(),m(w,{key:1},[g(l,{class:"module"},{default:o((()=>[g(l,{class:"module-title"},{default:o((()=>[g(l,null,{default:o((()=>[h("海报模版")])),_:1}),g(l,{onClick:H},{default:o((()=>[h(" 更多 "),g(s,{src:F})])),_:1})])),_:1}),g(l,{class:"module-list"},{default:o((()=>[(v(!0),m(w,null,_(b.value,((a,e)=>(v(),r(l,{key:e,onClick:e=>X(a)},{default:o((()=>[g(s,{src:a.tmpUrl,class:"main-img",mode:"widthFix"},null,8,["src"]),P.value==a.id?(v(),r(s,{key:0,src:J,class:"check-img"})):p("",!0)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),g(l,{class:"main-module"},{default:o((()=>[g(s,{src:D.value,mode:"widthFix"},null,8,["src"]),M.value?(v(),r(l,{key:0,class:"loading"},{default:o((()=>[g(t,{color:"#fff",size:"36"})])),_:1})):p("",!0)])),_:1})],64)):p("",!0)])),_:1}),b.value.length?(v(),r(l,{key:0,class:"share-box"},{default:o((()=>[g(l,{onClick:e[0]||(e[0]=a=>Z("wxSession"))},{default:o((()=>[g(s,{src:T}),g(l,null,{default:o((()=>[h("微信")])),_:1})])),_:1}),g(l,{onClick:e[1]||(e[1]=a=>Z("wxTimeline"))},{default:o((()=>[g(s,{src:Q}),g(l,null,{default:o((()=>[h("微信朋友圈")])),_:1})])),_:1}),g(l,{onClick:e[2]||(e[2]=a=>Z("wxworkSession"))},{default:o((()=>[g(s,{src:B}),g(l,null,{default:o((()=>[h("企业微信")])),_:1})])),_:1}),g(l,{onClick:j},{default:o((()=>[g(s,{src:z}),g(l,null,{default:o((()=>[h("保存至相册")])),_:1})])),_:1})])),_:1})):p("",!0),g(S,{show:O.value,title:"提示",content:"暂无海报模板",width:"300",onConfirm:V},null,8,["show"])])),_:1})}}}),[["__scopeId","data-v-feda2ece"]]);export{K as default};
