import{d as a,A as e,r as s,a9 as t,B as l,E as u,X as r,Y as d,au as o,x as n,c,w as i,i as p,I as m,M as f,K as _,o as h,a as v,y as g,u as y,g as U,t as k,h as I,n as P,R as D,a7 as b,Q as j,W as w,D as N,a1 as S,s as T,_ as x}from"./index-CK4DGatK.js";import{U as A}from"./UploadFile.BBuXxkzB.js";import{u as L}from"./useQuery.3dd8K18V.js";import{a as O}from"./index.HDA2F_3Q.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const $=x(a({__name:"purchaseInfo",setup(a){const x=L(),$=e();s({});const M=t({picUrls:[]}),V=s([]),C=s();l((()=>{"SoldOut"!=x.value.status&&"Locked"!=x.value.status&&"ToBeSigned"!=x.value.status&&"PaymentIng"!=x.value.status&&E(),Y()})),u((()=>{r("pickData"),d("pickData",(a=>{const{key:e,subKey:s}=a;M[s]=e})),r("sellData"),d("sellData",(a=>{const{name:e,id:s}=a;M.assessUserName=e,M.assessUserId=s}))}));const Y=()=>{uni.$u.http.get("/product/merchant/car/product/getPurchaseDetail",{params:{carProductId:x.value.carProductId}}).then((a=>{var e,s;Object.assign(M,a.data);const t=a.data.assessDate;M.assessDate=t?o(t).format("YYYY-MM-DD"):t,M.assessUserName=a.data.assessUserName||(null==(e=$.userInfo)?void 0:e.name),M.assessUserId=a.data.assessUserId||(null==(s=$.userInfo)?void 0:s.userId)}))},E=()=>{uni.$u.http.get("/admin/dict/type/purchase_type").then((a=>{V.value=a.data.map((a=>({value:a.label,key:a.value})))}))},J=n((()=>R(V.value,M.purchaseType))),R=(a,e)=>{const s=null==a?void 0:a.filter((a=>a.key==e));return(null==s?void 0:s.length)?s[0].value:"请选择"},B=()=>{var a,e;(new N).showLoading("提交中");const s=JSON.parse(JSON.stringify(M));s.picUrls=(null==(e=null==(a=C.value)?void 0:a.getFileFields())?void 0:e.all.map((a=>a.attachmentId)))||[],uni.$u.http.post("/product/merchant/car/product/updateCarProductPurchase",s).then((()=>{(new N).showToast("保存成功"),setTimeout((()=>{S()}),1500)}))},F=(a,e,s)=>{T((()=>{M[e]=O(a,s)}))};return(a,e)=>{const s=p,t=I,l=m(_("up-icon"),f),u=D,r=b,d=w;return h(),c(s,{class:"page pend-page f-c-s"},{default:i((()=>[v(s,{class:"content"},{default:i((()=>["SoldOut"!=y(x).status&&"Locked"!=y(x).status&&"ToBeSigned"!=y(x).status&&"PaymentIng"!=y(x).status&&y(M).canEdit?(h(),c(s,{key:1,class:"form-box write"},{default:i((()=>[v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("采购类型")])),_:1}),v(s,{class:"f-b-c",onClick:e[0]||(e[0]=a=>{return e="采购类型",s=y(V),t=y(M).purchaseType,l="purchaseType",void j(`/pages/carManage/pagePicker?title=${e}&list=${JSON.stringify(s)}&key=${t}&subKey=${l}`);var e,s,t,l})},{default:i((()=>[v(t,{class:P({placeholder:"请选择"==y(J)})},{default:i((()=>[U(k(y(J)),1)])),_:1},8,["class"]),v(l,{name:"arrow-right"})])),_:1})])),_:1}),v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("采购价")])),_:1}),v(u,{modelValue:y(M).purchasePrice,"onUpdate:modelValue":e[1]||(e[1]=a=>y(M).purchasePrice=a),type:"digit",placeholder:"请输入",onInput:e[2]||(e[2]=a=>F(a.detail.value,"purchasePrice","wanyuan"))},null,8,["modelValue"]),U(" 万元 ")])),_:1}),v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("已付金额")])),_:1}),v(u,{modelValue:y(M).paidAmount,"onUpdate:modelValue":e[3]||(e[3]=a=>y(M).paidAmount=a),type:"number",placeholder:"请输入",maxlength:"7",onInput:e[4]||(e[4]=a=>F(a.detail.value,"paidAmount","yuan"))},null,8,["modelValue"]),U(" 元 ")])),_:1}),v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("采购日期")])),_:1}),v(r,{mode:"date",value:y(M).assessDate,onChange:e[5]||(e[5]=a=>{return e=a,void(M["assessDate"]=e.detail.value);var e})},{default:i((()=>[v(s,{class:P({placeholder:!y(M).assessDate})},{default:i((()=>[U(k(y(M).assessDate||"请选择"),1)])),_:1},8,["class"])])),_:1},8,["value"]),v(l,{name:"arrow-right"})])),_:1}),v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("评估师")])),_:1}),v(s,{class:"f-b-c",onClick:e[6]||(e[6]=e=>("toPage"in a?a.toPage:y(j))(`/pages/carManage/sellUserList?title=评估师&id=${y(M).assessUserId}&userType=APPRAISER`))},{default:i((()=>[v(t,{class:P({placeholder:!y(M).assessUserName})},{default:i((()=>[U(k(y(M).assessUserName||"请选择"),1)])),_:1},8,["class"]),v(l,{name:"arrow-right"})])),_:1})])),_:1}),v(s,{class:"form-item photo-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("资料照片")])),_:1}),v(A,{ref_key:"infoUploadRef",ref:C,carAttachmentType:"SalesOrder",accept:"all","max-count":1,uploadList:y(M).picUrls},null,8,["uploadList"])])),_:1})])),_:1})):(h(),c(s,{key:0,class:"form-box"},{default:i((()=>[v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("采购类型")])),_:1}),U(" "+k(y(M).purchaseTypeName),1)])),_:1}),v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("采购价")])),_:1}),U(" "+k(y(M).purchasePrice?y(M).purchasePrice+"万元":"-"),1)])),_:1}),v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("已付金额")])),_:1}),U(" "+k(y(M).paidAmount?y(M).paidAmount+"元":"-"),1)])),_:1}),v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("采购日期")])),_:1}),U(" "+k(y(M).assessDate),1)])),_:1}),v(s,{class:"form-item"},{default:i((()=>[v(s,null,{default:i((()=>[U("评估师")])),_:1}),U(" "+k(y(M).assessUserName),1)])),_:1}),v(s,{class:"form-item photo-item"},{default:i((()=>{var a;return[v(s,null,{default:i((()=>[U("资料照片")])),_:1}),(null==(a=y(M).picUrls)?void 0:a.length)?(h(),c(A,{key:0,accept:"all",uploadList:y(M).picUrls,detail:1},null,8,["uploadList"])):(h(),c(t,{key:1},{default:i((()=>[U("-")])),_:1}))]})),_:1})])),_:1}))])),_:1}),"SoldOut"!=y(x).status&&"Locked"!=y(x).status&&y(M).canEdit?(h(),c(s,{key:0,class:"bottom-btn"},{default:i((()=>[v(d,{class:"save-btn w_100",onClick:B},{default:i((()=>[U("保存")])),_:1})])),_:1})):g("",!0)])),_:1})}}}),[["__scopeId","data-v-f5a14142"]]);export{$ as default};
