import{d as a,A as e,r as t,E as s,Z as l,a2 as u,$ as r,c as n,w as i,i as o,o as c,y as d,a as p,b as m,u as f,g as v,t as y,F as _,e as h,P as k,Q as g,h as I,W as j,D as P,bG as b,an as w,_ as A}from"./index-CK4DGatK.js";import{g as T}from"./time._VqwKl0d.js";import{_ as x}from"./avatar.Buy0-vr1.js";import{L as S}from"./listItem.De6Dqo0z.js";import{R as D}from"./refuse.BEcO0WCW.js";import{N as F}from"./NavBar.DSs5OGCU.js";import{u as K}from"./useQuery.3dd8K18V.js";import"./index.HDA2F_3Q.js";import"./car_default.CyENNAub.js";import"./purchase.B8DNaFGL.js";import"./fixPrice.CFXyKkhm.js";import"./base.6l0JEBJr.js";import"./close.Dhgi5Ijg.js";const $=A(a({__name:"examinePurchasePrice",setup(a){const A=K(),$=e(),C=t(),q=t(!1),N=t({});s((async()=>{l({title:"加载中",mask:!0});try{!async function(){var a;if(!A.value.purchaseApproveId)return;const e={purchaseApproveId:A.value.purchaseApproveId},t=await r().post("/product/purchase/queryUpdatePurchaseDetail",e,{});q.value="0"===(null==(a=A.value)?void 0:a.status),N.value=null==t?void 0:t.data,(null==t?void 0:t.data.attachments.length)>0&&(N.value.attachments=null==t?void 0:t.data.attachments.map((a=>a.attachmentUrl)));!async function(){const a=await r().post("/product/purchase/updatePurchase/track",{purchaseApproveId:A.value.purchaseApproveId});O.value=(null==a?void 0:a.data)??[]}()}()}finally{u()}}));const O=t([]);const U=(a,e="")=>{var t,s,l;(new P).showLoading("提交中");const u={taskId:null==(t=A.value)?void 0:t.taskId,taskDefinitionKey:null==(s=A.value)?void 0:s.taskDefinitionKey,primaryKey:null==(l=A.value)?void 0:l.primaryKey,auditOpinion:a};e&&(u.comment=e),uni.$u.http.post("/product/purchase/taskTurnover",u).then((()=>{"qw"==A.value.pushType||"app"==A.value.pushType?b(`/pages/purchaseOrder/examinePurchasePrice?taskId=${A.value.taskId}&primaryKey=${A.value.primaryKey}&taskDefinitionKey=MODIFY_PURCHASE_AUDIT&status=1&purchaseApproveId=${A.value.purchaseApproveId}`):w()}))};return(a,e)=>{const t=o,s=k,l=I,u=j;return c(),n(t,{class:"page f-c-s"},{default:i((()=>{var r;return[f($).needShowQw()?d("",!0):(c(),n(F,{key:0,title:"修改采购价"})),p(t,{class:"header"},{default:i((()=>[p(S,{item:f(N),page:"detail",mortgageStatusMap:{},query:f(A)},null,8,["item","query"])])),_:1}),p(t,{class:"bgFff"},{default:i((()=>[p(t,{class:"form-item"},{default:i((()=>[p(t,null,{default:i((()=>[v("修改后采购价")])),_:1}),p(t,null,{default:i((()=>{var a;return[v(y((null==(a=f(N))?void 0:a.modifyPrice)||"-")+"万元",1)]})),_:1})])),_:1}),p(t,{class:"form-item"},{default:i((()=>[p(t,null,{default:i((()=>[v("修改原因")])),_:1}),p(t,null,{default:i((()=>{var a;return[v(y((null==(a=f(N))?void 0:a.modifyReasonName)||"-"),1)]})),_:1})])),_:1}),p(t,{class:"form-item"},{default:i((()=>[p(t,null,{default:i((()=>[v("备注")])),_:1}),p(t,null,{default:i((()=>{var a;return[v(y((null==(a=f(N))?void 0:a.remark)||"-"),1)]})),_:1})])),_:1}),p(t,{class:"form-item",style:{"align-items":"flex-start"}},{default:i((()=>[p(t,{class:"area-title"},{default:i((()=>[v("附件")])),_:1}),f(N).attachments&&f(N).attachments.length>0?(c(),n(t,{key:0},{default:i((()=>[(c(!0),m(_,null,h(f(N).attachments,((e,t)=>(c(),n(s,{class:"attac",key:e.id,src:e,mode:"aspectFill",onClick:e=>("toPage"in a?a.toPage:f(g))(`/pages/guide/imageView?type=1&imageList=${JSON.stringify(f(N).attachments||"[]")}&index=${t}`)},null,8,["src","onClick"])))),128))])),_:1})):(c(),n(t,{key:1},{default:i((()=>[v("-")])),_:1}))])),_:1})])),_:1}),(null==(r=f(O))?void 0:r.length)?(c(),m(_,{key:1},[p(t,{class:"title"},{default:i((()=>[v("审核流程")])),_:1}),p(t,{class:"flow bgFff"},{default:i((()=>[(c(!0),m(_,null,h(f(O),((e,u)=>(c(),m(_,{key:u},[p(t,{class:"personnel"},{default:i((()=>[p(t,null,{default:i((()=>[e.avatar?(c(),n(s,{key:0,src:e.avatar,mode:"scaleToFill"},null,8,["src"])):(c(),n(s,{key:1,src:x,mode:"aspectFill"})),p(t,null,{default:i((()=>[p(t,{class:"mb10"},{default:i((()=>[v(y(1==e.operateType?"发起人":"审核人"),1)])),_:2},1024),p(t,{class:"personnel-name mb10"},{default:i((()=>[v(y(e.createUserName)+" ",1),1==e.status?(c(),n(l,{key:0,class:"green"},{default:i((()=>[v("(已同意)")])),_:1})):d("",!0),0==e.status?(c(),n(l,{key:1,class:"red"},{default:i((()=>[v("(已拒绝)")])),_:1})):d("",!0)])),_:2},1024),p(t,null,{default:i((()=>[v(y(e.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),p(t,{class:"personnel-name"},{default:i((()=>[v(y(("getTimeBySplitSecond"in a?a.getTimeBySplitSecond:f(T))(e.operateTime)),1)])),_:2},1024)])),_:2},1024),u!==f(O).length-1?(c(),n(t,{key:0,class:"steps"},{default:i((()=>[p(t)])),_:1})):d("",!0)],64)))),128))])),_:1})],64)):d("",!0),f(q)?(c(),n(t,{key:2,class:"bottom-btn"},{default:i((()=>[p(u,{onClick:e[0]||(e[0]=a=>f(C).open())},{default:i((()=>[v("拒绝")])),_:1}),p(u,{class:"save-btn",onClick:e[1]||(e[1]=a=>U(1))},{default:i((()=>[v("同意")])),_:1})])),_:1})):d("",!0),p(D,{ref_key:"refuseRef",ref:C,onConfirm:e[2]||(e[2]=a=>U(0,a))},null,512)]})),_:1})}}}),[["__scopeId","data-v-495ade77"]]);export{$ as default};
