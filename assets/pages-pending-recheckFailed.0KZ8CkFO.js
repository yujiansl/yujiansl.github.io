import{d as a,A as e,r as t,a9 as s,B as l,b2 as r,D as u,a2 as i,c as n,w as o,i as d,o as c,y as p,a as m,u as f,b as _,g as k,t as h,F as v,e as y,P as g,Q as P,h as w,R as I,aj as j,W as O,s as x,an as b,_ as K}from"./index-CK4DGatK.js";import{_ as R}from"./avatar.Buy0-vr1.js";import{N as C}from"./NavBar.DSs5OGCU.js";import{D}from"./listItem.CnogksUc.js";import{R as N}from"./refuse.BEcO0WCW.js";import{u as V}from"./useQuery.3dd8K18V.js";import{a as $,p as L}from"./index.HDA2F_3Q.js";import"./car_default.CyENNAub.js";import"./task.Cx6XxNwo.js";import"./isNil.aV-w2MPu.js";import"./close.Dhgi5Ijg.js";const S=K(a({__name:"recheckFailed",setup(a){const K=V(),S=e(),T=t(),E=t({}),A=t([]),Q=s({purchasePrice:"",remarks:""}),F=t(""),U=t([]);l((()=>{r({title:"pend"==K.value.task?"车辆复检不通过":"确认采购价"}),q(),B()}));const q=()=>{(new u).showLoading("加载中");const a={id:K.value.primaryKey};1==K.value.status&&(a.taskId=K.value.taskId),uni.$u.http.get("/product/purchaseOrder/queryReInspectionRejectInfo",{params:a}).then((a=>{var e;E.value=a.data,Q.purchasePrice=a.data.purchasePrice;const t=null==(e=a.data.approveList)?void 0:e.filter((a=>"RE_INSPECTION"==a.approveType))[0];U.value=null==t?void 0:t.attachments.map((a=>a.attachmentUrl)),F.value=null==t?void 0:t.remarks,i()}))},B=()=>{uni.$u.http.get("/product/process/getExamineAndApproveList",{params:{primaryKey:K.value.primaryKey}}).then((a=>{A.value=a.data}))},J=()=>{if(!Q.purchasePrice)return void(new u).showToast("请输入采购价");(new u).showLoading("提交中");const a={taskId:K.value.taskId,taskDefinitionKey:K.value.taskDefinitionKey,purchaseOrderId:K.value.primaryKey,...Q};uni.$u.http.post("/product/purchaseOrder/editPurchasePrice",a).then((()=>{b()})).catch((a=>{L(a.message)}))},M=(a,e="")=>{(new u).showLoading("提交中");const t={taskId:K.value.taskId,taskDefinitionKey:K.value.taskDefinitionKey,purchaseOrderId:K.value.primaryKey};""!==a&&(t.passOrReject=a),e&&(t.auditOpinion=e),uni.$u.http.post("/product/purchaseOrder/confirmPurchasePrice",t).then((()=>{b()})).catch((a=>{L(a.message)}))};return(a,e)=>{const t=d,s=g,l=w,r=I,u=j,i=O;return c(),n(t,{class:"page pend-page"},{default:o((()=>[f(S).needShowQw()?p("",!0):(c(),n(C,{key:0,title:""})),m(t,{class:"content"},{default:o((()=>{var i;return[m(D,{item:f(E),isDetail:!0},null,8,["item"]),m(t,{class:"form-box"},{default:o((()=>[m(t,{class:"form-item"},{default:o((()=>[m(t,{class:"area-title"},{default:o((()=>[k("复检结果")])),_:1}),k(" 不通过 ")])),_:1}),m(t,{class:"form-textarea"},{default:o((()=>[m(t,{class:"area-title"},{default:o((()=>[k("备注")])),_:1}),m(t,{class:"word-warp"},{default:o((()=>[k(h(f(F)||"-"),1)])),_:1})])),_:1}),m(t,{class:"form-item"},{default:o((()=>{var e;return[m(t,null,{default:o((()=>[k("修复前图片")])),_:1}),(null==(e=f(U))?void 0:e.length)?(c(),n(t,{key:0,class:"img-list"},{default:o((()=>[(c(!0),_(v,null,y(f(U),((e,t)=>(c(),n(s,{key:t,src:e,mode:"aspectFill",onClick:e=>("toPage"in a?a.toPage:f(P))(`/pages/guide/imageView?type=1&imageList=${JSON.stringify(f(U))}&index=${t}`)},null,8,["src","onClick"])))),128))])),_:1})):(c(),n(l,{key:1},{default:o((()=>[k("-")])),_:1}))]})),_:1})])),_:1}),m(t,{class:"form-box"},{default:o((()=>[m(t,{class:"form-item"},{default:o((()=>[m(t,null,{default:o((()=>[k("原采购价")])),_:1}),k(" "+h(f(E).purchasePriceOld)+"万元 ",1)])),_:1}),"confirm"==f(K).task&&0==f(K).status||1==f(K).status?(c(),_(v,{key:0},[m(t,{class:"form-item"},{default:o((()=>[m(t,null,{default:o((()=>[k("修改后采购价")])),_:1}),k(" "+h(f(E).purchasePrice?f(E).purchasePrice+"万元":"-"),1)])),_:1}),m(t,{class:"form-textarea"},{default:o((()=>[m(t,{class:"area-title"},{default:o((()=>[k("备注")])),_:1}),m(t,{class:"word-warp"},{default:o((()=>[k(h(f(E).remarks||"-"),1)])),_:1})])),_:1})],64)):p("",!0)])),_:1}),"pend"==f(K).task&&0==f(K).status?(c(),n(t,{key:0,class:"form-box write"},{default:o((()=>[m(t,{class:"form-item"},{default:o((()=>[m(t,null,{default:o((()=>[m(l,null,{default:o((()=>[k("*")])),_:1}),k("修改采购价")])),_:1}),m(r,{modelValue:f(Q).purchasePrice,"onUpdate:modelValue":e[0]||(e[0]=a=>f(Q).purchasePrice=a),modelModifiers:{trim:!0},type:"digit",placeholder:"请输入",onInput:e[1]||(e[1]=a=>{return e=a.detail.value,t="purchasePrice",s="wanyuan",void x((()=>{Q[t]=$(e,s)}));var e,t,s})},null,8,["modelValue"]),k(" 万元 ")])),_:1}),m(t,{class:"form-textarea"},{default:o((()=>[m(t,{class:"area-title"},{default:o((()=>[k("备注")])),_:1}),m(u,{modelValue:f(Q).remarks,"onUpdate:modelValue":e[2]||(e[2]=a=>f(Q).remarks=a),placeholder:"请输入改价原因",maxlength:"1000"},null,8,["modelValue"]),m(t,{class:"limit"},{default:o((()=>{var a;return[k(h((null==(a=f(Q).remarks)?void 0:a.length)||0)+"/1000",1)]})),_:1})])),_:1})])),_:1})):p("",!0),(null==(i=f(A))?void 0:i.length)?(c(),_(v,{key:1},[m(t,{class:"section-title"},{default:o((()=>[k("审批流程")])),_:1}),m(t,{class:"pend-list"},{default:o((()=>[(c(!0),_(v,null,y(f(A),((a,e)=>(c(),n(t,{class:"pend-item",key:e},{default:o((()=>[a.avatar?(c(),n(s,{key:0,src:a.avatar},null,8,["src"])):(c(),n(s,{key:1,src:R})),m(t,{class:"item-info"},{default:o((()=>[m(t,null,{default:o((()=>[m(t,null,{default:o((()=>[k(h(a.name),1)])),_:2},1024),m(t,null,{default:o((()=>[k(h(a.createTime),1)])),_:2},1024)])),_:2},1024),m(t,{class:"tip"},{default:o((()=>[k(h("START_PROCESS"===a.taskDefinitionKey?"发起审批":1==a.status?"已同意":2==a.status?"已拒绝":"已处理"),1)])),_:2},1024),a.auditOpinion?(c(),n(t,{key:0,class:"tip"},{default:o((()=>[k("拒绝原因："+h(a.auditOpinion),1)])),_:2},1024)):p("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})],64)):p("",!0)]})),_:1}),"pend"==f(K).task&&1!=f(K).status?(c(),n(t,{key:1,class:"bottom-btn"},{default:o((()=>[m(i,{class:"save-btn",onClick:J},{default:o((()=>[k("确定")])),_:1})])),_:1})):p("",!0),"confirm"==f(K).task&&1!=f(K).status?(c(),n(t,{key:2,class:"bottom-btn"},{default:o((()=>[m(i,{onClick:e[3]||(e[3]=a=>f(T).open())},{default:o((()=>[k("拒绝")])),_:1}),m(i,{class:"save-btn",onClick:e[4]||(e[4]=a=>M(1))},{default:o((()=>[k("确认")])),_:1})])),_:1})):p("",!0),m(N,{ref_key:"refuseRef",ref:T,onConfirm:e[5]||(e[5]=a=>M(0,a))},null,512)])),_:1})}}}),[["__scopeId","data-v-62a4dc9c"]]);export{S as default};
