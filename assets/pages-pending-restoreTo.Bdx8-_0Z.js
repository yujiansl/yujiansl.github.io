import{d as a,A as e,r as t,B as l,b2 as s,D as i,a2 as o,c as r,w as u,i as n,o as d,y as m,a as p,u as f,g as c,b as _,F as v,e as A,P as E,Q as y,h as T,t as h,aj as g,z as k,W as I,an as R,_ as N}from"./index-CK4DGatK.js";import{N as j}from"./NavBar.DSs5OGCU.js";import{D as w}from"./listItem.CnogksUc.js";import{U as S}from"./UploadFile.BBuXxkzB.js";import{T as x}from"./task.Cx6XxNwo.js";import{u as L}from"./useQuery.3dd8K18V.js";import{p as P}from"./index.HDA2F_3Q.js";import"./avatar.Buy0-vr1.js";import"./car_default.CyENNAub.js";import"./refuse.BEcO0WCW.js";import"./close.Dhgi5Ijg.js";import"./isNil.aV-w2MPu.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const D=N(a({__name:"restoreTo",setup(a){const N=L(),D=e(),H=t({}),F=t([]),b=t(""),C=t(),G=t([]),K=t("");l((()=>{const a=N.value.taskDefinitionKey;s({title:a===x["钣金修复待办"]?"钣金修复":a===x["补漆修复待办"]?"补漆修复":"洗车整备"}),M()}));const M=()=>{(new i).showLoading("加载中"),uni.$u.http.get("product/purchaseOrder/queryServicingDetails",{params:{id:N.value.primaryKey}}).then((a=>{var e,t;H.value=a.data;const l={SHEET_METAL:"SHEET_METAL",PAINTING_REPAIR:"REPAINTING",CAR_WASHING:"CAR_WASH"},s=null==(e=a.data.approveList)?void 0:e.filter((a=>a.approveType==l[N.value.taskDefinitionKey]))[0];if(F.value=null==s?void 0:s.attachments.map((a=>a.attachmentUrl)),b.value=null==s?void 0:s.remarks,1==N.value.status){const e={SHEET_METAL:"SHEET_METAL_AFTER",PAINTING_REPAIR:"REPAINTING_AFTER",CAR_WASHING:"CAR_WASH_AFTER"},l=null==(t=a.data.approveList)?void 0:t.filter((a=>a.approveType==e[N.value.taskDefinitionKey]))[0];G.value=null==l?void 0:l.attachments,K.value=null==l?void 0:l.remarks}o()}))},W=()=>{var a,e;const t=(null==(e=null==(a=C.value)?void 0:a.getFileFields())?void 0:e.all.map((a=>a.id)))||[];if(!t.length)return void(new i).showToast("请上传照片凭证");(new i).showLoading("提交中");const l={taskId:N.value.taskId,purchaseOrderId:N.value.primaryKey,type:{SHEET_METAL:"SHEET_METAL_AFTER",PAINTING_REPAIR:"REPAINTING_AFTER",CAR_WASHING:"CAR_WASH_AFTER"}[N.value.taskDefinitionKey],attachments:t,auditOpinion:K.value};uni.$u.http.post("/product/purchaseOrder/sheetMetalPending",l).then((()=>{R()})).catch((a=>{P(a.message)}))};return(a,e)=>{const t=n,l=E,s=T,i=g,o=I;return d(),r(t,{class:"page pend-page"},{default:u((()=>[f(D).needShowQw()?m("",!0):(d(),r(j,{key:0,title:""})),p(t,{class:"content"},{default:u((()=>[p(w,{item:f(H),isDetail:!0},null,8,["item"]),f(N).taskDefinitionKey!==f(x)["洗车待办"]?(d(),r(t,{key:0,class:"form-box"},{default:u((()=>[p(t,{class:"form-item"},{default:u((()=>{var e;return[p(t,null,{default:u((()=>[c("修复前图片")])),_:1}),(null==(e=f(F))?void 0:e.length)?(d(),r(t,{key:0,class:"img-list"},{default:u((()=>[(d(!0),_(v,null,A(f(F),((e,t)=>(d(),r(l,{key:t,src:e,mode:"aspectFill",onClick:e=>("toPage"in a?a.toPage:f(y))(`/pages/guide/imageView?type=1&imageList=${JSON.stringify(f(F))}&index=${t}`)},null,8,["src","onClick"])))),128))])),_:1})):(d(),r(s,{key:1},{default:u((()=>[c("-")])),_:1}))]})),_:1}),p(t,{class:"form-textarea"},{default:u((()=>[p(t,{class:"area-title"},{default:u((()=>[c("备注")])),_:1}),p(t,{class:"word-warp"},{default:u((()=>[c(h(f(b)||"-"),1)])),_:1})])),_:1})])),_:1})):m("",!0),1==f(N).status?(d(),r(t,{key:1,class:"form-box"},{default:u((()=>[p(t,{class:"form-item photo-item"},{default:u((()=>[p(t,null,{default:u((()=>[c("照片凭证")])),_:1}),p(S,{ref_key:"uploadRef",ref:C,accept:"all","max-count":99,uploadList:f(G),detail:f(N).status},null,8,["uploadList","detail"])])),_:1}),p(t,{class:"form-textarea"},{default:u((()=>[p(t,{class:"area-title"},{default:u((()=>[c("备注")])),_:1}),p(t,{class:"word-warp"},{default:u((()=>[c(h(f(K)||"-"),1)])),_:1})])),_:1})])),_:1})):(d(),r(t,{key:2,class:"form-box write"},{default:u((()=>[p(t,{class:"form-item photo-item"},{default:u((()=>[p(t,null,{default:u((()=>[p(s,null,{default:u((()=>[c("*")])),_:1}),c("照片凭证")])),_:1}),p(S,{ref_key:"uploadRef",ref:C,accept:"all","max-count":99,uploadList:[]},null,512)])),_:1}),p(t,{class:"form-textarea"},{default:u((()=>[p(t,{class:"area-title"},{default:u((()=>[c("备注")])),_:1}),p(i,{modelValue:f(K),"onUpdate:modelValue":e[0]||(e[0]=a=>k(K)?K.value=a:null),placeholder:`请描述需要${f(N).taskDefinitionKey===f(x)["钣金修复待办"]?"钣金修复的位置以及":f(N).taskDefinitionKey===f(x)["补漆修复待办"]?"补漆修复的位置以及":"洗车的"}说明`,maxlength:"1000"},null,8,["modelValue","placeholder"]),p(t,{class:"limit"},{default:u((()=>{var a;return[c(h((null==(a=f(K))?void 0:a.length)||0)+"/1000",1)]})),_:1})])),_:1})])),_:1}))])),_:1}),1!=f(N).status?(d(),r(t,{key:1,class:"bottom-btn"},{default:u((()=>[p(o,{class:"save-btn",onClick:W},{default:u((()=>[c("确定")])),_:1})])),_:1})):m("",!0)])),_:1})}}}),[["__scopeId","data-v-2d555615"]]);export{D as default};
