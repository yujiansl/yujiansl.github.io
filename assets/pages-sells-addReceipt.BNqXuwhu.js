import{d as a,r as e,a9 as t,B as l,c as n,w as s,i as o,I as u,M as m,K as d,aq as c,N as r,o as i,a as p,g as f,h as _,t as y,u as v,O as h,R as T,n as g,W as k,s as N,a1 as b,D as A,ar as w,_ as M}from"./index-CK4DGatK.js";import{U as C}from"./UploadFile.BBuXxkzB.js";import{u as E}from"./useQuery.3dd8K18V.js";import{a as j}from"./index.HDA2F_3Q.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const R=M(a({__name:"addReceipt",setup(a){const M=e({}),R=e(""),x=E(),P=t({amount:"",paymentType:"",paymentTypeName:"",payMethod:"",payMethodName:"",accountName:"",account:"",bank:""}),F=e(!1),I=e(!1),O=e([{name:"定金",key:"EARNEST_MONEY"},{name:"尾款",key:"BALANCE_PAYMENT"},{name:"全款",key:"FULL_PAYMENT"},{name:"首付款",key:"DOWN_PAYMENT"},{name:"其他",key:"OTHER"}]),D=e([{name:"现金",key:"0"},{name:"银行卡",key:"1"},{name:"优惠券",key:"2"}]);l((a=>{M.value=JSON.parse(a.params);const{id:e,dealPrice:t,amountReceived:l,receivableAmount:n,amountInTransit:s,mortgageAmount:o}=M.value;M.value.receivableAmount=n;const u=M.value.receivableAmount-(o??0);R.value=`可申请${u>0?u:0}元 在途${M.value.amountInTransit}元`,P.orderCarCustomerId=e}));const L=a=>{P.paymentType=a.key,P.paymentTypeName=a.name},S=a=>{P.payMethod=a.key,P.payMethodName=a.name},U=()=>{b()},Y=e(),V=()=>{var a,e,t;const l=(()=>{const{amount:a,paymentType:e,payMethod:t,accountName:l,account:n,bank:s}=P;return a?e?t?parseFloat(a)<=0?"申请收款金额需大于0":parseFloat(a)>M.value.receivableAmount?"超过可申请金额":"":"请选择收款方式":"请选择款项":"请填写申请收款金额"})();if(l)return void(new A).showToast(l);(new A).showLoading("提交中");const n=(null==(t=null==(e=null==(a=Y.value)?void 0:a.getFileFields())?void 0:e.all)?void 0:t.map((a=>a.attachmentId)))||[];uni.$u.http.post("product/orderPayment/initiatePayment",{...P,attachments:n}).then((()=>{(new A).showToast("添加成功"),w("refreshList"),w("refreshDetail"),b()}))};return(a,e)=>{const t=_,l=o,b=T,A=u(d("up-icon"),m),w=k,E=u(d("up-action-sheet"),c),$=r("amountUpper");return i(),n(l,{class:"page f-c-s"},{default:s((()=>[p(l,{class:"content"},{default:s((()=>[p(l,{class:"statis"},{default:s((()=>[p(l,null,{default:s((()=>[p(l,null,{default:s((()=>[p(t,null,{default:s((()=>[f(y(v(M).dealPrice||0),1)])),_:1}),f("万")])),_:1}),p(l,null,{default:s((()=>[f("成交价")])),_:1})])),_:1}),p(l,null,{default:s((()=>[p(l,null,{default:s((()=>[p(t,null,{default:s((()=>[f(y(v(M).amountReceived||0),1)])),_:1}),f("元")])),_:1}),p(l,null,{default:s((()=>[f("已收金额")])),_:1})])),_:1}),p(l,null,{default:s((()=>[p(l,null,{default:s((()=>[p(t,null,{default:s((()=>[f(y(v(M).mortgageAmount||""),1)])),_:1}),f(y(v(M).mortgageAmount?"元":"未提交"),1)])),_:1}),p(l,null,{default:s((()=>[f("按揭金额")])),_:1})])),_:1})])),_:1}),p(l,{class:"form-box"},{default:s((()=>[h((i(),n(l,{class:"form-item"},{default:s((()=>[p(l,null,{default:s((()=>[p(t,null,{default:s((()=>[f("*")])),_:1}),f("申请收款金额")])),_:1}),p(b,{modelValue:v(P).amount,"onUpdate:modelValue":e[0]||(e[0]=a=>v(P).amount=a),type:"digit",placeholder:v(R),onInput:e[1]||(e[1]=a=>{return e=a.detail.value,t="amount",l="yuanFloat",void N((()=>{P[t]=j(e,l)}));var e,t,l})},null,8,["modelValue","placeholder"]),f(" 元 ")])),_:1})),[[$,"yuanFloat"]]),p(l,{class:"form-item"},{default:s((()=>[p(l,null,{default:s((()=>[p(t,null,{default:s((()=>[f("*")])),_:1}),f("款项")])),_:1}),p(l,{class:"f-b-c",onClick:e[2]||(e[2]=a=>F.value=!0)},{default:s((()=>[p(t,{class:g({placeholder:!v(P).paymentType})},{default:s((()=>[f(y(v(P).paymentTypeName||"请选择"),1)])),_:1},8,["class"]),p(A,{name:"arrow-right"})])),_:1})])),_:1}),p(l,{class:"form-item"},{default:s((()=>[p(l,null,{default:s((()=>[p(t,null,{default:s((()=>[f("*")])),_:1}),f("收款方式")])),_:1}),p(l,{class:"f-b-c",onClick:e[3]||(e[3]=a=>I.value=!0)},{default:s((()=>[p(t,{class:g({placeholder:""===v(P).payMethod})},{default:s((()=>[f(y(v(P).payMethodName||"请选择"),1)])),_:1},8,["class"]),p(A,{name:"arrow-right"})])),_:1})])),_:1}),p(l,{class:"form-item img-boxs"},{default:s((()=>[p(l,{class:"name"},{default:s((()=>[f("附件")])),_:1}),p(l,{class:"val"},{default:s((()=>[p(C,{ref_key:"imageRef",ref:Y,carAttachmentType:"RECEIPT_RECORDS",accept:"all","max-count":9,detail:v(x).detail},null,8,["detail"])])),_:1})])),_:1})])),_:1})])),_:1}),p(l,{class:"bottom-btn"},{default:s((()=>[p(w,{onClick:U},{default:s((()=>[f("取消")])),_:1}),p(w,{class:"save-btn",onClick:e[4]||(e[4]=a=>V())},{default:s((()=>[f("确定")])),_:1})])),_:1}),p(E,{show:v(F),onClose:e[5]||(e[5]=a=>F.value=!1),actions:v(O),description:"款项",cancelText:"取消",onSelect:L},null,8,["show","actions"]),p(E,{show:v(I),onClose:e[6]||(e[6]=a=>I.value=!1),actions:v(D),description:"收款方式",cancelText:"取消",onSelect:S},null,8,["show","actions"])])),_:1})}}}),[["__scopeId","data-v-f805973a"]]);export{R as default};
