import{d as e,A as a,r as t,a9 as l,B as s,D as r,a2 as n,x as i,c as u,w as c,i as o,I as m,M as d,K as f,o as p,y,a as _,u as k,b as v,g,h,t as I,au as x,R as D,n as E,F as L,e as K,a7 as C,aj as b,P as T,W as j,Q as N,s as R,an as w,Z as P,a0 as A,_ as V}from"./index-CK4DGatK.js";import{_ as S}from"./avatar.Buy0-vr1.js";import{N as $}from"./NavBar.DSs5OGCU.js";import{L as U}from"./listItem.De6Dqo0z.js";import{U as F}from"./UploadFile.BBuXxkzB.js";import{R as M}from"./refuse.BEcO0WCW.js";import{u as O}from"./useQuery.3dd8K18V.js";import{a as Q,p as Y}from"./index.HDA2F_3Q.js";import"./time._VqwKl0d.js";import"./car_default.CyENNAub.js";import"./purchase.B8DNaFGL.js";import"./fixPrice.CFXyKkhm.js";import"./base.6l0JEBJr.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";import"./close.Dhgi5Ijg.js";const B=V(e({__name:"dataEntry",setup(e){const V=O(),B=a(),Z=t({}),J=t([]),W=l({registerCertificateimageList:[],vehicleLicenseimageList:[],keyNum:"",transferTime:"",compulsoryTrafficInsurance:1,insuranceExpireDate:"",commercialInsurance:1,commercialInsuranceData:"",commercialInsuranceAmount:"",examinationExpireDate:"",dataEntryRemark:""}),q=t([{key:1,value:"有"},{key:0,value:"无"}]),X=t(),z=t(),G=t(),H=t();s((()=>{ee(),"pend"==V.value.task&&"sales"!=V.value.page&&ae(),te();const{status:e,task:a,page:t}=V.value;1!=e&&"pend"==a&&"sales"!=t&&le()}));const ee=()=>{(new r).showLoading("加载中");const e="sales"==V.value.page?"/product/carSales/getTransferAndInsuranceInfo":"/product/dataEntry/getInfo",a="sales"==V.value.page?{primaryKey:V.value.primaryKey}:{primaryKey:V.value.primaryKey,taskId:V.value.taskId};uni.$u.http.get(e,{params:a}).then((e=>{e.data.registerCertificatePhotos=e.data.registerCertificatePhotos.map((e=>({attachmentUrl:e}))),e.data.vehicleLicensePhotos=e.data.vehicleLicensePhotos.map((e=>({attachmentUrl:e}))),Z.value=e.data,n()}))},ae=()=>{uni.$u.http.get("/product/dataEntry/getLastInfo",{params:{primaryKey:V.value.primaryKey}}).then((e=>{const a=e.data;W.registerCertificateimageList=a.registerCertificateimageListVO||[],W.vehicleLicenseimageList=a.vehicleLicenseimageListVO||[],W.keyNum=a.keyNum||"",W.transferTime=a.transferTime||"",W.compulsoryTrafficInsurance=a.insuranceExpireDate?1:0,W.insuranceExpireDate=a.insuranceExpireDate||"",W.commercialInsurance=a.commercialInsuranceData?1:0,W.commercialInsuranceData=a.commercialInsuranceData||"",W.commercialInsuranceAmount=a.commercialInsuranceAmount||"",W.examinationExpireDate=a.examinationExpireDate||"",W.dataEntryRemark=a.dataEntryRemark||""}))},te=()=>{uni.$u.http.get("sales"==V.value.page?"/product/carSales/getProcessLog":"/product/dataEntry/getProcessLog",{params:{primaryKey:V.value.primaryKey}}).then((e=>{J.value=e.data}))},le=()=>{uni.$u.http.get("admin/dict/type/transferTime",{params:{}}).then((e=>{H.value=e.data}))},se=i((()=>re(H.value,W.transferTime))),re=(e,a,t="")=>{const l=null==e?void 0:e.filter((e=>e.value==a));return(null==l?void 0:l.length)?l[0].label+t:"请选择"},ne=(e,a)=>{W[a]=e.detail.value},ie=e=>{const a={taskId:V.value.taskId,primaryKey:V.value.primaryKey,taskDefinitionKey:V.value.taskDefinitionKey,comment:e};uni.$u.http.post("/product/dataEntry/rejectTask",a).then((()=>{var e;null==(e=G.value)||e.close(),w()}))},ue=()=>{var e,a,t,l;const s=(null==(a=null==(e=X.value)?void 0:e.getFileFields())?void 0:a.all.map((e=>e.id)))||[],n=(null==(l=null==(t=z.value)?void 0:t.getFileFields())?void 0:l.all.map((e=>e.id)))||[],{keyNum:i,transferTime:u}=W,c=((e,a,t,l)=>{if(e.length&&a.length&&t&&l)return e.length?a.length?t?l?"":"请输入过户次数":"请输入钥匙数量":"请上传行驶证":"请上传登记证书";A({title:"请完善必填字段",icon:"none"})})(s,n,i,u);if(c)return void(new r).showToast(c);const o={taskId:V.value.taskId,primaryKey:V.value.primaryKey,taskDefinitionKey:V.value.taskDefinitionKey,registerCertificateimageList:s,vehicleLicenseimageList:n,keyNum:i,transferTime:u,insuranceExpireDate:W.insuranceExpireDate,commercialInsuranceData:W.commercialInsuranceData,commercialInsuranceAmount:W.commercialInsuranceAmount,examinationExpireDate:W.examinationExpireDate,dataEntryRemark:W.dataEntryRemark};oe(o)},ce=()=>{const e={taskId:V.value.taskId,primaryKey:V.value.primaryKey,taskDefinitionKey:V.value.taskDefinitionKey};oe(e)},oe=e=>{(new r).showLoading("提交中"),uni.$u.http.post("/product/dataEntry/completeTask",e).then((()=>{w()})).catch((e=>{Y(e.message)}))},me=()=>{P({title:"提交中",mask:!0});const e={taskId:V.value.taskId,primaryKey:V.value.primaryKey,taskDefinitionKey:V.value.taskDefinitionKey,auditOpinion:1};uni.$u.http.post("/product/carSales/taskTurnover",e).then((()=>{w()})).catch((e=>{Y(e.message)}))};return(e,a)=>{const t=o,l=h,s=D,r=m(f("up-icon"),d),n=C,i=b,w=T,P=j;return p(),u(t,{class:"page pend-page"},{default:c((()=>[k(B).needShowQw()?y("",!0):(p(),u($,{key:0,title:"详情"})),_(t,{class:"content"},{default:c((()=>{var e;return["pend"==k(V).task?(p(),u(U,{key:0,item:k(Z),isDetail:!0},null,8,["item"])):y("",!0),_(t,{class:"section-title"},{default:c((()=>[g("交接单")])),_:1}),_(t,{class:"form-box"},{default:c((()=>[_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("车辆款型")])),_:1}),_(t,null,{default:c((()=>[_(l,null,{default:c((()=>[g(I(k(Z).carBrandName),1)])),_:1}),g(I(k(Z).carSeriesName)+I(k(Z).carModelName),1)])),_:1})])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("VIN码")])),_:1}),g(" "+I(k(Z).vinNo),1)])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("车牌号")])),_:1}),g(" "+I(k(Z).plateNo||"-"),1)])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("车身颜色")])),_:1}),g(" "+I(k(Z).bodyColor||"-"),1)])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("首次上牌")])),_:1}),g(" "+I(k(Z).uetoDateStr?k(x)(k(Z).uetoDateStr).format("YYYY-MM"):"-"),1)])),_:1}),1!=k(V).status&&"pend"==k(V).task&&"sales"!=k(V).page?(p(),u(t,{key:0,class:"write"},{default:c((()=>[_(t,{class:"form-item photo-item"},{default:c((()=>[_(t,null,{default:c((()=>[_(l,null,{default:c((()=>[g("*")])),_:1}),g("登记证书")])),_:1}),_(F,{ref_key:"registerRef",ref:X,accept:"all","max-count":99,uploadList:k(W).registerCertificateimageList},null,8,["uploadList"])])),_:1}),_(t,{class:"form-item photo-item"},{default:c((()=>[_(t,null,{default:c((()=>[_(l,null,{default:c((()=>[g("*")])),_:1}),g("行驶证")])),_:1}),_(F,{ref_key:"licenseRef",ref:z,accept:"all","max-count":2,uploadList:k(W).vehicleLicenseimageList},null,8,["uploadList"])])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[_(l,null,{default:c((()=>[g("*")])),_:1}),g("钥匙")])),_:1}),_(s,{modelValue:k(W).keyNum,"onUpdate:modelValue":a[0]||(a[0]=e=>k(W).keyNum=e),type:"number",placeholder:"请输入"},null,8,["modelValue"]),g(" 把 ")])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[_(l,null,{default:c((()=>[g("*")])),_:1}),g("过户次数")])),_:1}),_(t,{class:"f-b-c",onClick:a[1]||(a[1]=e=>{return a="过户次数",t=k(H),l=k(W).transferTime,s="transferTime",void N(`/pages/carManage/pagePicker?title=${a}&list=${JSON.stringify(t)}&key=${l}&subKey=${s}&pageKey=purchase`);var a,t,l,s})},{default:c((()=>[_(l,{class:E({placeholder:"请选择"==k(se)})},{default:c((()=>[g(I(k(se)),1)])),_:1},8,["class"]),_(r,{name:"arrow-right"})])),_:1})])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("交强险")])),_:1}),_(t,{class:"tab-box"},{default:c((()=>[(p(!0),v(L,null,K(k(q),((e,a)=>(p(),u(l,{key:a,class:E({active:k(W).compulsoryTrafficInsurance==e.key}),onClick:a=>k(W).compulsoryTrafficInsurance=e.key},{default:c((()=>[g(I(e.value),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),1===k(W).compulsoryTrafficInsurance?(p(),u(t,{key:0,class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("交强险到期")])),_:1}),_(n,{mode:"date",value:k(W).insuranceExpireDate,onChange:a[2]||(a[2]=e=>ne(e,"insuranceExpireDate"))},{default:c((()=>[_(t,{class:E({placeholder:!k(W).insuranceExpireDate})},{default:c((()=>[g(I(k(W).insuranceExpireDate||"请选择"),1)])),_:1},8,["class"])])),_:1},8,["value"]),_(r,{name:"arrow-right"})])),_:1})):y("",!0),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("商业险")])),_:1}),_(t,{class:"tab-box"},{default:c((()=>[(p(!0),v(L,null,K(k(q),((e,a)=>(p(),u(l,{key:a,class:E({active:k(W).commercialInsurance==e.key}),onClick:a=>k(W).commercialInsurance=e.key},{default:c((()=>[g(I(e.value),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),1===k(W).commercialInsurance?(p(),u(t,{key:1,class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("商业险到期")])),_:1}),_(n,{mode:"date",value:k(W).commercialInsuranceData,onChange:a[3]||(a[3]=e=>ne(e,"commercialInsuranceData"))},{default:c((()=>[_(t,{class:E({placeholder:!k(W).commercialInsuranceData})},{default:c((()=>[g(I(k(W).commercialInsuranceData||"请选择"),1)])),_:1},8,["class"])])),_:1},8,["value"]),_(r,{name:"arrow-right"})])),_:1})):y("",!0),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("商业险金额")])),_:1}),_(s,{modelValue:k(W).commercialInsuranceAmount,"onUpdate:modelValue":a[4]||(a[4]=e=>k(W).commercialInsuranceAmount=e),type:"number",placeholder:"请输入",maxlength:"7",onInput:a[5]||(a[5]=e=>{return a=e.detail.value,t="commercialInsuranceAmount",l="yuan",void R((()=>{W[t]=Q(a,l)}));var a,t,l})},null,8,["modelValue"]),g(" 元 ")])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("年检到期日")])),_:1}),_(n,{mode:"date",value:k(W).examinationExpireDate,onChange:a[6]||(a[6]=e=>ne(e,"examinationExpireDate"))},{default:c((()=>[_(t,{class:E({placeholder:!k(W).examinationExpireDate})},{default:c((()=>[g(I(k(W).examinationExpireDate||"请选择"),1)])),_:1},8,["class"])])),_:1},8,["value"]),_(r,{name:"arrow-right"})])),_:1}),_(t,{class:"form-textarea"},{default:c((()=>[_(t,{class:"area-title"},{default:c((()=>[g("备注")])),_:1}),_(i,{modelValue:k(W).dataEntryRemark,"onUpdate:modelValue":a[7]||(a[7]=e=>k(W).dataEntryRemark=e),placeholder:"请输入",maxlength:"1000"},null,8,["modelValue"]),_(t,{class:"limit"},{default:c((()=>{var e;return[g(I((null==(e=k(W).dataEntryRemark)?void 0:e.length)||0)+"/1000",1)]})),_:1})])),_:1})])),_:1})):(p(),v(L,{key:1},[_(t,{class:"form-item photo-item"},{default:c((()=>{var e;return[_(t,null,{default:c((()=>[g("登记证书")])),_:1}),(null==(e=k(Z).registerCertificatePhotos)?void 0:e.length)?(p(),u(F,{key:0,ref_key:"registerRef",ref:X,accept:"all","max-count":99,uploadList:k(Z).registerCertificatePhotos,detail:1},null,8,["uploadList"])):(p(),u(t,{key:1},{default:c((()=>[g("-")])),_:1}))]})),_:1}),_(t,{class:"form-item photo-item"},{default:c((()=>{var e;return[_(t,null,{default:c((()=>[g("行驶证")])),_:1}),(null==(e=k(Z).vehicleLicensePhotos)?void 0:e.length)?(p(),u(F,{key:0,ref_key:"licenseRef",ref:z,accept:"all","max-count":2,uploadList:k(Z).vehicleLicensePhotos,detail:1},null,8,["uploadList"])):(p(),u(t,{key:1},{default:c((()=>[g("-")])),_:1}))]})),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("钥匙")])),_:1}),g(" "+I(k(Z).keyNum||0)+"把 ",1)])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("过户次数")])),_:1}),g(" "+I(k(Z).transferTimeName||"-"),1)])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("交强险")])),_:1}),g(" "+I(k(Z).insuranceExpireDate?"有":"无"),1)])),_:1}),k(Z).insuranceExpireDate?(p(),u(t,{key:0,class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("交强险到期")])),_:1}),g(" "+I(k(Z).insuranceExpireDate),1)])),_:1})):y("",!0),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("商业险")])),_:1}),g(" "+I(k(Z).commercialInsuranceData?"有":"无"),1)])),_:1}),k(Z).commercialInsuranceData?(p(),u(t,{key:1,class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("商业险到期")])),_:1}),g(" "+I(k(Z).commercialInsuranceData),1)])),_:1})):y("",!0),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("商业险金额")])),_:1}),g(" "+I(k(Z).commercialInsuranceAmount?k(Z).commercialInsuranceAmount+"元":"-"),1)])),_:1}),_(t,{class:"form-item"},{default:c((()=>[_(t,null,{default:c((()=>[g("年检日期")])),_:1}),g(" "+I(k(Z).examinationExpireDate||"-"),1)])),_:1}),_(t,{class:"form-textarea"},{default:c((()=>[_(t,{class:"area-title"},{default:c((()=>[g("备注")])),_:1}),_(t,{class:"word-warp"},{default:c((()=>[g(I("sales"==k(V).page?k(Z).remarkInfo||"-":k(Z).dataEntryRemark||"-"),1)])),_:1})])),_:1})],64))])),_:1}),(null==(e=k(J))?void 0:e.length)?(p(),v(L,{key:1},[_(t,{class:"section-title"},{default:c((()=>[g("审批流程")])),_:1}),_(t,{class:"pend-list"},{default:c((()=>[(p(!0),v(L,null,K(k(J),((e,a)=>(p(),u(t,{class:"pend-item",key:a},{default:c((()=>[e.avatar?(p(),u(w,{key:0,src:e.avatar},null,8,["src"])):(p(),u(w,{key:1,src:S})),_(t,{class:"item-info"},{default:c((()=>[_(t,null,{default:c((()=>[_(t,null,{default:c((()=>[g(I(e.name),1)])),_:2},1024),_(t,null,{default:c((()=>[g(I(e.startTime),1)])),_:2},1024)])),_:2},1024),_(t,{class:"tip"},{default:c((()=>[g(I("START_PROCESS"===e.taskDefinitionKey?"发起审批":1==e.status?"已同意":2==e.status?"已拒绝":"已处理"),1)])),_:2},1024),e.comment?(p(),u(t,{key:0,class:"tip"},{default:c((()=>[g("拒绝原因："+I(e.comment),1)])),_:2},1024)):y("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})],64)):y("",!0)]})),_:1}),"pend"==k(V).task&&1!=k(V).status&&"sales"!=k(V).page?(p(),u(t,{key:1,class:"bottom-btn"},{default:c((()=>[_(P,{class:"save-btn",onClick:ue},{default:c((()=>[g("发起入库")])),_:1})])),_:1})):y("",!0),"confirm"==k(V).task&&1!=k(V).status&&"sales"!=k(V).page?(p(),u(t,{key:2,class:"bottom-btn"},{default:c((()=>[_(P,{onClick:a[8]||(a[8]=e=>k(G).open())},{default:c((()=>[g("拒绝")])),_:1}),_(P,{class:"save-btn",onClick:ce},{default:c((()=>[g("确认入库")])),_:1})])),_:1})):y("",!0),1!=k(V).status&&"sales"==k(V).page?(p(),u(t,{key:3,class:"bottom-btn"},{default:c((()=>[_(P,{class:"save-btn",onClick:me},{default:c((()=>[g(I("pend"==k(V).task?"发起出库":"确认出库"),1)])),_:1})])),_:1})):y("",!0),_(M,{ref_key:"refuseRef",ref:G,onConfirm:ie},null,512)])),_:1})}}}),[["__scopeId","data-v-8e707964"]]);export{B as default};
