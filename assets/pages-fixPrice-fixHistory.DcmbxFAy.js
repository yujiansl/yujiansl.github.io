import{d as e,c as a,o as i,i as t,w as r,a as s,P as l,g as n,t as u,u as o,y as c,h as d,_ as m,r as p,a9 as v,E as f,$ as g,ad as _,O as P,b as y,F as M,e as b,T as j,W as x,z as k,Z as T,a0 as S}from"./index-CK4DGatK.js";import{N as h}from"./NavBar.DSs5OGCU.js";import{L as w}from"./ListLoadRefreshView.CnNC2lkG.js";import{g as R}from"./time._VqwKl0d.js";import{F as B}from"./fixPrice.CFXyKkhm.js";import{F as I}from"./FixPricePopup.B6Ost8DA.js";import{u as A}from"./useQuery.3dd8K18V.js";import{o as L}from"./omit.DzeQdT5l.js";import"./index.HDA2F_3Q.js";import"./close.Dhgi5Ijg.js";import"./isNil.aV-w2MPu.js";import"./cloneDeep.D7E8_JON.js";import"./_baseClone.Cc-Y92km.js";import"./_Uint8Array.B4mhORiM.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";import"./_baseGet.CmhOSbYr.js";import"./isSymbol.Bym6OQCA.js";const F=m(e({__name:"historyItem",props:{item:{},itemType:{}},setup(e){const m=e;return(e,p)=>{const v=l,f=t,g=d;return i(),a(f,{class:"list-item"},{default:r((()=>[s(f,{class:"one-item"},{default:r((()=>[s(f,{class:"user"},{default:r((()=>{var a;return[s(v,{src:(null==(a=e.item)?void 0:a.pricingUserIcon)??"/static/mine/avatar.png"},null,8,["src"]),s(f,null,{default:r((()=>{var a;return[n(u(null==(a=e.item)?void 0:a.pricingUserName),1)]})),_:1})]})),_:1}),s(f,null,{default:r((()=>{var a;return[n(u(("getTimeBySplitSecond"in e?e.getTimeBySplitSecond:o(R))(null==(a=e.item)?void 0:a.pricingData)),1)]})),_:1})])),_:1}),s(f,{class:"third-item"},{default:r((()=>{var t;return[s(f,null,{default:r((()=>[s(f,{class:"item-label"},{default:r((()=>[n("定价金额")])),_:1}),s(f,{class:"item-value price"},{default:r((()=>{var t,s;return[(null==(t=e.item)?void 0:t.pricingPriceMin)?(i(),a(g,{key:0},{default:r((()=>{var a;return[n(u((null==(a=e.item)?void 0:a.pricingPriceMin)??"--")+" ~ ",1)]})),_:1})):c("",!0),n(u((null==(s=e.item)?void 0:s.pricingPriceMax)??"--")+"万 ",1)]})),_:1})])),_:1}),s(f,null,{default:r((()=>[s(f,{class:"item-label"},{default:r((()=>[n("预估销售价")])),_:1}),s(f,{class:"item-value price"},{default:r((()=>{var a;return[n(u((null==(a=e.item)?void 0:a.estimateSalePriceMin)??"--")+"万 ",1)]})),_:1})])),_:1}),+m.itemType===o(B)["评估定价"]?(i(),a(f,{key:0},{default:r((()=>[s(f,{class:"item-label"},{default:r((()=>[n("毛利率")])),_:1}),s(f,{class:"item-value"},{default:r((()=>{var t,s;return[(null==(t=e.item)?void 0:t.grossMarginMin)?(i(),a(g,{key:0},{default:r((()=>{var a;return[n(u((null==(a=e.item)?void 0:a.grossMarginMin)??"--")+"% ~ ",1)]})),_:1})):c("",!0),n(u((null==(s=e.item)?void 0:s.grossMarginMax)??"--")+"% ",1)]})),_:1})])),_:1})):c("",!0),(null==(t=e.item)?void 0:t.pricingRemark)?(i(),a(f,{key:1},{default:r((()=>[s(f,{class:"item-label"},{default:r((()=>[n("备注")])),_:1}),s(f,{class:"item-value"},{default:r((()=>{var a;return[n(u(null==(a=e.item)?void 0:a.pricingRemark),1)]})),_:1})])),_:1})):c("",!0)]})),_:1})])),_:1})}}}),[["__scopeId","data-v-7a01853a"]]),N=m(e({__name:"fixHistory",setup(e){const l=A(),u=p(!1),d=p({}),m=p({budgetaryPrice:"",pricingPriceMin:"",pricingPriceMax:"",estimateSalePrice:"",needBossAudit:!1,pricingRemark:"",grossMarginMin:"",grossMarginMax:""}),R=p([]),N=p(),U=v({current:1,size:10,total:0});async function $(){var e;try{const e={...L(U,"total"),carPricingId:l.value.id},a=await g().post("/product/carPricing/getRaterHistory",e);U.total=a.data.count;const i=a.data.results;R.value=1===U.current?i:[...R.value,...i]}finally{null==(e=N.value)||e.loadFinish()}}const z=()=>{var e;U.current=1,$(),null==(e=N.value)||e.initTop()},C=()=>{U.current++,$()};async function D(e){T({title:"提交中",mask:!0}),m.value=e,await await g().post("/product/carPricing/addRecord/rater",{carPricingId:l.value.id,...m.value}),m.value={needBossAudit:!1},U.current=1,S({title:"提交成功"}),$(),u.value=!1}f((()=>{$()}));const H=async()=>{const e=await g().get(`/product/carPricing/getAppraiseInfo/${l.value.id}`);d.value=e.data||{};const{budgetaryPrice:a,forecastPriceMax:i,forecastPriceMin:t,raterPriceMax:r,raterPriceMin:s,estimateSalePrice:n}=e.data||{};m.value.budgetaryPrice=a,m.value.forecastPriceMin=t,m.value.forecastPriceMax=i,m.value.pricingPriceMin=s,m.value.pricingPriceMax=r,m.value.estimateSalePrice=n,m.value.pricingRemark="",m.value.needBossAudit=!1,u.value=!0};return(e,p)=>{const v=t,f=x;return i(),a(v,{class:"page f-c-s"},{default:r((()=>[s(h,{title:`历史定价(${o(U).total})`},null,8,["title"]),s(w,_({ref_key:"listLoadRef",ref:N,class:"scroll-view-box"},o(U),{istop:!1,onLoadMore:C,onLoadRefresh:z}),{default:r((()=>[P(s(v,{class:"list-box"},{default:r((()=>[(i(!0),y(M,null,b(o(R),(e=>(i(),a(F,{key:e.id,item:e,itemType:o(l).itemType},null,8,["item","itemType"])))),128))])),_:1},512),[[j,o(R).length]])])),_:1},16),+o(l).itemType===o(B)["评估定价"]?(i(),a(v,{key:0,class:"bottom-btn"},{default:r((()=>[s(f,{class:"save-btn",onClick:H},{default:r((()=>[n("调整定价")])),_:1})])),_:1})):c("",!0),s(I,{title:"调整定价",visible:o(u),"onUpdate:visible":p[0]||(p[0]=e=>k(u)?u.value=e:null),info:o(d),state:o(m),onSubmit:D,showPricingPrice:"",showBossAudit:!1},null,8,["visible","info","state"])])),_:1})}}}),[["__scopeId","data-v-3314fa64"]]);export{N as default};
