import{d as e,r as l,au as a,B as t,E as u,Z as s,a2 as n,$ as r,x as o,b as i,a as d,w as c,u as v,z as m,F as f,i as _,I as p,at as y,K as k,b8 as T,M as b,o as h,c as x,y as C,h as g,g as Y,t as w,n as V,e as M,aj as j,W as D,a0 as I,a1 as S,ar as $,s as U,_ as F}from"./index-CK4DGatK.js";import{c as H}from"./crm.-ZWUD7KR.js";import{N}from"./NextFollowUpTimePicker.B9FsksyN.js";import{a as B}from"./addState.BIkq4e66.js";import{u as L}from"./useQuery.3dd8K18V.js";import"./isNil.aV-w2MPu.js";const z=F(e({__name:"addFollow",setup(e){const F=L(),z=l(!1),A=l(!1),R=l(!1),E=["待联系","邀约","到店","成交"],K=new Map([["year","年"],["month","月"],["day","日"],["hour","时"],["minute","分"]]);function P(e,l){return`${l}${K.get(e)}`}function Q(){A.value=!1,R.value=!1}function W({value:e}){U((()=>{A.value&&(q.value.arriveTime=a(e).format("YYYY-MM-DD HH:mm")),R.value&&(q.value.dealTime=a(e).format("YYYY-MM-DD")),A.value=!1,R.value=!1}))}const Z=l(),q=l({result:"",arrive:0,invite:1,content:"",arriveTime:a().format("YYYY-MM-DD HH:mm"),dealTime:a().format("YYYY-MM-DD"),nextTime:""});t((()=>{O()})),u((async()=>{s({title:"加载中",mask:!0});try{!async function(){const e={clueId:F.value.clueId},l=await r().get(H.getClueBySell,{params:e});Z.value=null==l?void 0:l.data}()}finally{n()}}));const G=e=>{if(e){const{result:e,content:l}=q.value;if(!("成交"===e||e&&l))return I({title:"请完善必填字段",icon:"none"});s({title:"提交中",mask:!0});const a={crmClueId:F.value.clueId,clueType:F.value.clueType,crmCustomerId:F.value.customerId,...q.value,arriveTime:`${q.value.arriveTime}:00`,nextTime:q.value.nextTime?`${q.value.nextTime}:00`:""};uni.$u.http.post(H.followLog,a).then((e=>{I({title:"操作成功",icon:"none"}),S(),$("refreshDetail"),n()}))}else S()},J=l([]),O=()=>{uni.$u.http.get(H.intentionInfolist,{data:{current:1,size:-1}}).then((e=>{var l,a;J.value=null==(a=null==(l=e.data)?void 0:l.results)?void 0:a.map((e=>({label:e.code,value:e.code})))}))},X=o((()=>{const e=q.value.nextTime;return null===e?"不跟进":e||"请选择"})),ee=o((()=>{var e,l;return["3"].includes(null==(e=Z.value)?void 0:e.status)?"order-success":["4","5"].includes(null==(l=Z.value)?void 0:l.status)?"invalid":"intention"})),le=o((()=>{var e,l,a,t;return["3"].includes(null==(e=Z.value)?void 0:e.status)?"成":["4"].includes(null==(l=Z.value)?void 0:l.status)?"败":["5"].includes(null==(a=Z.value)?void 0:a.status)?"无":null==(t=Z.value)?void 0:t.intentionCode}));return(e,l)=>{const a=g,t=_,u=p(k("u-empty"),T),s=p(k("up-icon"),b),n=j,r=D,o=p(k("up-datetime-picker"),y);return h(),i(f,null,[d(t,{class:"page f-c-s"},{default:c((()=>[d(t,{class:"content",id:"page-box"},{default:c((()=>{var e;return[d(t,{class:"content-title"},{default:c((()=>{var e;return[d(a,{class:"mr20"},{default:c((()=>[Y(w("0"===v(F).clueType?"销售":"评估")+"机会",1)])),_:1}),v(le)?(h(),x(a,{key:0,class:V(["status mr20",[v(ee)]])},{default:c((()=>[Y(w(v(le)),1)])),_:1},8,["class"])):C("",!0),null!==(null==(e=v(Z))?void 0:e.orderStatus)?(h(),x(a,{key:1,class:V(["status1",["order-success"]])},{default:c((()=>{var e;return[Y(w(E[null==(e=v(Z))?void 0:e.orderStatus]),1)]})),_:1})):C("",!0)]})),_:1}),(null==(e=v(Z))?void 0:e.id)?(h(),x(t,{key:0,class:"section"},{default:c((()=>[d(t,{class:"series"},{default:c((()=>{var e,l;return[Y(w(null==(l=null==(e=v(Z))?void 0:e.sellSeries)?void 0:l.join(",")),1)]})),_:1}),d(t,{class:"desc"},{default:c((()=>{var e,l;return[Y("预计买车 "+w((null==(e=v(Z))?void 0:e.predictBuyCarTime)||"--")+" | 预算 "+w((null==(l=v(Z))?void 0:l.budgetary)||"--"),1)]})),_:1}),d(t,{class:"tag-box"},{default:c((()=>{var e,l,u,s,n,r;return[(null==(l=null==(e=v(Z))?void 0:e.carFocus)?void 0:l.length)?(h(),x(t,{key:0},{default:c((()=>{var e,l;return[Y(w(null==(l=null==(e=v(Z))?void 0:e.carFocus)?void 0:l.join(",")),1)]})),_:1})):C("",!0),(null==(u=v(Z))?void 0:u.vehicleAgeStr)?(h(),x(t,{key:1},{default:c((()=>{var e;return[d(a,{class:"mr20"},{default:c((()=>[Y("车龄")])),_:1}),Y(w(null==(e=v(Z))?void 0:e.vehicleAgeStr),1)]})),_:1})):C("",!0),(null==(n=null==(s=v(Z))?void 0:s.carLayout)?void 0:n.length)?(h(),x(t,{key:2},{default:c((()=>{var e,l;return[Y(w(null==(l=null==(e=v(Z))?void 0:e.carLayout)?void 0:l.join(",")),1)]})),_:1})):C("",!0),(null==(r=v(Z))?void 0:r.paymentTypeStr)?(h(),x(t,{key:3},{default:c((()=>{var e;return[Y(w(null==(e=v(Z))?void 0:e.paymentTypeStr)+"购车",1)]})),_:1})):C("",!0)]})),_:1})])),_:1})):(h(),x(t,{key:1,class:"section"},{default:c((()=>[d(u,{mode:"list",text:"暂无意向"})])),_:1})),d(t,{class:"form-box"},{default:c((()=>[d(t,{class:"form-textarea"},{default:c((()=>[d(t,{class:"area-title"},{default:c((()=>[d(a,null,{default:c((()=>[Y("*")])),_:1}),Y("跟进结果")])),_:1}),d(t,{class:"sub-content"},{default:c((()=>[(h(!0),i(f,null,M(v(J),(e=>(h(),x(t,{onClick:l=>((e,l)=>{q.value[e]=q.value[e]==l.value?"":l.value})("result",e),class:V({active:v(q).result==e.value}),key:e.label},{default:c((()=>[Y(w(e.label),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})])),_:1}),"成交"!==v(q).result?(h(),x(t,{key:2},{default:c((()=>[d(t,{class:"form-box"},{default:c((()=>[["战败","无效"].includes(v(q).result)?C("",!0):(h(),x(t,{key:0,class:"form-item"},{default:c((()=>[d(t,null,{default:c((()=>[d(a,null,{default:c((()=>[Y("*")])),_:1}),Y("是否到店")])),_:1}),d(t,{class:"tab-box"},{default:c((()=>[(h(!0),i(f,null,M(v(B),((e,l)=>(h(),x(a,{key:l,class:V({active:v(q).arrive==e.value}),onClick:l=>v(q).arrive=e.value},{default:c((()=>[Y(w(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})),1===v(q).arrive?(h(),x(t,{key:1,class:"form-item"},{default:c((()=>[d(t,null,{default:c((()=>[d(a,null,{default:c((()=>[Y("*")])),_:1}),Y("到店时间")])),_:1}),d(t,{class:V({placeholder:!v(q).arriveTime}),onClick:l[0]||(l[0]=e=>A.value=!0)},{default:c((()=>[Y(w(v(q).arriveTime||"请选择"),1)])),_:1},8,["class"]),d(s,{name:"arrow-right"})])),_:1})):C("",!0),["战败","无效"].includes(v(q).result)?C("",!0):(h(),x(t,{key:2,class:"form-item"},{default:c((()=>[d(t,null,{default:c((()=>[d(a,null,{default:c((()=>[Y("*")])),_:1}),Y("是否邀约")])),_:1}),d(t,{class:"tab-box"},{default:c((()=>[(h(!0),i(f,null,M(v(B),((e,l)=>(h(),x(a,{key:l,class:V({active:v(q).invite==e.value}),onClick:l=>v(q).invite=e.value},{default:c((()=>[Y(w(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})),d(t,{class:"form-textarea"},{default:c((()=>[d(t,{class:"area-title"},{default:c((()=>[d(a,null,{default:c((()=>[Y("*")])),_:1}),Y(" "+w(["战败","无效"].includes(v(q).result)?`${v(q).result}原因`:"跟进内容"),1)])),_:1}),d(n,{modelValue:v(q).content,"onUpdate:modelValue":l[1]||(l[1]=e=>v(q).content=e),placeholder:"请输入",maxlength:"1000"},null,8,["modelValue"]),d(t,{class:"limit"},{default:c((()=>{var e;return[Y(w((null==(e=v(q).content)?void 0:e.length)||0)+"/1000",1)]})),_:1})])),_:1}),["战败","无效"].includes(v(q).result)?C("",!0):(h(),x(t,{key:3,class:"form-item",onClick:l[2]||(l[2]=e=>z.value=!0)},{default:c((()=>[d(t,null,{default:c((()=>[Y("下次跟进时间")])),_:1}),d(t,{class:"f-b-c"},{default:c((()=>[d(a,{class:V({placeholder:"请选择"==v(X)})},{default:c((()=>[Y(w(v(X)),1)])),_:1},8,["class"]),d(s,{name:"arrow-right"})])),_:1})])),_:1}))])),_:1})])),_:1})):C("",!0),"成交"===v(q).result?(h(),x(t,{key:3,class:"form-box"},{default:c((()=>[d(t,{class:"form-item"},{default:c((()=>[d(t,null,{default:c((()=>[d(a,null,{default:c((()=>[Y("*")])),_:1}),Y("成交时间")])),_:1}),d(t,{class:V({placeholder:!v(q).dealTime}),onClick:l[3]||(l[3]=e=>R.value=!0)},{default:c((()=>[Y(w(v(q).dealTime||"请选择"),1)])),_:1},8,["class"]),d(s,{name:"arrow-right"})])),_:1})])),_:1})):C("",!0)]})),_:1}),d(t,{class:"bottom-btn"},{default:c((()=>[d(r,{onClick:l[4]||(l[4]=e=>G(!1))},{default:c((()=>[Y("取消")])),_:1}),d(r,{class:"save-btn",onClick:l[5]||(l[5]=e=>G(!0))},{default:c((()=>[Y("确定")])),_:1})])),_:1})])),_:1}),d(N,{title:"下次跟进时间",visible:v(z),"onUpdate:visible":l[6]||(l[6]=e=>m(z)?z.value=e:null),modelValue:v(q).nextTime,"onUpdate:modelValue":l[7]||(l[7]=e=>v(q).nextTime=e)},null,8,["visible","modelValue"]),d(o,{ref:"pickerRef",confirmColor:"#fe391e",onCancel:Q,onConfirm:W,title:"到店时间",show:v(A),formatter:P,mode:"datetime",modelValue:v(q).arriveTime,"onUpdate:modelValue":l[8]||(l[8]=e=>v(q).arriveTime=e)},null,8,["show","modelValue"]),d(o,{ref:"pickerRef",confirmColor:"#fe391e",onCancel:Q,onConfirm:W,title:"成交时间",show:v(R),formatter:P,mode:"date",modelValue:v(q).dealTime,"onUpdate:modelValue":l[9]||(l[9]=e=>v(q).dealTime=e)},null,8,["show","modelValue"])],64)}}}),[["__scopeId","data-v-64343f77"]]);export{z as default};
