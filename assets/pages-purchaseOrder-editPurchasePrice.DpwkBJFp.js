import{d as a,r as e,a9 as l,B as s,x as t,c as o,w as u,i as d,I as n,M as i,K as r,aq as c,N as m,o as f,a as p,g as _,h,t as P,u as v,O as y,R as g,n as R,aj as w,W as j,s as x,a1 as k,D as b,ar as I,_ as N}from"./index-CK4DGatK.js";import{U as V}from"./UploadFile.BBuXxkzB.js";import{a as C}from"./index.HDA2F_3Q.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";import"./useQuery.3dd8K18V.js";const F=N(a({__name:"editPurchasePrice",setup(a){const N=e({}),F=l({modifyPrice:"",modifyReason:"",modifyReasonName:"",attachments:[],remark:""}),T=e(!1),U=e(),$=e();s((a=>{const{paidPrice:e,purchasePrice:l,enRoutePrice:s,id:t}=a;N.value={purchasePrice:l,paidPrice:e,enRoutePrice:s,id:t},L()}));const A=t((()=>`已付${N.value.paidPrice??0}元，在途${N.value.enRoutePrice??0}元`)),L=()=>{uni.$u.http.get("/admin/dict/type/modify_purchase_reason").then((a=>{U.value=a.data.map((a=>({name:a.label,key:a.value})))}))},M=()=>{T.value=!0},D=(a,e)=>{F.modifyReason=a.key,F.modifyReasonName=a.name},Y=()=>{k()},q=async()=>{var a,e,l;const s=(()=>{const{modifyPrice:a,modifyReason:e}=F;return a?e?"":"请选择修改采购原因":"请填写修改后采购价"})();if(s)return void(new b).showToast(s);const t=(null==(l=null==(e=null==(a=$.value)?void 0:a.getFileFields())?void 0:e.all)?void 0:l.map((a=>a.attachmentId)))||[];(new b).showLoading("提交中"),uni.$u.http.post("product/purchase/updatePurchasePrice",{...F,attachments:t,purchaseId:N.value.id}).then((()=>{(new b).showToast("添加成功"),I("refreshList"),k()}))};return(a,e)=>{const l=h,s=d,t=g,k=n(r("up-icon"),i),b=w,I=j,L=n(r("up-action-sheet"),c),B=m("amountUpper");return f(),o(s,{class:"page f-c-s"},{default:u((()=>[p(s,{class:"content"},{default:u((()=>[p(s,{class:"statis"},{default:u((()=>[p(s,null,{default:u((()=>[p(s,null,{default:u((()=>[p(l,null,{default:u((()=>[_(P(v(N).purchasePrice),1)])),_:1}),_("万")])),_:1}),p(s,null,{default:u((()=>[_("采购金额")])),_:1})])),_:1}),p(s,null,{default:u((()=>[p(s,null,{default:u((()=>[p(l,null,{default:u((()=>[_(P(v(N).paidPrice),1)])),_:1}),_("元")])),_:1}),p(s,null,{default:u((()=>[_("已付金额")])),_:1})])),_:1})])),_:1}),p(s,{class:"form-box"},{default:u((()=>[y((f(),o(s,{class:"form-item"},{default:u((()=>[p(s,null,{default:u((()=>[p(l,null,{default:u((()=>[_("*")])),_:1}),_("修改后采购价")])),_:1}),p(t,{modelValue:v(F).modifyPrice,"onUpdate:modelValue":e[0]||(e[0]=a=>v(F).modifyPrice=a),type:"digit",placeholder:v(A),onInput:e[1]||(e[1]=a=>{return e=a.detail.value,l="modifyPrice",s="wanFloat",void x((()=>{F[l]=C(e,s)}));var e,l,s})},null,8,["modelValue","placeholder"]),_(" 万元 ")])),_:1})),[[B,"wanFloat"]]),p(s,{class:"form-item"},{default:u((()=>[p(s,null,{default:u((()=>[p(l,null,{default:u((()=>[_("*")])),_:1}),_("修改原因")])),_:1}),p(s,{class:"f-b-c",onClick:M},{default:u((()=>[p(l,{class:R({placeholder:!v(F).modifyReason})},{default:u((()=>[_(P(v(F).modifyReasonName||"请选择"),1)])),_:1},8,["class"]),p(k,{name:"arrow-right"})])),_:1})])),_:1}),p(s,{class:"form-textarea"},{default:u((()=>[p(s,{class:"area-title"},{default:u((()=>[_("备注")])),_:1}),p(b,{modelValue:v(F).remark,"onUpdate:modelValue":e[2]||(e[2]=a=>v(F).remark=a),placeholder:"请输入",maxlength:"1000"},null,8,["modelValue"])])),_:1}),p(s,{class:"form-item img-boxs"},{default:u((()=>[p(s,{class:"name"},{default:u((()=>[_("附件")])),_:1}),p(s,{class:"val"},{default:u((()=>[p(V,{ref_key:"imageRef",ref:$,carAttachmentType:"PRICING_PAYMENT_APPLY",accept:"all","max-count":9},null,512)])),_:1})])),_:1})])),_:1})])),_:1}),p(s,{class:"bottom-btn"},{default:u((()=>[p(I,{onClick:Y},{default:u((()=>[_("取消")])),_:1}),p(I,{class:"save-btn",onClick:e[3]||(e[3]=a=>q())},{default:u((()=>[_("确定")])),_:1})])),_:1}),p(L,{show:v(T),onClose:e[4]||(e[4]=a=>T.value=!1),actions:v(U),description:"修改原因",cancelText:"取消",onSelect:D},null,8,["show","actions"])])),_:1})}}}),[["__scopeId","data-v-8962d3a6"]]);export{F as default};
