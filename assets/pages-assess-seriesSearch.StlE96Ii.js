import{g as e}from"./highlight.BhMHDnLY.js";import{d as a,aY as s,r as l,m as t,q as o,I as r,b9 as i,K as n,b as u,o as c,a as d,y as p,f as v,k as m,j as f,_ as h,v as b,c as g,w as y,i as _,ag as S,u as j,z as k,F as I,e as x,Z as V,a2 as C,a1 as M}from"./index-CK4DGatK.js";import{S as F}from"./SeriesCard.BXJ3ECJo.js";import{o as T,a as w}from"./index.DEPEwlq9.js";import{d as B}from"./debounce.BkVTat1y.js";import{a as H}from"./carSelect-emit.CejlvgP5.js";import"./_Uint8Array.B4mhORiM.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";import"./_baseIteratee.DvY8IqJy.js";import"./_baseGet.CmhOSbYr.js";import"./isSymbol.Bym6OQCA.js";import"./event.CJk5hinv.js";const U=h(a({__name:"SearchPopover",props:s({placeholder:{},offset:{default:0},initFocus:{type:Boolean}},{modelValue:{},modelModifiers:{},visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:s(["search","input","blur","focus"],["update:modelValue","update:visible"]),setup(e,{emit:a}){const s=e,h=a,b=l(),g=t(e,"modelValue"),y=t(e,"visible"),_=e=>{h("search",e),y.value=!1};T(b,(()=>{y.value=!1}));const S=l();w(S,"input",(()=>{j(g.value)})),o((()=>{S.value=b.value.querySelector("input")}));const j=B((e=>{h("input",e),y.value=!0}),100);return(e,a)=>{const l=r(n("up-search"),i);return c(),u("div",{class:"popover-box",ref_key:"rootRef",ref:b},[d(l,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),modelModifiers:{trim:!0},placeholder:s.placeholder,onSearch:_,onCustom:_,onBlur:a[1]||(a[1]=e=>h("blur",g.value)),onFocus:a[2]||(a[2]=e=>h("focus",g.value)),"show-action":!0,focus:s.initFocus,actionText:"搜索"},null,8,["modelValue","placeholder","focus"]),y.value?(c(),u("div",{key:0,class:"search-popover-content","data-offset":s.offset,style:v({top:`${110+s.offset}rpx`})},[m("div",{class:"scroll-warp scroll-col"},[f(e.$slots,"content",{},void 0,!0)])],12,["data-offset"])):p("",!0)],512)}}}),[["__scopeId","data-v-4f354bc1"]]),$=h(a({__name:"seriesSearch",setup(a){const s=l({}),t=l(""),o=l(!1),i=l(!1),p=l([]),v=l([]),f=()=>{B()},h=()=>{t.value?w():o.value=!1},T=()=>{o.value||h()};b(t,(e=>{e||(o.value=!1,p.value=[])}));const w=async()=>{i.value=!0,p.value=[];try{const e=((await uni.$u.http.get("/product/carSeries/getSeries",{params:{name:t.value,containsAll:!1}})).data||[]).flatMap((e=>(e.carSeries||[]).map((a=>({...a,brandId:e.brandId})))));p.value=e,o.value=!!e.length}finally{i.value=!1}},B=async()=>{var e;V({title:"加载中",mask:!0}),v.value=[];const a=null==(e=s.value.brand)?void 0:e.id,l=await uni.$u.http.get("/product/carSeries/getSeries",{params:{carBrandId:a,name:t.value,containsAll:!1}});v.value=(l.data||[]).flatMap((e=>(e.carSeries||[]).map((a=>({...a,brandId:e.brandId}))))),C()};return(a,s)=>{const l=r(n("up-loading-icon"),S),b=_;return c(),g(b,{class:"page"},{default:y((()=>[d(b,{class:"search-box"},{default:y((()=>[d(U,{modelValue:j(t),"onUpdate:modelValue":s[0]||(s[0]=e=>k(t)?t.value=e:null),placeholder:"请输入车系搜索",onSearch:f,onCustom:f,onInput:h,onFocus:T,visible:j(o),"onUpdate:visible":s[1]||(s[1]=e=>k(o)?o.value=e:null),initFocus:!0,ref:"searchPopoverRef"},{content:y((()=>[j(i)?(c(),g(l,{key:0})):j(p).length?(c(),u("div",{key:1,class:"pop-content"},[m("div",{class:"list-box"},[(c(!0),u(I,null,x(j(p),(s=>(c(),u("div",{class:"item",onClick:e=>(async e=>{t.value=e.name,o.value=!1,p.value=[],B()})(s),key:s.id,innerHTML:("getHighlightText"in a?a.getHighlightText:j(e))(s.name,j(t))},null,8,["onClick","innerHTML"])))),128))])])):(c(),u("div",{key:2,class:"search-empty"},"暂无数据"))])),_:1},8,["modelValue","visible"])])),_:1}),d(F,{list:j(v),onItemClick:s[2]||(s[2]=e=>{return a=e,H.emitEvent({data:a}),void M();var a})},null,8,["list"])])),_:1})}}}),[["__scopeId","data-v-c278e521"]]);export{$ as default};
