import{d as a,r as s,B as e,E as t,X as r,Y as i,D as o,$ as l,a2 as n,c,w as u,i as p,o as m,a as f,b as d,F as v,e as y,u as P,n as g,g as j,t as b,ad as k,s as w,Z as _,a0 as h,_ as A}from"./index-CK4DGatK.js";import{L}from"./ListLoadRefreshView.CnNC2lkG.js";import{D as x}from"./listItem.CnogksUc.js";import{F as K}from"./FixPricePopup.B6Ost8DA.js";import{u as M}from"./useQuery.3dd8K18V.js";import{o as I}from"./omit.DzeQdT5l.js";import"./index.HDA2F_3Q.js";import"./avatar.Buy0-vr1.js";import"./car_default.CyENNAub.js";import"./refuse.BEcO0WCW.js";import"./close.Dhgi5Ijg.js";import"./task.Cx6XxNwo.js";import"./isNil.aV-w2MPu.js";import"./cloneDeep.D7E8_JON.js";import"./_baseClone.Cc-Y92km.js";import"./_Uint8Array.B4mhORiM.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";import"./_baseGet.CmhOSbYr.js";import"./isSymbol.Bym6OQCA.js";const D=A(a({__name:"pendList",setup(a){const A=M(),D=s([{name:"待处理",value:0},{name:"已处理",value:1}]),F=s([]),B=s(),C=s({current:1,size:15,total:0,processApproval:"",status:0});e((a=>{C.value.status=+a.type,C.value.processApproval=a.processApproval,R()})),t((()=>{r("refreshList"),i("refreshList",(()=>{S()}))}));const R=async()=>{var a,s;(new o).showLoading("加载中");try{const a={...I(C.value,"total")},s=await l().get("product/process/pageList",{params:a});C.value.total=+s.data.count;const e=s.data.results;F.value=1===C.value.current?e:[...F.value,...e]}finally{1==C.value.current&&(null==(a=B.value)||a.initTop()),null==(s=B.value)||s.loadFinish(),n()}},S=()=>{C.value.current=1,R()},T=()=>{C.value.current++,R()},N=s({form:{carPricingId:"",needBossAudit:!1},info:{},show:!1});async function O(a){const s=await l().get(`/product/carPricing/getAppraiseInfo/${a.primaryKey}`);N.value.info=s.data||{};const{budgetaryPrice:e,forecastPriceMax:t,forecastPriceMin:r,raterPriceMax:i,raterPriceMin:o,estimateSalePrice:n}=s.data||{},c=N.value.form;c.carPricingId=a.primaryKey,c.budgetaryPrice=e,c.forecastPriceMin=r,c.forecastPriceMax=t,c.pricingPriceMin=o,c.pricingPriceMax=i,c.estimateSalePrice=n,c.pricingRemark="",c.needBossAudit=!1,N.value.show=!0,c.taskDefinitionKey=a.taskDefinitionKey,c.taskId=a.taskId,c.primaryKey=a.primaryKey}async function U(a){_({title:"提交中",mask:!0}),N.value.form=a,await l().post("/product/carPricingFlowable/taskTurnover",{flowPricingAddDTO:{...a},taskId:a.taskId,primaryKey:a.primaryKey,taskDefinitionKey:a.taskDefinitionKey,auditOpinion:1}),N.value.form={needBossAudit:!1},C.value.current=1,h({title:"提交成功"}),R(),N.value.show=!1}return(a,s)=>{const e=p;return m(),c(e,{class:"page f-c-s"},{default:u((()=>[f(e,{class:"tabs-bg"},{default:u((()=>[f(e,{class:"tabs"},{default:u((()=>[(m(!0),d(v,null,y(P(D),((a,s)=>(m(),c(e,{key:s,class:g({active:a.value==P(C).status}),onClick:s=>{var e;(e=a.value)!=C.value.status&&(F.value=[],C.value={current:1,size:15,total:0,processApproval:"",status:0},C.value.processApproval=A.value.processApproval,w((()=>{C.value.status=e,R()})))}},{default:u((()=>[j(b(a.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),f(e,{class:"total"},{default:u((()=>[j("共 "+b(P(C).total)+" 个审批单",1)])),_:1}),f(L,k({ref_key:"listLoadRef",ref:B,class:"scroll-view-box"},P(C),{istop:!1,onLoadMore:T,onLoadRefresh:S}),{"list-cont":u((()=>[(m(!0),d(v,null,y(P(F),((a,s)=>(m(),c(x,{key:s,item:a,className:"first-mt-0",status:P(C).status,onConfirm:S,onFixPrice:O},null,8,["item","status"])))),128))])),_:1},16),f(K,{title:"调整定价",visible:P(N).show,"onUpdate:visible":s[0]||(s[0]=a=>P(N).show=a),info:P(N).info,state:P(N).form,onSubmit:U,showPricingPrice:!0,showBossAudit:!1},null,8,["visible","info","state"])])),_:1})}}}),[["__scopeId","data-v-b1b0651f"]]);export{D as default};
