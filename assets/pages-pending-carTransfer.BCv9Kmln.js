import{d as a,A as e,r as t,a9 as l,au as s,B as r,D as i,a2 as n,b as u,a as o,w as m,u as d,z as f,F as p,i as c,I as v,at as y,K as h,ae as g,af as k,M as _,o as w,c as x,y as L,n as j,g as T,t as Y,h as D,e as b,aj as M,W as I,an as V,s as F,_ as R}from"./index-CK4DGatK.js";import{N as U}from"./NavBar.DSs5OGCU.js";import{L as K}from"./listItem.De6Dqo0z.js";import{U as P}from"./UploadFile.BBuXxkzB.js";import{u as C}from"./useQuery.3dd8K18V.js";import{p as W}from"./index.HDA2F_3Q.js";import"./time._VqwKl0d.js";import"./car_default.CyENNAub.js";import"./purchase.B8DNaFGL.js";import"./fixPrice.CFXyKkhm.js";import"./base.6l0JEBJr.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const A=R(a({__name:"carTransfer",setup(a){const R=C(),A=e(),N=t({}),O=l({way:1,imageList:[],remark:"",attachments:[],expirationTime:s().add(1,"year"),labelList:[]}),S=t(),$=t(),Q=t(),B=t([{name:"店内代办",value:1},{name:"客户办理",value:2}]),Z=t([{name:"店内购买",value:1},{name:"店外购买",value:2}]);r((()=>{z()}));const z=()=>{(new i).showLoading("加载中"),uni.$u.http.get("/product/carSales/getTransferAndInsuranceInfo",{params:{primaryKey:R.value.primaryKey}}).then((a=>{if(N.value=a.data,n(),1==R.value.status){const{transferWay:e,insuranceWay:t,transferPhotos:l,insurancePhotos:s,carInsurancePhotos:r,transferRemark:i,insuranceRemark:n,insuranceAttachmentPhotos:u,expirationTime:o,otherPhotos:m}=a.data,d=(a,e)=>{var t;return null==(t=null==a?void 0:a.filter((a=>a.value==e))[0])?void 0:t.name},f="transfer"==R.value.page;N.value.wayName=d(f?B.value:Z.value,f?e:t),O.expirationTime=o||null,O.way=f?e:t;const p=a=>a?null==a?void 0:a.map((a=>({attachmentUrl:a}))):[];O.imageList=p(f?l:s),N.value.remark=f?i:n,O.attachments=(null==u?void 0:u.map((a=>({attachmentUrl:a}))))||[],O.labelList=p(f?m:r)}}))},J=()=>{var a,e,t,l,r,n;const u=(null==(e=null==(a=S.value)?void 0:a.getFileFields())?void 0:e.all.map((a=>a.id)))||[];if(!u.length&&1==O.way)return(new i).showToast("请上传"+("transfer"==R.value.page?"资料":"图片"));const{way:o,remark:m,expirationTime:d}=O;if("insurance"==R.value.page&&!d)return(new i).showToast("请选择保险到期时间");(new i).showLoading("提交中");const f={taskId:R.value.taskId,primaryKey:R.value.primaryKey,taskDefinitionKey:R.value.taskDefinitionKey,auditOpinion:1},p=(null==(l=null==(t=Q.value)?void 0:t.getFileFields())?void 0:l.all.map((a=>a.id)))||[],c=(null==(n=null==(r=$.value)?void 0:r.getFileFields())?void 0:n.all.map((a=>a.id)))||[];"transfer"==R.value.page?(f.transferWay=o,f.transferimageList=u,f.transferRemark=m,f.otherImageList=c):(f.insuranceWay=o,f.insuranceimageList=u,f.labelList=c,f.insuranceRemark=m,f.insuranceAttachmentList=2==o?p:[],f.expirationTime=d?s(d).format("YYYY-MM-DD"):null),uni.$u.http.post("/product/carSales/taskTurnover",f).then((()=>{V()})).catch((a=>{W(a.message)}))},X=t(!1),q=t(""),E=t(""),G=a=>{F((()=>{O[q.value]=s(a.value).valueOf(),X.value=!1}))};function H(a){return a?s(a).format("YYYY-MM-DD"):""}const aa=new Map([["year","年"],["month","月"],["day","日"]]);function ea(a,e){return`${e}${aa.get(a)}`}return(a,e)=>{const t=c,l=D,r=v(h("up-radio"),g),i=v(h("up-radio-group"),k),n=v(h("up-icon"),_),V=M,F=I,C=v(h("up-datetime-picker"),y);return w(),u(p,null,[o(t,{class:"page pend-page"},{default:m((()=>[d(A).needShowQw()?L("",!0):(w(),x(U,{key:0,title:"transfer"==d(R).page?"车辆过户":"车辆保险"},null,8,["title"])),o(t,{class:"content"},{default:m((()=>[o(K,{item:d(N),isDetail:!0,isTransfer:!0},null,8,["item"]),o(t,{class:j(["form-box",{write:1!=d(R).status}])},{default:m((()=>[o(t,{class:"form-item radio"},{default:m((()=>[o(t,null,{default:m((()=>[T(Y("transfer"==d(R).page?"过户方式":"购买方式"),1)])),_:1}),1==d(R).status?(w(),x(l,{key:0},{default:m((()=>[T(Y(d(N).wayName),1)])),_:1})):(w(),x(i,{key:1,modelValue:d(O).way,"onUpdate:modelValue":e[0]||(e[0]=a=>d(O).way=a)},{default:m((()=>[(w(!0),u(p,null,b("transfer"==d(R).page?d(B):d(Z),((a,e)=>(w(),x(r,{customStyle:{marginRight:"20px"},activeColor:"#ff7525",key:e,label:a.name,name:a.value},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]))])),_:1}),"insurance"===d(R).page?(w(),x(t,{key:0,class:"form-item"},{default:m((()=>[o(t,null,{default:m((()=>[1!=d(R).status?(w(),x(l,{key:0},{default:m((()=>[T("*")])),_:1})):L("",!0),T("保险到期时间")])),_:1}),1!=d(R).status?(w(),x(t,{key:0,class:j({placeholder:!d(O).expirationTime}),onClick:e[1]||(e[1]=a=>{return e="expirationTime",t=d(O).expirationTime,X.value=!0,q.value=e,void(E.value=t||s().format("YYYY-MM-DD"));var e,t})},{default:m((()=>[T(Y(H(d(O).expirationTime)||"请选择"),1)])),_:1},8,["class"])):(w(),x(t,{key:1},{default:m((()=>[T(Y(H(d(O).expirationTime)||"-"),1)])),_:1})),1!=d(R).status?(w(),x(n,{key:2,name:"arrow-right"})):L("",!0)])),_:1})):L("",!0),o(t,{class:"form-item photo-item"},{default:m((()=>[o(t,null,{default:m((()=>[1!=d(R).status&&1==d(O).way?(w(),x(l,{key:0},{default:m((()=>[T("*")])),_:1})):L("",!0),T(Y("transfer"==d(R).page?"资料":"图片"),1)])),_:1}),o(P,{ref_key:"uploadRef",ref:S,accept:"all","max-count":99,uploadList:d(O).imageList,detail:d(R).status},null,8,["uploadList","detail"])])),_:1}),o(t,{class:"form-item photo-item"},{default:m((()=>[o(t,null,{default:m((()=>[T("其他")])),_:1}),o(P,{ref_key:"otherUploadRef",ref:$,accept:"all","max-count":99,uploadList:d(O).labelList,detail:d(R).status},null,8,["uploadList","detail"])])),_:1}),o(t,{class:"form-textarea"},{default:m((()=>[o(t,{class:"area-title"},{default:m((()=>[T("备注")])),_:1}),1==d(R).status?(w(),x(t,{key:0,class:"word-warp"},{default:m((()=>[T(Y(d(N).remark||"-"),1)])),_:1})):(w(),u(p,{key:1},[o(V,{modelValue:d(O).remark,"onUpdate:modelValue":e[2]||(e[2]=a=>d(O).remark=a),placeholder:"请输入备注说明",maxlength:"1000"},null,8,["modelValue"]),o(t,{class:"limit"},{default:m((()=>{var a;return[T(Y((null==(a=d(O).remark)?void 0:a.length)||0)+"/1000",1)]})),_:1})],64))])),_:1}),"insurance"==d(R).page&&2==d(O).way?(w(),x(t,{key:1,class:"form-item photo-item"},{default:m((()=>[o(t,null,{default:m((()=>[T("附件")])),_:1}),o(P,{ref_key:"attachmentRef",ref:Q,accept:"all","max-count":99,uploadList:d(O).attachments,detail:d(R).status},null,8,["uploadList","detail"])])),_:1})):L("",!0)])),_:1},8,["class"])])),_:1}),1!=d(R).status?(w(),x(t,{key:1,class:"bottom-btn"},{default:m((()=>[o(F,{class:"save-btn",onClick:J},{default:m((()=>[T("确定")])),_:1})])),_:1})):L("",!0)])),_:1}),o(C,{show:d(X),modelValue:d(E),"onUpdate:modelValue":e[3]||(e[3]=a=>f(E)?E.value=a:null),mode:"date","value-format":"YYYY-MM-DD",confirmColor:"#ff5719",minDate:d(s)().add(1,"day").valueOf(),formatter:ea,onCancel:e[4]||(e[4]=a=>X.value=!1),onConfirm:G},null,8,["show","modelValue","minDate"])],64)}}}),[["__scopeId","data-v-f4ddcfc5"]]);export{A as default};
