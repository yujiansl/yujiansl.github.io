import{d as a,r as t,a9 as e,B as s,E as r,X as l,Y as o,Z as c,a2 as u,x as n,c as i,w as d,i as m,I as p,M as f,K as h,o as g,a as v,y as _,u as y,g as k,f as S,P as I,h as A,t as b,n as w,b as $,F as C,e as T,W as P,a8 as x,Q as j,D as M,bG as N,ar as D,a1 as O,_ as E}from"./index-CK4DGatK.js";import{_ as K}from"./camera.DDOxr1zP.js";import{D as R}from"./listItem.Dt6aurFb.js";import{u as J}from"./useQuery.3dd8K18V.js";import{p as L}from"./index.HDA2F_3Q.js";import"./time._VqwKl0d.js";import"./car_default.CyENNAub.js";const U=E(a({__name:"detail",setup(a){const E=J(),U=t({imageList:[]}),H=e({carAttachments:[],regionId:"",microStoreStatus:!0}),Q=t([]),Z=t([{value:"是",key:!0},{value:"否",key:!1}]);s((()=>{q(),B()})),r((()=>{l("pickData"),o("pickData",(a=>{const{key:t,subKey:e}=a;H[e]=t})),l("addPhoto"),o("addPhoto",(a=>{H.carAttachments=a}))}));const q=()=>{c({title:"加载中"}),uni.$u.http.get(`/product/carPricing/carStock/${E.value.purchaseId}`).then((a=>{const{carPricingInfo:t,coverUrl:e,carAttachmentInfo:s,regionId:r,microStoreStatus:l}=a.data;U.value={...a.data,...t,photoUrl:e},H.carAttachments=s,H.regionId=r,H.microStoreStatus=l,u()}))},B=()=>{uni.$u.http.get("/product/regionManage/getAllRegion").then((a=>{Q.value=a.data.map((a=>({value:a.regionName,key:a.regionId})))}))},F=n((()=>{var a;const t=null==(a=Q.value)?void 0:a.filter((a=>a.key==H.regionId));return(null==t?void 0:t.length)?t[0].value:"请选择"})),G=n((()=>{var a,t;return(null==(t=null==(a=H.carAttachments)?void 0:a.filter((a=>"Cover"==a.carAttachmentType))[0])?void 0:t.attachmentUrl)||""})),W=()=>{var a;const{carAttachments:t,regionId:e}=H,s=[];if(t.map((a=>{["Cover","APPEARANCE","Normal","TRIM","OTHER_PHOTOS"].includes(a.carAttachmentType)&&s.push(a)})),!(null==(a=t.filter((a=>"Cover"==a.carAttachmentType)))?void 0:a.length))return void(new M).showToast("请至少上传一张外观图片");if(!e)return void(new M).showToast("请选择区域");(new M).showLoading("提交中");const r={purchaseId:E.value.purchaseId,...H,carAttachments:s};uni.$u.http.post("/product/carPricing/editStorage",r).then((()=>{(new M).showToast("提交成功"),"qw"==E.value.pushType||"app"==E.value.pushType?N(`/pages/storagePond/detail?id=${E.value.id}&purchaseId=${E.value.purchaseId}&status=completeCarStock`):(D("refreshList"),O())})).catch((a=>{L(a.message)}))};return(a,t)=>{const e=m,s=I,r=A,l=p(h("up-icon"),f),o=P;return g(),i(e,{class:"page pend-page"},{default:d((()=>[v(e,{class:"content"},{default:d((()=>[v(R,{item:y(U),isDetail:!0},null,8,["item"]),v(e,{class:"photo-box"},{default:d((()=>[v(e,{class:"title"},{default:d((()=>[k("照片资料")])),_:1}),v(e,{class:"photo-item"},{default:d((()=>[v(e,{onClick:t[0]||(t[0]=a=>(a=>{x("carAttachments",JSON.stringify(H.carAttachments));const t="waitCarStock"==E.value.status;j(`/pages/carManage/photoManage?type=${a}&detail=${t?0:1}&showTabsAll=false`)})(0)),style:S(`background-image:url(${y(G)})`)},{default:d((()=>[v(s,{src:K}),v(r,null,{default:d((()=>[k("车辆照片")])),_:1})])),_:1},8,["style"])])),_:1})])),_:1}),"completeCarStock"==y(E).status?(g(),i(e,{key:0,class:"form-box"},{default:d((()=>[v(e,{class:"form-item"},{default:d((()=>[v(e,null,{default:d((()=>[k("区域")])),_:1}),k(" "+b(y(U).regionName||"-"),1)])),_:1}),v(e,{class:"form-item"},{default:d((()=>[v(e,null,{default:d((()=>[k("是否上架")])),_:1}),k(" "+b(y(U).microStoreStatus?"是":"否"),1)])),_:1})])),_:1})):(g(),i(e,{key:1,class:"form-box write"},{default:d((()=>[v(e,{class:"form-item"},{default:d((()=>[v(e,null,{default:d((()=>[v(r,null,{default:d((()=>[k("*")])),_:1}),k(" 区域 ")])),_:1}),v(e,{class:"f-b-c",onClick:t[1]||(t[1]=a=>{return t="区域",e=y(Q),s=y(H).regionId,r="regionId",void j(`/pages/carManage/pagePicker?title=${t}&list=${JSON.stringify(e)}&key=${s}&subKey=${r}&tKey=${l}`);var t,e,s,r,l})},{default:d((()=>[v(r,{class:w({placeholder:"请选择"==y(F)})},{default:d((()=>[k(b(y(F)),1)])),_:1},8,["class"]),v(l,{name:"arrow-right"})])),_:1})])),_:1}),v(e,{class:"form-item"},{default:d((()=>[v(e,null,{default:d((()=>[k("是否上架")])),_:1}),v(e,{class:"tab-box"},{default:d((()=>[(g(!0),$(C,null,T(y(Z),((a,t)=>(g(),i(r,{key:t,class:w({active:y(H).microStoreStatus==a.key}),onClick:t=>y(H).microStoreStatus=a.key},{default:d((()=>[k(b(a.value),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1}))])),_:1}),"waitCarStock"==y(E).status?(g(),i(e,{key:0,class:"bottom-btn"},{default:d((()=>[v(o,{class:"save-btn",onClick:W},{default:d((()=>[k("确定")])),_:1})])),_:1})):_("",!0)])),_:1})}}}),[["__scopeId","data-v-90fc4d2d"]]);export{U as default};
