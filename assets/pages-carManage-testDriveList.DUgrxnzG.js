import{d as e,r as a,I as l,a6 as t,K as s,c as r,o as i,i as c,w as o,a as u,a5 as n,g as d,b as p,e as m,n as v,u as f,t as h,F as _,h as b,a0 as g,_ as y,a9 as T,q as D,v as k,M as I,ae as w,af as S,ag as U,S as j,y as L,R as C,B as V,E as x,G as H,Z as E,$ as R,a2 as A,ad as B,O as F,T as O,s as N}from"./index-CK4DGatK.js";import{U as z,a as M}from"./u-dropdown-item.B66HFyYv.js";import{N as $}from"./NavBar.DSs5OGCU.js";import{B as G}from"./brandDrop.WDU7kvw8.js";import{D as K}from"./datePicker.DPajrKz9.js";import{u as P}from"./useQuery.3dd8K18V.js";import{L as Q}from"./ListLoadRefreshView.CnNC2lkG.js";import{L as Z}from"./testDriveDetailItem.DjqyF4_P.js";import{o as q}from"./omit.DzeQdT5l.js";import"./time._VqwKl0d.js";import"./car_default.CyENNAub.js";import"./_baseGet.CmhOSbYr.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";import"./isSymbol.Bym6OQCA.js";import"./_Uint8Array.B4mhORiM.js";import"./_baseClone.Cc-Y92km.js";const J=y(e({__name:"testDriveAllFilter",props:{methodTypes:{type:Array,default:()=>[]},initData:{type:Object,default:()=>{}}},emits:["search"],setup(e,{expose:y,emit:T}){const D=a({testDriveTime:[],salesDateTime:[],prices:"",priceLow:"",priceHigh:""}),k=a([{label:"不限",val:"0,0"},{label:"3万以下",val:"0,3"},{label:"3-5万",val:"3,5"},{label:"5-8万",val:"5,8"},{label:"8-10万",val:"8,10"},{label:"10-15万",val:"10,15"},{label:"15-20万",val:"15,20"},{label:"20-30万",val:"20,30"},{label:"30-50万",val:"30,50"},{label:"50-100万",val:"50,100"},{label:"100万以上",val:"100"}]),I=(e,a)=>{D.value.prices="";const l=D.value.priceLow,t=D.value.priceHigh;if(l&&t&&parseFloat(l)>parseFloat(t))return g({title:"最高价必须大于最低价",icon:"none"}),void(D.value[a]="")},w=T,S=()=>{D.value={testDriveTime:[],salesDateTime:[],prices:"",priceLow:"",priceHigh:""};const e={...D.value,testDriveTimeStart:"",testDriveTimeEnd:"",salesDateTimeStart:"",salesDateTimeEnd:""};w("search",e,!1,"clear")};y({resetFilter:S});const U=async()=>{const e={testDriveTimeStart:D.value.testDriveTime[0]?D.value.testDriveTime[0]+" 00:00:00":"",testDriveTimeEnd:D.value.testDriveTime[1]?D.value.testDriveTime[1]+" 23:59:59":"",salesDateTimeStart:D.value.salesDateTime[0]?D.value.salesDateTime[0]+" 00:00:00":"",salesDateTimeEnd:D.value.salesDateTime[1]?D.value.salesDateTime[1]+" 23:59:59":"",prices:D.value.prices||"",priceLow:D.value.priceLow||"",priceHigh:D.value.priceHigh||""};w("search",e,!0)};return(e,a)=>{const g=c,y=l(s("up-input"),t),T=b,w=n;return i(),r(g,{class:"all-filter"},{default:o((()=>[u(w,{class:"scrolls","scroll-y":""},{default:o((()=>[u(g,{class:"content"},{default:o((()=>[u(g,{class:"models"},{default:o((()=>[u(g,{class:"sub-title"},{default:o((()=>[d("价格")])),_:1}),u(g,{class:"price-list"},{default:o((()=>[u(g,{class:"price-item"},{default:o((()=>[(i(!0),p(_,null,m(f(k),((e,a)=>(i(),r(g,{key:a,class:v({active:f(D).prices==e.val}),onClick:a=>((e,a)=>{D.value[e]=a.val;const l=D.value[e].split(",");l.length>1?"0,0"==D.value[e]?(D.value.priceLow="",D.value.priceHigh=""):(D.value.priceLow=l[0],D.value.priceHigh=l[1]):(D.value.priceLow=l[0],D.value.priceHigh="")})("prices",e)},{default:o((()=>[d(h(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),u(g,{class:"customs"},{default:o((()=>[u(y,{type:"number",inputAlign:"center",placeholder:"最低价",border:"bottom",modelValue:f(D).priceLow,"onUpdate:modelValue":a[0]||(a[0]=e=>f(D).priceLow=e),clearable:"",onBlur:a[1]||(a[1]=e=>I(0,"priceLow"))},null,8,["modelValue"]),u(T,null,{default:o((()=>[d("-")])),_:1}),u(y,{type:"number",inputAlign:"center",placeholder:"最高价",border:"bottom",modelValue:f(D).priceHigh,"onUpdate:modelValue":a[2]||(a[2]=e=>f(D).priceHigh=e),clearable:"",onBlur:a[3]||(a[3]=e=>I(0,"priceHigh"))},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),u(g,{class:"models"},{default:o((()=>[u(g,{class:"sub-title"},{default:o((()=>[d("试驾时间")])),_:1}),u(K,{creatAt:f(D).testDriveTime,"onUpdate:creatAt":a[4]||(a[4]=e=>f(D).testDriveTime=e)},null,8,["creatAt"])])),_:1}),u(g,{class:"models"},{default:o((()=>[u(g,{class:"sub-title"},{default:o((()=>[d("创建时间")])),_:1}),u(K,{creatAt:f(D).salesDateTime,"onUpdate:creatAt":a[5]||(a[5]=e=>f(D).salesDateTime=e)},null,8,["creatAt"])])),_:1})])),_:1})])),_:1}),u(g,{class:"btns"},{default:o((()=>[u(g,{class:"btn-box"},{default:o((()=>[u(g,{onClick:S,class:"reset-btn"},{default:o((()=>[d("重置")])),_:1}),u(g,{onClick:U,class:"confirm-car"},{default:o((()=>[d("查询")])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-1242e351"]]),Y=y(e({__name:"testDriveFilter",props:{status:{type:Number,default:null},typeVal:{type:String,default:"1"}},emits:["search"],setup(e,{expose:t,emit:y}){P();const V=y,x=e,H=a(),E=a(),R=a(),A=a(""),B=a(!1),F=a(!1),O=T({orders:"3"==x.typeVal?"cancelTime":"createTime",brandId:"",seriesId:"",salesUserId:""}),N=a([{label:"取消时间",id:"cancelTime"}]),$=a([]);D((()=>{ee(),H.value.highlight(0,O.orders)}));const K=e=>{console.log(e)},Q=()=>{var e;null==(e=H.value)||e.close()},Z=()=>{V("search",O),Q()},q=(e,a,l)=>{H.value.highlight(l,a.id.toString()),O[e]=a.id,"orders"==e&&Z()},Y=(e,a)=>{O.brandId=e,O.seriesId=a,H.value.highlight(1,a||e),Z()},W=(e,a,l)=>{Object.assign(O,e),H.value.highlight(3,a),"clear"==l&&(H.value.highlight(1,""),H.value.highlight(2,""),O.brandId="",O.seriesId="",O.salesUserId=""),Z()},X=e=>{A.value=e.detail.value,e.detail.value.length>0?B.value=!0:B.value=!1},ee=()=>{F.value=!0;try{uni.$u.http.get("product/order/car/custom/findAll",{params:{search:A.value}}).then((e=>{$.value=e.data,F.value=!1}))}catch(e){F.value=!1}finally{F.value=!1}},ae=()=>{A.value="",B.value=!1,O.salesUserId=null,ee()},le=a(0),te=()=>{ae(),H.value.highlight(2,null),Z()},se=()=>{if(!O.salesUserId)return g({title:"请先选择销售",icon:"none"});H.value.highlight(2,O.salesUserId),Z()};return k((()=>x.typeVal),((e,a)=>{O.orders="3"==e?"cancelTime":"createTime",N.value="3"==e?[{label:"取消时间",id:"cancelTime"}]:[{label:"创建时间",id:"createTime"}]}),{deep:!0,immediate:!0}),t({close:Q,allDropRef:R}),(e,a)=>{const t=c,g=l(s("up-icon"),I),y=C,T=b,D=l(s("up-radio"),w),k=l(s("up-radio-group"),S),V=n,x=l(s("up-loading-icon"),U);return i(),r(z,{ref_key:"uDropdownRef",ref:H,class:"drop",borderRadius:"20rpx",onOpen:K},{default:o((()=>[u(M,{title:"排序"},{default:o((()=>[u(t,{class:"item-list"},{default:o((()=>[(i(!0),p(_,null,m(f(N),((e,a)=>(i(),r(t,{key:a,class:v({active:f(O).orders==e.id}),onClick:j((a=>q("orders",e,0)),["stop"])},{default:o((()=>[u(t,null,{default:o((()=>[d(h(e.label),1)])),_:2},1024),f(O).orders==e.id?(i(),r(g,{key:0,name:"checkbox-mark",color:"#ff5719",size:"20"})):L("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),u(M,{title:"品牌车系"},{default:o((()=>[u(G,{ref_key:"brandDropRef",ref:E,onSearch:Y,pBrand:f(O).brandId,pSeries:f(O).seriesId},null,8,["pBrand","pSeries"])])),_:1}),u(M,{title:"销售"},{default:o((()=>[u(t,{class:"u-menu-wrap",style:{height:"calc(100vh - 316rpx)"}},{default:o((()=>[u(t,{class:"flexs"},{default:o((()=>[u(t,{class:"flexs"},{default:o((()=>[u(y,{onInput:X,clearable:!0,onConfirm:ee,onKeyboardheightchange:ee,value:f(A),placeholder:"输入销售名字"},null,8,["value"]),f(B)?(i(),r(T,{key:0,class:"uni-icon",onClick:ae},{default:o((()=>[u(g,{name:"close-circle"})])),_:1})):L("",!0)])),_:1}),u(t,{onClick:ee,class:"searchs"},{default:o((()=>[d("搜索")])),_:1})])),_:1}),f($).length>0?(i(),r(V,{key:0,"scroll-y":"","scroll-with-animation":"",class:"sellUser u-tab-view menu-scroll-view","scroll-top":f(le)},{default:o((()=>[u(k,{modelValue:f(O).salesUserId,"onUpdate:modelValue":a[0]||(a[0]=e=>f(O).salesUserId=e),placement:"column"},{default:o((()=>[(i(!0),p(_,null,m(f($),((e,a)=>(i(),r(t,{class:v(["user-item",{active:f(O).salesUserId==e.id}]),key:a,onClick:j((a=>q("salesUserId",e,2)),["stop"])},{default:o((()=>[(i(),r(D,{activeColor:"rgb(221, 79, 51)",customStyle:{marginBottom:"8px",marginTop:0},key:a,label:e.name+"("+e.phone+")",name:e.id},null,8,["label","name"])),u(t,{class:"dept"},{default:o((()=>[d(h(e.deptName||""),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["scroll-top"])):(i(),r(t,{key:1,class:"no-content"},{default:o((()=>[d("暂无数据")])),_:1})),f(F)?(i(),r(x,{key:2,class:"loading-icon",size:"32"})):L("",!0)])),_:1}),u(t,{class:"brand-btn"},{default:o((()=>[u(t,{class:"clear",onClick:te},{default:o((()=>[d("清空")])),_:1}),u(t,{class:"sure",onClick:se},{default:o((()=>[d("确定")])),_:1})])),_:1})])),_:1}),u(M,{title:"筛选"},{default:o((()=>[u(t,{class:"all-list"},{default:o((()=>[u(J,{ref_key:"allDropRef",ref:R,onSearch:W,obj:f(O)},null,8,["obj"])])),_:1})])),_:1})])),_:1},512)}}}),[["__scopeId","data-v-c2c4a4ca"]]),W=y(e({__name:"testDriveList",setup(e){const t=P(),n=a([]),b=a(),g=a("1"),y=a([]),D=T({current:1,size:20,total:0,status:"1",orders:"createTime",salesUserId:"",seriesId:"",brandId:"",modelId:"",salesDateTimeEnd:"",salesDateTimeStart:"",priceLow:"",priceHigh:"",testDriveTimeEnd:"",testDriveTimeStart:""});V((e=>{var a;g.value=e.type,D.status=g.value,K(),null==(a=b.value)||a.initTop(),w()}));const k=a([]),w=()=>{uni.$u.http.get("product/common/getInitSelect").then((e=>{const a=e.data;k.value=a.SalesMethodEnum}))},S=a([]),U=a(!0);x((()=>{S.value=JSON.parse(H("userBtnPermission")||"{}").map((e=>e)),S.value.includes("product:info")||S.value.includes("inventory:info")?U.value=!0:U.value=!1,C()}));const j=a(!1);async function C(){var e;try{E({title:"加载中"});const e={...q(D,"total")},a=await R().post("/product/carTestDrive/page",e);D.total=+a.data.count;const l=a.data.results.map((e=>({...e,coverUrl:decodeURIComponent(e.coverUrl),checked:!1})));n.value=1===D.current?l:[...n.value,...l]}finally{A(),null==(e=b.value)||e.loadFinish()}}const G=a(),K=()=>{D.current=1,y.value=[],C()},J=()=>{D.current++,C()},W=(e,a)=>{var l;j.value=!1,D.current=1,D.brandId=e.brandId||"",D.seriesId=e.seriesId||"",D.priceHigh=e.priceHigh||"",D.priceLow=e.priceLow||"",D.salesUserId=e.salesUserId,D.salesDateTimeEnd=e.salesDateTimeEnd,D.salesDateTimeStart=e.salesDateTimeStart,D.testDriveTimeEnd=e.testDriveTimeEnd,D.testDriveTimeStart=e.testDriveTimeStart,K(),null==(l=b.value)||l.initTop()},X=a(),ee=a([{label:"待签署",val:"1"},{label:"已签署",val:"2"},{label:"已取消",val:"3"}]),ae=e=>{switch(e){case"1":return"待签署";case"2":return"已签署";case"3":return"已取消";default:return""}};return(e,a)=>{const y=c,T=l(s("up-icon"),I);return i(),r(y,{class:"page f-c-s car-lists"},{default:o((()=>[u($,null,{title:o((()=>[u(y,{class:"head-drop",style:{display:"flex","align-items":"center","justify-content":"center"}},{default:o((()=>["4"!=f(t).type?(i(),r(z,{key:0,ref_key:"uDropdownRef",ref:G,class:"drop",borderRadius:"20rpx"},{default:o((()=>[u(M,{title:ae(f(g))},{default:o((()=>[u(y,{class:"item-list"},{default:o((()=>[(i(!0),p(_,null,m(f(ee),((e,a)=>(i(),r(y,{key:a,class:v({active:f(g)==e.val}),onClick:a=>(async e=>{var a;g.value=e.val,D.orders=3==e.val?"cancelTime":"createTime",D.status=e.val,G.value.close(),D.salesUserId="",D.seriesId="",D.brandId="",D.modelId="",D.salesDateTimeEnd="",D.salesDateTimeStart="",D.priceLow="",D.priceHigh="",D.testDriveTimeEnd="",D.testDriveTimeStart="",await N(),K(),null==(a=b.value)||a.initTop(),X.value.allDropRef.resetFilter()})(e)},{default:o((()=>[u(y,null,{default:o((()=>[d(h(e.label),1)])),_:2},1024),f(g)==e.val?(i(),r(T,{key:0,name:"checkbox-mark",color:"#DD4F33",size:"20"})):L("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["title"])])),_:1},512)):(i(),r(y,{key:1},{default:o((()=>[d("试乘试驾")])),_:1}))])),_:1})])),right:o((()=>[])),_:1}),u(Y,{ref_key:"filterRef",ref:X,methodTypes:f(k),typeVal:f(g),onSearch:W},null,8,["methodTypes","typeVal"]),u(y,{class:"total"},{default:o((()=>[u(y,null,{default:o((()=>[d("共找到 "+h(f(D).total)+" 辆",1)])),_:1})])),_:1}),u(Q,B({ref_key:"listLoadRef",ref:b,class:"scroll-view-box"},f(D),{istop:!1,onLoadMore:J,onLoadRefresh:K}),{default:o((()=>[F(u(y,{class:"list-box"},{default:o((()=>[(i(!0),p(_,null,m(f(n),(e=>(i(),r(Z,{key:e.id,item:e,page:"4"!=f(t).type?"list":"page",typeVal:f(g),type:f(t).type,class:v("4"==f(t).type?"p32":"")},null,8,["item","page","typeVal","type","class"])))),128))])),_:1},512),[[O,f(n).length]])])),_:1},16)])),_:1})}}}),[["__scopeId","data-v-5054b855"]]);export{W as default};
