import{d as a,r as e,I as t,aq as l,K as s,ac as r,b as u,o as n,a as o,w as i,i as c,g as d,t as f,h as m,F as _,e as p,c as v,y as g,S as h,u as C,P as b,U as y,ai as S,a0 as T,Q as w,_ as N,a9 as j,B as k,D,$ as R,a2 as A,M as L,n as U,ad as E}from"./index-CK4DGatK.js";import{N as O}from"./NavBar.DSs5OGCU.js";import{U as x,a as I}from"./u-dropdown-item.B66HFyYv.js";import{L as G}from"./ListLoadRefreshView.CnNC2lkG.js";import{_ as M,a as P}from"./album.BQJzdOdy.js";import{z as $}from"./image.DobRSNlT.js";import{o as z}from"./omit.DzeQdT5l.js";import"./_baseGet.CmhOSbYr.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";import"./isSymbol.Bym6OQCA.js";import"./_Uint8Array.B4mhORiM.js";import"./_baseClone.Cc-Y92km.js";const F=N(a({__name:"listItem",props:{item:{type:Object,default:{}}},setup(a){const N=e(!1),j=e([]),k=e(!1),D=e({}),R=a,A=a=>{switch(a){case"CREATE_CONTRACT":return"未签署";case"CONTRACT_SIGNED":return"已签署";case"CANCEL":return"已取消";default:return"-"}},L=()=>{const{signType:a,contractSignDetails:e,previewUrl:t,afterSignContractUrl:l}=R.item;(null==e?void 0:e.length)>1?(j.value=e.map((a=>({...a,name:a.userName,enter:"view"}))),N.value=!0):w(`/pages/carManage/pdf?url=${"CONTRACT_SIGNED"==a?l:t}`)},U=a=>{const{signStatus:e,previewUrl:t,afterSignContractUrl:l}=a;"view"==a.enter?w(`/pages/carManage/pdf?url=${"CONTRACT_SIGNED"==e?l:t}`):(D.value=a,k.value=!0)},E=()=>{const{contractSignDetails:a}=R.item;(null==a?void 0:a.length)>1?(j.value=a.map((a=>({...a,name:a.userName,enter:"share"}))),N.value=!0):(D.value=R.item,k.value=!0)},O=()=>{S({data:D.value.shortUrl,success:function(){T({title:"复制成功",icon:"success"}),k.value=!1}})};return(e,S)=>{const T=c,w=m,R=t(s("up-action-sheet"),l),x=b,I=t(s("u-popup"),r);return n(),u(_,null,[o(T,{class:"order-item",onClick:L},{default:i((()=>[o(T,{class:"title"},{default:i((()=>[o(T,{class:"status"},{default:i((()=>[d(f(1==a.item.businessType?"采购":2==a.item.businessType?"销售":""),1)])),_:1}),o(w,null,{default:i((()=>[d(f(A(a.item.signType)),1)])),_:1})])),_:1}),o(T,{class:"inner"},{default:i((()=>[o(T,{class:"right"},{default:i((()=>[o(T,null,{default:i((()=>[o(w,null,{default:i((()=>[d("合同名称：")])),_:1}),o(T,null,{default:i((()=>[d(f(a.item.templateName||"-"),1)])),_:1})])),_:1}),(n(!0),u(_,null,p(a.item.contractSignDetails,((a,e)=>(n(),v(T,{key:e},{default:i((()=>[o(w,null,{default:i((()=>[d("签署方：")])),_:1}),o(T,null,{default:i((()=>[d(f(a.userName),1),a.userPhone?(n(),v(w,{key:0},{default:i((()=>[d("("+f(a.userPhone)+")",1)])),_:2},1024)):g("",!0)])),_:2},1024)])),_:2},1024)))),128)),o(T,null,{default:i((()=>[o(w,null,{default:i((()=>[d("签约主体：")])),_:1}),o(T,null,{default:i((()=>[d(f(a.item.enterpriseName||"-"),1)])),_:1})])),_:1}),o(T,null,{default:i((()=>[o(w,null,{default:i((()=>[d("创建时间：")])),_:1}),o(T,null,{default:i((()=>[d(f(a.item.createTime||"-"),1)])),_:1})])),_:1})])),_:1}),o(T,{class:"share",onClick:h(E,["stop"])},{default:i((()=>[d("分享")])),_:1})])),_:1})])),_:1}),o(R,{show:C(N),onClose:S[0]||(S[0]=a=>N.value=!1),actions:C(j),description:"签署方",cancelText:"取消",onSelect:U},null,8,["show","actions"]),o(I,{mode:"bottom",round:20,closeOnClickOverlay:!0,show:C(k),onClose:S[2]||(S[2]=a=>k.value=!1)},{default:i((()=>[o(T,{class:"share-box"},{default:i((()=>[o(T,{onClick:S[1]||(S[1]=a=>(y.shareMiniProgram({category:"wxSession",title:"合同签署",desc:"",thumbData:$("https://sjmc.obs.cn-north-4.myhuaweicloud.com/static/login/logo_bg.jpg",30),path:`pages/webview/index?url=${D.value.shortUrl}&title=合同`,miniprogramType:"2",webpageUrl:D.value.shortUrl,userName:"gh_e720593589f5"}),void(k.value=!1)))},{default:i((()=>[o(x,{src:M}),o(T,null,{default:i((()=>[d("微信好友")])),_:1})])),_:1}),o(T,{onClick:O},{default:i((()=>[o(x,{src:P}),o(T,null,{default:i((()=>[d("复制链接")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-ed8f59d0"]]),B=N(a({__name:"contractList",setup(a){const l=e(),r=e([]),m=e(),h=j({current:1,size:10,total:0,signStatus:""}),b=e([{label:"未签署",val:"CREATE_CONTRACT"},{label:"已签署",val:"CONTRACT_SIGNED"},{label:"已取消",val:"CANCEL"},{label:"全部",val:""}]);async function y(){var a;(new D).showLoading("加载中...");try{const a={...z(h,"total")},e=await R().get("/product/contractSignTask/pageList",{params:a});h.total=e.data.count;const t=e.data.results;r.value=1===h.current?t:[...r.value,...t]}finally{A(),null==(a=m.value)||a.loadFinish()}}k((a=>{h.signStatus=a.type||"",y()}));const S=()=>{h.current=1,y()},T=()=>{h.current++,y()};return(a,e)=>{const w=c,N=t(s("up-icon"),L);return n(),v(w,{class:"page f-c-s"},{default:i((()=>[o(O,null,{title:i((()=>[o(w,{class:"head-drop f-r-a f-r-c"},{default:i((()=>[o(x,{ref_key:"uDropdownRef",ref:l,class:"drop",borderRadius:"20rpx"},{default:i((()=>[o(I,{title:C(b).filter((a=>a.val==C(h).signStatus))[0].label},{default:i((()=>[o(w,{class:"item-list"},{default:i((()=>[(n(!0),u(_,null,p(C(b),((a,e)=>(n(),v(w,{key:e,class:U({active:C(h).signStatus==a.val}),onClick:e=>{return t=a,h.signStatus=t.val,l.value.close(),h.current=1,void y();var t}},{default:i((()=>[o(w,null,{default:i((()=>[d(f(a.label),1)])),_:2},1024),C(h).signStatus==a.val?(n(),v(N,{key:0,name:"checkbox-mark",color:"#DD4F33",size:"20"})):g("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},8,["title"])])),_:1},512)])),_:1})])),_:1}),o(w,{class:"total"},{default:i((()=>{var a;return[d("共有 "+f(C(h).total)+" 个"+f(null==(a=C(b).filter((a=>a.val==C(h).signStatus))[0])?void 0:a.label),1)]})),_:1}),o(G,E({ref_key:"listLoadRef",ref:m,class:"scroll-view-box"},C(h),{istop:!1,onLoadMore:T,onLoadRefresh:S}),{"list-cont":i((()=>[(n(!0),u(_,null,p(C(r),((a,e)=>(n(),v(F,{key:e,item:a},null,8,["item"])))),128))])),_:1},16)])),_:1})}}}),[["__scopeId","data-v-ff269eaa"]]);export{B as default};
