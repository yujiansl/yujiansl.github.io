import{d as a,r as e,a9 as t,B as s,E as l,X as o,Y as n,Z as i,$ as r,a2 as u,c,w as d,i as p,I as f,M as m,K as y,ah as _,o as v,a as h,b as g,u as k,h as C,g as w,F as b,Q as j,ad as T,O as L,e as x,y as B,t as z,T as F,ar as M,a1 as Q,D as R,_ as $}from"./index-CK4DGatK.js";import{N as D}from"./NavBar.DSs5OGCU.js";import{L as I}from"./ListLoadRefreshView.CnNC2lkG.js";import{u as N}from"./useQuery.3dd8K18V.js";import{o as O}from"./omit.DzeQdT5l.js";import"./_baseGet.CmhOSbYr.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";import"./isSymbol.Bym6OQCA.js";import"./_Uint8Array.B4mhORiM.js";import"./_baseClone.Cc-Y92km.js";const P=$(a({__name:"index",setup(a){const $=N(),P=e("ready"),U=e(!1),V=e(),Y=t({current:1,size:5,total:0}),q=e([]),A=e("");s((()=>{var a;Y.current=1,null==(a=V.value)||a.initTop(),G()}));const E=e();async function G(){var a;try{i({title:"加载中"});const a={...O(Y,"total"),templateType:"generic",templateFrom:"app",name:A.value},e=await r().post("/product/convenientTemplate/listByCurrentUser",a);Y.total=+e.data.count;const t=e.data.results;q.value=1===Y.current?t:[...q.value,...t],0===q.value.length&&(P.value="ready")}finally{u(),null==(a=V.value)||a.loadFinish()}}l((()=>{o("refresh"),n("refresh",(()=>{K()}))}));const K=()=>{Y.current=1,G()},S=()=>{Y.current++,G()};async function X(){(new R).showLoading("提交中"),uni.$u.http.delete(`/product/convenientTemplate?idList=${[E.value.id]}`).then((()=>{(new R).showToast("删除成功"),U.value=!1,K()}))}return(a,e)=>{const t=C,s=f(y("up-icon"),m),l=p,o=f(y("u-modal"),_);return v(),c(l,{class:"page f-c-s"},{default:d((()=>[h(D,{title:"我的模板"},{right:d((()=>[h(l,{class:"nav-right"},{default:d((()=>["edit"===k(P)?(v(),c(t,{key:0,class:"ensure-btn",onClick:e[0]||(e[0]=a=>P.value="ready")},{default:d((()=>[w("确认")])),_:1})):(v(),g(b,{key:1},[h(s,{name:"edit-pen",size:"25",color:"#000",onClick:e[1]||(e[1]=a=>P.value="edit")}),h(s,{onClick:e[2]||(e[2]=e=>("toPage"in a?a.toPage:k(j))("/pagesB/myTemplate/add")),name:"plus-circle",size:"25",color:"#000"})],64))])),_:1})])),_:1}),h(I,T({ref_key:"listLoadRef",ref:V,class:"scroll-view-box"},k(Y),{istop:!1,onLoadMore:S,onLoadRefresh:K}),{default:d((()=>[L(h(l,{class:"list-box"},{default:d((()=>[(v(!0),g(b,null,x(k(q),(a=>(v(),c(l,{class:"list-item",key:a.id},{default:d((()=>[h(l,{class:"left"},{default:d((()=>[h(l,{class:"title one-line"},{default:d((()=>[w(z(a.name),1)])),_:2},1024),h(l,{class:"content two-line"},{default:d((()=>[w(z(a.content),1)])),_:2},1024)])),_:2},1024),"ready"===k(P)?(v(),c(l,{key:0,class:"right"},{default:d((()=>[h(l,{class:"use-btn",onClick:e=>function(a){M("useTemplate",{data:a,queryData:{type:$.value.type}}),Q()}(a)},{default:d((()=>[w("使用此模版")])),_:2},1032,["onClick"])])),_:2},1024)):B("",!0),"edit"===k(P)?(v(),c(l,{key:1,class:"right"},{default:d((()=>[h(l,{class:"edit-btn",onClick:e=>function(a){j("/pagesB/myTemplate/add?id="+a.id)}(a)},{default:d((()=>[w("编辑")])),_:2},1032,["onClick"]),h(l,{class:"del-btn",onClick:e=>(a=>{E.value=a,U.value=!0})(a)},{default:d((()=>[w("删除")])),_:2},1032,["onClick"])])),_:2},1024)):B("",!0)])),_:2},1024)))),128))])),_:1},512),[[F,k(q).length]])])),_:1},16),h(o,{show:k(U),showCancelButton:!0,width:"500rpx",title:"提示",content:"确定执行删除操作？",confirmColor:"#ff5719",onCancel:e[3]||(e[3]=a=>U.value=!1),onConfirm:X},null,8,["show"])])),_:1})}}}),[["__scopeId","data-v-7e817dbe"]]);export{P as default};
