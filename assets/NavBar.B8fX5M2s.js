var e=Object.defineProperty,t=(t,a,l)=>((t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l)(t,"symbol"!=typeof a?a+"":a,l);import{c as a}from"./callPhone.KEQUzljZ.js";import{d as l,r as s,I as i,M as n,K as o,aq as u,b as r,o as c,a as d,w as v,i as m,u as p,g as f,F as h,_ as b,x as _,v as y,am as g,c as x,aP as k,aQ as C,e as w,y as I,h as S,q as T,b8 as M,k as L,P as $,t as B,Z as F,a2 as V,l as A,aY as z,m as P,ac as j,j as O,W as U,bF as D,bJ as N,aT as R,a6 as E,z as Z,s as q,a0 as K,ah as W,aU as Q,c2 as H,a9 as G,B as Y,$ as J,O as X,T as ee,ad as te,aK as ae,E as le,aN as se,f as ie,aM as ne,ak as oe,A as ue,a8 as re,b3 as ce,n as de,a1 as ve,aS as me}from"./index-CK4DGatK.js";import{c as pe}from"./crm.-ZWUD7KR.js";import{u as fe}from"./useQuery.3dd8K18V.js";import{_ as he}from"./close.Dhgi5Ijg.js";import{u as be}from"./useDict.DwAUsZFY.js";import{a as _e}from"./index.HDA2F_3Q.js";import{L as ye}from"./ListLoadRefreshView.CnNC2lkG.js";import{c as ge}from"./carListItem.hYH6YShY.js";import{o as xe}from"./omit.DzeQdT5l.js";import{i as ke}from"./isNil.aV-w2MPu.js";import{L as Ce}from"./listItem.De6Dqo0z.js";const we=b(l({__name:"btnGroup",props:{options:{default:()=>[]},phone:{default:""}},emits:["follow","sheet"],setup(e,{emit:t}){const l=e,b=t,_=s(!1),y=()=>{_.value=!0},g=e=>{b("sheet",e)},x=()=>{b("follow")};return(e,t)=>{const s=i(o("up-icon"),n),b=m,k=i(o("up-action-sheet"),u);return c(),r(h,null,[d(b,{class:"footer-box"},{default:v((()=>[d(b,{onClick:t[0]||(t[0]=t=>("callPhone"in e?e.callPhone:p(a))(null==l?void 0:l.phone))},{default:v((()=>[d(s,{name:"phone",size:"20"}),d(b,null,{default:v((()=>[f("电话")])),_:1})])),_:1}),d(b,{onClick:y},{default:v((()=>[d(s,{name:"more-circle",size:"20"}),d(b,null,{default:v((()=>[f("更多")])),_:1})])),_:1}),d(b,{class:"follow-btn",onClick:x},{default:v((()=>[f(" 跟进 ")])),_:1})])),_:1}),d(k,{title:"更多操作",class:"pop-action",onSelect:g,onClose:t[1]||(t[1]=e=>_.value=!1),actions:null==l?void 0:l.options,closeOnClickOverlay:!0,closeOnClickAction:!0,cancelText:"取消",show:p(_)},null,8,["actions","show"])],64)}}}),[["__scopeId","data-v-2a863e42"]]),Ie=l({__name:"SmallTabs",props:{list:{},defaultActive:{default:0}},emits:["change"],setup(e,{expose:t,emit:a}){const l=e,n=s(l.defaultActive),u=a,r=_((()=>l.list[n.value])),f=e=>{n.value=e.index};return y(n,(()=>{r.value&&u("change",r.value,n.value)})),t({reset:function(){n.value=0}}),(e,t)=>{const a=i(o("u-tabs"),g),s=m;return c(),x(s,{class:"small-tabs"},{default:v((()=>[d(a,{class:"tabs-box",lineColor:"#ff5719","is-scroll":"",list:l.list,current:p(n),onChange:f},null,8,["list","current"])])),_:1})}}}),Se=b(l({__name:"TrackFollow",props:{list:{},activeIndex:{}},setup(e){const t=e;return(e,a)=>{var l;const s=S,n=m,u=i(o("up-steps-item"),k),p=i(o("up-steps"),C);return c(),r("div",{class:"step-box"},[d(p,{class:"steps",activeColor:"#F75A1E",direction:"column",current:null==(l=t.list)?void 0:l.length,dot:""},{default:v((()=>[(c(!0),r(h,null,w(t.list,((e,t)=>(c(),x(u,{title:e.logType,key:t},{desc:v((()=>[d(n,{class:"desc-box"},{default:v((()=>[e.logText?(c(),x(n,{key:0,class:"desc-item"},{default:v((()=>[d(s,{innerHTML:e.logText},null,8,["innerHTML"])])),_:2},1024)):I("",!0)])),_:2},1024)])),_:2},1032,["title"])))),128))])),_:1},8,["current"])])}}}),[["__scopeId","data-v-27dd695d"]]),Te=b(l({__name:"TrackCard",setup(e,{expose:t}){const a=fe(),l=s(0),n=s([]);async function u(){const e=await uni.$u.http.get(pe.getClueLogById,{params:{customerId:a.value.id,clueType:a.value.clueType}});n.value=e.data||[]}return T((()=>{u()})),t({getData:u}),(e,t)=>{const a=i(o("u-empty"),M);return c(),r("div",{class:"track-card"},[L("div",{class:"body"},[p(n).length?(c(),x(Se,{key:0,list:p(n),"active-index":p(l)},null,8,["list","active-index"])):(c(),x(a,{key:1,mode:"list",text:"暂无数据"}))])])}}}),[["__scopeId","data-v-06e9a77b"]]),Me=b(l({__name:"FollowUpCard",setup(e){const t=fe(),a=s([]);return T((()=>{!async function(){F({title:"加载中",mask:!0});const e=await uni.$u.http.get(pe.getClueTeam,{params:{crmCustomerId:t.value.id,type:t.value.clueType}});a.value=e.data||[],V()}()})),(e,t)=>{const l=$,s=i(o("u-empty"),M);return c(),r("div",{class:"follow-up-card"},[L("div",{class:"body"},[p(a).length?(c(),r("div",{key:0,class:"card-box"},[(c(!0),r(h,null,w(p(a),(e=>(c(),r("div",{class:"item",key:e.userId},[L("div",{class:"left"},[d(l,{class:"avatar-img",mode:"scaleToFill",src:e.avatar||"/static/mine/avatar.png"},null,8,["src"]),L("div",null,[L("div",{class:"text break-all"},B(e.name?e.name+"("+e.phone+")("+e.deptName+")":"--"),1)])])])))),128))])):(c(),x(s,{key:1,mode:"list",text:"暂无数据"}))])])}}}),[["__scopeId","data-v-65a956cb"]]);class Le{checkTelephone(e){return!!/^1[23456789]\d{9}$/.test(e)}isIos(){return A().platform.indexOf("ios")>=0}envVersion(){return uni.getAccountInfoSync().miniProgram.envVersion}checkEmail(e){return!!/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(e)}checkPassWord(e){const t=e;if(!new RegExp(/^[0-9A-Za-z]+$/).test(t))return!1;return!!new RegExp(/[A-Za-z].*[0-9]|[0-9].*[A-Za-z]/).test(t)}getQueryString(e){const t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null}getTimeBefore(e){if(!e)return"";class a extends Date{constructor(e){super(e),t(this,"time"),t(this,"timeStr"),this.time=e,e instanceof Date||(this.time=new Date(e)),this.timeStr=this.time.getTime()}getCurrentTimeStr(){return(new Date).getTime()}getText(){if(this.timeStr>this.getCurrentTimeStr())return"";const e=[{timeStr:36e5,base:6e4,text:"分钟前"},{timeStr:864e5,base:36e5,text:"小时前"},{timeStr:2592e6,base:864e5,text:"天前"},{timeStr:31104e6,base:2592e6,text:"个月前"},{timeStr:373248e6,base:31104e6,text:"个年前"}];for(const t of e)if(this.getCurrentTimeStr()-this.timeStr<t.timeStr)return Math.floor((this.getCurrentTimeStr()-this.timeStr)/t.base)+t.text;return Math.floor((this.getCurrentTimeStr()-this.timeStr)/e[e.length-1].base)+e[e.length-1].text}}return new a(e).getText()}isNumber(e){return!(!/^\d+(\.\d+)?$/.test(e)&&!/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/.test(e))}transformationNumber(e){const t=["零","一","二","三","四","五","六","七","八","九"],a=["","十","百","千","万"];function l(e){const l=e.toString().split("").reverse();let s="";for(let i=0;i<l.length;i++)s=(0==i&&0==l[i]||i>0&&0==l[i]&&0==l[i-1]?"":t[l[i]]+(0==l[i]?a[0]:a[i]))+s;return s}const s=Math.floor(e/1e4);let i=e%1e4;return i.toString().length<4&&(i="0"+i),s?l(s)+"万"+l(i):l(e)}getMapStaticImg(e,t,a,l,s=14,i=2){return"https://apis.map.qq.com/ws/staticmap/v2/?center="+e+","+t+"&zoom="+s+"&scale="+i+"&markers=size:large|icon:https://cd.uj.cn/Public/images/wap/icon_mylocation.png|"+t+","+e+"&key=DGFBZ-3IFW2-PDEUL-CBLCE-XOSYK-K5B5I&size="+ +a+"*"+l}randomNum(e,t){switch(arguments.length){case 1:return parseInt((Math.random()*e+1).toString(),10);case 2:return parseInt((Math.random()*(t-e+1)+e).toString(),10);default:return 0}}randomDecimalNum(e,t,a){let l=0,s=0;switch(t<=e?(s=t,l=e):(s=e,l=t),arguments.length){case 1:return Math.floor(Math.random()*(l+1));case 2:return Math.floor(Math.random()*(l-s+1)+s);case 3:return(Math.random()*(l-s)+s).toFixed(a);default:return Math.random()}}bMapToQQMap(e,t){if(!t||!e)return{lat:t,lng:e};const a=3.141592653589793,l=parseFloat(e.toString())-.0065,s=parseFloat(t.toString())-.006,i=Math.sqrt(l*l+s*s)-2e-5*Math.sin(s*a),n=Math.atan2(s,l)-3e-6*Math.cos(l*a),o=(i*Math.cos(n)).toFixed(7),u=(i*Math.sin(n)).toFixed(7);return{lat:Number(u),lng:Number(o)}}isNumType(e){return/^[0-9]+.?[0-9]*$/.test(e)}}const $e=b(l({__name:"BasePopup",props:z({submitFn:{},title:{},hasSubmitBtn:{type:Boolean,default:!0}},{visible:{type:Boolean},visibleModifiers:{}}),emits:z(["confirm","cancel"],["update:visible"]),setup(e,{emit:t}){const a=e,l=t,s=P(e,"visible");async function n(){var e;!1!==await(null==(e=a.submitFn)?void 0:e.call(a))&&(l("confirm"),s.value=!1)}function u(){l("cancel"),s.value=!1}return(e,t)=>{const l=m,p=$,h=U,b=i(o("up-popup"),j);return c(),r("div",{class:"base-popup"},[d(b,{title:e.title,show:s.value,onClose:t[0]||(t[0]=e=>s.value=!1),mode:"bottom",round:20,closeOnClickOverlay:!0},{default:v((()=>[L("div",{class:"content"},[L("div",{class:"header"},[d(l,null,{default:v((()=>[f(B(a.title),1)])),_:1}),d(p,{onClick:u,class:"close-btn",src:he,mode:"aspectFill"})]),L("div",{class:"body"},[O(e.$slots,"default",{},void 0,!0)]),d(h,{class:"submit-btn",onClick:n},{default:v((()=>[f("提交")])),_:1})])])),_:3},8,["title","show"])])}}}),[["__scopeId","data-v-dc5f5963"]]),Be=b(l({__name:"WwSelect",props:{title:{},loading:{type:Boolean},visible:{type:Boolean},modelValue:{},options:{}},emits:["update:visible","update:modelValue","change","cancel"],setup(e,{emit:t}){const a=e,l=t,n=_({get:()=>a.visible,set:e=>l("update:visible",e)}),u=_({get:()=>a.modelValue,set:e=>l("update:modelValue",e)}),v=s(),m=s(),p=_((()=>u.value&&a.options.length&&a.options.findIndex((e=>e.value===u.value))||0));function f(e){var t;const a=null==(t=e.value[0])?void 0:t.value;u.value=a,n.value=!1,l("change",a)}function h(){n.value=!1,l("cancel")}return D((()=>{n.value&&(m.value=v.value.$el.querySelector(".uni-picker-view-wrapper"))})),(e,t)=>{const l=i(o("up-picker"),N);return c(),r("div",{class:"ww-select"},[d(l,{ref_key:"pickerRef",ref:v,show:n.value,keyName:"label",columns:[a.options],title:a.title,loading:a.loading,closeOnClickOverlay:!0,onClose:t[0]||(t[0]=e=>n.value=!1),onCancel:h,defaultIndex:[p.value],onConfirm:f,confirmColor:"#ff5719"},null,8,["show","columns","title","loading","defaultIndex"]),!a.options.length&&m.value?(c(),x(R,{key:0,to:m.value},[L("div",{class:"empty-box"},[L("div",{class:"empty-text"},"暂无数据")])],8,["to"])):I("",!0)])}}}),[["__scopeId","data-v-e95bb235"]]),Fe=b(l({__name:"EditPopup",props:{modelValue:{default:()=>{}},modelModifiers:{},visible:{type:Boolean},visibleModifiers:{}},emits:z(["confirm"],["update:modelValue","update:visible"]),setup(e,{emit:t}){const a=P(e,"modelValue"),l=t,n=P(e,"visible"),u=fe(),{relation_type:m}=be("relation_type"),h=s(!1),b=_((()=>{var e,t;return null==(t=null==(e=m.value)?void 0:e.find((e=>{var t;return e.value===(null==(t=a.value)?void 0:t.relation)})))?void 0:t.label})),y=_((()=>{var e;return((null==(e=a.value)?void 0:e.id)?"编辑":"新增")+"客户关系"}));async function g(e){await q(),a.value.phone=e?_e(String(e),"int"):e}async function k(){if(!function(){const e=[["请输入姓名",!a.value.name],["请输入手机号",!a.value.phone],["请选择关系",!a.value.relation],["请输入正确的手机号",!(new Le).checkTelephone(a.value.phone)]];for(const[t,a]of e)if(a)return K({title:t,icon:"none"}),!1;return!0}())return!1;F({title:"提交中",mask:!0}),await uni.$u.http.post(pe.updateCustomerRelations,[{...a.value,crmCustomerId:u.value.id}]),K({title:"提交成功",icon:"success"}),l("confirm")}return(e,t)=>{const l=i(o("up-input"),E),s=S;return c(),r("div",{class:"edit-popup"},[d($e,{title:p(y),visible:n.value,"onUpdate:visible":t[3]||(t[3]=e=>n.value=e),submitFn:k},{default:v((()=>[L("div",{class:"form-box"},[L("div",{class:"form-item"},[L("div",{class:"label"},"姓名"),L("div",{class:"value"},[d(l,{border:"none",type:"text",placeholder:"请输入",modelValue:a.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.name=e),modelModifiers:{trim:!0},maxlength:"10"},null,8,["modelValue"])])]),L("div",{class:"form-item"},[L("div",{class:"label"},"手机号"),L("div",{class:"value"},[d(l,{border:"none",maxlength:"11",type:"number",placeholder:"请输入",onInput:g,modelValue:a.value.phone,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.phone=e),modelModifiers:{trim:!0}},null,8,["modelValue"])])]),L("div",{class:"form-item"},[L("div",{class:"label"},"关系"),L("div",{class:"value",onClick:t[2]||(t[2]=e=>h.value=!0)},[p(b)?I("",!0):(c(),x(s,{key:0,class:"gray"},{default:v((()=>[f("请选择")])),_:1})),d(s,null,{default:v((()=>[f(B(p(b)),1)])),_:1})])])])])),_:1},8,["title","visible"]),d(Be,{title:"关系",modelValue:a.value.relation,"onUpdate:modelValue":t[4]||(t[4]=e=>a.value.relation=e),options:p(m)||[],visible:p(h),"onUpdate:visible":t[5]||(t[5]=e=>Z(h)?h.value=e:null)},null,8,["modelValue","options","visible"])])}}}),[["__scopeId","data-v-77ce997b"]]),Ve=l({__name:"ConfirmModal",props:z({title:{},content:{},confirmColor:{default:"#ff5719"},confirmText:{default:"确定"},submitFn:{}},{visible:{type:Boolean,required:!0},visibleModifiers:{}}),emits:z(["cancel","confirm"],["update:visible"]),setup(e,{emit:t}){const a=e,l=t,s=P(e,"visible");async function n(){var e;!1!==await(null==(e=a.submitFn)?void 0:e.call(a))&&(s.value=!1,l("confirm"))}function u(){s.value=!1,l("cancel")}return(e,t)=>{const l=i(o("up-modal"),W);return c(),r("div",{class:"confirm-modal"},[d(l,{title:a.title,show:s.value,onCancel:u,onConfirm:n,showCancelButton:"",confirmText:a.confirmText,confirmColor:a.confirmColor,"async-close":!!a.submitFn},{default:v((()=>[O(e.$slots,"default",{},(()=>[f(B(e.content),1)]))])),_:3},8,["title","show","confirmText","confirmColor","async-close"])])}}}),Ae=b(l({__name:"WithCard",setup(e){const t=fe(),a=s({}),l=s([]),{relation_type:u,getDictItem:m}=be("relation_type"),b=s(!1),_=s(!1),y=s({}),g=s({});async function k(){F({title:"加载中",mask:!0});const e=await uni.$u.http.get(pe.getCustomerRelationsById,{params:{customerId:t.value.id}});l.value=e.data||[],V()}function C(){setTimeout((()=>{k()}),1e3)}function A(){y.value={},b.value=!0}async function z(){F({title:"删除中",mask:!0}),await uni.$u.http.delete(`${pe.delCustomerRelationsById}?${Q({primaryId:g.value.id})}`),_.value=!1,g.value={},K({title:"删除成功",icon:"success"}),C()}return T((()=>{k(),async function(){F({title:"加载中",mask:!0});const e=await uni.$u.http.get(pe.getCustomerById,{params:{crmCustomerId:t.value.id}});a.value=e.data||{},V()}()})),(e,t)=>{const s=$,k=S,T=i(o("up-icon"),n),F=i(o("u-empty"),M);return c(),r("div",{class:"with-card"},[L("div",{class:"body"},[L("div",{class:"card-box"},[L("div",{class:"item"},[L("div",{class:"left"},[d(s,{class:"avatar-img",src:p(a).avatar||"/static/mine/avatar.png",mode:"scaleToFill"},null,8,["src"])]),L("div",{class:"right"},[L("div",{class:"up break-all copy"},[f(B(p(a).name),1),p(a).phone?(c(),x(k,{key:0},{default:v((()=>[f("("+B(String(p(a).phone).slice(-4))+") - ("+B(p(a).phone)+")",1)])),_:1})):I("",!0)])])])]),L("div",{class:"title sub"},[L("div",null,"客户关系"),d(T,{name:"plus-circle",class:"add-btn",color:"#ff5719",onClick:A},{default:v((()=>[f("+")])),_:1})]),p(l).length?(c(),r("div",{key:0,class:"list-box"},[(c(!0),r(h,null,w(p(l),(e=>{var t;return c(),r("div",{class:"list-item",key:e.id},[L("div",{class:"left"},[L("div",{class:"text break-all"},B(e.name),1),L("div",{class:"text copy"},B(e.phone),1)]),L("div",{class:"right"},[L("div",{class:"right-tag gray"},B(null==(t=p(m)(e.relation,p(u)||[]))?void 0:t.label),1),L("div",{class:"actions-box"},[d(k,{style:{color:"#ff5719"},onClick:t=>function(e){y.value={...e},b.value=!0}(e)},{default:v((()=>[f("编辑")])),_:2},1032,["onClick"]),d(k,{class:"gray",onClick:t=>function(e){g.value={...e},_.value=!0}(e)},{default:v((()=>[f("删除")])),_:2},1032,["onClick"])])])])})),128))])):(c(),x(F,{key:1,mode:"list",text:"暂无数据"}))]),d(Fe,{visible:p(b),"onUpdate:visible":t[0]||(t[0]=e=>Z(b)?b.value=e:null),modelValue:p(y),"onUpdate:modelValue":t[1]||(t[1]=e=>Z(y)?y.value=e:null),onConfirm:C},null,8,["visible","modelValue"]),d(Ve,{visible:p(_),"onUpdate:visible":t[2]||(t[2]=e=>Z(_)?_.value=e:null),title:"删除客户关系","submit-fn":z},{default:v((()=>[L("div",{class:"del-box"},[f(" 确认删除"),d(k,{class:"red"},{default:v((()=>{var e;return[f(B(null==(e=p(g))?void 0:e.name),1)]})),_:1}),f("吗？ ")])])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-9004770d"]]),ze=b(l({__name:"CardOne",props:{data:{}},setup:e=>(e,t)=>{var a,l,s,i,n,o,u,d,v,m,p;return c(),r("div",{class:"card-box"},[L("div",{class:"title-box"},[L("div",null,"销售机会"),L("div",null,B((null==(a=e.data)?void 0:a.intentionCode)||"--")+" "+B(e.data.statusStr||"--"),1)]),L("div",{class:"sub-box"},[L("div",{class:"sub-item"},[L("div",{class:"sub-title"},B(e.data.budgetary||"--"),1),L("div",{class:"text"},"预算")]),L("div",{class:"sub-item"},[L("div",{class:"sub-title"},B((null==(l=e.data)?void 0:l.predictBuyCarTime)||"--"),1),L("div",{class:"text"},"预计买车日期")]),L("div",{class:"sub-item"},[L("div",{class:"sub-title"},B((null==(s=e.data)?void 0:s.vehicleAge)||"--"),1),L("div",{class:"text"},"车龄")])]),L("div",{class:"form-box"},[L("div",{class:"form-item"},[L("div",{class:"label"},"车体形式"),L("div",{class:"value"},B((null==(n=null==(i=e.data)?void 0:i.carLayout)?void 0:n.join(","))||"--"),1)]),L("div",{class:"form-item"},[L("div",{class:"label"},"关注点"),L("div",{class:"value"},B((null==(u=null==(o=e.data)?void 0:o.carFocus)?void 0:u.join(","))||"--"),1)]),L("div",{class:"form-item"},[L("div",{class:"label"},"意向车系"),L("div",{class:"value"},B((null==(v=null==(d=e.data)?void 0:d.sellSeries)?void 0:v.join(","))||"--"),1)]),L("div",{class:"form-item col"},[L("div",{class:"label"},"意向描述"),L("div",{class:"value"},B((null==(m=e.data)?void 0:m.description)||"--"),1)])]),L("div",{class:"footer-text"},B(null==(p=e.data)?void 0:p.followUpPerson),1)])}}),[["__scopeId","data-v-90350028"]]),Pe=b(l({__name:"SaleCard",setup(e){const t=fe(),a=s([]);return T((()=>{!async function(){F({title:"加载中",mask:!0});const e=await uni.$u.http.get(pe.getClueSellAll,{params:{customerId:t.value.id}});a.value=(null==e?void 0:e.data)||[],V()}()})),(e,t)=>{const l=i(o("u-empty"),M);return c(),r("div",{class:"with-card"},[L("div",{class:"body"},[p(a).length?(c(!0),r(h,{key:0},w(p(a),(e=>(c(),x(ze,{data:e,key:e.id},null,8,["data"])))),128)):(c(),x(l,{key:1,mode:"list",text:"暂无数据"}))])])}}}),[["__scopeId","data-v-2d2cad38"]]),je=b(l({__name:"SaleOrderCard",setup(e){const t=H("crm-customerId"),a=s([]),l=s(),n=s(!0),u=G({current:1,size:5,total:0,status:"SALES_ORDER_ALL",orders:"createTime",customerId:t.value,salesUserId:null,paymentMethod:null});async function f(){var e;try{F({title:"加载中"});const e={...xe(u,"total")},t=await J().post("/product/carProductApp/vehiclePage",e);u.total=t.data.count;const l=t.data.results;a.value=1===u.current?l:[...a.value,...l]}finally{V(),null==(e=l.value)||e.loadFinish()}}Y((()=>{var e;u.current=1,null==(e=l.value)||e.initTop(),f()}));const b=()=>{u.current=1,f()},_=()=>{u.current++,f()};return(e,t)=>{const s=m,f=i(o("u-empty"),M);return c(),r("div",{class:"with-card"},[p(a).length?(c(),x(ye,te({key:0,ref_key:"listLoadRef",ref:l,class:"scroll-view-box"},p(u),{istop:!1,onLoadMore:_,onLoadRefresh:b}),{default:v((()=>[X(d(s,{class:"list-box"},{default:v((()=>[(c(!0),r(h,null,w(p(a),(e=>(c(),x(ge,{key:e.id,isOrders:p(n),item:e},null,8,["isOrders","item"])))),128))])),_:1},512),[[ee,p(a).length]])])),_:1},16)):(c(),x(f,{key:1,mode:"list",text:"暂无数据"}))])}}}),[["__scopeId","data-v-11f0f65f"]]),Oe=b(l({__name:"AssessCard",setup(e){const t=fe(),a=s([]);return T((()=>{!async function(){F({title:"加载中",mask:!0});const e=await uni.$u.http.get(pe.getCluePurchaseAll,{params:{customerId:t.value.id}});a.value=e.data||[],V()}()})),(e,t)=>{const l=S,s=i(o("u-empty"),M);return c(),r("div",{class:"assess-card"},[L("div",{class:"body"},[p(a).length?(c(!0),r(h,{key:0},w(p(a),(e=>(c(),r("div",{class:"card-box",key:e.id},[L("div",{class:"title-box"},[L("div",null,"评估机会"),L("div",null,B((null==e?void 0:e.intentionCode)||"--")+" "+B((null==e?void 0:e.statuesStr)||"--"),1)]),L("div",{class:"box"},[L("div",{class:"box-title"},B(null==e?void 0:e.modelName),1),L("div",{class:"text"},"VIN码："+B((null==e?void 0:e.vin)||"--"),1),L("div",{class:"text"},"公里数："+B((null==e?void 0:e.kilometres)||"--")+" 万公里",1),L("div",{class:"sub-box"},[L("div",{class:"sub-item"},[L("div",{class:"sub-title"},B((null==e?void 0:e.colorSource)||"--"),1),L("div",{class:"text"},"车身颜色")]),L("div",{class:"sub-item"},[L("div",{class:"sub-title"},B((null==e?void 0:e.factoryDate)||"--"),1),L("div",{class:"text"},"出厂日期")]),L("div",{class:"sub-item"},[L("div",{class:"sub-title"},B((null==e?void 0:e.registrationTime)||"--"),1),L("div",{class:"text"},"上牌日期")])])]),L("div",{class:"form-box"},[L("div",{class:"form-item"},[L("div",{class:"label"},"客户预估价格"),L("div",{class:"value red"},[p(ke)(null==e?void 0:e.priceMin)?(c(),x(l,{key:0},{default:v((()=>[f("--")])),_:1})):(c(),x(l,{key:1},{default:v((()=>[f(B(null==e?void 0:e.priceMin)+"万",1)])),_:2},1024))])])]),L("div",{class:"footer-text"},B(null==e?void 0:e.followUpPerson),1)])))),128)):(c(),x(s,{key:1,mode:"list",text:"暂无数据"}))])])}}}),[["__scopeId","data-v-03c2475f"]]),Ue=b(l({__name:"AssessOrderCard",setup(e){const t=H("crm-customerId"),a=s([]),l=s(),n=G({current:1,size:10,total:0,orderStatus:"",customerId:t.value,orders:"createTimeDesc"});async function u(){var e,t;F({title:"加载中",mask:!0});try{const e={...xe(n,"total")},t=await J().get("/product/purchaseOrder/pageList",{params:e});n.total=t.data.count;const l=t.data.results;a.value=1===n.current?l:[...a.value,...l]}finally{1==n.current&&(null==(e=l.value)||e.initTop()),null==(t=l.value)||t.loadFinish(),V()}}const d=()=>{n.current=1,u()},m=()=>{n.current++,u()};return Y((e=>{n.orderStatus=e.type||"",u()})),(e,t)=>{const s=i(o("u-empty"),M);return c(),r("div",{class:"with-card"},[p(a).length?(c(),x(ye,te({key:0,ref_key:"listLoadRef",ref:l,class:"scroll-view-box"},p(n),{istop:!1,onLoadMore:m,onLoadRefresh:d}),{"list-cont":v((()=>[(c(!0),r(h,null,w(p(a),((e,t)=>(c(),x(Ce,{key:t,item:e},null,8,["item"])))),128))])),_:1},16)):(c(),x(s,{key:1,mode:"list",text:"暂无数据"}))])}}}),[["__scopeId","data-v-0874e8cb"]]),De=b(l({__name:"BuyInfoCard",setup(e,{expose:t}){const a=ae([{name:"轨迹",value:0,comp:Te,ref:"TrackCard"},{name:"跟进团队",value:1,comp:Me},{name:"关联用户",value:2,comp:Ae},{name:"销售机会",value:3,comp:Pe},{name:"销售订单",value:4,comp:je},{name:"评估机会",value:5,comp:Oe},{name:"评估订单",value:6,comp:Ue}]),l=s(Date.now()),i=ae(a.value[0]),n=s({});function u(e){i.value=e,l.value=Date.now()}return le((()=>{l.value=Date.now()})),t({getTrackCardRef:()=>n.value.TrackCard}),(e,t)=>(c(),r("div",{class:"buy-info-card"},[d(Ie,{list:p(a),onChange:u},null,8,["list"]),(c(),x(o(p(i).comp),{key:p(l),ref:e=>function(e,t){n.value[e]=t}(p(i).ref,e)}))]))}}),[["__scopeId","data-v-a6680af6"]]),Ne=b(l({__name:"BaseInfo",props:{data:{default:{}},stepList1:{default:()=>[]},chanceList:{default:()=>[]},stepsKey:{default:0}},emits:["import","addTag","changeClue"],setup(e,{expose:t,emit:a}){const l=e,u=a,b=s(0),_=["待联系","已战败"],y=["待联系","已无效"],g=s(0),T=e=>4===e?_:5===e?y:l.stepList1,M=()=>{u("addTag")},L=e=>{const t=e.detail.current;b.value=t,u("changeClue",l.chanceList[t],t)};return t({getElementTop:()=>{setTimeout((()=>{oe().in(this).select(".opportunity-box").boundingClientRect((e=>{e&&(g.value=e.height)})).exec()}),50)}}),(e,t)=>{const a=$,s=S,u=m,_=i(o("up-icon"),n),y=i(o("up-steps-item"),k),F=i(o("up-steps"),C),V=se,A=ne;return c(),r(h,null,[d(u,{class:"contact-box"},{default:v((()=>[d(u,{class:"contact-item"},{default:v((()=>[d(a,{class:"img",src:"./static/selectCar/wechat.png"}),d(s,null,{default:v((()=>{var e;return[f(B((null==(e=l.data)?void 0:e.wechat)||"微信未知"),1)]})),_:1})])),_:1}),d(u,{class:"contact-item"},{default:v((()=>[d(a,{class:"img-card",src:"./static/crm/idcard.png"}),d(s,null,{default:v((()=>{var e;return[f(B((null==(e=l.data)?void 0:e.idCard)||"身份证未知"),1)]})),_:1})])),_:1})])),_:1}),d(u,{class:"info-box"},{default:v((()=>{var e,t,a;return[f(B((null==(e=l.data)?void 0:e.sourceStr)||"-")+" | "+B((null==(t=l.data)?void 0:t.age)?`${l.data.age}岁`:"-")+" | "+B((null==(a=l.data)?void 0:a.address)||"-"),1)]})),_:1}),d(u,{class:"tag-box"},{default:v((()=>{var e;return[(c(!0),r(h,null,w(null==(e=l.data)?void 0:e.labelList,(e=>(c(),x(u,{key:e.id},{default:v((()=>[f(B(e.name),1)])),_:2},1024)))),128)),d(u,null,{default:v((()=>[d(_,{class:"pl10",name:"plus-circle",color:"#20283d",size:"19",onClick:M})])),_:1})]})),_:1}),d(A,{style:ie(`height:${p(g)}px`),class:"swiper",current:p(b),onChange:L,"disable-touch":!(e.chanceList.length>1)},{default:v((()=>[(c(!0),r(h,null,w(e.chanceList,((t,a)=>(c(),x(V,{key:a},{default:v((()=>[d(u,{class:"opportunity-box"},{default:v((()=>[d(u,{class:"item-1"},{default:v((()=>[d(u,null,{default:v((()=>[f(B(0===(null==t?void 0:t.clueType)?"销售":"评估")+"机会",1)])),_:2},1024),d(u,{class:"item-1-right"},{default:v((()=>[(null==t?void 0:t.intentionCode)?(c(),x(u,{key:0,class:"intention"},{default:v((()=>[f(B(null==t?void 0:t.intentionCode),1)])),_:2},1024)):I("",!0)])),_:2},1024)])),_:2},1024),[null,void 0].includes(null==t?void 0:t.orderStatus)?I("",!0):(c(),x(u,{key:0,class:"item-2"},{default:v((()=>{return[(c(),x(F,{current:(a=null==t?void 0:t.orderStatus,null===a?0:[4,5,7].includes(a)?1:a),dot:"",activeColor:"#ff5719",key:e.stepsKey},{default:v((()=>[(c(!0),r(h,null,w(T(null==t?void 0:t.orderStatus),(e=>(c(),x(y,{title:e,key:e},null,8,["title"])))),128))])),_:2},1032,["current"]))];var a})),_:2},1024)),O(e.$slots,"detail",{},void 0,!0),d(u,{class:"item-3"},{default:v((()=>[O(e.$slots,"footer",{orderStatus:t.orderStatus},void 0,!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:3},8,["style","current","disable-touch"]),l.data.otherSellCount||l.data.otherPurchaseCount?(c(),x(u,{key:0,class:"other-num"},{default:v((()=>[d(u,null,{default:v((()=>[f("客户机会")])),_:1}),d(u,null,{default:v((()=>[f("其他销售机会："),d(s,null,{default:v((()=>[f(B(l.data.otherSellCount||0),1)])),_:1})])),_:1}),d(u,null,{default:v((()=>[f("其他评估机会："),d(s,null,{default:v((()=>[f(B(l.data.otherPurchaseCount||0),1)])),_:1})])),_:1})])),_:1})):I("",!0)],64)}}}),[["__scopeId","data-v-2f5777eb"]]),Re=b(l({__name:"NavBar",props:{data:{default:{}}},emits:["import"],setup(e,{emit:t}){const a=e,l=t,s=ue(),u=()=>{l("import")},r=_((()=>["暂无跟进计划","已逾期"].includes(a.data.followUpInfo)?"no-plan":"other-plan")),h=A(),b=h.statusBarHeight||0,y="ios"===h.platform?44:48;re("navbarHeight",y+b);const g=_((()=>{const e=ce();return!!e[e.length-2]})),k=()=>{ve()},C=()=>{me({url:"/pages/index/index"})};return(e,t)=>{const l=i(o("u-icon"),n),h=S,b=$,_=m,y=i(o("up-icon"),n);return c(),x(_,{class:"header"},{default:v((()=>[d(_,{class:"head-left"},{default:v((()=>{var e,t,i;return[g.value?(c(),x(l,{key:0,name:"arrow-left",color:"#000",size:"18",bold:"",onClick:k})):I("",!0),!g.value&&p(s).isLogin?(c(),x(l,{key:1,name:"home-fill",color:"#000",size:"20",onClick:C})):I("",!0),d(h,{class:"custom-name"},{default:v((()=>{var e;return[f(B(null==(e=null==a?void 0:a.data)?void 0:e.name),1)]})),_:1}),(null==(e=null==a?void 0:a.data)?void 0:e.phone)?(c(),x(h,{key:2},{default:v((()=>{var e;return[f("("+B(null==(e=null==a?void 0:a.data)?void 0:e.phone)+")",1)]})),_:1})):I("",!0),[1,0].includes(null==(t=null==a?void 0:a.data)?void 0:t.gender)?(c(),x(b,{key:3,class:"sex",src:0===(null==(i=null==a?void 0:a.data)?void 0:i.gender)?"/static/crm/man.png":"/static/crm/woman.png"},null,8,["src"])):I("",!0)]})),_:1}),d(_,{class:"head-right"},{default:v((()=>{var e,t,l,s;return[["暂无跟进计划"].includes(null==(e=null==a?void 0:a.data)?void 0:e.followUpInfo)?(c(),x(_,{key:0,class:"item-right"},{default:v((()=>{var e;return[f(" 已等待："+B(null==(e=null==a?void 0:a.data)?void 0:e.waitTime),1)]})),_:1})):(null==(t=null==a?void 0:a.data)?void 0:t.followUpInfo)?(c(),x(_,{key:1,class:de(["right-status",[r.value]])},{default:v((()=>{var e;return[f(B(null==(e=null==a?void 0:a.data)?void 0:e.followUpInfo),1)]})),_:1},8,["class"])):I("",!0),d(y,{name:(null==(l=null==a?void 0:a.data)?void 0:l.attention)?"star-fill":"star",size:"22",class:"import",color:(null==(s=null==a?void 0:a.data)?void 0:s.attention)?"#f9ae3d":"#20283d",onClick:u},null,8,["name","color"])]})),_:1})])),_:1})}}}),[["__scopeId","data-v-f4263666"]]);export{Ne as B,Re as N,De as a,we as b};
