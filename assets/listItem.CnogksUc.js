import{j as e}from"./index.HDA2F_3Q.js";import{d as t,r as a,I as i,ah as l,K as r,c as s,o as n,i as u,n as o,w as d,y as c,a as m,g as p,P as f,h as v,t as y,f as k,u as g,b as _,F as h,k as C,S as D,W as I,aU as $,Q as T,D as N,_ as K}from"./index-CK4DGatK.js";import{_ as S}from"./avatar.Buy0-vr1.js";import{_ as x}from"./car_default.CyENNAub.js";import{R as P}from"./refuse.BEcO0WCW.js";import{T as A}from"./task.Cx6XxNwo.js";import{i as b}from"./isNil.aV-w2MPu.js";const E={0:{text:"已处理",color:"#70b603"},1:{text:"已同意",color:"#70b603"},2:{text:"已拒绝",color:"#FF0000"},3:{text:"已撤回",color:"#999999"}},F=(e,t)=>{if(!b(t)&&""!==t)return e[t]};const j=K(t({__name:"listItem",props:{item:{type:Object,default:{}},status:{type:Number},className:{type:String,default:""},isDetail:{type:Boolean,default:!1},isWorkOrder:{type:Boolean,default:!1}},emits:["confirm","fixPrice"],setup(t,{emit:K}){const b=K,j=t,O=a(),w=a(),R=a(),M=a(!1),U=()=>{var e;if(j.isDetail)return;const{taskId:t,taskDefinitionKey:a,primaryKey:i,purchaseId:l,orderCustomerId:r,orderPaymentId:s,status:n,purchaseApproveId:u}=j.item;let o="",d={};if(d=a===A["财务审核"]?{taskId:t,primaryKey:r,taskDefinitionKey:a,status:j.status,orderId:i}:a===A["按揭审核"]?{taskId:t,primaryKey:i,taskDefinitionKey:a,status:j.item.status,orderPaymentId:s,orderCustomerId:r}:{taskId:t,primaryKey:i,taskDefinitionKey:a,status:j.status},a===A["发起入库"]&&(o=`/pages/pending/carEntry?${$({...d,task:"pend"})}`),a===A["车辆采购确认"]&&(o=`/pages/pending/carEntry?${$({...d,task:"confirm"})}`),a===A["提交资料"]&&(o=`/pages/pending/dataEntry?${$({...d,task:"pend"})}`),a===A["资料员审核"]&&(o=`/pages/pending/dataEntry?${$({...d,task:"confirm"})}`),a===A["销售定价"]&&(o=`/pages/pending/carFix?${$(d)}`),a===A["整备待办"]&&(o=`/pages/pending/readyTo?${$(d)}`),a!==A["钣金修复待办"]&&a!==A["补漆修复待办"]&&a!==A["洗车待办"]||(o=`/pages/pending/restoreTo?${$(d)}`),a===A["拍照待办"]&&(o=`/pages/pending/photoTo?${$(d)}`),a===A["修改采购价"]&&(o=`/pages/pending/recheckFailed?${$({...d,task:"pend"})}`),a===A["确认修改采购价"]&&(o=`/pages/pending/recheckFailed?${$({...d,task:"confirm"})}`),a===A["车辆资料出库待办"]&&(o=`/pages/pending/dataEntry?${$({...d,task:"pend",page:"sales"})}`),a===A["车辆资料出库确认"]&&(o=`/pages/pending/dataEntry?${$({...d,task:"confirm",page:"sales"})}`),a===A["车辆过户待办"]&&(o=`/pages/pending/carTransfer?${$({...d,page:"transfer"})}`),a===A["车辆保险待办"]&&(o=`/pages/pending/carTransfer?${$({...d,page:"insurance"})}`),a===A["采购审批"]&&(o=`/pages/pending/purchaseConfirm?${$({...d,task:"confirm"})}`),a===A["采购提交待办"]&&(o=`/pages/pending/purchaseConfirm?${$({...d,task:"pend"})}`),a!==A["车辆售出审批"]&&a!==A["总经理确定"]&&a!==A["销售审核提交"]&&a!==A["车辆预定审核"]&&a!==A["金融专员审核"]||(o=`/pages/sells/details/index?${$(d)}`),a===A["财务审核"]&&(o=`/pages/pending/receiptAudit?${$(d)}`),a===A["上级定价"]&&(o=`/pages/fixPrice/fixDetail?${$(d)}`),a===A["复检池"]&&(o=`/pages/reCheck/detail?${$({...d,purchaseId:l})}`),[A["采购上级审核"],A["采购审核"]].includes(a)){const e="/pages/purchaseOrder/purchaseDetail",a={...d,purchaseId:l,detailStatus:n};o=`${e}?${$(a)}`,3==+n&&(o=`${e}?${$({...a,taskId:t})}`)}a===A["财务付款审核"]&&(o=`/pages/pending/paymentAudit?${$({...d,purchaseId:l})}`),a===A["按揭审核"]&&(o=`/pagesC/carMortgage/mortgageDetail?${$({...d,orderCarCustomerId:r,audit:1})}`),a===A["修改采购审核"]&&(o=`/pages/purchaseOrder/examinePurchasePrice?${$({...d,purchaseApproveId:u})}`),1==j.status&&a===A["上级定价"]&&(o=`/pages/fixPrice/fixDetailDone?${$({id:null==(e=j.item)?void 0:e.primaryKey})}`),o&&T(o)},B=()=>{var e,t,a,i,l,r;console.log("成交价",null==(e=j.item)?void 0:e.dealPrice,"销售底价",null==(t=j.item)?void 0:t.salesPrice),void 0!==(null==(a=j.item)?void 0:a.dealPrice)&&void 0!==(null==(i=j.item)?void 0:i.salesPrice)?(null==(l=j.item)?void 0:l.dealPrice)<+(null==(r=j.item)?void 0:r.salesPrice)?M.value=!0:R.value.open():M.value=!0},L=(e,t="")=>{console.log("passOrReject",e),(new N).showLoading("提交中");const{taskDefinitionKey:a,taskId:i,primaryKey:l,orderPaymentId:r,orderCustomerId:s}=j.item,n={taskId:i,taskDefinitionKey:a,primaryKey:l,auditOpinion:e};t&&(n.comment=t),a===A["车辆采购确认"]&&(n.passOrReject=e),t&&a===A["车辆采购确认"]&&(n.auditOpinion=t),t&&[A["资料员审核"],A["采购审批"],A["车辆售出审批"],A["上级定价"],A["采购合同审核"],A["车辆预定审核"],A["总经理确定"],A["采购上级审核"],A["采购审核"],A["按揭审核"]].includes(a)&&(n.comment=t),[A["采购审批"],A["车辆售出审批"],A["上级定价"],A["采购合同审核"],A["车辆预定审核"],A["金融专员审核"],A["总经理确定"],A["采购上级审核"],A["采购审核"],A["客户移交审核"],A["按揭审核"]].includes(a)&&(n.auditOpinion=e),[A["按揭审核"]].includes(a)&&(n.orderPaymentId=r,n.orderCustomerId=s);const u=function(e,t){return[A["上级定价"],"FINANCE_AUDIT",A["采购上级审核"],A["采购审核"]].includes(e)?"/product/carPricingFlowable/taskTurnover":e===A["修改采购审核"]?"/product/purchase/taskTurnover":e===A["车辆采购确认"]?"/product/process/processApproval":e===A["客户移交审核"]?"/crm/customer/customerTransferTaskTurnover":e===A["按揭审核"]?"/product/mortgageCarSalesAudit/taskTurnover":[A["车辆资料出库确认"],A["车辆出库待办"]].includes(e)?"/product/carSales/taskTurnover":e===A["采购审批"]?"/product/purchaseOrder/purchaseAuditing":[A["车辆售出审批"],A["车辆预定审核"],A["金融专员审核"],A["总经理确定"]].includes(e)?"/product/carSalesAudit/taskTurnover":1==+t?"/product/carPricingFlowable/taskTurnover":"/product/dataEntry/rejectTask"}(a,e);uni.$u.http.post(u,n).then((()=>{(new N).showToast("提交成功"),M.value=!1,O.value.close(),w.value.close(),R.value.close(),b("confirm")}))},W=e=>[A["车辆采购确认"],A["资料员审核"],A["财务审核"],A["钣金修复待办"],A["补漆修复待办"],A["洗车待办"],A["复检池"],A["车辆资料出库确认"],A["采购审批"],A["车辆售出审批"],A["总经理确定"],A["上级定价"],A["车辆预定审核"],A["金融专员审核"],A["采购上级审核"],A["采购审核"],A["财务付款审核"],A["客户移交审核"],A["按揭审核"],A["修改采购审核"]].includes(e);return(a,$)=>{const N=f,K=v,V=u,H=I,J=i(r("up-modal"),l);return n(),s(V,{class:o(["list-item",j.className]),onClick:U},{default:d((()=>{var i,l,r,u,o,f,v;return[t.isDetail?c("",!0):(n(),s(V,{key:0,class:"header"},{default:d((()=>{var e;return[m(V,{class:"header-top"},{default:d((()=>{var e,a,i;return[W(null==(e=t.item)?void 0:e.taskDefinitionKey)?(n(),s(V,{key:0,class:"user"},{default:d((()=>{var e;return[(null==(e=t.item)?void 0:e.avatar)?(n(),s(N,{key:0,src:t.item.avatar},null,8,["src"])):(n(),s(N,{key:1,src:S})),m(K,{class:"header-title SC-Medium"},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.userName),1)]})),_:1}),p(" 发起的 ")]})),_:1})):(n(),s(V,{key:1,class:"title SC-Semibold"},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.taskName),1)]})),_:1})),0==t.status?(n(),s(V,{key:2,class:"header-top-time"},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.processTime),1)]})),_:1})):(n(),s(V,{key:3,class:"right",style:k({color:null==(i=g(F)(g(E),null==(a=t.item)?void 0:a.status))?void 0:i.color})},{default:d((()=>{var e,a;return[p(y(null==(a=g(F)(g(E),null==(e=t.item)?void 0:e.status))?void 0:a.text),1)]})),_:1},8,["style"]))]})),_:1}),W(null==(e=t.item)?void 0:e.taskDefinitionKey)?(n(),s(V,{key:0,class:"header-bottom"},{default:d((()=>[m(V,{class:"title SC-Semibold"},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.taskName),1)]})),_:1})])),_:1})):c("",!0)]})),_:1})),[g(A)["客户移交审核"]].includes(null==(i=t.item)?void 0:i.taskDefinitionKey)?(n(),s(V,{key:1,class:"content",style:{"margin-top":"0"}},{default:d((()=>[m(V,null,{default:d((()=>[m(V,{class:"chance-item"},{default:d((()=>[m(V,{class:"model-name"},{default:d((()=>{var e,a;return[p(y(`${(null==(e=t.item)?void 0:e.crmCustomerName)||""}-${(null==(a=t.item)?void 0:a.customerPhone)||""}`),1)]})),_:1}),m(V,{class:"model-tag"},{default:d((()=>{var e;return[p(y(0===(null==(e=t.item)?void 0:e.culeType)?"销售机会":"评估机会"),1)]})),_:1})])),_:1}),m(V,{class:"vin"},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.customerSource),1)]})),_:1})])),_:1})])),_:1})):(n(),s(V,{key:2,class:"content"},{default:d((()=>{var i,l;return[(null==(i=t.item)?void 0:i.photoUrl)?(n(),s(N,{key:0,src:null==(l=t.item)?void 0:l.photoUrl,mode:"aspectFill"},null,8,["src"])):(n(),s(N,{key:1,src:x,mode:"aspectFill"})),m(V,null,{default:d((()=>{var i;return[t.isWorkOrder?(n(),s(V,{key:0,class:"model-name"},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.carModelFullName),1)]})),_:1})):(n(),_(h,{key:1},[m(V,{class:"name SC-Semibold"},{default:d((()=>{var e,a,i,l;return[(null==(i=null==(e=t.item)?void 0:e.carSeriesName)?void 0:i.indexOf(null==(a=t.item)?void 0:a.carBrandName))<0?(n(),s(K,{key:0},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.carBrandName),1)]})),_:1})):c("",!0),p(" "+y(null==(l=t.item)?void 0:l.carSeriesName),1)]})),_:1}),m(V,{class:"model-name"},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.carModelName),1)]})),_:1})],64)),(null==(i=t.item)?void 0:i.taskDefinitionKey)!==g(A)["采购合同审核"]?(n(),s(V,{key:2,class:"label"},{default:d((()=>{var i,l,r,s,n,u;return[p(y(("joinStr"in a?a.joinStr:g(e))([null==(r=(null==(i=t.item)?void 0:i.uetoDate)||(null==(l=t.item)?void 0:l.registerDate))?void 0:r.substring(0,7),((null==(s=t.item)?void 0:s.mileage)||0)+"万公里",t.isWorkOrder?"评估师："+((null==(n=t.item)?void 0:n.appraiser)||"-"):null==(u=t.item)?void 0:u.bodyColor]," | ")),1)]})),_:1})):c("",!0),m(V,{class:"vin"},{default:d((()=>{var e;return[m(K,null,{default:d((()=>[p("VIN码：")])),_:1}),p(" "+y((null==(e=t.item)?void 0:e.vinNo)||"-"),1)]})),_:1}),1==j.status?(n(),s(V,{key:3,class:"time-box"},{default:d((()=>{var e,a;return[C("div",null,"发起时间："+y((null==(e=t.item)?void 0:e.startTime)||"-"),1),C("div",null,"处理时间："+y((null==(a=t.item)?void 0:a.endTime)||"-"),1)]})),_:1})):c("",!0)]})),_:1})]})),_:1})),(null==(l=t.item)?void 0:l.taskDefinitionKey)===g(A)["采购合同审核"]?(n(),s(V,{key:3,class:"purchase-info"},{default:d((()=>[m(V,null,{default:d((()=>{var e;return[m(V,null,{default:d((()=>{var e;return[p("采购价："+y(null==(e=t.item)?void 0:e.purchasePrice)+"万元",1)]})),_:1}),m(V,null,{default:d((()=>{var e;return[p("付款方式："+y(null==(e=t.item)?void 0:e.paymentMethod),1)]})),_:1}),"全款"!=(null==(e=t.item)?void 0:e.paymentMethod)?(n(),s(V,{key:0},{default:d((()=>{var e;return[p("定金："+y((null==(e=t.item)?void 0:e.deposit)||0)+"元",1)]})),_:1})):c("",!0)]})),_:1}),m(V,{onClick:$[0]||($[0]=D((e=>{var a,i;return i=null==(a=t.item)?void 0:a.previewUrl,void T(`/pages/carManage/pdf?url=${i}`)}),["stop"]))},{default:d((()=>[p("查看合同>")])),_:1})])),_:1})):c("",!0),(null==(r=t.item)?void 0:r.taskDefinitionKey)===g(A)["修改采购审核"]?(n(),s(V,{key:4,class:"modify-info"},{default:d((()=>[m(V,null,{default:d((()=>{var e;return[p("采购价："+y(null==(e=t.item)?void 0:e.purchasePriceOld)+"万元",1)]})),_:1}),m(V,null,{default:d((()=>{var e;return[p("修改后采购价："+y(null==(e=t.item)?void 0:e.modifyPrice)+"万元",1)]})),_:1}),m(V,null,{default:d((()=>{var e;return[p("修改原因："+y(null==(e=t.item)?void 0:e.modifyReasonName),1)]})),_:1})])),_:1})):c("",!0),[g(A)["财务审核"],g(A)["按揭审核"]].includes(null==(u=t.item)?void 0:u.taskDefinitionKey)&&(null==(o=t.item)?void 0:o.amount)?(n(),s(V,{key:5,class:"purchase-info purchase-info-price"},{default:d((()=>[m(K,{class:"price-text"},{default:d((()=>[p("金额：")])),_:1}),m(K,{class:"price-num SC-Semibold"},{default:d((()=>{var e;return[p(y(null==(e=t.item)?void 0:e.amount)+"元",1)]})),_:1})])),_:1})):c("",!0),!t.isDetail&&[g(A)["资料员审核"],g(A)["车辆资料出库确认"]].includes(null==(f=t.item)?void 0:f.taskDefinitionKey)?(n(),s(V,{key:6,class:"card"},{default:d((()=>[m(V,null,{default:d((()=>{var e;return[m(K,null,{default:d((()=>[p("登记证书")])),_:1}),p(" "+y((null==(e=t.item)?void 0:e.registerCertificateCount)>0?"有":"无"),1)]})),_:1}),m(V,null,{default:d((()=>{var e;return[m(K,null,{default:d((()=>[p("行驶证")])),_:1}),p(" "+y((null==(e=t.item)?void 0:e.vehicleLicenseCount)>0?"有":"无"),1)]})),_:1}),m(V,null,{default:d((()=>{var e;return[m(K,null,{default:d((()=>[p("钥匙")])),_:1}),p(" "+y((null==(e=t.item)?void 0:e.keyNum)||0)+"把 ",1)]})),_:1})])),_:1})):c("",!0),!t.isDetail&&1!=t.status&&[g(A)["车辆采购确认"],g(A)["资料员审核"],g(A)["车辆资料出库确认"],g(A)["采购审批"],g(A)["车辆售出审批"],g(A)["总经理确定"],"FINANCE_AUDIT",g(A)["上级定价"],"VEHICLE_DELIVERY",g(A)["车辆预定审核"],g(A)["金融专员审核"],g(A)["采购上级审核"],g(A)["采购审核"],"TRANSFER_AUDIT",g(A)["按揭审核"],g(A)["修改采购审核"]].includes(null==(v=t.item)?void 0:v.taskDefinitionKey)?(n(),s(V,{key:7,class:"handle"},{default:d((()=>{var e,a,i;return[[g(A)["资料员审核"],g(A)["采购审批"],g(A)["车辆售出审批"],g(A)["总经理确定"],"FINANCE_AUDIT",g(A)["车辆预定审核"],g(A)["采购上级审核"],g(A)["采购审核"],"TRANSFER_AUDIT",g(A)["按揭审核"],g(A)["修改采购审核"]].includes(null==(e=t.item)?void 0:e.taskDefinitionKey)?(n(),s(H,{key:0,class:"SC-Medium",onClick:$[1]||($[1]=D((e=>g(O).open()),["stop"]))},{default:d((()=>[p(" 拒绝 ")])),_:1})):c("",!0),(null==(a=t.item)?void 0:a.taskDefinitionKey)===g(A)["车辆售出审批"]?(n(),s(H,{key:1,class:"SC-Medium",onClick:D(B,["stop"])},{default:d((()=>[p(" 同意 ")])),_:1})):[g(A)["上级定价"]].includes(null==(i=t.item)?void 0:i.taskDefinitionKey)?(n(),s(H,{key:2,class:"SC-Medium",onClick:$[2]||($[2]=D((e=>b("fixPrice",t.item)),["stop"]))},{default:d((()=>[p(" 定价 ")])),_:1})):(n(),s(H,{key:3,onClick:$[3]||($[3]=D((e=>g(w).open()),["stop"])),class:"SC-Medium"},{default:d((()=>[p("同意")])),_:1}))]})),_:1})):c("",!0),m(P,{ref_key:"refuseRef",ref:O,onConfirm:$[4]||($[4]=e=>L(0,e))},null,512),m(P,{ref_key:"agreeRef",ref:w,title:"备注",onConfirm:$[5]||($[5]=e=>L(1,e))},null,512),m(P,{ref_key:"agreeRef2",ref:R,title:"备注",onConfirm:$[6]||($[6]=e=>L(2,e))},null,512),m(J,{show:g(M),width:"500rpx",title:"提示",content:"是否需要总经理审批？",cancelText:"是",confirmText:"否",showCancelButton:!0,confirmColor:"#606266",cancelColor:"#ff5719",onCancel:$[7]||($[7]=e=>L(1)),onConfirm:$[8]||($[8]=e=>L(2))},null,8,["show"])]})),_:1},8,["class"])}}}),[["__scopeId","data-v-d54edb92"]]);export{j as D};
