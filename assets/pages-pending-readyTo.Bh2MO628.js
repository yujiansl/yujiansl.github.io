import{d as a,r as e,a9 as t,B as s,D as l,a2 as r,c as o,w as i,i as u,I as n,ae as p,K as d,af as m,o as c,a as v,y as f,u as g,n as _,b as y,g as h,t as T,F as k,e as I,h as E,aj as j,W as A,an as F,_ as S}from"./index-CK4DGatK.js";import{D as b}from"./listItem.CnogksUc.js";import{U as x}from"./UploadFile.BBuXxkzB.js";import{u as L}from"./useQuery.3dd8K18V.js";import{p as N}from"./index.HDA2F_3Q.js";import"./avatar.Buy0-vr1.js";import"./car_default.CyENNAub.js";import"./refuse.BEcO0WCW.js";import"./close.Dhgi5Ijg.js";import"./task.Cx6XxNwo.js";import"./isNil.aV-w2MPu.js";import"./dev.3CSglq9A.js";import"./index.BP9c-u7r.js";import"./image.DobRSNlT.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";const V=S(a({__name:"readyTo",setup(a){const S=L(),V=e({}),w=t({servicingFlag:1,servicingInfo:[{status:0,attachments:[],remarks:"",approveType:"SHEET_METAL"},{status:0,attachments:[],remarks:"",approveType:"REPAINTING"},{status:1,attachments:[],remarks:"",approveType:"CAR_WASH"}]}),R=e([{name:"是",value:1},{name:"否",value:0}]),H=e([{approveType:"SHEET_METAL"},{approveType:"REPAINTING"}]);s((()=>{C()}));const C=()=>{(new l).showLoading("加载中"),uni.$u.http.get("product/purchaseOrder/queryServicingDetails",{params:{id:S.value.primaryKey}}).then((a=>{var e;V.value=a.data,1==S.value.status&&(w.servicingFlag=a.data.servicingFlag,w.servicingInfo=null==(e=a.data.approveList)?void 0:e.filter((a=>"SHEET_METAL"==a.approveType||"REPAINTING"==a.approveType||"CAR_WASH"==a.approveType))),r()}))},U=()=>{var a,e,t,s;const r=(null==(e=null==(a=H.value[0].el)?void 0:a.getFileFields())?void 0:e.all.map((a=>a.id)))||[],o=(null==(s=null==(t=H.value[1].el)?void 0:t.getFileFields())?void 0:s.all.map((a=>a.id)))||[];if(console.log(r,o,w.servicingInfo),1==w.servicingFlag&&(1==w.servicingInfo[0].status&&!r.length||1==w.servicingInfo[1].status&&!o.length))return void(new l).showToast("请上传照片凭证");(new l).showLoading("提交中");const i=JSON.parse(JSON.stringify(w.servicingInfo));i[0].attachments=1==w.servicingInfo[0].status?r:[],i[1].attachments=1==w.servicingInfo[1].status?o:[];const u={taskId:S.value.taskId,purchaseOrderId:S.value.primaryKey,servicingFlag:w.servicingFlag,servicingInfo:1==w.servicingFlag?i:null};console.log(u),uni.$u.http.post("/product/purchaseOrder/servicingSubmit",u).then((()=>{F()})).catch((a=>{N(a.message)}))};return(a,e)=>{const t=u,s=n(d("up-radio"),p),l=n(d("up-radio-group"),m),r=E,F=j,L=A;return c(),o(t,{class:"page pend-page"},{default:i((()=>[v(t,{class:"content"},{default:i((()=>[v(b,{item:g(V),isDetail:!0},null,8,["item"]),v(t,{class:_(["form-box",{write:1!=g(S).status}])},{default:i((()=>[v(t,{class:"form-item"},{default:i((()=>[v(t,null,{default:i((()=>[h("是否整备")])),_:1}),1==g(S).status?(c(),o(t,{key:0},{default:i((()=>[h(T(1==g(w).servicingFlag?"是":"否"),1)])),_:1})):(c(),o(l,{key:1,modelValue:g(w).servicingFlag,"onUpdate:modelValue":e[0]||(e[0]=a=>g(w).servicingFlag=a)},{default:i((()=>[(c(!0),y(k,null,I(g(R),((a,e)=>(c(),o(s,{customStyle:{marginRight:"20px"},activeColor:"#ff7525",key:e,label:a.name,name:a.value},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]))])),_:1}),1==g(w).servicingFlag?(c(!0),y(k,{key:0},I(g(w).servicingInfo,((a,e)=>(c(),o(t,{key:e},{default:i((()=>[v(t,{class:"form-item"},{default:i((()=>[v(t,null,{default:i((()=>[h(T("SHEET_METAL"===a.approveType?"钣金修复":"REPAINTING"==a.approveType?"补漆修复":"洗车"),1)])),_:2},1024),"CAR_WASH"!=a.approveType?(c(),o(t,{key:0},{default:i((()=>[1==g(S).status?(c(),o(t,{key:0},{default:i((()=>[h(T(1==a.status?"是":"否"),1)])),_:2},1024)):(c(),o(l,{key:1,modelValue:a.status,"onUpdate:modelValue":e=>a.status=e},{default:i((()=>[(c(!0),y(k,null,I(g(R),((a,e)=>(c(),o(s,{customStyle:{marginRight:"20px"},activeColor:"#ff7525",key:e,label:a.name,name:a.value},null,8,["label","name"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]))])),_:2},1024)):(c(),o(t,{key:1},{default:i((()=>[h("是")])),_:1}))])),_:2},1024),1==a.status&&"CAR_WASH"!=a.approveType?(c(),y(k,{key:0},[1==g(S).status?(c(),y(k,{key:0},[v(t,{class:"form-item photo-item"},{default:i((()=>[v(t,null,{default:i((()=>[h("照片凭证")])),_:1}),v(x,{accept:"all","max-count":99,uploadList:a.attachments,detail:g(S).status},null,8,["uploadList","detail"])])),_:2},1024),v(t,{class:"form-textarea"},{default:i((()=>[v(t,{class:"area-title"},{default:i((()=>[h("备注")])),_:1}),v(t,{class:"word-warp"},{default:i((()=>[h(T(a.remarks||"-"),1)])),_:2},1024)])),_:2},1024)],64)):(c(),y(k,{key:1},[v(t,{class:"form-item photo-item"},{default:i((()=>[v(t,null,{default:i((()=>[v(r,null,{default:i((()=>[h("*")])),_:1}),h("照片凭证")])),_:1}),v(x,{ref_for:!0,ref:e=>((a,e)=>{H.value.forEach((t=>{t.approveType==e&&(t.el=a)}))})(e,a.approveType),accept:"all","max-count":99,uploadList:a.attachments},null,8,["uploadList"])])),_:2},1024),v(t,{class:"form-textarea"},{default:i((()=>[v(t,{class:"area-title"},{default:i((()=>[h("备注")])),_:1}),v(F,{modelValue:a.remarks,"onUpdate:modelValue":e=>a.remarks=e,placeholder:`请描述需要${"SHEET_METAL"==a.approveType?"钣金":"补漆"}修复的位置以及说明`,maxlength:"1000"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),v(t,{class:"limit"},{default:i((()=>{var e;return[h(T((null==(e=a.remarks)?void 0:e.length)||0)+"/1000",1)]})),_:2},1024)])),_:2},1024)],64))],64)):f("",!0)])),_:2},1024)))),128)):f("",!0)])),_:1},8,["class"])])),_:1}),1!=g(S).status?(c(),o(t,{key:0,class:"bottom-btn"},{default:i((()=>[v(L,{class:"save-btn",onClick:U},{default:i((()=>[h("确定")])),_:1})])),_:1})):f("",!0)])),_:1})}}}),[["__scopeId","data-v-dbd22f0c"]]);export{V as default};
