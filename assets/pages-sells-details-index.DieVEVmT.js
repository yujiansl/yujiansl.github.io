import{b as e,a,p as l}from"./index.HDA2F_3Q.js";import{d as t,c as r,o,i as u,w as n,a as s,y as i,b as d,g as c,t as m,u as f,h as v,e as C,P as _,F as p,Q as D,ai as y,a0 as T,_ as g,n as O,A as h,a9 as k,r as b,x as I,B as A,G as w,E as P,X as S,Y as N,Z as x,a2 as R,al as M,I as j,am as K,K as L,M as U,ah as E,N as V,R as $,W as F,O as B,s as q,D as Y,$ as G,an as Q}from"./index-CK4DGatK.js";import{_ as z}from"./avatar.Buy0-vr1.js";import{N as J}from"./NavBar.DSs5OGCU.js";import{p as W}from"./image.DobRSNlT.js";import{t as H}from"./index.BP9c-u7r.js";import{T as X}from"./task.Cx6XxNwo.js";import{u as Z}from"./useQuery.3dd8K18V.js";import{T as ee}from"./tracks.Bx8MlLQ0.js";import{U as ae}from"./UploadFile.BBuXxkzB.js";import{D as le}from"./detailItem.D7jJ4BsD.js";import{R as te}from"./refuse.BEcO0WCW.js";import{o as re}from"./omit.DzeQdT5l.js";import"./dev.3CSglq9A.js";import"./play.dJbs8fP_.js";import"./vuedraggable.umd.DwpyKIuh.js";import"./car_default.CyENNAub.js";import"./close.Dhgi5Ijg.js";import"./_baseGet.CmhOSbYr.js";import"./_getTag.DG-N9UUn.js";import"./isObject.C8HfsiHw.js";import"./isSymbol.Bym6OQCA.js";import"./_Uint8Array.B4mhORiM.js";import"./_baseClone.Cc-Y92km.js";const oe="./static/carManage/car_icon_tk.png",ue=g(t({__name:"carInfo",props:{infoData:{type:Object,default:{}},isSell:{type:Boolean,default:!1}},setup(a){const l=Z(),t=a,g=e=>{switch(e){case"CREATE_CONTRACT":return"未签署";case"CONTRACT_SIGNED":return"已签署";case"CANCEL":return"已取消";default:return"-"}},O=e=>{const{salesPrice:a}=t.infoData.orderCarDetailDTO||{},{dealPrice:l}=t.infoData.orderCarCustomerDTO||{};return!!((e.taskDefinitionKey===X["车辆售出审批"]||e.taskDefinitionKey===X["总经理确定"])&&0==e.status&&a&&l&&+l<+a)};return(h,k)=>{const b=u,I=v,A=_;return o(),r(b,{class:"car-info"},{default:n((()=>{var u,v,_,w,P,S,N,x,R,M;return[s(b,{class:"sub-title"},{default:n((()=>[c("销售信息")])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("成交价")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l,t,r;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.dealPrice)?(null==(r=null==(t=a.infoData)?void 0:t.orderCarCustomerDTO)?void 0:r.dealPrice)+"万元":"-"),1)]})),_:1}),O(f(l))?(o(),r(I,{key:0},{default:n((()=>[c("低于销售底价")])),_:1})):i("",!0)])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("定金")])),_:1}),s(b,{class:"val"},{default:n((()=>{var l,t;return[c(m(("formatShowPrice"in h?h.formatShowPrice:f(e))(null==(t=null==(l=a.infoData)?void 0:l.orderCarCustomerDTO)?void 0:t.deposit,"元")),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("付款方式")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.paymentMethodName)||"-"),1)]})),_:1})])),_:1}),"Mortgage"===(null==(v=null==(u=a.infoData)?void 0:u.orderCarCustomerDTO)?void 0:v.paymentMethod)?(o(),r(b,{key:0,class:"info-item"},{default:n((()=>{var e;return[s(b,{class:"label"},{default:n((()=>[c("按揭图片")])),_:1}),(null==(e=a.infoData.mortgageCarAttachments)?void 0:e.length)?(o(),r(b,{key:0,class:"val attachment"},{default:n((()=>[(o(!0),d(p,null,C(a.infoData.mortgageCarAttachments,((e,a)=>(o(),r(A,{key:a,src:e.attachmentUrl,onClick:a=>("previewImage"in h?h.previewImage:f(W))(e.attachmentUrl)},null,8,["src","onClick"])))),128))])),_:1})):(o(),r(b,{key:1,class:"val"},{default:n((()=>[c("-")])),_:1}))]})),_:1})):i("",!0),"Mortgage"==(null==(w=null==(_=a.infoData)?void 0:_.orderCarCustomerDTO)?void 0:w.paymentMethod)&&f(l).taskDefinitionKey!==f(X).ATTACHE_AUDIT?(o(),d(p,{key:1},[],64)):i("",!0),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("过户方式")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.transferMethodName)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("销售类型")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.salesTypeName)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("销售")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.salesUserName)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("预计交车时间")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.reserveTime)||"-"),1)]})),_:1})])),_:1}),f(l).taskDefinitionKey!==f(X)["金融专员审核"]?(o(),d(p,{key:2},[s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("收齐全款时间")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.fullPaymentTime)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("已收金额")])),_:1}),s(b,{class:"val"},{default:n((()=>{var l,t;return[c(m(("formatShowPrice"in h?h.formatShowPrice:f(e))(null==(t=null==(l=a.infoData)?void 0:l.orderCarCustomerDTO)?void 0:t.amountReceived,"元")),1)]})),_:1})])),_:1})],64)):i("",!0),s(b,{class:"sub-title"},{default:n((()=>[c("客户信息")])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("姓名")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.customerName)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("手机号")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.customerMobile)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("身份证号")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.idNumber)||"-"),1)]})),_:1})])),_:1}),f(l).taskDefinitionKey!==f(X)["金融专员审核"]?(o(),d(p,{key:3},[s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("地址")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.address)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("客户来源")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.customerSourceName)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>{var e,l;return[s(b,{class:"label"},{default:n((()=>[c("所在地")])),_:1}),(null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.provinceName)?(o(),r(b,{key:0,class:"val"},{default:n((()=>{var e,l,t,r,o,u;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.provinceName)+(null==(r=null==(t=a.infoData)?void 0:t.orderCarCustomerDetailDTO)?void 0:r.cityName)+(null==(u=null==(o=a.infoData)?void 0:o.orderCarCustomerDetailDTO)?void 0:u.countyName)),1)]})),_:1})):(o(),r(b,{key:1,class:"val"},{default:n((()=>[c("-")])),_:1}))]})),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("交强险到期日")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.trafficInsuranceDate)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("商业险到期日")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.commercialInsuranceDate)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("年检到期日")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDetailDTO)?void 0:l.inspectionDate)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("订单备注")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.remark)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>{var e,l;return[c(m("Reserved"==(null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.orderStatus)?"定金凭证":"资料照片"),1)]})),_:1}),a.infoData.carAttachments&&a.infoData.carAttachments.length>0?(o(),r(b,{key:0,class:"val attachment"},{default:n((()=>[(o(!0),d(p,null,C(a.infoData.carAttachments,((e,a)=>(o(),r(A,{key:a,src:e.attachmentUrl,onClick:a=>("previewImage"in h?h.previewImage:f(W))(e.attachmentUrl)},null,8,["src","onClick"])))),128))])),_:1})):(o(),r(b,{key:1,class:"val"},{default:n((()=>[c("-")])),_:1}))])),_:1}),s(b,{class:"sub-title"},{default:n((()=>[c("合同信息")])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("签约方式")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l,t,r;return[c(m(1==(null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.wayOfSigning)?"线下签约":0==(null==(r=null==(t=a.infoData)?void 0:t.orderCarCustomerDTO)?void 0:r.wayOfSigning)?"线上签约":"未签署"),1)]})),_:1})])),_:1}),1==(null==(S=null==(P=a.infoData)?void 0:P.orderCarCustomerDTO)?void 0:S.wayOfSigning)?(o(),r(b,{key:0,class:"info-item"},{default:n((()=>{var e;return[s(b,{class:"label"},{default:n((()=>[c("合同照片")])),_:1}),(null==(e=a.infoData.contractAnnex)?void 0:e.length)?(o(),r(b,{key:0,class:"val attachment"},{default:n((()=>[(o(!0),d(p,null,C(a.infoData.contractAnnex,((e,l)=>(o(),r(A,{key:l,src:e.attachmentUrl,onClick:e=>("toViewImage"in h?h.toViewImage:f(H))(`/pages/guide/imageView?type=1&index=${l}`,a.infoData.contractAnnex)},null,8,["src","onClick"])))),128))])),_:1})):(o(),r(b,{key:1,class:"val"},{default:n((()=>[c("-")])),_:1}))]})),_:1})):i("",!0),0==(null==(x=null==(N=a.infoData)?void 0:N.orderCarCustomerDTO)?void 0:x.wayOfSigning)?(o(),r(b,{key:1,class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("主体")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.enterpriseName)||"-"),1)]})),_:1})])),_:1})):i("",!0),0==(null==(M=null==(R=a.infoData)?void 0:R.orderCarCustomerDTO)?void 0:M.wayOfSigning)?(o(),r(b,{key:2,class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("合同")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l,u,d,f,v,C,_;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.templateName)||"-")+" ",1),(null==(d=null==(u=a.infoData)?void 0:u.orderCarCustomerDTO)?void 0:d.signType)?(o(),r(I,{key:0},{default:n((()=>{var e,l;return[c("("+m(g(null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.signType))+")",1)]})),_:1})):i("",!0),s(I,{onClick:k[0]||(k[0]=e=>{var l,r;return(e=>{if(e)D(`/pages/carManage/pdf?url=${e}&title=预览`);else{const e={carProductId:t.infoData.carProductId,...t.infoData};uni.$u.http.post("/product/sign/sale/preview",e).then((e=>{D(`/pages/carManage/pdf?url=${e.data}&title=预览`)}))}})(null==(r=null==(l=a.infoData)?void 0:l.orderCarCustomerDTO)?void 0:r.previewUrl)}),class:"preview"},{default:n((()=>{var e,l;return[c(m("CONTRACT_SIGNED"==(null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.signType)?"查看>":"预览>"),1)]})),_:1}),["noSign","Reserved"].includes(null==(v=null==(f=a.infoData)?void 0:f.orderCarCustomerDTO)?void 0:v.orderStatus)&&(null==(_=null==(C=a.infoData)?void 0:C.orderCarCustomerDTO)?void 0:_.shortUrl)?(o(),r(I,{key:1,onClick:k[1]||(k[1]=e=>{var l,t,r;return r=null==(t=null==(l=a.infoData)?void 0:l.orderCarCustomerDTO)?void 0:t.shortUrl,void y({data:r,success:function(){T({title:"复制成功",icon:"success"})}})}),class:"preview two"},{default:n((()=>[c(" 复制 ")])),_:1})):i("",!0)]})),_:1})])),_:1})):i("",!0),s(b,{class:"sub-title"},{default:n((()=>[c("其他信息")])),_:1}),s(b,{class:"info-item"},{default:n((()=>[s(b,{class:"label"},{default:n((()=>[c("创建人")])),_:1}),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.createUserName)||"-"),1)]})),_:1})])),_:1}),s(b,{class:"info-item"},{default:n((()=>[t.isSell?(o(),r(b,{key:0,class:"label"},{default:n((()=>[c("下单时间")])),_:1})):(o(),r(b,{key:1,class:"label"},{default:n((()=>[c("创建时间")])),_:1})),s(b,{class:"val"},{default:n((()=>{var e,l;return[c(m((null==(l=null==(e=a.infoData)?void 0:e.orderCarCustomerDTO)?void 0:l.createdAt)||"-"),1)]})),_:1})])),_:1})],64)):i("",!0)]})),_:1})}}}),[["__scopeId","data-v-9531c1bb"]]),ne=g(t({__name:"payRecord",props:{infoData:Array,default:()=>[]},setup(e){const a=e=>{switch(e){case 0:return"待审核";case 1:return"已付款";case 2:return"驳回";case 3:return"已撤回";default:return""}},l=e=>{switch(e){case"EARNEST_MONEY":return"定金";case"BALANCE_PAYMENT":return"尾款";case"FULL_PAYMENT":return"全款";case"DOWN_PAYMENT":return"首付款";case"MORTGAGE_PAYMENT":return"按揭款";default:return"其他"}},t=e=>{switch(e){case 0:return"现金";case 1:return"银行卡";default:return"优惠券"}};return(f,v)=>{const _=u;return o(),r(_,{class:"record"},{default:n((()=>[(o(!0),d(p,null,C(e.infoData,((e,u)=>(o(),r(_,{class:"list-item",key:u},{default:n((()=>[s(_,{class:"head"},{default:n((()=>[s(_,null,{default:n((()=>[c("付款单")])),_:1}),s(_,{class:"status"},{default:n((()=>[c(m(a(e.status)),1)])),_:2},1024)])),_:2},1024),s(_,{class:"info"},{default:n((()=>[s(_,null,{default:n((()=>[s(_,null,{default:n((()=>[c("收款金额(元)")])),_:1}),s(_,null,{default:n((()=>[c(m(e.amount||"-"),1)])),_:2},1024)])),_:2},1024),s(_,null,{default:n((()=>[s(_,null,{default:n((()=>[c("付款类型")])),_:1}),s(_,null,{default:n((()=>[c(m(l(e.paymentType)||"-"),1)])),_:2},1024)])),_:2},1024),s(_,null,{default:n((()=>[s(_,null,{default:n((()=>[c("付款方式")])),_:1}),s(_,null,{default:n((()=>[c(m(t(e.payMethod)||"-"),1)])),_:2},1024)])),_:2},1024),s(_,null,{default:n((()=>[s(_,null,{default:n((()=>[c("实付日期")])),_:1}),s(_,null,{default:n((()=>[c(m(e.paymentDate||"-"),1)])),_:2},1024)])),_:2},1024),s(_,null,{default:n((()=>[s(_,null,{default:n((()=>[c("申请时间")])),_:1}),s(_,null,{default:n((()=>[c(m(e.createTime||"-"),1)])),_:2},1024)])),_:2},1024),s(_,null,{default:n((()=>[s(_,null,{default:n((()=>[c("申请人")])),_:1}),s(_,null,{default:n((()=>[c(m(e.createUserName||"-"),1)])),_:2},1024)])),_:2},1024),s(_,{class:"img-boxs"},{default:n((()=>{var a,l;return[s(_,{class:"name"},{default:n((()=>[c("收款凭证")])),_:1}),(null==(a=e.certificateList.filter)?void 0:a.length)?(o(),r(_,{key:0,class:O(["val",{single:1==(null==(l=e.certificateList)?void 0:l.length)}])},{default:n((()=>[s(ae,{ref_for:!0,ref:"imageRef",carAttachmentType:"FINANCIAL_AUDIT",accept:"all","max-count":99,uploadList:e.certificateList,detail:1},null,8,["uploadList"])])),_:2},1032,["class"])):(o(),r(_,{key:1},{default:n((()=>[c("-")])),_:1}))]})),_:2},1024),s(_,{class:"img-boxs"},{default:n((()=>{var a,l;return[s(_,{class:"name"},{default:n((()=>[c("附件")])),_:1}),(null==(a=e.attachmentList)?void 0:a.length)?(o(),r(_,{key:0,class:O(["val",{single:1==(null==(l=e.attachmentList)?void 0:l.length)}])},{default:n((()=>[s(ae,{ref_for:!0,ref:"imageRef",carAttachmentType:"RECEIPT_RECORDS",accept:"all","max-count":9,uploadList:e.attachmentList,detail:1},null,8,["uploadList"])])),_:2},1032,["class"])):(o(),r(_,{key:1},{default:n((()=>[c("-")])),_:1}))]})),_:2},1024),2==e.status&&e.auditReason?(o(),r(_,{key:0},{default:n((()=>[s(_,null,{default:n((()=>[c("驳回原因")])),_:1}),s(_,null,{default:n((()=>[c(m(e.auditReason),1)])),_:2},1024)])),_:2},1024)):i("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})}}}),[["__scopeId","data-v-bc1e32cf"]]),se=g(t({__name:"index",setup(t){const y=Z(),g=h(),W=k({current:1,size:3,total:0}),H=b({orderCarCustomerDTO:{downPaymentRatio:null,mortgageNumber:"",mortgageAmount:"",paymentAmount:"",monthlyPaymentAmount:"",financialLoanIncome:"",boutiqueIncome:"",insuranceAppreciationIncome:"",otherIncome:""}}),ae=b([]),se=b([{name:"详情",val:"detail"},{name:"轨迹",val:"track"}]),ie=b(y.value.id?"record":"detail"),de=b(y.value.id?1:0),ce=b([]),me=b([]),fe=b(!1),ve=b(),Ce=b(""),_e=b(""),pe=b(!1),De=b([]),ye=b([{key:12,value:"12期"},{key:24,value:"24期"},{key:36,value:"36期"},{key:48,value:"48期"},{key:60,value:"60期"}]),Te=I((()=>{var e,a,l,t;return me.value.includes("sells:add:payment")&&"PaymentIng"==(null==(a=null==(e=H.value)?void 0:e.orderCarCustomerDTO)?void 0:a.orderStatus)&&(null==(t=null==(l=H.value)?void 0:l.orderCarCustomerDTO)?void 0:t.salesUserId)==g.userInfo.userId})),ge=I((()=>{var e,a,l,t,r,o,u,n;return(null==(a=null==(e=H.value)?void 0:e.orderCarCustomerDTO)?void 0:a.orderStatus)&&"CANCEL_ORDER"!==(null==(t=null==(l=H.value)?void 0:l.orderCarCustomerDTO)?void 0:t.orderStatus)&&"Reserved"!==(null==(o=null==(r=H.value)?void 0:r.orderCarCustomerDTO)?void 0:o.orderStatus)&&(null==(n=null==(u=H.value)?void 0:u.orderCarCustomerDTO)?void 0:n.salesUserId)==g.userInfo.userId}));A((()=>{be();for(let e=0;e<=95;e+=5)De.value.push({key:e,value:e});me.value=JSON.parse(w("userBtnPermission")||"{}"),y.value.primaryKey&&je()})),P((()=>{S("pickData"),N("pickData",(e=>{const{key:a,subKey:l,tKey:t}=e;t?H.value[l][t]=a:H.value[l]=a,"downPaymentRatio"==t&&xe()})),S("refreshDetail"),N("refreshDetail",(()=>{be()}))}));const Oe=()=>{var e,a;console.log("成交价，销售底价",H.value.orderCarCustomerDTO.dealPrice,H.value.orderCarDetailDTO.salesPrice),+H.value.orderCarCustomerDTO.dealPrice<(+(null==(a=null==(e=H.value)?void 0:e.orderCarDetailDTO)?void 0:a.salesPrice)||0)?pe.value=!0:Ee("",2)},he=e=>{switch(ie.value=e.val,e.val){case"detail":de.value=0;break;case"record":de.value=1;break;case"track":de.value=2;break;default:return}},ke=b(""),be=()=>{x({title:"加载中"}),uni.$u.http.get("/product/order/car/custom/getDetail",{params:{id:y.value.id||y.value.primaryKey}}).then((e=>{ke.value=e.data.carProductId,H.value=e.data,R(),se.value=[{name:"详情",val:"detail"},{name:"付款记录",val:"record"},{name:"轨迹",val:"track"}],Ie(),y.value.id?he({val:"record"}):he({val:"detail"})}))};M((()=>{W.current*W.size<W.total&&(W.current++,Ie())}));const Ie=()=>{uni.$u.http.post("/product/orderPayment/pageFullPaymentRecord",{orderId:y.value.id||y.value.primaryKey,...re(W,"total")}).then((e=>{ae.value=ae.value.concat(e.data.results),W.total=e.data.count}))},Ae=I((()=>Pe(De.value,H.value.orderCarCustomerDTO.downPaymentRatio,"%"))),we=I((()=>Pe(ye.value,H.value.orderCarCustomerDTO.mortgageNumber))),Pe=(e,a,l="")=>{const t=null==e?void 0:e.filter((e=>e.key==a));return(null==t?void 0:t.length)?t[0].value+l:(a&&l?a+l:"")||"请选择"},Se=(e,l,t,r)=>{q((()=>{if(H.value[l][t]=a(e,r),["financialLoanIncome","boutiqueIncome","insuranceAppreciationIncome","otherIncome"].includes(t)){const e=(.5*H.value.orderCarCustomerDTO.dealPrice*1e4).toFixed(2);parseInt(H.value[l][t])>e&&((new Y).showToast(`${Ne(t)}需小于等于车款的50%`),H.value[l][t]="")}if("monthlyPaymentAmount"==t){const e=(.2*H.value.orderCarCustomerDTO.dealPrice*1e4).toFixed(2);parseFloat(H.value[l][t])>e&&((new Y).showToast("月供需小于等于车款的20%"),H.value[l][t]="")}}))},Ne=e=>{switch(e){case"financialLoanIncome":return"金融贷款收入";case"boutiqueIncome":return"汽车精品收入";case"insuranceAppreciationIncome":return"保险增值收入";case"otherIncome":return"其他收入";default:return""}},xe=()=>{const{dealPrice:e,downPaymentRatio:a}=H.value.orderCarCustomerDTO;if(e&&null!==a){const e=100*Math.round(17.99*100);H.value.orderCarCustomerDTO.paymentAmount=e*(a/100),H.value.orderCarCustomerDTO.mortgageAmount=e-H.value.orderCarCustomerDTO.paymentAmount}},Re=()=>{const{dealPrice:e,paymentAmount:a}=H.value.orderCarCustomerDTO;if(e&&a){const e=100*Math.round(17.99*100),l=a<=e;H.value.orderCarCustomerDTO.downPaymentRatio=l?parseFloat((a/e*100).toFixed(1)):"0",H.value.orderCarCustomerDTO.mortgageAmount=l?parseInt(e-H.value.orderCarCustomerDTO.paymentAmount):"0"}},Me=(e,a,l,t,r)=>{D(`/pages/carManage/pagePicker?title=${e}&list=${JSON.stringify(a)}&key=${l}&subKey=${t}&tKey=${r}`)},je=()=>{uni.$u.http.get("/product/carSalesAudit/getProcessLog",{params:{primaryKey:y.value.primaryKey}}).then((e=>{ce.value=e.data}))},Ke=()=>{x({title:"提交中",mask:!0}),uni.$u.http.put("/product/order/car/custom/updateStatus",{primaryKey:H.value.id,customerOrderStatus:"CANCEL_ORDER"}).then((()=>{T({title:"取消成功",mask:!0}),fe.value=!1,be()}))},Le=(e,a)=>{Ce.value=e,_e.value=a,ve.value.open()},Ue=()=>{D(`/pages/carManage/details/carSell?carProductId=${ke.value}&source=reserveToSale&sourceId=${y.value.id}`)},Ee=async(e,a)=>{var t;e||(Ce.value="拒绝原因");const r=()=>{var e;null==(e=ve.value)||e.close(),Q()};if("拒绝原因"==Ce.value){let o={};if(o={taskId:y.value.taskId,primaryKey:y.value.primaryKey,taskDefinitionKey:y.value.taskDefinitionKey,auditOpinion:a},e&&(o.comment=e),y.value.taskDefinitionKey===X["金融专员审核"]){const e=(()=>{const{paymentMethod:e,downPaymentRatio:a,mortgageAmount:l,paymentAmount:t}=H.value.orderCarCustomerDTO;return"Mortgage"==e&&null===a?"请选择首付比例":"Mortgage"!=e||l?"Mortgage"!=e||t?void 0:"请输入首付金额":"请输入按揭金额"})();if(e)return void(new Y).showToast(e);(new Y).showLoading("提交中"),await G().put("/product/order/car/custom/reserve",{...H.value,contractAnnex:null==(t=H.value.contractAnnex)?void 0:t.map((e=>e.attachmentId))}).then((()=>{r()}))}(new Y).showLoading("提交中"),uni.$u.http.post("/product/carSalesAudit/taskTurnover",o).then((()=>{r()})).catch((e=>{l(e.message)}))}else{(new Y).showLoading("提交中");const a={id:y.value.id,remark:e},l="预定转售出"==Ce.value?"/product/order/car/custom/reserve/sold":"/product/order/car/custom/reserve/cancel";uni.$u.http.put(l,a).then((()=>{r()}))}};return(a,l)=>{const t=j(L("up-tabs"),K),T=u,h=v,k=j(L("up-icon"),U),b=$,I=_,A=F,w=j(L("u-modal"),E),P=j(L("up-modal"),E),S=V("permissionBtn");return o(),r(T,{class:"page pend-page sells-detail"},{default:n((()=>{var u,v;return[f(g).needShowQw()?i("",!0):(o(),r(J,{key:0,title:"销售详情"})),s(le,{detailObj:f(H),isSell:1},null,8,["detailObj"]),f(y).id?(o(),r(t,{key:1,list:f(se),lineColor:"#3C73FF",activeStyle:{color:"#20283D",fontSize:"32rpx"},inactiveStyle:{color:"#999",fontSize:"32rpx"},current:f(de),onClick:he,scrollable:!1},null,8,["list","current"])):i("",!0),s(T,{class:O(["tab-content content",{padding:"track"==f(ie)}])},{default:n((()=>{var t,u,v;return["detail"==f(ie)?(o(),d(p,{key:0},[s(ue,{infoData:f(H),isSell:!0},null,8,["infoData"]),f(y).taskDefinitionKey===f(X)["金融专员审核"]&&"Mortgage"==(null==(u=null==(t=f(H))?void 0:t.orderCarCustomerDTO)?void 0:u.paymentMethod)?(o(),d(p,{key:0},[s(T,{class:"section-title"},{default:n((()=>[c("按揭信息")])),_:1}),1==f(y).status?(o(),r(T,{key:0,class:"form-box"},{default:n((()=>[s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("首付比例")])),_:1}),c(" "+m(f(Ae)),1)])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("按揭期数")])),_:1}),c(" "+m(f(we)||"-"),1)])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("按揭金额")])),_:1}),c(" "+m(f(H).orderCarCustomerDTO.mortgageAmount)+"元 ",1)])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("首付金额")])),_:1}),c(" "+m(f(H).orderCarCustomerDTO.paymentAmount)+"元 ",1)])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("月供")])),_:1}),c(" "+m(("formatShowPrice"in a?a.formatShowPrice:f(e))(f(H).orderCarCustomerDTO.monthlyPaymentAmount,"元")),1)])),_:1})])),_:1})):(o(),r(T,{key:1,class:"form-box write"},{default:n((()=>[s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[s(h,null,{default:n((()=>[c("*")])),_:1}),c("首付比例")])),_:1}),s(T,{class:"f-b-c",onClick:l[0]||(l[0]=e=>Me("首付比例",f(De),f(H).orderCarCustomerDTO.downPaymentRatio,"orderCarCustomerDTO","downPaymentRatio"))},{default:n((()=>[s(h,{class:O({placeholder:"请选择"==f(Ae)})},{default:n((()=>[c(m(f(Ae)),1)])),_:1},8,["class"]),s(k,{name:"arrow-right"})])),_:1})])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("按揭期数")])),_:1}),s(T,{class:"f-b-c",onClick:l[1]||(l[1]=e=>Me("按揭期数",f(ye),f(H).orderCarCustomerDTO.mortgageNumber,"orderCarCustomerDTO","mortgageNumber"))},{default:n((()=>[s(h,{class:O({placeholder:"请选择"==f(we)})},{default:n((()=>[c(m(f(we)),1)])),_:1},8,["class"]),s(k,{name:"arrow-right"})])),_:1})])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[s(h,null,{default:n((()=>[c("*")])),_:1}),c("按揭金额")])),_:1}),s(b,{modelValue:f(H).orderCarCustomerDTO.mortgageAmount,"onUpdate:modelValue":l[2]||(l[2]=e=>f(H).orderCarCustomerDTO.mortgageAmount=e),type:"number",placeholder:"请输入",maxlength:"7",onInput:l[3]||(l[3]=e=>Se(e.detail.value,"orderCarCustomerDTO","mortgageAmount","yuan"))},null,8,["modelValue"]),c(" 元 ")])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[s(h,null,{default:n((()=>[c("*")])),_:1}),c("首付金额")])),_:1}),s(b,{modelValue:f(H).orderCarCustomerDTO.paymentAmount,"onUpdate:modelValue":l[4]||(l[4]=e=>f(H).orderCarCustomerDTO.paymentAmount=e),type:"number",placeholder:"请输入",maxlength:"7",onInput:l[5]||(l[5]=e=>Se(e.detail.value,"orderCarCustomerDTO","paymentAmount","yuan")),onBlur:Re},null,8,["modelValue"]),c(" 元 ")])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("月供")])),_:1}),s(b,{modelValue:f(H).orderCarCustomerDTO.monthlyPaymentAmount,"onUpdate:modelValue":l[6]||(l[6]=e=>f(H).orderCarCustomerDTO.monthlyPaymentAmount=e),type:"digit",placeholder:"请输入",maxlength:"10",onInput:l[7]||(l[7]=e=>Se(e.detail.value,"orderCarCustomerDTO","monthlyPaymentAmount","yuanFloat"))},null,8,["modelValue"]),c(" 元 ")])),_:1})])),_:1}))],64)):i("",!0),f(y).taskDefinitionKey===f(X)["金融专员审核"]?(o(),d(p,{key:1},[s(T,{class:"section-title"},{default:n((()=>[c("衍生收入")])),_:1}),1==f(y).status?(o(),r(T,{key:0,class:"form-box"},{default:n((()=>[s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("金融贷款收入")])),_:1}),c(" "+m(f(H).orderCarCustomerDTO.financialLoanIncome||0)+"元 ",1)])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("汽车精品收入")])),_:1}),c(" "+m(f(H).orderCarCustomerDTO.boutiqueIncome||0)+"元 ",1)])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("保险增值收入")])),_:1}),c(" "+m(f(H).orderCarCustomerDTO.insuranceAppreciationIncome||0)+"元 ",1)])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("其他收入")])),_:1}),c(" "+m(f(H).orderCarCustomerDTO.otherIncome||0)+"元 ",1)])),_:1})])),_:1})):(o(),r(T,{key:1,class:"form-box write"},{default:n((()=>[s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("金融贷款收入")])),_:1}),s(b,{modelValue:f(H).orderCarCustomerDTO.financialLoanIncome,"onUpdate:modelValue":l[8]||(l[8]=e=>f(H).orderCarCustomerDTO.financialLoanIncome=e),type:"number",placeholder:"请输入",maxlength:"7",onInput:l[9]||(l[9]=e=>Se(e.detail.value,"orderCarCustomerDTO","financialLoanIncome","yuan"))},null,8,["modelValue"]),c(" 元 ")])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("汽车精品收入")])),_:1}),s(b,{modelValue:f(H).orderCarCustomerDTO.boutiqueIncome,"onUpdate:modelValue":l[10]||(l[10]=e=>f(H).orderCarCustomerDTO.boutiqueIncome=e),type:"number",placeholder:"请输入",maxlength:"7",onInput:l[11]||(l[11]=e=>Se(e.detail.value,"orderCarCustomerDTO","boutiqueIncome","yuan"))},null,8,["modelValue"]),c(" 元 ")])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("保险增值收入")])),_:1}),s(b,{modelValue:f(H).orderCarCustomerDTO.insuranceAppreciationIncome,"onUpdate:modelValue":l[12]||(l[12]=e=>f(H).orderCarCustomerDTO.insuranceAppreciationIncome=e),type:"number",placeholder:"请输入",maxlength:"7",onInput:l[13]||(l[13]=e=>Se(e.detail.value,"orderCarCustomerDTO","insuranceAppreciationIncome","yuan"))},null,8,["modelValue"]),c(" 元 ")])),_:1}),s(T,{class:"form-item"},{default:n((()=>[s(T,null,{default:n((()=>[c("其他收入")])),_:1}),s(b,{modelValue:f(H).orderCarCustomerDTO.otherIncome,"onUpdate:modelValue":l[14]||(l[14]=e=>f(H).orderCarCustomerDTO.otherIncome=e),type:"number",placeholder:"请输入",maxlength:"7",onInput:l[15]||(l[15]=e=>Se(e.detail.value,"orderCarCustomerDTO","otherIncome","yuan"))},null,8,["modelValue"]),c(" 元 ")])),_:1})])),_:1}))],64)):i("",!0),(null==(v=f(ce))?void 0:v.length)?(o(),d(p,{key:2},[s(T,{class:"section-title"},{default:n((()=>[c("审批流程")])),_:1}),s(T,{class:"pend-list"},{default:n((()=>[(o(!0),d(p,null,C(f(ce),((e,a)=>(o(),r(T,{class:"pend-item",key:a},{default:n((()=>[e.avatar?(o(),r(I,{key:0,src:e.avatar},null,8,["src"])):(o(),r(I,{key:1,src:z})),s(T,{class:"item-info"},{default:n((()=>[s(T,null,{default:n((()=>[s(T,null,{default:n((()=>[c(m(e.name),1)])),_:2},1024),s(T,null,{default:n((()=>[c(m(e.createTime),1)])),_:2},1024)])),_:2},1024),s(T,{class:"tip"},{default:n((()=>[c(m(e.taskDefinitionKey===f(X)["流程开始"]?"发起审批":1==e.status?"已同意":2==e.status?"已拒绝":"已处理"),1)])),_:2},1024),e.auditOpinion?(o(),r(T,{key:0,class:"tip"},{default:n((()=>[c("拒绝原因："+m(e.auditOpinion),1)])),_:2},1024)):i("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})],64)):i("",!0)],64)):i("",!0),"track"==f(ie)?(o(),r(ee,{key:1,infoData:f(H),pageType:"sell"},null,8,["infoData"])):i("",!0),"record"==f(ie)?(o(),r(ne,{key:2,infoData:f(ae),pageType:"sell"},null,8,["infoData"])):i("",!0)]})),_:1},8,["class"]),f(y).primaryKey&&1!=f(y).status?(o(),r(T,{key:2,class:"bottom-btn"},{default:n((()=>[f(y).taskDefinitionKey!==f(X)["金融专员审核"]?(o(),r(A,{key:0,onClick:l[16]||(l[16]=e=>Le("拒绝原因",""))},{default:n((()=>[c(" 拒绝 ")])),_:1})):i("",!0),f(y).taskDefinitionKey===f(X)["车辆售出审批"]?(o(),r(A,{key:1,class:"save-btn",onClick:Oe},{default:n((()=>[c(" 同意 ")])),_:1})):(o(),r(A,{key:2,class:"save-btn",onClick:l[17]||(l[17]=e=>Ee("",1))},{default:n((()=>[c("同意")])),_:1}))])),_:1})):i("",!0),f(g).needShowQw()||f(y).primaryKey||!(f(Te)||f(me).includes("sells:cancelOrder")&&f(ge)||f(me).some((e=>["sells:reserve:sold","sells:reserve:cancel"].includes(e)))&&"Reserved"==(null==(v=null==(u=f(H))?void 0:u.orderCarCustomerDTO)?void 0:v.orderStatus))?i("",!0):(o(),r(T,{key:3,class:"btns"},{default:n((()=>{var e,t;return[f(Te)?(o(),r(T,{key:0,onClick:l[18]||(l[18]=e=>("toPage"in a?a.toPage:f(D))(`/pages/sells/replyReceipt?id=${f(H).id}`))},{default:n((()=>[s(I,{src:"./static/carManage/car_icon_cs.png"}),c(" 添加收款 ")])),_:1})):i("",!0),f(ge)?B((o(),r(T,{key:1,onClick:l[19]||(l[19]=e=>fe.value=!0)},{default:n((()=>[s(I,{src:oe}),c(" 取消订单 ")])),_:1})),[[S,["sells:cancelOrder"]]]):i("",!0),"Reserved"==(null==(t=null==(e=f(H))?void 0:e.orderCarCustomerDTO)?void 0:t.orderStatus)?(o(),d(p,{key:2},[B((o(),r(T,{onClick:Ue},{default:n((()=>[s(I,{src:"./static/carManage/car_icon_cgxx.png"}),c(" 预定转售出 ")])),_:1})),[[S,["sells:reserve:sold"]]]),B((o(),r(T,{onClick:l[20]||(l[20]=e=>Le("取消预定","请输入取消预订原因"))},{default:n((()=>[s(I,{src:oe}),c(" 取消预定 ")])),_:1})),[[S,["sells:reserve:cancel"]]])],64)):i("",!0)]})),_:1})),s(w,{show:f(fe),showCancelButton:!0,width:"500rpx",title:"提示",content:"确定执行取消操作？",onCancel:l[21]||(l[21]=e=>fe.value=!1),onConfirm:Ke},null,8,["show"]),s(te,{ref_key:"refuseRef",ref:ve,title:f(Ce),refuseTitlePlace:f(_e),onConfirm:l[22]||(l[22]=e=>Ee(e,0))},null,8,["title","refuseTitlePlace"]),s(P,{show:f(pe),width:"500rpx",title:"提示",content:"是否需要总经理审批？",cancelText:"是",confirmText:"否",showCancelButton:!0,cancelColor:"#4E5969",confirmColor:"#ff5719",onConfirm:l[23]||(l[23]=e=>Ee("",2)),onCancel:l[24]||(l[24]=e=>Ee("",1))},null,8,["show"])]})),_:1})}}}),[["__scopeId","data-v-aea71ee3"]]);export{se as default};
