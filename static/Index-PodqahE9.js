import{l as Le,r as p,d as Ve,b as De,ah as v,ap as Pe,m as d,p as i,q as a,U as l,O as s,F as B,a7 as E,M as g,a8 as Re,S as h,P as A,u,T as c,I as X,R as Y,aF as ze,aG as Ie}from"./vue-C87Wc4A0.js";import{_ as T}from"./empty-BiNgvBdS.js";import{u as qe}from"./useTable-CVQ-UVVt.js";import{P as ee,q as k,v as We,w as N,x as Me,F as Ue,y as Fe,k as $,z as He,A as Be,_ as Ee}from"./index-c78MVIZI.js";import{F as Ye}from"./Index-BU8kA-XB.js";import{m as $e}from"./moment-C9JMj0Wb.js";import{a as Ke}from"./index-Cap7k8T_.js";import{E as Oe}from"./element-CD5rsoqi.js";import"//at.alicdn.com/t/c/font_4557022_0o7l3b0t8egq.js";import"./vxe-sm_XFqm0.js";import"./LIKU-logo-CHqxCLOK.js";function Ge(b){return ee({url:"/webhook/all?id="+b,method:"get"})}function Ze(b){return ee({url:"/webhook/retrigger?id="+b,method:"post"})}const m=b=>(ze("data-v-eebd469e"),b=b(),Ie(),b),je={class:"order base-box p-36 ml-40 mr-40 mt-20"},Je={class:"top-search"},Qe={class:"table-wrapper"},Xe=m(()=>a("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[a("span",null,[a("img",{src:T,alt:""})]),a("span",{class:"custom-empty-text"},"暂无数据")],-1)),et={key:0},tt={key:1},at={key:0},lt=["onClick"],ot={class:"pager-wrapper mt-32 flex justify-end"},st={key:0,class:"base-box detail-box"},rt=m(()=>a("div",{class:"order-title mb-30"},"订单信息",-1)),nt={class:"mb-24 flex"},dt=m(()=>a("div",{class:"order-text"},"订单金额",-1)),ct={class:"order-value"},ut={class:"mb-24 flex"},it=m(()=>a("div",{class:"order-text"},"下单用户",-1)),pt={class:"order-value"},mt={class:"mb-24 flex"},_t=m(()=>a("div",{class:"order-text"},"商户订单号",-1)),vt={class:"order-value"},ht={class:"mb-24 flex"},ft=m(()=>a("div",{class:"order-text"},"支付方式",-1)),bt={class:"order-value"},yt={class:"mb-24 flex"},wt=m(()=>a("div",{class:"order-text"},"下单时间（香港）",-1)),gt={class:"order-value"},kt=m(()=>a("div",{class:"order-line mt-42 mb-40"},null,-1)),xt=m(()=>a("div",{class:"order-title mb-30"},"商品信息",-1)),Ct=m(()=>a("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[a("span",null,[a("img",{src:T,alt:""})]),a("span",{class:"custom-empty-text"},"暂无数据")],-1)),St={key:0,class:"mt-30"},At=m(()=>a("div",{class:"order-title mb-30"},"退款信息",-1)),Nt=m(()=>a("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[a("span",null,[a("img",{src:T,alt:""})]),a("span",{class:"custom-empty-text"},"暂无数据")],-1)),Tt={key:1,class:"mt-30"},Lt=m(()=>a("div",{class:"order-title mb-30"},"拒付信息",-1)),Vt=m(()=>a("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[a("span",null,[a("img",{src:T,alt:""})]),a("span",{class:"custom-empty-text"},"暂无数据")],-1)),Dt=m(()=>a("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[a("span",null,[a("img",{src:T,alt:""})]),a("span",{class:"custom-empty-text"},"暂无数据")],-1)),Pt={key:0,class:"webhook-state-success"},Rt={key:1,class:"webhook-state-fail"},zt={key:2,class:"webhook-state-inqueue"},It=["onClick"],qt=["onClick"],Wt=["onClick"],Mt={key:1,class:"base-box detail-box"},Ut={key:0},Ft={key:1},Ht={class:"flex-center w-full mt-30 http-detail-return-btn"},Bt=Le({__name:"Index",setup(b){const _=p({}),K=p([]),L=p([]),V=p([]),te=p([]),y=p(!1),O=p([]),q=p([]),D=p(null),P=p(!0),R=p({}),W=p("request"),G=[{label:"等待支付",value:"10"},{label:"支付成功",value:"20"},{label:"支付失败",value:"30"},{label:"取消支付",value:"40"},{label:"全额退款",value:"60"},{label:"部分退款",value:"61"}],z=p(!1),f=p({}),M=p("orderInfo"),{paginationData:x,handleCurrentChange:ae,handleSizeChange:le,tableData:oe,handSearch:se,queryTableData:Et,loadingRef:Z}=qe({searchData:{},url:"/traderecord/list",method:"post"}),re=()=>{_.value={}};function U(){const t=[];for(const o in _.value){let n=_.value[o];Array.isArray(n)&&(n=n.map(w=>$e.utc(new Date(w)).format("YYYY-MM-DD HH:mm:ss")).toString()),n&&t.push({columnName:o,value:n})}se(t)}const ne=(t,o)=>{t.paneName==="webhookList"&&!D.value&&de()},de=async()=>{Ge(f.value.id).then(t=>{D.value=t.data}).catch(t=>{console.error(t)})},ce=[{text:"Last week",value:()=>{const t=new Date,o=new Date;return o.setTime(o.getTime()-3600*1e3*24*7),[o,t]}},{text:"Last month",value:()=>{const t=new Date,o=new Date;return o.setTime(o.getTime()-3600*1e3*24*30),[o,t]}},{text:"Last 3 months",value:()=>{const t=new Date,o=new Date;return o.setTime(o.getTime()-3600*1e3*24*90),[o,t]}}],ue=async()=>{try{const t=await Me();O.value=t.data.map(o=>({name:o.code+"通道",value:o.code}))}catch(t){console.log(t,"e")}},ie=async()=>{try{const t=await Ue();t.data&&t.data.length&&(q.value=t.data)}catch(t){console.log(t,"e")}},pe=t=>{var o;return(o=G.filter(n=>n.value===t)[0])==null?void 0:o.label},j=t=>{let o="";return q.value.forEach(n=>{n.code.toUpperCase()===t.toUpperCase()&&(o=n.name)}),o},J=t=>{if(t==="10")return"order-wait";if(t==="20")return"order-success";if(t==="30")return"order-fail";if(t==="40")return"order-cancel";if(t==="60"||t==="61")return"order-refund"},me=t=>{const o={searchItems:[{columnName:"luTradeRecord",value:t}]};y.value=!0,Fe(o).then(n=>{K.value=$(n.data.rows)||[],y.value=!1}).catch(n=>{y.value=!1,console.log(n,"getProductApi")})},_e={10:"待退款",20:"退款成功",30:"退款失败",40:"取消退款"},ve={100:"收到预拒付",110:"预拒付已处理",200:"收到拒付",210:"拒付已回复",220:"已驳回",230:"已接受拒付",240:"争议败诉",250:"争议胜诉",300:"收到调单",310:"调单已回复",400:"收到仲裁",500:"仲裁已提交到卡组织"},he=t=>{const o={searchItems:[{columnName:"luTradeRecord",value:t}]};y.value=!0,He(o).then(n=>{L.value=$(n.data.rows)||[],console.log(n,"getRefundList")}).catch(n=>{console.log(n,"getProductApi")})},fe=t=>{const o={searchItems:[{columnName:"luTradeRecord",value:t}]};y.value=!0,Be(o).then(n=>{V.value=$(n.data.rows)||[],console.log(n,"getRefuseList")}).catch(n=>{console.log(n,"getProductApi")})},be=t=>{me(t.id),he(t.id),fe(t.id),f.value={...t},z.value=!0},ye=async t=>{Ze(t).then(o=>{Oe.success("触发成功")}).catch(o=>{console.error(o)})},we=t=>{W.value="request",R.value=t,P.value=!1},ge=t=>{W.value="response",R.value=t,P.value=!1},ke=t=>{P.value=!0},xe=async()=>{try{const t=await Ke({paging:{pageNumber:1,pageSize:200}});te.value=t.data.items}catch{}};return Ve(()=>{U(),ue(),ie(),xe()}),De(z,t=>{t||(M.value="orderInfo",D.value=null,V.value=[],L.value=[])}),(t,o)=>{const n=v("el-option"),I=v("el-select"),w=v("el-form-item"),Ce=v("el-date-picker"),Se=v("el-input"),F=v("el-button"),Ae=v("el-form"),r=v("el-table-column"),C=v("el-table"),Ne=v("el-pagination"),Q=v("el-tab-pane"),Te=v("el-tabs"),S=Pe("loading");return d(),i("div",je,[a("div",Je,[l(Ae,{inline:!0,model:_.value,class:"demo-form-inline"},{default:s(()=>[l(w,null,{default:s(()=>[l(I,{modelValue:_.value.tradeState,"onUpdate:modelValue":o[0]||(o[0]=e=>_.value.tradeState=e),placeholder:"全部订单状态",clearable:""},{default:s(()=>[(d(),i(B,null,E(G,e=>l(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(w,null,{default:s(()=>[l(I,{modelValue:_.value.payWay,"onUpdate:modelValue":o[1]||(o[1]=e=>_.value.payWay=e),placeholder:"全部支付方式",clearable:""},{default:s(()=>[(d(!0),i(B,null,E(q.value,e=>(d(),g(n,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(w,null,{default:s(()=>[l(I,{modelValue:_.value.channelName,"onUpdate:modelValue":o[2]||(o[2]=e=>_.value.channelName=e),placeholder:"全部支付通道",clearable:""},{default:s(()=>[(d(!0),i(B,null,E(O.value,e=>(d(),g(n,{key:e.value,label:e.name,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(w,null,{default:s(()=>[l(Ce,{modelValue:_.value.createdAt,"onUpdate:modelValue":o[3]||(o[3]=e=>_.value.createdAt=e),type:"daterange","unlink-panels":"","range-separator":"To","start-placeholder":"开始时间","end-placeholder":"结束时间",shortcuts:ce,size:"default"},null,8,["modelValue"])]),_:1}),l(w,null,{default:s(()=>[l(Se,{modelValue:_.value.orderNo,"onUpdate:modelValue":o[4]||(o[4]=e=>_.value.orderNo=e),placeholder:"请输入订单号搜寻",onKeyup:Re(U,["enter"]),clearable:""},null,8,["modelValue"])]),_:1}),l(w,null,{default:s(()=>[l(F,{onClick:re},{default:s(()=>[h("重置")]),_:1}),l(F,{type:"primary",onClick:U},{default:s(()=>[h("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),a("div",Qe,[A((d(),g(C,{data:u(oe),style:{width:"100%"}},{empty:s(()=>[Xe]),default:s(()=>[l(r,{prop:"merchant~merchantName",label:"站点名称","min-width":"150"}),l(r,{prop:"partner~partnerName",label:"合作伙伴名称","min-width":"140"}),l(r,{prop:"partnerRate",label:"合作伙伴佣金比例","min-width":"140"},{default:s(e=>[e.row.partnerRate==="0"?(d(),i("div",et)):(d(),i("div",tt,c(parseFloat(e.row.partnerRate)/10)+"%",1))]),_:1}),l(r,{prop:"orderNo",label:"订单号","min-width":"280"}),l(r,{prop:"bizNo",label:"商户订单号","min-width":"260"}),l(r,{prop:"tradeState",label:"订单状态",width:"180"},{default:s(e=>[a("div",{class:X(J(e.row.tradeState))},c(pe(e.row.tradeState)),3)]),_:1}),l(r,{prop:"price",label:"订单金额",width:"180"},{default:s(e=>[u(k)(e.row.price,e.row.currencyMultiply)?(d(),i("span",at,c(u(k)(e.row.price,e.row.currencyMultiply)+" "+e.row.currency),1)):Y("",!0)]),_:1}),l(r,{prop:"payWay",label:"支付方式",width:"180"},{default:s(e=>[h(c(j(e.row.payWay)),1)]),_:1}),l(r,{prop:"channelName",label:"通道名称",width:"100"}),l(r,{prop:"accountName",label:"下单用户",width:"220"}),l(r,{prop:"createdAt",label:"下单时间(当地)","min-width":"240"},{default:s(e=>[a("div",null,c(u(We)(e.row.createdAt,e.row.timezone))+" ("+c(e.row.timezone)+")",1)]),_:1}),l(r,{prop:"createdAt",label:"下单时间(香港)",width:"180"},{default:s(e=>[a("div",null,c(u(N)(e.row.createdAt)),1)]),_:1}),l(r,{prop:"action",label:"操作",fixed:"right"},{default:s(e=>[a("div",{class:"action-btn cursor-pointer",onClick:H=>be(e.row)},"查看详情",8,lt)]),_:1})]),_:1},8,["data"])),[[S,u(Z)]])]),a("div",ot,[l(Ne,{background:"",layout:u(x).layout,"page-sizes":u(x).pageSizes,total:u(x).total,"page-size":u(x).pageSize,currentPage:u(x).currentPage,onSizeChange:u(le),onCurrentChange:u(ae)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])]),l(Ye,{modelValue:z.value,"onUpdate:modelValue":o[6]||(o[6]=e=>z.value=e)},{default:s(()=>[P.value?(d(),i("div",st,[l(Te,{modelValue:M.value,"onUpdate:modelValue":o[5]||(o[5]=e=>M.value=e),class:"modal-tabs",onTabClick:ne},{default:s(()=>[l(Q,{label:"订单详情",name:"orderInfo"},{default:s(()=>[rt,a("div",nt,[dt,a("div",ct,c(u(k)(f.value.price,f.value.currencyMultiply)+" "+f.value.currency),1)]),a("div",ut,[it,a("div",pt,c(f.value.accountName),1)]),a("div",mt,[_t,a("div",vt,c(f.value.bizNo),1)]),a("div",ht,[ft,a("div",bt,c(j(f.value.payWay)),1)]),a("div",yt,[wt,a("div",gt,c(u(N)(f.value.createdAt)),1)]),kt,xt,A((d(),g(C,{data:K.value,style:{width:"100%"}},{empty:s(()=>[Ct]),default:s(()=>[l(r,{prop:"name",label:"商品名称"}),l(r,{prop:"quantity",label:"商品数量"}),l(r,{prop:"price",label:"商品价格"},{default:s(e=>[h(c(u(k)(e.row.price,e.row.currencyMultiply)+" "+e.row.currency),1)]),_:1})]),_:1},8,["data"])),[[S,y.value]]),L.value.length?(d(),i("div",St,[At,A((d(),g(C,{data:L.value,style:{width:"100%"}},{empty:s(()=>[Nt]),default:s(()=>[l(r,{prop:"price",label:"退款金额"},{default:s(e=>[h(c(u(k)(e.row.price,e.row.currencyMultiply)+" "+e.row.currency),1)]),_:1}),l(r,{prop:"refundState",label:"退款状态"},{default:s(e=>[a("div",{class:X(J(e.row.refundState))},c(_e[e.row.refundState]),3)]),_:1}),l(r,{prop:"refundNo",label:"退款单号"}),l(r,{prop:"updatedAt",label:"退款时间"},{default:s(e=>[h(c(u(N)(e.row.updatedAt)),1)]),_:1})]),_:1},8,["data"])),[[S,y.value]])])):Y("",!0),V.value.length?(d(),i("div",Tt,[Lt,A((d(),g(C,{data:V.value,style:{width:"100%"}},{empty:s(()=>[Vt]),default:s(()=>[l(r,{prop:"amount",label:"拒付金额"},{default:s(e=>[h(c(u(k)(e.row.amount,e.row.currencyMultiply)+" "+e.row.currency),1)]),_:1}),l(r,{prop:"disputeState",label:"拒付状态"},{default:s(e=>[h(c(ve[e.row.disputeState]),1)]),_:1}),l(r,{prop:"disputeNo",label:"拒付编码"}),l(r,{prop:"cardScheme",label:"卡组织"}),l(r,{prop:"createdAt",label:"发起时间"},{default:s(e=>[h(c(u(N)(e.row.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[S,y.value]])])):Y("",!0)]),_:1}),l(Q,{label:"Webhooks",name:"webhookList"},{default:s(()=>[A((d(),g(C,{data:D.value,style:{width:"100%"}},{empty:s(()=>[Dt]),default:s(()=>[l(r,{prop:"eventType",label:"事件类型",width:"200"}),l(r,{prop:"latestPushAt",label:"触发时间（香港时间）",width:"200"},{default:s(e=>[h(c(u(N)(e.row.latestPushAt)),1)]),_:1}),l(r,{prop:"state",label:"状态",width:"180"},{default:s(e=>[e.row.state==="已完成"?(d(),i("div",Pt,"成功")):e.row.state==="處理失敗"?(d(),i("div",Rt," 失败 ("+c(e.row.retryTimes)+"次) ",1)):(d(),i("div",zt,"队列中"))]),_:1}),l(r,{prop:"action",label:"操作",fixed:"right",width:"280"},{default:s(e=>[a("a",{class:"action-btn cursor-pointer mr-20",onClick:H=>ye(e.row.id)},"重新触发",8,It),a("a",{class:"action-btn cursor-pointer mr-20",onClick:H=>we(e.row)},"查看报文",8,qt),a("a",{class:"action-btn cursor-pointer",onClick:H=>ge(e.row)},"查看HTTP回应",8,Wt)]),_:1})]),_:1},8,["data"])),[[S,u(Z)]])]),_:1})]),_:1},8,["modelValue"])])):(d(),i("div",Mt,[W.value==="request"?(d(),i("div",Ut,c(R.value.requestPayload),1)):(d(),i("div",Ft,c(R.value.responsePayload),1)),a("div",Ht,[l(F,{onClick:ke},{default:s(()=>[h("返回")]),_:1})])]))]),_:1},8,["modelValue"])])}}}),ta=Ee(Bt,[["__scopeId","data-v-eebd469e"]]);export{ta as default};
