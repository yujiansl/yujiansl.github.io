import{u as j}from"./useTable-Br0VH9YA.js";import{c as E}from"./index-B3sZ9j6O.js";import{c as G,h as J}from"./commonFn-DSVr4W-5.js";import{e as K,_ as Z}from"./index-bEAPwbJM.js";import{a as Q}from"./index-COelV0l7.js";import{l as X,r as g,d as $,ah as s,ap as ee,m as i,p as b,q as h,U as l,O as r,F as w,a7 as S,M as x,S as p,P as ae,u,I as te,T as _}from"./vue-BtEXIrqH.js";import"./element-BbMnn7tA.js";import"//at.alicdn.com/t/c/font_4557022_266y8yxi6v9.js";import"./vxe-EK889JN8.js";const le={class:"order base-box p-36 ml-40 mr-40 mt-20"},re={class:"top-search"},oe={class:"table-wrapper"},ne={class:"pager-wrapper mt-32 flex justify-end"},se=X({__name:"Index",setup(ue){const v=JSON.parse(K("user-info")||"{}"),n=g({luAgent:v.agent,tradeState:"",payWay:"",merchantId:"",bizNo:""}),D=g([]),y=g([]),C=[{label:"待支付",value:"10"},{label:"支付成功",value:"20"},{label:"支付失败",value:"30"},{label:"取消支付",value:"40"},{label:"全额退款",value:"60"},{label:"部分退款",value:"61"}];g("first");const{paginationData:m,handleCurrentChange:z,handSearch:T,tableData:N,queryTableData:I,loadingRef:A}=j({searchData:n,url:"/traderecord/list",method:"post"}),L=()=>{n.value={luAgent:v.agent}};function M(){const t=[];for(const a in n.value){let o=n.value[a];Array.isArray(o)&&(o=o.map(d=>J.utc(new Date(d)).format("YYYY-MM-DD HH:mm:ss")).toString()),o&&t.push({columnName:a,value:o})}T(t)}const P=[{text:"Last week",value:()=>{const t=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*7),[a,t]}},{text:"Last month",value:()=>{const t=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*30),[a,t]}},{text:"Last 3 months",value:()=>{const t=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*90),[a,t]}}],U=()=>{const t={agentId:v.agent,pageNo:1,pageSize:15},a=new URLSearchParams(Object.entries(t)).toString();Q(a).then(o=>{o.data.results&&(D.value=o.data.results)}).catch(o=>{console.error(o)})},W=async()=>{try{const t=await E();t.data&&t.data.length&&(y.value=t.data)}catch(t){console.log(t,"e")}},V=t=>{if(t==="10")return{class:"order-wait",text:"等待支付"};if(t==="20")return{class:"order-success",text:"支付成功"};if(t==="30")return{class:"order-fail",text:"支付失败"};if(t==="40")return{class:"order-cancel",text:"取消支付"};if(t==="60")return{class:"order-refund",text:"全额退款"};if(t==="61")return{class:"order-partial-refund",text:"部分退款"}},Y=t=>{let a="";return y.value.forEach(o=>{o.code.toUpperCase()===t.toUpperCase()&&(a=o.name)}),a};return $(()=>{I(),U(),W()}),(t,a)=>{const o=s("el-option"),f=s("el-select"),d=s("el-form-item"),B=s("el-date-picker"),q=s("el-input"),k=s("el-button"),O=s("el-form"),c=s("el-table-column"),F=s("el-table"),H=s("el-pagination"),R=ee("loading");return i(),b("div",le,[h("div",re,[l(O,{inline:!0,model:n.value,class:"demo-form-inline"},{default:r(()=>[l(d,null,{default:r(()=>[l(f,{modelValue:n.value.merchantId,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value.merchantId=e),placeholder:"全部站点",clearable:""},{default:r(()=>[(i(!0),b(w,null,S(D.value,e=>(i(),x(o,{key:e.id,label:e.merchant,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:r(()=>[l(f,{modelValue:n.value.tradeState,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value.tradeState=e),placeholder:"全部订单状态",clearable:""},{default:r(()=>[(i(),b(w,null,S(C,e=>l(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:r(()=>[l(f,{modelValue:n.value.payWay,"onUpdate:modelValue":a[2]||(a[2]=e=>n.value.payWay=e),placeholder:"全部支付方式",clearable:""},{default:r(()=>[(i(!0),b(w,null,S(y.value,e=>(i(),x(o,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:r(()=>[l(B,{modelValue:n.value.createdAt,"onUpdate:modelValue":a[3]||(a[3]=e=>n.value.createdAt=e),type:"daterange","unlink-panels":"","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD",shortcuts:P,size:"default"},null,8,["modelValue"])]),_:1}),l(d,null,{default:r(()=>[l(q,{modelValue:n.value.bizNo,"onUpdate:modelValue":a[4]||(a[4]=e=>n.value.bizNo=e),placeholder:"请输入商户订单号",clearable:""},null,8,["modelValue"])]),_:1}),l(d,null,{default:r(()=>[l(k,{type:"primary",onClick:L},{default:r(()=>[p("重置")]),_:1}),l(k,{type:"primary",onClick:M},{default:r(()=>[p("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),h("div",oe,[ae((i(),x(F,{data:u(N),style:{width:"100%"}},{default:r(()=>[l(c,{prop:"merchant~merchantName",label:"站点名称",width:"120"}),l(c,{prop:"bizNo",label:"商户订单号",width:"240"}),l(c,{prop:"tradeState",label:"订单状态",width:"120"},{default:r(e=>[h("div",{class:te(V(e.row.tradeState).class)},_(V(e.row.tradeState).text),3)]),_:1}),l(c,{prop:"price",label:"订单金额",width:"120"},{default:r(e=>[p(_(e.row.price+" "+e.row.currency),1)]),_:1}),l(c,{prop:"agentBrokerage",label:"佣金",width:"120"},{default:r(e=>[p(_(e.row.agentBrokerage+" "+e.row.currency),1)]),_:1}),l(c,{prop:"payWay",label:"支付方式",width:"120"},{default:r(e=>[p(_(Y(e.row.payWay)),1)]),_:1}),l(c,{prop:"createdAt",label:"下单时间(香港)",width:"160"},{default:r(e=>[p(_(u(G)(e.row.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[R,u(A)]])]),h("div",ne,[l(H,{background:"",layout:u(m).layout,"page-sizes":u(m).pageSizes,total:u(m).total,"page-size":u(m).pageSize,currentPage:u(m).currentPage,onCurrentChange:u(z)},null,8,["layout","page-sizes","total","page-size","currentPage","onCurrentChange"])])])}}}),he=Z(se,[["__scopeId","data-v-53d83b18"]]);export{he as default};
