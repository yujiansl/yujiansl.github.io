import{l as le,r,Z as oe,aD as se,d as ne,ah as c,ap as re,m as d,p,P as z,q as a,T as _,U as t,O as o,F as L,a7 as q,M as A,a8 as ie,S as D,u as n,I as ue,R as k,aF as ce,aG as de}from"./vue-C87Wc4A0.js";import{_ as me}from"./empty-BiNgvBdS.js";import{u as pe}from"./useTable-CVQ-UVVt.js";import{B,q as R,x as _e,_ as ve}from"./index-c78MVIZI.js";import{g as he,a as fe}from"./index-Cap7k8T_.js";import{V as ge}from"./index-BZHf1ii5.js";import{s as be}from"./index-CKZZcXKM.js";import{n as we,E as ye}from"./element-CD5rsoqi.js";import"//at.alicdn.com/t/c/font_4557022_0o7l3b0t8egq.js";import"./vxe-sm_XFqm0.js";const v=b=>(ce("data-v-4cbfdb6e"),b=b(),de(),b),Ce={class:"top-balance base-box flex flex-wrap ml-40 mr-40 mt-20 items-center"},Ve={class:"balance-item pr-80"},Se=v(()=>a("div",{class:"item-title"},"系统未入账 (USD)",-1)),xe={class:"item-price mt-10 mb-8"},De={class:"balance-item pr-80"},Re=v(()=>a("div",{class:"item-title"},"待审核金额 (USD)",-1)),ke={class:"item-price mt-10 mb-8"},Ne={class:"balance-item"},Ie=v(()=>a("div",{class:"item-title"},"已入账未结算 (USD)",-1)),Te={class:"item-price mt-10 mb-8"},Me={class:"order base-box p-36 ml-40 mr-40 mt-20"},Pe=v(()=>a("div",{class:"title"},"结算账单记录",-1)),Fe={class:"top-search"},Ue={class:"table-wrapper"},ze=v(()=>a("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[a("span",null,[a("img",{src:me,alt:""})]),a("span",{class:"custom-empty-text"},"暂无数据")],-1)),Le={key:0},qe={key:0},Ae={class:"flex"},Be=["onClick"],Ee={class:"pager-wrapper mt-32 flex justify-between"},$e=v(()=>a("div",null,null,-1)),Ke=v(()=>a("div",{class:"delete-confirm-warning"},"确定结算账单吗？",-1)),je={class:"delete-google-otp"},Ge={class:"delete-confirm-footer"},Oe=le({__name:"Detail",setup(b){r("first");const f=r(!1),N=r(),h=r({challengeResult:""}),E=oe({challengeResult:[{required:!0,message:"请输入谷歌验证码",trigger:"blur"}]});r("");const I=r([]),T=se(),i=r({channelCode:"",processNo:"",channel:"",username:""}),w=r({}),y=r(!1),C=r(!1),$=r([]),M=r({}),K=[{label:"可结算",value:"10"},{label:"审核中",value:"20"},{label:"已结算",value:"30"}],{paginationData:g,handleCurrentChange:j,tableData:G,queryTableData:Ze,loadingRef:O,handSearch:Z}=pe({searchData:i.value,url:"/settlement/list",method:"post"});function V(){const s=[{columnName:"luPartner",value:T.params.id}];for(const l in i.value){const m=i.value[l];m&&s.push({columnName:l,value:m})}Z(s,"/settlement/list")}const H=async()=>{try{const s=await _e();$.value=s.data.map(l=>({name:l.code,value:l.code}))}catch(s){console.log(s,"e")}},J=()=>{i.value={}},Q=s=>{M.value=s,f.value=!0},W=async()=>{try{y.value=!0;const s=await he(T.params.id);w.value=s.data||{},y.value=!1}catch(s){console.log("getStaticsData",s),y.value=!1}},X=async()=>{try{const s=await fe({paging:{pageNumber:1,pageSize:200}});I.value=s.data.items}catch{}},Y=async s=>{s&&await s.validate(async l=>{if(l)try{C.value=!0;const m={challengeResult:h.value.challengeResult,settlementIds:[M.value.id]};await be(m),h.value.challengeResult="",C.value=!1,f.value=!1,ye.success("结算成功"),V()}catch{h.value.challengeResult="",C.value=!1}})};return ne(()=>{V(),X(),H(),W()}),(s,l)=>{const m=c("el-option"),P=c("el-select"),S=c("el-form-item"),ee=c("el-input"),x=c("el-button"),F=c("el-form"),u=c("el-table-column"),te=c("el-pagination"),ae=c("el-dialog"),U=re("loading");return d(),p("div",null,[z((d(),p("div",Ce,[a("div",Ve,[Se,a("div",xe,_(w.value.onAir||0),1)]),a("div",De,[Re,a("div",ke,_(w.value.approving||0),1)]),a("div",Ne,[Ie,a("div",Te,_(w.value.settled||0),1)])])),[[U,y.value]]),a("div",Me,[Pe,a("div",Fe,[t(F,{inline:!0,model:i.value,class:"demo-form-inline"},{default:o(()=>[t(S,null,{default:o(()=>[t(P,{modelValue:i.value.luVirtualMerchant,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value.luVirtualMerchant=e),placeholder:"全部站点",clearable:""},{default:o(()=>[(d(!0),p(L,null,q(I.value,e=>(d(),A(m,{key:e.virtualMerchantId,label:e.name,value:e.virtualMerchantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(S,null,{default:o(()=>[t(P,{modelValue:i.value.state,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.state=e),placeholder:"全部结算状态",clearable:""},{default:o(()=>[(d(),p(L,null,q(K,e=>t(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(S,null,{default:o(()=>[t(ee,{modelValue:i.value.settlementProcessNo,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value.settlementProcessNo=e),placeholder:"请输入结算批次号搜寻",onKeyup:ie(V,["enter"]),clearable:""},null,8,["modelValue"])]),_:1}),t(S,null,{default:o(()=>[t(x,{onClick:J},{default:o(()=>[D("重置")]),_:1}),t(x,{type:"primary",onClick:V},{default:o(()=>[D("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),a("div",Ue,[z((d(),A(n(we),{data:n(G),style:{width:"100%"}},{empty:o(()=>[ze]),default:o(()=>[t(u,{prop:"settlementProcessNo",label:"结算批次号","min-width":"200"}),t(u,{prop:"state",label:"结算状态",width:"100"},{default:o(e=>[a("div",{class:ue(n(B)(e.row.state).class)},_(n(B)(e.row.state).value),3)]),_:1}),t(u,{prop:"virtualMerchant~merchantName",label:"站点名称",width:"150"}),t(u,{prop:"merchant~merchantName",label:"商户名称",width:"150"}),t(u,{prop:"settlementTotal",label:"结算金额",width:"200"},{default:o(e=>[n(R)(e.row.settlementTotal)?(d(),p("span",Le,_(n(R)(e.row.settlementTotal)+" "+e.row.settlementCurrency),1)):k("",!0)]),_:1}),t(u,{prop:"orderTotal",label:"订单币种金额",width:"200"},{default:o(e=>[n(R)(e.row.orderTotal,e.row.orderCurrencyMultiply)?(d(),p("span",qe,_(n(R)(e.row.orderTotal,e.row.orderCurrencyMultiply)+" "+e.row.orderCurrency),1)):k("",!0)]),_:1}),t(u,{prop:"averageExchangeRate",label:"汇率",width:"200"},{default:o(e=>[a("div",null,_((+e.row.averageExchangeRate).toFixed(6)),1)]),_:1}),t(u,{prop:"orderCount",label:"订单笔数",width:"100"}),t(u,{prop:"orderCount",label:"账单时间",width:"100"}),t(u,{prop:"action",label:"操作",fixed:"right",width:"80"},{default:o(e=>[a("div",Ae,[e.row.state==="10"?(d(),p("div",{key:0,class:"action-btn cursor-pointer",onClick:He=>Q(e.row)}," 结算 ",8,Be)):k("",!0)])]),_:1})]),_:1},8,["data"])),[[U,n(O)]])]),a("div",Ee,[$e,t(te,{background:"",layout:n(g).layout,"page-sizes":n(g).pageSizes,total:n(g).total,"page-size":n(g).pageSize,currentPage:n(g).currentPage,onCurrentChange:n(j)},null,8,["layout","page-sizes","total","page-size","currentPage","onCurrentChange"])]),t(ae,{modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=e=>f.value=e),center:"",style:{width:"480px"}},{footer:o(()=>[a("div",Ge,[t(x,{type:"primary",loading:C.value,onClick:l[4]||(l[4]=e=>Y(N.value))},{default:o(()=>[D(" 确定结算 ")]),_:1},8,["loading"]),t(x,{onClick:l[5]||(l[5]=e=>f.value=!1)},{default:o(()=>[D("取消")]),_:1})])]),default:o(()=>[Ke,a("div",je,[t(F,{"label-position":"top",ref_key:"settlementFormRef",ref:N,rules:E,model:h.value,"label-width":"auto"},{default:o(()=>[t(ge,{modelValue:h.value.challengeResult,"onUpdate:modelValue":l[3]||(l[3]=e=>h.value.challengeResult=e)},null,8,["modelValue"])]),_:1},8,["rules","model"])])]),_:1},8,["modelValue"])])])}}}),st=ve(Oe,[["__scopeId","data-v-4cbfdb6e"]]);export{st as default};
