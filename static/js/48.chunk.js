(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{"2F6a":function(ue,I,e){"use strict";e.r(I);var G=e("2qtc"),C=e("kLXV"),ie=e("P2fV"),M=e("NJEC"),B=e("nRaC"),T=e("5RzL"),A=e("bbsP"),f=e("/wGt"),h=e("T2oS"),m=e("W9HT"),l=e("ozfa"),t=e("MJZm"),s=e("+L6B"),n=e("2/Rp"),a=e("miYZ"),d=e("tsqr"),U=e("oBTY"),j=e("k1fw"),P=e("tJVT"),H=e("Ag2N"),D=e("Bmqs"),S=e("Qurx"),se=e("BiO0"),de=e("GF/2"),z=e("+Mfq"),_e=e("ZqYi"),p=e("q1tI"),Me=e.n(p),J=e("PKFI"),r=e("nKUr"),Re=e.n(r),u="eONS",le=[{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"name",sorter:!0,width:150,ellipsis:!0},{title:"\u89D2\u8272\u6807\u8BC6",dataIndex:"code",sorter:!0,width:180,copyable:!0,ellipsis:!0},{title:"\u7C7B\u578B",dataIndex:"type",sorter:!0,width:80,hideInSearch:!0,render:function(V,x){return Object(r.jsx)(de.DictTag,{code:"role_type",value:x.type,_nk:"".concat(u,"11")})}},{title:"\u5907\u6CE8",dataIndex:"remarks",ellipsis:!0,hideInSearch:!0},{title:"\u521B\u5EFA\u65F6\u95F4",valueType:"dateTime",dataIndex:"createTime",width:150,sorter:!0,hideInSearch:!0},{title:"\u66F4\u65B0\u65F6\u95F4",valueType:"dateTime",dataIndex:"updateTime",width:150,sorter:!0,hideInSearch:!0}];I.default=function(){var L=Object(p.useRef)(),V=Object(p.useState)(void 0),x=Object(P.a)(V,2),Y=x[0],me=x[1],ce=Object(p.useState)(void 0),Z=Object(P.a)(ce,2),g=Z[0],w=Z[1],fe=Object(p.useState)([]),Q=Object(P.a)(fe,2),F=Q[0],X=Q[1],he=Object(p.useState)([]),$=Object(P.a)(he,2),O=$[0],K=$[1],Ee=Object(p.useState)(!1),q=Object(P.a)(Ee,2),pe=q[0],b=q[1],Oe=Object(p.useState)(void 0),ee=Object(P.a)(Oe,2),E=ee[0],te=ee[1],ge=Object(p.useState)([]),ne=Object(P.a)(ge,2),ve=ne[0],Pe=ne[1],De=function(i){b(!0),w(i),D.menu.listRoleGrant().then(function(o){var c=J.a.ofList(o.data,0,function(v){return Object(j.a)(Object(j.a)({},v),{},{key:v.id,checkable:!0})});X(c)}),D.role.getPermissionIds(i.code).then(function(o){K(o.data)}).finally(function(){return b(!1)})},ye=function _(i,o){b(!0);var c=Number(o.key),v=O.indexOf(c);if(i&&v===-1){var k;if(O.push(c),O.indexOf(o.parentId)===-1){var ae=o.pos.split("-"),y;ae.forEach(function(R,re){if(re===0||re===ae.length-1)return;var oe=Number(R);if(y===void 0)y=F[oe];else if(y.children)y=y.children[oe];else return;O.indexOf(y.id)===-1&&O.push(y.id)})}(k=o.children)===null||k===void 0||k.forEach(function(R){_(i,R)})}else if(v!==-1){var N;O.splice(v,1),(N=o.children)===null||N===void 0||N.forEach(function(R){_(i,R)})}K(Object(U.a)(O)),b(!1)},W=function(){w(void 0),K([]),X([])},je=function(){if(!g){d.default.warning("\u6570\u636E\u5F02\u5E38!");return}b(!0),D.role.updatePermissionIds(g==null?void 0:g.code,O).then(function(){d.default.success("\u6388\u6743\u6210\u529F"),W()}).finally(function(){b(!1)})},be=function(i){te(i),D.organization.query().then(function(o){var c=J.a.toTreeSelectData(o.data);Pe(c||[])})},Ce=function(){te(void 0)};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(H.default.Modal,Object(j.a)(Object(j.a)({},D.role),{},{title:"\u89D2\u8272\u7BA1\u7406",rowKey:"id",columns:le,onStatusChange:me,toolBarActions:[{type:"create",permission:"system:role:add"}],operateBarProps:{width:200},operateBar:[{type:"edit",permission:"system:role:edit"},function(_,i){return Object(r.jsx)(z.default.A,{permission:"system:role:grant",text:"\u6388\u6743",onClick:function(){return De(i)},_nk:"".concat(u,"22")},"sys-role-gr1-".concat(i.id))},function(_,i){return Object(r.jsx)(z.default.A,{permission:"system:role:grant",text:"\u7ED1\u5B9A",onClick:function(){return be(i)},_nk:"".concat(u,"23")},"sys-role-gr2-".concat(i.id))},{type:"del",permission:"system:role:del"}],formProps:{titleSuffix:"\u89D2\u8272"},_nk:"".concat(u,"21"),children:[Object(r.jsx)(S.a,{name:"id",hidden:!0,_nk:"".concat(u,"31")}),Object(r.jsx)(S.a,{name:"name",label:"\u89D2\u8272\u540D\u79F0",rules:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A!"}],_nk:"".concat(u,"32")}),Object(r.jsx)(S.a,{name:"password",label:"\u89D2\u8272\u6807\u8BC6",disabled:Y==="edit",placeholder:"\u5FC5\u987B\u4EE5ROLE_\u5F00\u5934!",rules:[{required:!0,message:"\u89D2\u8272\u6807\u8BC6\u4E0D\u80FD\u4E3A\u7A7A!"},{validator:function(i,o){if(o&&!o.startsWith("ROLE_")){var c="\u5FC5\u987B\u4EE5ROLE_\u5F00\u5934!";return Promise.reject(c)}return Promise.resolve()}}],_nk:"".concat(u,"33")}),Object(r.jsx)(_e.FormDictRadio,{name:"type",label:"\u89D2\u8272\u7C7B\u578B",code:"role_type",dictProps:{radioType:"button",disabled:Y==="edit"},initialValue:1,_nk:"".concat(u,"41")}),Object(r.jsx)(se.a,{name:"remarks",label:"\u5907\u6CE8",_nk:"".concat(u,"51")})]})),Object(r.jsx)(f.a,{width:"590px",title:"".concat(g==null?void 0:g.code," \u6388\u6743"),visible:g!==void 0,footerStyle:{textAlign:"right"},footer:Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(n.a,{style:{marginRight:10},onClick:function(){return W()},_nk:"".concat(u,"71"),children:"\u53D6\u6D88"}),Object(r.jsx)(n.a,{type:"primary",onClick:function(){return je()},_nk:"".concat(u,"72"),children:"\u4FDD\u5B58"})]}),onClose:function(){return W()},_nk:"".concat(u,"61"),children:Object(r.jsx)(m.a,{spinning:pe||F.length===0,size:"large",_nk:"".concat(u,"81"),children:Object(r.jsx)(t.a,{checkable:!0,checkStrictly:!0,autoExpandParent:!0,treeData:F,checkedKeys:O,onCheck:function(i,o){var c=o.checked,v=o.node;ye(c,v)},_nk:"".concat(u,"91")})})}),Object(r.jsx)(C.a,{destroyOnClose:!0,width:800,title:"".concat(E==null?void 0:E.code," \u89D2\u8272\u7528\u6237\u7ED1\u5B9A"),visible:E!==void 0,footer:!1,bodyStyle:{padding:0},onCancel:function(){return Ce()},_nk:"".concat(u,"a1"),children:Object(r.jsx)(H.default.Modal,{rowKey:"userId",query:D.role.listRoleBindUser,tableRef:L,columns:[{title:"\u7528\u6237ID",dataIndex:"userId",width:"60px",align:"center"},{title:"\u7528\u6237\u540D",dataIndex:"username",width:"120px",ellipsis:!0},{title:"\u6635\u79F0",dataIndex:"nickname",hideInSearch:!0,ellipsis:!0},{title:"\u7EC4\u7EC7\u673A\u6784",dataIndex:"organizationName",width:"120px",ellipsis:!0,hideInSearch:!0},{title:"\u7EC4\u7EC7",dataIndex:"organizationId",hideInTable:!0,renderFormItem:function(){return Object(r.jsx)(T.a,{treeData:ve,_nk:"".concat(u,"b1")})}}],operateBar:[function(_,i){return Object(r.jsx)(M.a,{title:"\u786E\u8BA4\u8981\u89E3\u7ED1\u5417\uFF1F",onConfirm:function(){return D.role.unbindUser(i.userId,E==null?void 0:E.code).then(function(){var c;return(c=L.current)===null||c===void 0?void 0:c.reload()})},_nk:"".concat(u,"c1"),children:Object(r.jsx)("a",{style:{color:"red"},_nk:"".concat(u,"d1"),children:"\u89E3\u7ED1"})})}],tableProps:{params:{roleCode:E==null?void 0:E.code},options:!1},_nk:"".concat(u,"24")})})]})}},PKFI:function(ue,I,e){"use strict";var G=e("oBTY"),C=e("k1fw"),ie="u6lJ";function M(f,h){for(var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(j){return j},l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"id",t=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"parentId",s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"children",n=[],a=0;a<f.length;){var d=m(f[a]);if(d[t]===h){f.splice(a,1);var U=M(f,d[l],m,l,t,s);d[s]=U.length>0?U:void 0,d.permissionNodes&&d.permissionNodes.length&&(d.children=M(d.permissionNodes,d[l],m,l,t,s)),n.push(d),a=0}else a+=1}return n}function B(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(n){return n},m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"id",l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"name",t=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"children",s=[];return f.forEach(function(n){var a=Object(C.a)({label:n[l],value:n[m]},h(n));n[t]&&n[t]instanceof Array?a[t]=B(n[t],h,m,l,t):a[t]=void 0,s.push(a)}),s.length>0?s:void 0}function T(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(n){return n},m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"id",l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"name",t=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"children",s=[];return f.forEach(function(n){var a=Object(C.a)({title:n[l],key:n[m]},h(n));n[t]&&n[t]instanceof Array?a[t]=T(n[t],h,m,l,t):a[t]=void 0,s.push(a)}),s.length>0?s:void 0}function A(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){return!0},l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"children",t=[];return f.forEach(function(s){var n=h(s),a=A(s[l]||[],h,m,l);a=a&&a.length>0?a:void 0;var d=Object(C.a)({},s);n?(d[l]=a,t.push(d)):a&&a.length>0&&(m(s,a)?(d[l]=a,t.push(d)):t.push.apply(t,Object(G.a)(a)))}),t}I.a={ofList:M,toTreeSelectData:B,toTreeData:T,treeFilter:A}}}]);
