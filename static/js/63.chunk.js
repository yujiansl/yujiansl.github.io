(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{"2F6a":function(ue,R,e){"use strict";e.r(R);var H=e("2qtc"),C=e("kLXV"),_e=e("P2fV"),I=e("NJEC"),B=e("nRaC"),U=e("5RzL"),A=e("bbsP"),f=e("/wGt"),h=e("T2oS"),m=e("W9HT"),s=e("ozfa"),a=e("MJZm"),d=e("+L6B"),t=e("2/Rp"),n=e("miYZ"),c=e("tsqr"),T=e("oBTY"),j=e("k1fw"),D=e("tJVT"),z=e("Ag2N"),P=e("Bmqs"),S=e("Qurx"),ie=e("BiO0"),de=e("GF/2"),J=e("+Mfq"),se=e("ZqYi"),p=e("q1tI"),Me=e.n(p),N=e("PKFI"),r=e("nKUr"),Re=e.n(r),u="eONS",le=[{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"name",sorter:!0,width:150,ellipsis:!0},{title:"\u89D2\u8272\u6807\u8BC6",dataIndex:"code",sorter:!0,width:180,copyable:!0,ellipsis:!0},{title:"\u7C7B\u578B",dataIndex:"type",sorter:!0,width:80,hideInSearch:!0,render:function(V,x){return Object(r.jsx)(de.DictTag,{code:"role_type",value:x.type,_nk:"".concat(u,"11")})}},{title:"\u5907\u6CE8",dataIndex:"remarks",ellipsis:!0,hideInSearch:!0},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",width:150,sorter:!0,hideInSearch:!0},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updateTime",width:150,sorter:!0,hideInSearch:!0}];R.default=function(){var L=Object(p.useRef)(),V=Object(p.useState)(void 0),x=Object(D.a)(V,2),Y=x[0],me=x[1],ce=Object(p.useState)(void 0),Z=Object(D.a)(ce,2),O=Z[0],w=Z[1],fe=Object(p.useState)([]),Q=Object(D.a)(fe,2),F=Q[0],X=Q[1],he=Object(p.useState)([]),$=Object(D.a)(he,2),g=$[0],K=$[1],Ee=Object(p.useState)(!1),q=Object(D.a)(Ee,2),pe=q[0],b=q[1],ge=Object(p.useState)(void 0),ee=Object(D.a)(ge,2),E=ee[0],te=ee[1],Oe=Object(p.useState)([]),ne=Object(D.a)(Oe,2),ve=ne[0],De=ne[1],Pe=function(_){b(!0),w(_),P.menu.listRoleGrant().then(function(o){var l=N.a.ofList(o.data,0,function(v){return Object(j.a)(Object(j.a)({},v),{},{key:v.id,checkable:!0})});X(l)}),P.role.getPermissionIds(_.code).then(function(o){K(o.data)}).finally(function(){return b(!1)})},ye=function i(_,o){b(!0);var l=Number(o.key),v=g.indexOf(l);if(_&&v===-1){var k;if(g.push(l),g.indexOf(o.parentId)===-1){var ae=o.pos.split("-"),y;ae.forEach(function(M,re){if(re===0||re===ae.length-1)return;var oe=Number(M);if(y===void 0)y=F[oe];else if(y.children)y=y.children[oe];else return;g.indexOf(y.id)===-1&&g.push(y.id)})}(k=o.children)===null||k===void 0||k.forEach(function(M){i(_,M)})}else if(v!==-1){var G;g.splice(v,1),(G=o.children)===null||G===void 0||G.forEach(function(M){i(_,M)})}K(Object(T.a)(g)),b(!1)},W=function(){w(void 0),K([]),X([])},je=function(){if(!O){c.default.warning("\u6570\u636E\u5F02\u5E38!");return}b(!0),P.role.updatePermissionIds(O==null?void 0:O.code,g).then(function(){c.default.success("\u6388\u6743\u6210\u529F"),W()}).finally(function(){b(!1)})},be=function(_){te(_),P.organization.query().then(function(o){var l=N.a.toTreeSelectData(o.data);De(l||[])})},Ce=function(){te(void 0)};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(z.default.Modal,Object(j.a)(Object(j.a)({},P.role),{},{title:"\u89D2\u8272\u7BA1\u7406",rowKey:"id",columns:le,onStatusChange:me,toolBarActions:[{type:"create",permission:"system:role:add"}],operateBarProps:{width:200},operateBar:[{type:"edit",permission:"system:role:edit"},function(i,_){return Object(r.jsx)(J.default.A,{permission:"system:role:grant",text:"\u6388\u6743",onClick:function(){return Pe(_)},_nk:"".concat(u,"22")},"sys-role-gr1-".concat(_.id))},function(i,_){return Object(r.jsx)(J.default.A,{permission:"system:role:grant",text:"\u7ED1\u5B9A",onClick:function(){return be(_)},_nk:"".concat(u,"23")},"sys-role-gr2-".concat(_.id))},{type:"del",permission:"system:role:del"}],formProps:{titleSuffix:"\u89D2\u8272"},_nk:"".concat(u,"21"),children:[Object(r.jsx)(S.a,{name:"id",hidden:!0,_nk:"".concat(u,"31")}),Object(r.jsx)(S.a,{name:"name",label:"\u89D2\u8272\u540D\u79F0",rules:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A!"}],_nk:"".concat(u,"32")}),Object(r.jsx)(S.a,{name:"code",label:"\u89D2\u8272\u6807\u8BC6",disabled:Y==="edit",placeholder:"\u5FC5\u987B\u4EE5ROLE_\u5F00\u5934!",rules:[{required:!0,message:"\u89D2\u8272\u6807\u8BC6\u4E0D\u80FD\u4E3A\u7A7A!"},{validator:function(_,o){if(o&&!o.startsWith("ROLE_")){var l="\u5FC5\u987B\u4EE5ROLE_\u5F00\u5934!";return Promise.reject(l)}return Promise.resolve()}}],_nk:"".concat(u,"33")}),Object(r.jsx)(se.FormDictRadio,{name:"type",label:"\u89D2\u8272\u7C7B\u578B",code:"role_type",dictProps:{radioType:"button",disabled:Y==="edit"},initialValue:1,_nk:"".concat(u,"41")}),Object(r.jsx)(ie.a,{name:"remarks",label:"\u5907\u6CE8",_nk:"".concat(u,"51")})]})),Object(r.jsx)(f.a,{width:"590px",title:"".concat(O==null?void 0:O.code," \u6388\u6743"),visible:O!==void 0,footerStyle:{textAlign:"right"},footer:Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(t.a,{style:{marginRight:10},onClick:function(){return W()},_nk:"".concat(u,"71"),children:"\u53D6\u6D88"}),Object(r.jsx)(t.a,{type:"primary",onClick:function(){return je()},_nk:"".concat(u,"72"),children:"\u4FDD\u5B58"})]}),onClose:function(){return W()},_nk:"".concat(u,"61"),children:Object(r.jsx)(m.a,{spinning:pe||F.length===0,size:"large",_nk:"".concat(u,"81"),children:Object(r.jsx)(a.a,{checkable:!0,checkStrictly:!0,autoExpandParent:!0,treeData:F,checkedKeys:g,onCheck:function(_,o){var l=o.checked,v=o.node;ye(l,v)},_nk:"".concat(u,"91")})})}),Object(r.jsx)(C.a,{destroyOnClose:!0,width:800,title:"".concat(E==null?void 0:E.code," \u89D2\u8272\u7528\u6237\u7ED1\u5B9A"),visible:E!==void 0,footer:!1,bodyStyle:{padding:0},onCancel:function(){return Ce()},_nk:"".concat(u,"a1"),children:Object(r.jsx)(z.default.Modal,{rowKey:"userId",query:P.role.listRoleBindUser,tableRef:L,columns:[{title:"\u7528\u6237ID",dataIndex:"userId",width:"60px",align:"center"},{title:"\u7528\u6237\u540D",dataIndex:"username",width:"120px",ellipsis:!0},{title:"\u6635\u79F0",dataIndex:"nickname",hideInSearch:!0,ellipsis:!0},{title:"\u7EC4\u7EC7\u673A\u6784",dataIndex:"organizationName",width:"120px",ellipsis:!0,hideInSearch:!0},{title:"\u7EC4\u7EC7",dataIndex:"organizationId",hideInTable:!0,renderFormItem:function(){return Object(r.jsx)(U.a,{treeData:ve,_nk:"".concat(u,"b1")})}}],operateBar:[function(i,_){return Object(r.jsx)(I.a,{title:"\u786E\u8BA4\u8981\u89E3\u7ED1\u5417\uFF1F",onConfirm:function(){return P.role.unbindUser(_.userId,E==null?void 0:E.code).then(function(){var l;return(l=L.current)===null||l===void 0?void 0:l.reload()})},_nk:"".concat(u,"c1"),children:Object(r.jsx)("a",{style:{color:"red"},_nk:"".concat(u,"d1"),children:"\u89E3\u7ED1"})})}],tableProps:{params:{roleCode:E==null?void 0:E.code},options:!1},_nk:"".concat(u,"24")})})]})}},PKFI:function(ue,R,e){"use strict";var H=e("oBTY"),C=e("k1fw"),_e="u6lJ";function I(f,h){for(var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(j){return j},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"id",a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"parentId",d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"children",t=[],n=0;n<f.length;){var c=m(f[n]);if(c[a]===h){f.splice(n,1);var T=I(f,c[s],m,s,a,d);c[d]=T.length>0?T:void 0,console.log(c,"item"),t.push(c),console.log(t,"treeData push"),n=0}else n+=1}return console.log(t,"treeData"),t}function B(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(t){return t},m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"id",s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"name",a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"children",d=[];return f.forEach(function(t){var n=Object(C.a)({label:t[s],value:t[m]},h(t));t[a]&&t[a]instanceof Array?n[a]=B(t[a],h,m,s,a):n[a]=void 0,d.push(n)}),d.length>0?d:void 0}function U(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(t){return t},m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"id",s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"name",a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"children",d=[];return f.forEach(function(t){var n=Object(C.a)({title:t[s],key:t[m]},h(t));t[a]&&t[a]instanceof Array?n[a]=U(t[a],h,m,s,a):n[a]=void 0,d.push(n)}),d.length>0?d:void 0}function A(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){return!0},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"children",a=[];return f.forEach(function(d){var t=h(d),n=A(d[s]||[],h,m,s);n=n&&n.length>0?n:void 0;var c=Object(C.a)({},d);t?(c[s]=n,a.push(c)):n&&n.length>0&&(m(d,n)?(c[s]=n,a.push(c)):a.push.apply(a,Object(H.a)(n)))}),a}R.a={ofList:I,toTreeSelectData:B,toTreeData:U,treeFilter:A}}}]);
