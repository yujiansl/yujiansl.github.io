import{Z as P,r as g,l as ge,aD as ve,aE as fe,d as be,ah as v,m as y,p as D,q as u,U as t,O as o,u as l,S as x,T as C,I as Ve,F as K,a7 as j,M as Q,aF as _e,aG as ye}from"./vue-BtEXIrqH.js";import{e as he,_ as Re}from"./index-Cfrc5ih1.js";import{g as p,a as ke,t as Fe}from"./commonFn-Ei0WKKhK.js";import{_ as h}from"./Index.vue_vue_type_script_setup_true_lang-TK6O32Dg.js";import{m as q,c as Ie,g as Ue}from"./index-C7XNEq9c.js";import{V as w}from"./index-BwQtaG9W.js";import{_ as W}from"./lodash-BUB0GWD5.js";import{d as Se}from"./index-BRvIyV96.js";import{a as xe}from"./index-DRaevwyq.js";import{E as L}from"./element-BbMnn7tA.js";import"//at.alicdn.com/t/c/font_4557022_266y8yxi6v9.js";import"./vxe-EK889JN8.js";const Ce=P({name:[{required:!0,message:"请输入站点名称",trigger:"blur"}],websiteUrl:[{required:!0,message:"请输入业务/产品网址",trigger:"blur"}],category:[{required:!0,message:"请选择行业类别",trigger:"change"}],currency:[{required:!0,message:"请选择收款币种",trigger:"change"}],turnover:[{required:!0,message:"请选择单月营业额",trigger:"change"}],region:[{required:!0,message:"请选择业务分布地区",trigger:"change"}],callback:[{required:!0,message:"请输入回调地址",trigger:"change"}]}),Ae=g(),Me=JSON.parse(he("user-info")||"{}"),Te=g(!1),X=g({email:Me.name||"",baseword:"",reAccount:"",code:"",type:""}),De=r=>{var V;X.value={name:r.name,websiteUrl:p(r.claims,"websiteUrl"),category:(V=p(r.claims,"category"))==null?void 0:V.split(","),region:p(r.claims,"region"),currency:p(r.claims,"currency"),turnover:p(r.claims,"turnover"),desc:p(r.claims,"desc"),callback:p(r.claims,"callback"),siteRemark:p(r.claims,"siteRemark"),parentMerchantName:r.parentMerchantName,appId:r.appId,createdAt:r.createdAt,isVerificated:r.isVerificated,virtualMerchantId:r.virtualMerchantId}};function qe(){return{baseFormRef:Ae,baseForm:X,baseRules:Ce,setForm:De,baseLoading:Te}}const we=P({serviceFeePercent:[{required:!0,message:"请输入收单费率",trigger:"blur"}],settledDays:[{required:!0,message:"请选择选择周期",trigger:"change"}],ecomChannel:[{required:!0,message:"请选择支付通道",trigger:"change"}],challengeResult:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),Le=g(),Ne=g(!1),N=g({serviceFeePercent:"",settledDays:"",ecomChannel:"",agentRate:""}),Pe=r=>{N.value={settledDays:r.settledDays,serviceFeePercent:p(r.claims,"serviceFeePercent"),ecomChannel:p(r.claims,"ecomChannel"),agentId:r.agentID,agentRate:r.agentRate,virtualMerchantId:r.virtualMerchantId},console.log(N.value.ecomChannel,"ecomChannel")};function Ee(){return{orderFormRef:Le,orderForm:N,orderRules:we,setOrderForm:Pe,orderLoading:Ne}}const Be=g(),Oe=g(!1),Y=g({}),$e=P({settledSum:[{required:!0,message:"请输入最低结算金额",trigger:"blur"}],settledFee:[{required:!0,message:"请输入每笔结算手续费",trigger:"blur"}],challengeResult:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),ze=r=>{Y.value={settledSum:p(r.claims,"settledSum"),settledFee:p(r.claims,"settledFee"),isRisk:p(r.claims,"isRisk")==="1",riskAmount:p(r.claims,"riskAmount"),isEnabled:r.isEnabled==="1",virtualMerchantId:r.virtualMerchantId}};function Ze(){return{riskFormRef:Be,riskForm:Y,riskRules:$e,riskLoading:Oe,setRiskForm:ze}}const f=r=>(_e("data-v-10d5a1a8"),r=r(),ye(),r),Ge={class:"mer-setting flex flex-col items-center"},He=f(()=>u("div",{class:"set-title mb-40"},"站点设置",-1)),Je={class:"base-box setting"},Ke=f(()=>u("div",{class:"line mt-50 mb-50"},null,-1)),je={class:"flex-center mb-16"},Qe=f(()=>u("div",{class:"item-label flex-1"},"站点ID",-1)),We={class:"item-desc"},Xe={class:"item-desc"},Ye={class:"flex-center mb-16"},el=f(()=>u("div",{class:"item-label flex-1"},"加入时间",-1)),ll={class:"item-desc"},al={class:"item-desc"},tl={class:"flex-center mb-16"},sl=f(()=>u("div",{class:"item-label flex-1"},"认证状态",-1)),ol={class:"item-desc"},rl={class:"item-desc"},nl={class:"w-full flex-center"},ul={class:"w-full flex-center"},dl=f(()=>u("div",{class:"item-desc"},"当结算金额低于最低预设值，将收取每笔手续费",-1)),il={class:"w-full flex-center"},ml=f(()=>u("div",{class:"item-label"},"风险保证金（USD）",-1)),cl={class:"item-value"},pl=f(()=>u("div",{class:"item-desc"},"开启保证金后，会通知用户缴纳保证金。",-1)),gl={class:"w-full flex-center"},vl=f(()=>u("div",{class:"item-label"},"站点状态",-1)),fl={class:"item-value"},bl={class:"w-full flex-center"},Vl=ge({__name:"Setting",setup(r){const{query:V}=ve(),ee=fe(),R=g(!1),E=g([]),k=g({}),{baseFormRef:B,baseForm:s,baseRules:le,setForm:ae,baseLoading:F}=qe(),{orderFormRef:O,orderForm:m,orderRules:te,setOrderForm:A,orderLoading:I}=Ee(),{riskFormRef:$,riskForm:c,riskRules:se,setRiskForm:oe,riskLoading:U}=Ze(),_=g("first"),z=g([]),re=async d=>{d&&await d.validate(async(e,i)=>{if(e){F.value=!0;try{const n={claims:[{claimType:"category",claimValue:s.value.category.toString()},{claimType:"currency",claimValue:s.value.currency},{claimType:"turnover",claimValue:s.value.turnover},{claimType:"region",claimValue:s.value.region},{claimType:"callback",claimValue:s.value.callback},{claimType:"desc",claimValue:s.value.desc},{claimType:"siteRemark",claimValue:s.value.siteRemark},{claimType:"websiteUrl",claimValue:s.value.websiteUrl}],challengeResult:s.value.challengeResult,name:s.value.name,merchantId:s.value.virtualMerchantId};await q(n),await S(),L.success("修改成功"),F.value=!1}catch{F.value=!1}}else console.log("error submit!",i)})},ne=async d=>{console.log("ddd",m.value),d&&await d.validate(async(e,i)=>{if(e){I.value=!0;try{const n={claims:[{claimType:"serviceFeePercent",claimValue:m.value.serviceFeePercent},{claimType:"ecomChannel",claimValue:m.value.ecomChannel}],challengeResult:m.value.challengeResult,settledDays:m.value.settledDays,agentId:m.value.agentId,agentRate:m.value.agentRate,merchantId:m.value.virtualMerchantId};await q(n),L.success("修改成功"),await S(),I.value=!1}catch{I.value=!1}}else console.log("error submit!",i)})},ue=async d=>{d&&await d.validate(async(e,i)=>{var n;if(e){U.value=!0;try{const b={claims:[{claimType:"settledSum",claimValue:c.value.settledSum},{claimType:"isRisk",claimValue:c.value.isRisk?"1":"0"},{claimType:"riskAmount",claimValue:c.value.riskAmount},{claimType:"settledFee",claimValue:c.value.settledFee}],challengeResult:(n=c.value)==null?void 0:n.challengeResult,isEnabled:c.value.isEnabled?"1":"0",merchantId:c.value.virtualMerchantId};await q(b),L.success("修改成功"),await S(),U.value=!1}catch{U.value=!1}}else console.log("error submit!",i)})},de=()=>{_.value==="third"&&oe(k.value),_.value==="second"&&A(k.value),_.value==="second"&&A(k.value)},ie=async()=>{try{const d=await Ie();z.value=d.data.map(e=>({name:e.code+"通道",value:e.code}))}catch(d){console.log(d,"e")}},me=async()=>{try{const d=V.virtualMerchantId,e=await Ue(d)}catch{}},Z=async d=>{try{const i=await Se({paging:{pageNumber:1,pageSize:15},searchItems:[{columnName:"agentName",value:d}],sorting:{columnNames:["createdAt"],direction:"desc"}});E.value=Fe(i.data.rows)||[],R.value=!1}catch(e){R.value=!1,console.log(e,"queryAgentList")}},S=async()=>{try{const d={paging:{pageNumber:1,pageSize:15},condition:{virtualMerchantID:V.id}},e=await xe(d);if(e.data.items.length===0){ee.back();return}const i=e.data.items[0]||{};k.value=i,ae(i),A(i)}catch(d){console.log(d,"getAppdetail")}},ce=d=>{d?(R.value=!0,W.throttle(()=>Z(d),500)()):W.throttle(()=>Z(""),500)()};return be(()=>{S(),me(),ie()}),(d,e)=>{const i=v("el-input"),n=v("el-form-item"),b=v("el-button"),M=v("el-form"),T=v("el-tab-pane"),G=v("el-option"),H=v("el-select"),J=v("el-switch"),pe=v("el-tabs");return y(),D("div",Ge,[He,u("div",Je,[t(pe,{modelValue:_.value,"onUpdate:modelValue":e[25]||(e[25]=a=>_.value=a),class:"modal-tabs",onTabChange:de},{default:o(()=>[t(T,{label:"业务信息",name:"first"},{default:o(()=>[t(M,{ref_key:"baseFormRef",ref:B,"label-position":"top",model:l(s),rules:l(le),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(n,{label:"站点名称",prop:"name"},{default:o(()=>[t(i,{modelValue:l(s).name,"onUpdate:modelValue":e[0]||(e[0]=a=>l(s).name=a),placeholder:"请输入站点名称"},null,8,["modelValue"])]),_:1}),t(n,{label:"业务/产品网址",prop:"websiteUrl"},{default:o(()=>[t(i,{modelValue:l(s).websiteUrl,"onUpdate:modelValue":e[1]||(e[1]=a=>l(s).websiteUrl=a),placeholder:"请输入业务/产品网址"},null,8,["modelValue"])]),_:1}),t(n,{label:"行业类别",prop:"category"},{default:o(()=>[t(h,{type:"category",modelValue:l(s).category,"onUpdate:modelValue":e[2]||(e[2]=a=>l(s).category=a),placeholder:"请选择行业类别"},null,8,["modelValue"])]),_:1}),t(n,{label:"收款币种",prop:"currency"},{default:o(()=>[t(h,{type:"currency",modelValue:l(s).currency,"onUpdate:modelValue":e[3]||(e[3]=a=>l(s).currency=a),placeholder:"请选择收款币种"},null,8,["modelValue"])]),_:1}),t(n,{label:"单月营业额",prop:"turnover"},{default:o(()=>[t(h,{type:"turnover",modelValue:l(s).turnover,"onUpdate:modelValue":e[4]||(e[4]=a=>l(s).turnover=a),placeholder:"请选择单月营业额"},null,8,["modelValue"])]),_:1}),t(n,{label:"业务分布地区",prop:"region"},{default:o(()=>[t(h,{type:"region",modelValue:l(s).region,"onUpdate:modelValue":e[5]||(e[5]=a=>l(s).region=a),placeholder:"请选择业务分布地区"},null,8,["modelValue"])]),_:1}),t(n,{label:"回调地址",prop:"callback"},{default:o(()=>[t(i,{modelValue:l(s).callback,"onUpdate:modelValue":e[6]||(e[6]=a=>l(s).callback=a),placeholder:"请输入回调地址"},null,8,["modelValue"])]),_:1}),t(n,{label:"业务/产品描述（选填）",prop:"desc"},{default:o(()=>[t(i,{modelValue:l(s).desc,"onUpdate:modelValue":e[7]||(e[7]=a=>l(s).desc=a),placeholder:"请输入业务/产品描述"},null,8,["modelValue"])]),_:1}),Ke,t(n,{label:"所属商户",prop:"name"},{default:o(()=>[x(C(l(s).parentMerchantName),1)]),_:1}),t(n,{label:"站点备注（选填）",prop:"siteRemark"},{default:o(()=>[t(i,{modelValue:l(s).siteRemark,"onUpdate:modelValue":e[8]||(e[8]=a=>l(s).siteRemark=a),placeholder:"请输入站点备注"},null,8,["modelValue"])]),_:1}),u("div",je,[Qe,u("div",We,[u("div",Xe,C(l(s).appId),1)])]),u("div",Ye,[el,u("div",ll,[u("div",al,C(l(ke)(l(s).createdAt)),1)])]),u("div",tl,[sl,u("div",ol,[u("div",rl,[u("div",{class:Ve(["item-value",l(s).isVerificated==="1"?"is-auth":"is-no-auth"])},C(l(s).isVerificated==="1"?"已认证":"未认证"),3)])])]),t(w,{class:"mt-30",modelValue:l(s).challengeResult,"onUpdate:modelValue":e[9]||(e[9]=a=>l(s).challengeResult=a)},null,8,["modelValue"]),t(n,null,{default:o(()=>[u("div",nl,[t(b,{type:"primary",loading:l(F),onClick:e[10]||(e[10]=a=>re(l(B)))},{default:o(()=>[x("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(T,{label:"收单设置",name:"second"},{default:o(()=>[t(M,{ref_key:"orderFormRef",ref:O,"label-position":"top",model:l(m),rules:l(te),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(n,{label:"收单费率",prop:"serviceFeePercent"},{default:o(()=>[t(i,{modelValue:l(m).serviceFeePercent,"onUpdate:modelValue":e[11]||(e[11]=a=>l(m).serviceFeePercent=a),placeholder:"请输入收单费率"},null,8,["modelValue"])]),_:1}),t(n,{label:"结算周期",prop:"settledDays"},{default:o(()=>[t(h,{type:"settledDays",modelValue:l(m).settledDays,"onUpdate:modelValue":e[12]||(e[12]=a=>l(m).settledDays=a),placeholder:"请选择选择周期"},null,8,["modelValue"])]),_:1}),t(n,{label:"支付通道",prop:"ecomChannel"},{default:o(()=>[t(H,{modelValue:l(m).ecomChannel,"onUpdate:modelValue":e[13]||(e[13]=a=>l(m).ecomChannel=a),placeholder:"请选择支付通道",clearable:""},{default:o(()=>[(y(!0),D(K,null,j(z.value,a=>(y(),Q(G,{key:a.value,label:a.name,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"所属代理",prop:"agentId"},{default:o(()=>[t(H,{modelValue:l(m).agentId,"onUpdate:modelValue":e[14]||(e[14]=a=>l(m).agentId=a),filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入代理名称","remote-show-suffix":"","remote-method":ce,loading:R.value},{default:o(()=>[(y(!0),D(K,null,j(E.value,a=>(y(),Q(G,{key:a.id,label:a.agentName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(n,{label:"代理返佣费率",prop:"agentRate"},{default:o(()=>[t(i,{modelValue:l(m).agentRate,"onUpdate:modelValue":e[15]||(e[15]=a=>l(m).agentRate=a),placeholder:"请输入代理返佣费率"},null,8,["modelValue"])]),_:1}),t(w,{class:"mt-30",modelValue:l(m).challengeResult,"onUpdate:modelValue":e[16]||(e[16]=a=>l(m).challengeResult=a)},null,8,["modelValue"]),t(n,null,{default:o(()=>[u("div",ul,[t(b,{type:"primary",loading:l(I),onClick:e[17]||(e[17]=a=>ne(l(O)))},{default:o(()=>[x("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(T,{label:"风控设置",name:"third"},{default:o(()=>[t(M,{ref_key:"riskFormRef",ref:$,"label-position":"top",model:l(c),rules:l(se),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(n,{label:"最低结算金额（USD）",prop:"settledSum"},{default:o(()=>[t(i,{modelValue:l(c).settledSum,"onUpdate:modelValue":e[18]||(e[18]=a=>l(c).settledSum=a),placeholder:"请输入最低结算金额",maxlength:"10"},null,8,["modelValue"])]),_:1}),t(n,{label:"每笔结算手续费（USD）",prop:"settledFee"},{default:o(()=>[t(i,{modelValue:l(c).settledFee,"onUpdate:modelValue":e[19]||(e[19]=a=>l(c).settledFee=a),placeholder:"请输入每笔结算手续费",maxlength:"10"},null,8,["modelValue"]),dl]),_:1}),t(n,{prop:"isRisk"},{default:o(()=>[u("div",il,[ml,u("div",cl,[t(J,{modelValue:l(c).isRisk,"onUpdate:modelValue":e[20]||(e[20]=a=>l(c).isRisk=a)},null,8,["modelValue"])])])]),_:1}),t(n,{prop:"riskAmount"},{default:o(()=>[t(i,{modelValue:l(c).riskAmount,"onUpdate:modelValue":e[21]||(e[21]=a=>l(c).riskAmount=a),placeholder:"请输入风险保证金",maxlength:"10"},null,8,["modelValue"]),pl]),_:1}),t(n,{prop:"name"},{default:o(()=>[u("div",gl,[vl,u("div",fl,[t(J,{modelValue:l(c).isEnabled,"onUpdate:modelValue":e[22]||(e[22]=a=>l(c).isEnabled=a)},null,8,["modelValue"])])])]),_:1}),t(w,{class:"mt-30",modelValue:l(c).challengeResult,"onUpdate:modelValue":e[23]||(e[23]=a=>l(c).challengeResult=a)},null,8,["modelValue"]),t(n,null,{default:o(()=>[u("div",bl,[t(b,{type:"primary",loading:l(U),onClick:e[24]||(e[24]=a=>ue(l($)))},{default:o(()=>[x("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])])])}}}),Ml=Re(Vl,[["__scopeId","data-v-10d5a1a8"]]);export{Ml as default};
