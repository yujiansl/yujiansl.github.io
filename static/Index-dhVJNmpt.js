import{u as ye}from"./useTable-B7hd0WvU.js";import{c as we,d as xe,f as Se}from"./index-C7XNEq9c.js";import{F as Ce}from"./Index-Di390-Cq.js";import{f as Ve,e as Ae,_ as ke}from"./index-Cfrc5ih1.js";import{b as q,c as A,a as F,d as Te,h as Ne,g as H,t as O}from"./commonFn-Ei0WKKhK.js";import{V as De}from"./index-BwQtaG9W.js";import{a as j}from"./index-DRaevwyq.js";import{g as Le}from"./index-BqctQlg1.js";import{s as Fe,a as Ie}from"./index-DB6xQqCT.js";import{g as ze}from"./index-BRvIyV96.js";import{n as Re,E as I}from"./element-BbMnn7tA.js";import{l as Me,r as u,Z as Pe,d as Ue,ah as g,ap as Z,m as d,p as v,q as e,T as o,P as G,U as l,O as r,F as z,a7 as R,M as k,S as M,u as c,I as We,R as J,aF as Be,aG as Ee}from"./vue-BtEXIrqH.js";import"./LIKU-logo-BbnHVERV.js";import"//at.alicdn.com/t/c/font_4557022_266y8yxi6v9.js";import"./vxe-EK889JN8.js";const i=x=>(Be("data-v-a9e92928"),x=x(),Ee(),x),Ye={class:"top-balance base-box flex flex-wrap ml-40 mr-40 mt-20"},qe={class:"balance-item pr-80"},He=i(()=>e("div",{class:"item-title"},"可结算余额 (USD)",-1)),Oe={class:"item-price mt-10 mb-8"},je=i(()=>e("div",{class:"item-text"},"结算币种以美元结算",-1)),Ze={class:"balance-item"},Ge=i(()=>e("div",{class:"item-title"},"账户余额",-1)),Je={class:"item-price mt-10 mb-8"},Ke={class:"order base-box p-36 ml-40 mr-40 mt-20"},$e={class:"top-search"},Qe=i(()=>e("div",{class:"table-title mb-33"},"结算记录",-1)),Xe={class:"table-wrapper"},et={key:0},tt={key:0},at=["onClick"],lt={class:"pager-wrapper mt-32 flex justify-end"},st={class:"base-box detail-box"},ot=i(()=>e("div",{class:"detail-title mb-50"},"结算账单详情",-1)),nt={class:"mb-24 flex"},rt=i(()=>e("div",{class:"order-text"},"结算批次号：",-1)),ct={class:"order-value"},it={class:"mb-24 flex"},dt=i(()=>e("div",{class:"order-text"},"结算状态：",-1)),ut={class:"order-value"},mt={class:"mb-24 flex"},vt=i(()=>e("div",{class:"order-text"},"结算金额：",-1)),_t={class:"order-value"},pt={class:"mb-24 flex"},ht=i(()=>e("div",{class:"order-text"},"订单币种金额：",-1)),gt={class:"order-value"},ft={class:"mb-24 flex"},bt=i(()=>e("div",{class:"order-text"},"汇率：",-1)),yt={class:"order-value"},wt={class:"mb-24 flex"},xt=i(()=>e("div",{class:"order-text"},"订单笔数：",-1)),St={class:"order-value"},Ct={class:"mb-24 flex"},Vt=i(()=>e("div",{class:"order-text"},"收单手续费：",-1)),At={class:"order-value"},kt={class:"mb-24 flex"},Tt=i(()=>e("div",{class:"order-text"},"结算手续费：",-1)),Nt={class:"order-value"},Dt={class:"mb-24 flex"},Lt=i(()=>e("div",{class:"order-text"},"账单时间：",-1)),Ft={class:"order-value"},It=i(()=>e("div",{class:"order-line mt-42 mb-40"},null,-1)),zt={class:"mb-24 flex"},Rt=i(()=>e("div",{class:"order-text"},"实际结算金额：",-1)),Mt={key:0,class:"order-value"},Pt={key:1,class:"order-value"},Ut={key:2,class:"order-value"},Wt={class:"flex-center mt-60"},Bt={key:1},Et={class:"mb-24 flex"},Yt=i(()=>e("div",{class:"order-text"},"结算收款账户：",-1)),qt={class:"order-value"},Ht={class:"mb-24 flex"},Ot=i(()=>e("div",{class:"order-text"},"申请结算时间：",-1)),jt={class:"order-value"},Zt=Me({__name:"Index",setup(x){const T=u(""),P=Ve(),K=u([]),$=u(),_=u({payWay:"",channel:"",username:""}),h=Pe({account:"",challengeResult:"",type:""}),y=u({}),U=u([]),f=u({}),W=[{label:"可结算",value:"10"},{label:"审核中",value:"20"},{label:"已结算",value:"30"}],B=u([]),E=JSON.parse(Ae("user-info")||"{}"),Q=u([]),X=u([]),S=u(!1),C=u(!1),n=u({}),N=u({}),{paginationData:w,handleCurrentChange:ee,handleSizeChange:te,tableData:ae,queryTableData:Gt,loadingRef:le,handSearch:se,reset:Jt}=ye({searchData:{},url:"/settlement/list?tableView=SettledSettlementView",method:"post"});function D(){const a=[];for(const s in _.value){let m=_.value[s];Array.isArray(m)&&(m=m.map(b=>Ne.utc(new Date(b)).format("YYYY-MM-DD HH:mm:ss")).toString()),m&&a.push({columnName:s,value:m})}a.push({columnName:T.value==="merchant"?"luMerchant":"luAgent",value:E.mer||E.agent}),se(a)}const oe=async()=>{try{const a=await we();Q.value=a.data.map(s=>({name:s.code+"站点",value:s.code}))}catch(a){console.log(a,"e")}},ne=async()=>{try{const a=await xe();a.data&&a.data.length&&(X.value=a.data)}catch(a){console.log(a,"e")}},re=a=>{console.log(a,"val"),K.value=a},ce=async()=>{if(!h.account){I.warning("请选择结算收款账户");return}if(!h.challengeResult){I.warning("请输入验证码");return}C.value=!0;try{const a={settlementAccount:h.account,challengeResult:h.challengeResult,settlementIds:[n.value.id]};await Fe(a),I.success("创建结算订单成功"),D(),C.value=!1,S.value=!1}catch{C.value=!1}},ie=()=>{_.value={}},de=async()=>{try{const a=await(T.value==="merchant"?Se:ze)();N.value=a.data||{}}catch(a){console.log("getStaticsData",a)}},ue=a=>{n.value=a,a.state==="10"?(me("1544175232779000001"),ve()):_e(a.luWithdraw),console.log(a,"rowValue"),S.value=!0},me=async a=>{try{const m=(await j({condition:{virtualMerchantID:a},paging:{pageNumber:1,pageSize:30}})).data.items[0]||{};y.value.settledSum=H(m.cliaims,"settledSum")||0,y.value.settledFee=H(m.cliaims,"settledFee")||0}catch{}},ve=async()=>{try{const a=await Le({paging:{pageNumber:1,pageSize:30}});U.value=O(a.data.rows)||[]}catch{}},_e=async a=>{try{const s=await Ie({paging:{pageNumber:1,pageSize:30}},a);f.value=O(s.data.rows)[0]||{},console.log("getWithdrawList.value",s.daa)}catch(s){console.log(s,"getWithdrawList")}},pe=async()=>{try{const a=await j({paging:{pageNumber:1,pageSize:200}});B.value=a.data.items}catch{}};return Ue(()=>{T.value=P.roles.includes("merchant")?"merchant":P.roles.includes("agent")?"agent":"",pe(),D(),oe(),ne(),de()}),(a,s)=>{const m=g("el-option"),V=g("el-select"),b=g("el-form-item"),he=g("el-input"),L=g("el-button"),Y=g("el-form"),p=g("el-table-column"),ge=g("el-pagination"),fe=Z("permission"),be=Z("loading");return d(),v("div",null,[e("div",Ye,[e("div",qe,[He,e("div",Oe,o(N.value.settled||0),1),je]),G((d(),v("div",Ze,[Ge,e("div",Je,o(N.value.onAir||0),1)])),[[fe,["merchant"]]])]),e("div",Ke,[e("div",$e,[Qe,l(Y,{inline:!0,model:_.value,class:"demo-form-inline"},{default:r(()=>[l(b,null,{default:r(()=>[l(V,{modelValue:_.value.luVirtualMerchant,"onUpdate:modelValue":s[0]||(s[0]=t=>_.value.luVirtualMerchant=t),placeholder:"全部站点",clearable:""},{default:r(()=>[(d(!0),v(z,null,R(B.value,t=>(d(),k(m,{key:t.virtualMerchantId,label:t.name,value:t.virtualMerchantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,null,{default:r(()=>[l(V,{modelValue:_.value.state,"onUpdate:modelValue":s[1]||(s[1]=t=>_.value.state=t),placeholder:"全部结算状态",clearable:""},{default:r(()=>[(d(),v(z,null,R(W,t=>l(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(b,null,{default:r(()=>[l(he,{modelValue:_.value.settlementProcessNo,"onUpdate:modelValue":s[2]||(s[2]=t=>_.value.settlementProcessNo=t),placeholder:"请输入结算批次号搜寻",clearable:""},null,8,["modelValue"])]),_:1}),l(b,null,{default:r(()=>[l(L,{type:"primary",onClick:ie},{default:r(()=>[M("重置")]),_:1}),l(L,{type:"primary",onClick:D},{default:r(()=>[M("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),e("div",Xe,[G((d(),k(c(Re),{ref_key:"multipleTableRef",ref:$,data:c(ae),onSelectionChange:re,style:{width:"100%"}},{default:r(()=>[l(p,{type:"selection",width:"55"}),l(p,{prop:"settlementProcessNo",label:"结算批次号",width:"200"}),l(p,{prop:"state",label:"结算状态",width:"100"},{default:r(t=>[e("div",{class:We(c(q)(t.row.state).class)},o(c(q)(t.row.state).value),3)]),_:1}),l(p,{prop:"virtualMerchant~merchantName",label:"站点名称",width:"120"}),l(p,{prop:"settlementTotal",label:"结算金额",width:"180"},{default:r(t=>[c(A)(t.row.settlementTotal)?(d(),v("span",et,o(c(A)(t.row.settlementTotal)+" "+t.row.settlementCurrency),1)):J("",!0)]),_:1}),l(p,{prop:"orderTotal",label:"订单币种金额",width:"180"},{default:r(t=>[c(A)(t.row.orderTotal,t.row.orderCurrencyMultiply)?(d(),v("span",tt,o(c(A)(t.row.orderTotal,t.row.orderCurrencyMultiply)+" "+t.row.orderCurrency),1)):J("",!0)]),_:1}),l(p,{prop:"averageExchangeRate",label:"汇率",width:"220"}),l(p,{prop:"orderCount",label:"订单笔数",width:"100"}),l(p,{prop:"createdAt",label:"账单时间",width:"180"},{default:r(t=>[e("div",null,o(c(F)(t.row.createdAt)),1)]),_:1}),l(p,{prop:"action",label:"操作",fixed:"right"},{default:r(t=>[e("div",{class:"action-btn cursor-pointer",onClick:Kt=>ue(t.row)},"查看详情",8,at)]),_:1})]),_:1},8,["data"])),[[be,c(le)]])]),e("div",lt,[l(ge,{background:"",layout:c(w).layout,"page-sizes":c(w).pageSizes,total:c(w).total,"page-size":c(w).pageSize,currentPage:c(w).currentPage,onSizeChange:c(te),onCurrentChange:c(ee)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])]),l(Ce,{modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=t=>S.value=t)},{default:r(()=>[e("div",st,[ot,e("div",nt,[rt,e("div",ct,o(n.value.settlementProcessNo),1)]),e("div",it,[dt,e("div",ut,o(c(Te)(n.value.state,W)),1)]),e("div",mt,[vt,e("div",_t,o((n.value.settlementTotal||0)+n.value.settlementCurrency),1)]),e("div",pt,[ht,e("div",gt,o((n.value.orderTotal||0)+n.value.orderCurrency),1)]),e("div",ft,[bt,e("div",yt,o(n.value.averageExchangeRate),1)]),e("div",wt,[xt,e("div",St,o(n.value.orderCount),1)]),e("div",Ct,[Vt,e("div",At,o(n.value.orderServiceFee),1)]),e("div",kt,[Tt,e("div",Nt,o(f.value.settlementFee||n.value.settlementServiceFee),1)]),e("div",Dt,[Lt,e("div",Ft,o(c(F)(n.value.createdAt)),1)]),It,e("div",zt,[Rt,f.value.settlementAmount?(d(),v("div",Mt,o(f.value.settlementAmount+" "+f.value.settlementCurrency),1)):y.value.settledSum&&y.value.settledFee?(d(),v("div",Pt,o(y.value.settledSum>(n.value.settlementTotal||0)?(n.value.settlementTotal||0)-y.value.settledFee:n.value.settlementTotal||0)+" "+o(" "+n.value.settlementCurrency),1)):(d(),v("div",Ut,o((n.value.settlementTotal||0)+n.value.settlementCurrency),1))]),e("div",null,[n.value.state==="10"?(d(),k(Y,{key:0,"label-position":"top","label-width":"auto",model:h},{default:r(()=>[l(b,{label:"结算收款账户"},{default:r(()=>[l(V,{modelValue:h.account,"onUpdate:modelValue":s[3]||(s[3]=t=>h.account=t),placeholder:"请选择结算收款账户"},{default:r(()=>[(d(!0),v(z,null,R(U.value,t=>(d(),k(m,{key:t.id,label:t.accountName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(De,{modelValue:h.challengeResult,"onUpdate:modelValue":s[4]||(s[4]=t=>h.challengeResult=t)},null,8,["modelValue"]),e("div",Wt,[l(L,{type:"primary",loading:C.value,onClick:ce},{default:r(()=>[M("确认并申请结算")]),_:1},8,["loading"])])]),_:1},8,["model"])):(d(),v("div",Bt,[e("div",Et,[Yt,e("div",qt,o(f.value["settlementAccount~accountName"]),1)]),e("div",Ht,[Ot,e("div",jt,o(c(F)(f.value.createdAt)),1)])]))])])]),_:1},8,["modelValue"])])])}}}),ma=ke(Zt,[["__scopeId","data-v-a9e92928"]]);export{ma as default};
