import{b as Se,_ as ke,g as Ue}from"./index-Dr7EymDI.js";import{F as K}from"./Index-Di390-Cq.js";import{f as xe,e as E,j as Re,k as Ne,_ as De}from"./index-Cfrc5ih1.js";import{b as Ce}from"./validate-JA1bY0wI.js";import{u as Fe,b as qe,c as Te}from"./index-BRvIyV96.js";import{E as v,n as Ie}from"./element-BbMnn7tA.js";import{r as p,Z as U,l as Pe,d as Oe,ah as V,ap as Ge,m as S,p as x,U as l,O as a,q as t,T as b,u as m,S as h,F as $e,a7 as Le,M as W,P as Be,aF as Ee,aG as Je}from"./vue-BtEXIrqH.js";import{V as O}from"./index-BwQtaG9W.js";import{g as je,c as X,d as ze}from"./index-BqctQlg1.js";import{_ as Me}from"./Index.vue_vue_type_script_setup_true_lang-TK6O32Dg.js";import{a as Y}from"./commonFn-Ei0WKKhK.js";import"./LIKU-logo-BbnHVERV.js";import"//at.alicdn.com/t/c/font_4557022_266y8yxi6v9.js";import"./vxe-EK889JN8.js";const He=(w,i,r)=>{i===""?r(new Error("请输入密码")):Ce(i)?r():r(new Error("密码格式错误"))},Qe=(w,i,r)=>{i===""?r(new Error("请输入验证码")):r()},Ze=(w,i,r)=>{i===""?r(new Error("请再次输入密码")):i!==F.password?r(new Error("两次输入的密码不一致")):r()},B=p(!1),Ke=xe(),We=U({password:[{required:!0,validator:He,trigger:"blur"}],rePass:[{required:!0,validator:Ze,trigger:"blur"}],challengeResult:[{required:!0,validator:Qe,trigger:"blur"}]}),Xe=p(),ee=JSON.parse(E("user-info")||"{}"),F=U({email:ee.email||"79026@qq.com",name:ee.name,password:"",rePass:"",challengeResult:""}),Ye=async w=>{w&&await w.validate(async(i,r)=>{if(i)try{const _=JSON.parse(E("user-info")||"{}"),G={password:F.password,rePassword:F.rePass,id:_.agent,userId:_.uid,challengeResult:F.challengeResult};B.value=!0,await Fe(G),v.success("保存成功"),setTimeout(()=>{Ke.logout()},1e3)}catch(_){v.error("修改密码失败，请稍后再试"),B.value=!1,console.log("submitPass",_)}else console.log("error submit!",r)})};function et(){return{passFormRef:Xe,passForm:F,passRules:We,submitPass:Ye,passLoading:B}}const u=w=>(Ee("data-v-cf0ff1b6"),w=w(),Je(),w),tt={class:"order base-box p-36 ml-40 mr-40 mt-20"},lt={class:"mx-640"},ot=u(()=>t("div",{class:"item-desc mt-14"},"如需修改登录邮箱，请联系客服",-1)),at={class:"create-at mb-60"},st=u(()=>t("div",{class:"item-label"},"加入时间",-1)),nt={class:"item-desc"},ct={class:"w-full flex"},ut={class:"flex justify-end w-full mb-40"},dt={class:"table-wrapper"},rt={class:"base-box detail-box"},it=u(()=>t("div",{class:"flex-center w-full mt-30 settlement-account-detail-title"},"结算账户详情",-1)),mt={key:0},pt={class:"settlement-account-detail-line"},_t=u(()=>t("span",{class:"settlement-account-field"},"结算币种：",-1)),vt={class:"settlement-account-value"},ft={class:"settlement-account-detail-line"},gt=u(()=>t("span",{class:"settlement-account-field"},"银行国家/地区：",-1)),bt={class:"settlement-account-value"},ht={class:"settlement-account-detail-line"},yt=u(()=>t("span",{class:"settlement-account-field"},"银行名称：",-1)),Vt={class:"settlement-account-value"},wt={class:"settlement-account-detail-line"},At=u(()=>t("span",{class:"settlement-account-field"},"银行地址：",-1)),St={class:"settlement-account-value"},kt={class:"settlement-account-detail-line"},Ut=u(()=>t("span",{class:"settlement-account-field"},"结算账户名称：",-1)),xt={class:"settlement-account-value"},Rt={class:"settlement-account-detail-line"},Nt=u(()=>t("span",{class:"settlement-account-field"},"银行账号：",-1)),Dt={class:"settlement-account-value"},Ct={class:"settlement-account-detail-line"},Ft=u(()=>t("span",{class:"settlement-account-field"},"公司地址：",-1)),qt={class:"settlement-account-value"},Tt={key:1},It={class:"settlement-account-detail-line"},Pt=u(()=>t("span",{class:"settlement-account-field"},"结算币种：",-1)),Ot={class:"settlement-account-value"},Gt={class:"settlement-account-detail-line"},$t=u(()=>t("span",{class:"settlement-account-field"},"USDT 钱包地址：",-1)),Lt={class:"settlement-account-value"},Bt={class:"settlement-account-detail-line"},Et=u(()=>t("span",{class:"settlement-account-field"},"钱包名称/备注：",-1)),Jt={class:"settlement-account-value"},jt={class:"flex-center w-full mt-30 settlement-account-return-btn"},zt={class:"detail-box"},Mt=u(()=>t("div",{class:"detail-title mb-50"},"新增结算收款账户",-1)),Ht=u(()=>t("div",{class:"select-currency"},[t("span",{class:"select-currency-flag"},"*"),t("span",{class:"select-currency-title"},"选择结算币种")],-1)),Qt={class:"flex-center w-full mt-30"},Zt={class:"flex-center w-full mt-30"},Kt=u(()=>t("div",{class:"item-desc mt-14"},"如需修改登录邮箱，请联系客服",-1)),Wt={class:"w-full flex"},Xt={key:0},Yt=u(()=>t("div",{class:"bound-google mt-80"},[t("img",{src:ke,class:"bound-google-img"}),t("div",{class:"bound-google-text ml-28"},[t("div",{class:"bound-google-title"},"已绑定谷歌验证器"),t("div",{class:"bound-google-tips mt-8 mb-50"},"使用谷歌验证器 (Google Authenticator) 获取谷歌验证码")])],-1)),el={class:"google-download flex ml-92"},tl={key:1},ll=u(()=>t("div",{class:"google-title mt-40"},"开启谷歌安全验证，将极大的保障您的账户安全",-1)),ol=u(()=>t("div",{class:"google-text mt-30 mb-14"},"使用谷歌验证器 (Google Authenticator) 扫描二维码进行绑定",-1)),al={class:"google-download flex"},sl={key:0,class:"auth-img mt-40 mb-50 ml-5"},nl=["src"],cl={key:1,class:"auth-img mt-40 mb-50 ml-5 flex-center"},ul={class:"google-qrcode-loading"},dl={class:"w-full mb-60"},rl=u(()=>t("div",{class:"google-input-label mb-12 flex-1"},"谷歌验证码",-1)),il={class:""},ml={class:"flex"},pl=u(()=>t("div",{class:"delete-confirm-warning"}," 确定删除结算账户吗？ ",-1)),_l={class:"delete-google-otp"},vl={class:"delete-confirm-footer"},fl=Pe({__name:"Index",setup(w){const i=JSON.parse(E("user-info")||"{}"),r=p(i["otp.enabled"]==="1"),_=p({otp:"",totpID:""}),G=[{value:"USD",label:"USD"},{value:"USDT",label:"USDT"}],d=U({id:"",role:"",currency:"USD",type:"10",region:"",bankName:"",bankAddress:"",account:"",accountName:"",companyAddress:"",remark:"",challengeResult:""}),y=U({id:"",role:"",currency:"USDT",type:"20",currency:"",account:"",accountName:"",challengeResult:""}),te=U({account:[{required:!0,message:"请输入USDT(TRC20)钱包地址",trigger:"blur"}],accountName:[{required:!0,message:"请输入钱包名称/备注",trigger:"blur"}]}),le=U({region:[{required:!0,message:"请选择银行账户开户国家",trigger:"change"}],bankName:[{required:!0,message:"请输入银行名称",trigger:"blur"}],bankAddress:[{required:!0,message:"请输入银行地址",trigger:"blur"}],account:[{required:!0,message:"请输入完整的银行账号",trigger:"blur"}],accountName:[{required:!0,message:"请输入结算账户名称",trigger:"blur"}],companyAddress:[{required:!0,message:"请输入公司所在地址",trigger:"blur"}]}),J=p(),j=p(),z=p(),M=p();Re();const q=p("info"),R=p("USD"),f=p({}),$=p(null),T=p(!1),I=p(!1),L=p(!1),N=U({id:"",challengeResult:""}),g=U({id:"",name:"",email:"",createdAt:""}),oe=U({name:[{required:!0,message:"请输入代理名称",trigger:"blur"}]}),{passFormRef:H,passForm:k,passRules:ae,submitPass:se,passLoading:ne}=et(),ce=async()=>{if(!_.value.otp){v.error("请输入谷歌验证码");return}const c={totpID:_.value.totpID,otp:_.value.otp};Se(c).then(()=>{v.success("绑定成功"),Ne(JSON.stringify({...i,"otp.enabled":"1"}),"user-info"),r.value=!0}).catch(e=>{v.success("操作失败"),console.error(e)})},ue=async()=>{try{const c=await Ue({id:i.agent});_.value.totpID=c.data.totpId,_.value.qrcode=c.data.qrcode}catch(c){console.log("getOtpQr",c)}},de=(c,e)=>{q.value==="settlementAccount"&&!$.value&&re(),q.value==="google"&&!r.value&&ue()},re=()=>{const c=[];c.push({columnName:"luAgent",value:g.id}),je({searchItems:c}).then(n=>{$.value=n.data.rows}).catch(n=>{console.error(n)})},ie=async c=>{c&&await c.validate((e,n)=>{if(e)try{d.currency=R,d.role="agent",d.id=i.agent,X(d).then(()=>{v.success("保存成功"),setTimeout(()=>{window.location.reload()},1e3)}).catch(s=>{v.error("操作失败"),console.error(s)})}catch(s){console.error(s)}else console.error("error submit!",n)})},me=async c=>{c&&await c.validate((e,n)=>{if(e)try{y.currency=R,y.role="agent",y.id=i.agent,X(y).then(()=>{v.success("保存成功"),setTimeout(()=>{window.location.reload()},1e3)}).catch(s=>{v.error("操作失败"),console.error(s)})}catch(s){console.error(s)}else console.error("error submit!",n)})},pe=c=>{R.value=c.currency.value,f.value=c,I.value=!0},_e=c=>{I.value=!1},ve=()=>{T.value=!0},fe=async c=>{c&&await c.validate((e,n)=>{if(e)try{N.id=f.value.id.value,ze(N).then(s=>{v.success("删除成功"),setTimeout(()=>{window.location.reload()},1e3)}).catch(s=>{v.error("操作失败"),console.log(s)})}catch(s){console.error(s)}else console.e("error submit!",n)})},ge=async()=>{const c={id:"",account:"yes"},e=new URLSearchParams(Object.entries(c)).toString();qe(e).then(n=>{g.id=n.data.id,g.email=n.data.email,g.name=n.data.agentName,g.createdAt=n.data.createdAt}).catch(n=>{console.log(n)})},Q=()=>{window.open("https://docs.liku.io/google-authenticator","_blank")},be=async c=>{c&&await c.validate((e,n)=>{if(e)try{Te(g).then(()=>{v.success("保存成功")}).catch(s=>{v.error("操作失败"),console.error(s)})}catch(s){console.error(s)}else console.error("error submit!",n)})};return Oe(()=>{ge(),r.value=i["otp.enabled"]==="1"}),(c,e)=>{const n=V("el-input"),s=V("el-form-item"),A=V("el-button"),D=V("el-form"),P=V("el-tab-pane"),C=V("el-table-column"),he=V("el-option"),ye=V("el-select"),Z=V("SvgIcon"),Ve=V("el-tabs"),we=V("el-dialog"),Ae=Ge("loading");return S(),x("div",tt,[l(Ve,{modelValue:q.value,"onUpdate:modelValue":e[25]||(e[25]=o=>q.value=o),class:"page-tabs",onTabChange:de},{default:a(()=>[l(P,{label:"账户信息",name:"info"},{default:a(()=>[t("div",lt,[l(D,{ref_key:"agentFormRef",ref:z,"label-position":"top",model:g,rules:oe,"label-width":"auto",class:"demo-ruleForm mt-40"},{default:a(()=>[l(s,{label:"登录邮箱",prop:"email"},{default:a(()=>[l(n,{modelValue:g.email,"onUpdate:modelValue":e[0]||(e[0]=o=>g.email=o),disabled:""},null,8,["modelValue"]),ot]),_:1}),l(s,{label:"代理名称",prop:"agentName"},{default:a(()=>[l(n,{modelValue:g.name,"onUpdate:modelValue":e[1]||(e[1]=o=>g.name=o),placeholder:"请输入代理名称",minlength:"1",maxlength:"30"},null,8,["modelValue"])]),_:1}),t("div",at,[st,t("div",nt,b(m(Y)(g.createdAt)),1)]),l(s,null,{default:a(()=>[t("div",ct,[l(A,{type:"primary",onClick:e[2]||(e[2]=o=>be(z.value))},{default:a(()=>[h("保存")]),_:1})])]),_:1})]),_:1},8,["model","rules"])])]),_:1}),l(P,{label:"结算账户",name:"settlementAccount"},{default:a(()=>[t("div",ut,[l(A,{type:"primary",onClick:e[3]||(e[3]=o=>L.value=!0)},{default:a(()=>[h("新增结算账户")]),_:1})]),t("div",dt,[l(m(Ie),{data:$.value,style:{width:"100%"}},{default:a(()=>[l(C,{prop:"accountName.value",label:"结算账户名称",width:"200"}),l(C,{prop:"currency.value",label:"账户币种",width:"200"}),l(C,{prop:"account.value",label:"收款账户",width:"260"}),l(C,{prop:"createdAt.value",label:"创建时间",width:"260"},{default:a(o=>[t("div",null,b(m(Y)(o.row.createdAt.value)),1)]),_:1}),l(C,{label:"操作",width:"130"},{default:a(o=>[l(A,{link:"",type:"primary",size:"default",onClick:gl=>pe(o.row)},{default:a(()=>[h(" 管理结算账户 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),l(K,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=o=>I.value=o)},{default:a(()=>[t("div",rt,[it,R.value==="USD"?(S(),x("div",mt,[t("div",pt,[_t,t("span",vt,b(f.value.currency.value),1)]),t("div",ft,[gt,t("span",bt,b(f.value.region.value),1)]),t("div",ht,[yt,t("span",Vt,b(f.value.bankName.value),1)]),t("div",wt,[At,t("span",St,b(f.value.bankAddress.value),1)]),t("div",kt,[Ut,t("span",xt,b(f.value.accountName.value),1)]),t("div",Rt,[Nt,t("span",Dt,b(f.value.account.value),1)]),t("div",Ct,[Ft,t("span",qt,b(f.value.companyAddress.value),1)])])):(S(),x("div",Tt,[t("div",It,[Pt,t("span",Ot,b(f.value.currency.value),1)]),t("div",Gt,[$t,t("span",Lt,b(f.value.account.value),1)]),t("div",Bt,[Et,t("span",Jt,b(f.value.accountName.value),1)])])),t("div",jt,[l(A,{onClick:_e},{default:a(()=>[h("返回")]),_:1})]),t("div",{class:"flex-center w-full del-btn cursor-pointer",onClick:ve}," 删除结算账户 ")])]),_:1},8,["modelValue"]),l(K,{modelValue:L.value,"onUpdate:modelValue":e[18]||(e[18]=o=>L.value=o)},{default:a(()=>[t("div",zt,[Mt,Ht,l(ye,{class:"select-currency-input",modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=o=>R.value=o)},{default:a(()=>[(S(),x($e,null,Le(G,o=>l(he,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),R.value==="USD"?(S(),W(D,{key:0,ref_key:"settlementAccountFormRef",ref:J,"label-position":"top",rules:le,"label-width":"auto",model:d},{default:a(()=>[l(s,{prop:"region",label:"银行国家/地区"},{default:a(()=>[l(Me,{modelValue:d.region,"onUpdate:modelValue":e[6]||(e[6]=o=>d.region=o),type:"region",placeholder:"请选择银行账户开户国家/地区"},null,8,["modelValue"])]),_:1}),l(s,{prop:"bankName",label:"银行名称"},{default:a(()=>[l(n,{modelValue:d.bankName,"onUpdate:modelValue":e[7]||(e[7]=o=>d.bankName=o),placeholder:"请输入银行名称",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(s,{prop:"bankAddress",label:"银行地址"},{default:a(()=>[l(n,{modelValue:d.bankAddress,"onUpdate:modelValue":e[8]||(e[8]=o=>d.bankAddress=o),placeholder:"请输入银行地址",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(s,{prop:"accountName",label:"结算账户名称"},{default:a(()=>[l(n,{modelValue:d.accountName,"onUpdate:modelValue":e[9]||(e[9]=o=>d.accountName=o),placeholder:"请输入结算账户名称",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(s,{prop:"account",label:"银行账号"},{default:a(()=>[l(n,{modelValue:d.account,"onUpdate:modelValue":e[10]||(e[10]=o=>d.account=o),placeholder:"请输入完整的银行账号",maxlength:"64"},null,8,["modelValue"])]),_:1}),l(s,{prop:"companyAddress",label:"公司地址"},{default:a(()=>[l(n,{modelValue:d.companyAddress,"onUpdate:modelValue":e[11]||(e[11]=o=>d.companyAddress=o),placeholder:"请输入公司所在地址",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(O,{modelValue:d.challengeResult,"onUpdate:modelValue":e[12]||(e[12]=o=>d.challengeResult=o)},null,8,["modelValue"]),l(s,null,{default:a(()=>[t("div",Qt,[l(A,{type:"primary",onClick:e[13]||(e[13]=o=>ie(J.value))},{default:a(()=>[h("保存 ")]),_:1})])]),_:1})]),_:1},8,["rules","model"])):(S(),W(D,{key:1,ref_key:"trcSettlementAccountFormRef",ref:j,"label-position":"top",rules:te,"label-width":"auto",model:y},{default:a(()=>[l(s,{prop:"account",label:"USDT钱包地址"},{default:a(()=>[l(n,{modelValue:y.account,"onUpdate:modelValue":e[14]||(e[14]=o=>y.account=o),placeholder:"请输入USDT(TRC20)钱包地址",maxlength:"64"},null,8,["modelValue"])]),_:1}),l(s,{prop:"accountName",label:"钱包名称/备注"},{default:a(()=>[l(n,{modelValue:y.accountName,"onUpdate:modelValue":e[15]||(e[15]=o=>y.accountName=o),placeholder:"请输入钱包名称备注",maxlength:"30"},null,8,["modelValue"])]),_:1}),l(O,{modelValue:y.challengeResult,"onUpdate:modelValue":e[16]||(e[16]=o=>y.challengeResult=o)},null,8,["modelValue"]),l(s,null,{default:a(()=>[t("div",Zt,[l(A,{type:"primary",onClick:e[17]||(e[17]=o=>me(j.value))},{default:a(()=>[h("保存 ")]),_:1})])]),_:1})]),_:1},8,["rules","model"]))])]),_:1},8,["modelValue"])]),_:1}),l(P,{label:"修改密码",name:"pass"},{default:a(()=>[l(D,{ref_key:"passFormRef",ref:H,"label-position":"top",model:m(k),rules:m(ae),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:a(()=>[l(s,{label:"登录邮箱",prop:"email"},{default:a(()=>[l(n,{modelValue:m(k).name,"onUpdate:modelValue":e[19]||(e[19]=o=>m(k).name=o),disabled:""},null,8,["modelValue"]),Kt]),_:1}),l(s,{label:"新密码",prop:"password"},{default:a(()=>[l(n,{modelValue:m(k).password,"onUpdate:modelValue":e[20]||(e[20]=o=>m(k).password=o),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),l(s,{label:"确认新密码",prop:"rePass"},{default:a(()=>[l(n,{modelValue:m(k).rePass,"onUpdate:modelValue":e[21]||(e[21]=o=>m(k).rePass=o),type:"password",placeholder:"请输入确认密码"},null,8,["modelValue"])]),_:1}),l(O,{modelValue:m(k).challengeResult,"onUpdate:modelValue":e[22]||(e[22]=o=>m(k).challengeResult=o)},null,8,["modelValue"]),l(s,null,{default:a(()=>[t("div",Wt,[l(A,{type:"primary",loading:m(ne),onClick:e[23]||(e[23]=o=>m(se)(m(H)))},{default:a(()=>[h("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),l(P,{label:"谷歌验证器",name:"google"},{default:a(()=>[r.value?(S(),x("div",Xt,[Yt,t("div",el,[t("div",{class:"cursor-pointer",onClick:Q},[h(" 下载 Google Authenticator "),l(Z,{name:"icon-xiazai",class:"ml-5"})])])])):(S(),x("div",tl,[ll,ol,t("div",al,[t("div",{class:"cursor-pointer",onClick:Q},[h(" 下载 Google Authenticator "),l(Z,{name:"icon-xiazai",class:"ml-5"})])]),_.value.qrcode?(S(),x("div",sl,[t("img",{src:"data:image/png;base64,"+_.value.qrcode,class:"google-auth-img"},null,8,nl)])):(S(),x("div",cl,[Be(t("span",ul,null,512),[[Ae,!0]])])),t("div",dl,[rl,t("div",il,[l(n,{modelValue:_.value.otp,"onUpdate:modelValue":e[24]||(e[24]=o=>_.value.otp=o),placeholder:"请输入谷歌验证码"},null,8,["modelValue"])])]),t("div",ml,[l(A,{type:"primary",onClick:ce},{default:a(()=>[h("绑定")]),_:1})])]))]),_:1})]),_:1},8,["modelValue"]),l(we,{modelValue:T.value,"onUpdate:modelValue":e[29]||(e[29]=o=>T.value=o),center:"",style:{width:"480px"}},{footer:a(()=>[t("div",vl,[l(A,{type:"primary",onClick:e[27]||(e[27]=o=>fe(M.value))},{default:a(()=>[h(" 确定删除 ")]),_:1}),l(A,{onClick:e[28]||(e[28]=o=>T.value=!1)},{default:a(()=>[h("取消")]),_:1})])]),default:a(()=>[pl,t("div",_l,[l(D,{ref_key:"deleteSettlementAccountFormRef",ref:M,"label-position":"top","label-width":"auto",model:N},{default:a(()=>[l(O,{modelValue:N.challengeResult,"onUpdate:modelValue":e[26]||(e[26]=o=>N.challengeResult=o)},null,8,["modelValue"])]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}}),Fl=De(fl,[["__scopeId","data-v-cf0ff1b6"]]);export{Fl as default};
