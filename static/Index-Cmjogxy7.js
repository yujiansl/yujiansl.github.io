import{l as z,aL as Y,aD as ee,r as _,Z as te,aK as ae,ah as u,m as f,M as B,O as l,q as t,U as e,p as h,F as oe,a7 as le,S as U,aF as K,aG as O,aE as se,d as ne,b as ie,ap as re,T as M,a8 as ce,P as de,u as p,R as ue}from"./vue-C87Wc4A0.js";import{_ as me}from"./empty-BiNgvBdS.js";import{J as pe,_ as P,f as _e,w as fe,U as ve}from"./index-c78MVIZI.js";import{u as he}from"./useTable-CVQ-UVVt.js";import{_ as j}from"./Index.vue_vue_type_script_setup_true_lang-BhDJDWBy.js";import be from"./Setting-B4jROdr1.js";import{F as Ve}from"./Index-BU8kA-XB.js";import{V as ye}from"./index-BZHf1ii5.js";import{E as A,n as ge}from"./element-CD5rsoqi.js";import"//at.alicdn.com/t/c/font_4557022_0o7l3b0t8egq.js";import"./vxe-sm_XFqm0.js";import"./usePerson-ClhUjQEF.js";import"./index-Cwe4D9Ts.js";import"./Index-DqM0qE4v.js";import"./validate-JA1bY0wI.js";import"./Delete-BgrM9xes.js";import"./LIKU-logo-CHqxCLOK.js";const we=m=>(K("data-v-e2e385cb"),m=m(),O(),m),xe={class:"base-box detail-box"},Ce=we(()=>t("div",{class:"reject-tips"},"驳回后，将以邮件的方式通知商户。商户修改后可再次提交审核。",-1)),ke={class:"flex-center w-full mt-30"},Re=z({__name:"Verification",props:Y({id:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(m){const S=m;ee();const R=_(),s=te({merchantId:"",isRejected:"0",isVerificated:"1",approvalReason:"",challengeResult:""}),c=[{value:"0",label:"审核不通过"},{value:"1",label:"审核通过"}],g=ae(m,"modelValue"),w=async b=>{b&&await b.validate((n,x)=>{if(n)try{s.isVerificated=="0"?s.isRejected="1":s.isRejected="0",s.merchantId=S.id;const d={...s};d.claims=[{claimType:"approvalReason",claimValue:d.approvalReason}],delete d.approvalReason,d[s.isVerificated=="0"?"sendMerchantRejectEmail":"sendMerchantApproveEmail"]=1,pe(d).then(()=>{A.success("保存成功"),location.reload()}).catch(v=>{A.error("操作失败"),console.error(v)})}catch(d){console.error(d)}else console.error("error submit!",x)})};return(b,n)=>{const x=u("el-option"),d=u("el-select"),v=u("el-form-item"),V=u("el-input"),E=u("el-button"),I=u("el-form");return f(),B(Ve,{modelValue:g.value,"onUpdate:modelValue":n[4]||(n[4]=r=>g.value=r),title:"商户认证审核"},{default:l(()=>[t("div",xe,[e(I,{ref_key:"modifyMerchantFormRef",ref:R,"label-position":"top","label-width":"auto",model:s,class:"mt-20"},{default:l(()=>[e(v,{prop:"isRejected",label:"认证审核操作"},{default:l(()=>[e(d,{modelValue:s.isVerificated,"onUpdate:modelValue":n[0]||(n[0]=r=>s.isVerificated=r)},{default:l(()=>[(f(),h(oe,null,le(c,r=>e(x,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(v,{prop:"remark",label:"驳回理由"},{default:l(()=>[e(V,{modelValue:s.approvalReason,"onUpdate:modelValue":n[1]||(n[1]=r=>s.approvalReason=r),placeholder:"请输入驳回理由",type:"textarea",rows:3,maxlength:"50"},null,8,["modelValue"]),Ce]),_:1}),e(ye,{modelValue:s.challengeResult,"onUpdate:modelValue":n[2]||(n[2]=r=>s.challengeResult=r)},null,8,["modelValue"]),e(v,null,{default:l(()=>[t("div",ke,[e(E,{type:"primary",onClick:n[3]||(n[3]=r=>w(R.value))},{default:l(()=>[U("保存")]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])}}}),Me=P(Re,[["__scopeId","data-v-e2e385cb"]]),k=m=>(K("data-v-cad939d1"),m=m(),O(),m),Se={class:"top-balance base-box flex items-center flex-wrap ml-40 mr-40 mt-20"},Ee={class:"balance-item pr-80"},Ie=k(()=>t("div",{class:"item-title"},"商户总数",-1)),Te={class:"item-price mt-10 mb-8"},Ue={class:"balance-item pr-80"},De=k(()=>t("div",{class:"item-title"},"已认证商户",-1)),Fe={class:"item-price mt-10 mb-8"},Ne={class:"balance-item"},$e=k(()=>t("div",{class:"item-title"},"待审核商户",-1)),je={class:"item-price mt-10 mb-8"},Ae=k(()=>t("div",{class:"flex-1"},null,-1)),ze={class:"order base-box p-36 ml-40 mr-40 mt-20"},Be={class:"top-search"},Ke={class:"table-wrapper"},Oe=k(()=>t("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[t("span",null,[t("img",{src:me,alt:""})]),t("span",{class:"custom-empty-text"},"暂无数据")],-1)),Pe={key:0,class:"verificated flex-center"},Je={key:1,class:"not-verificated flex-center"},qe={key:0},Ge={key:1,class:"lockout-status-text"},Le={class:"flex"},Ze=["onClick"],He=["onClick"],Qe=["onClick"],We={key:1,class:"cursor-pointer"},Xe={class:"pager-wrapper mt-32 flex justify-between"},Ye=k(()=>t("div",null,null,-1)),et=z({__name:"Index",setup(m){const S=_(),R=_e(),s=se(),c=_({}),g=_(!1),w=_(!1),b=_({}),n=_(""),x=_(0),d=_(0),v=_(0),{paginationData:V,handleCurrentChange:E,tableData:I,loadingRef:r,handSearch:T}=he({searchData:{},url:"/merchant/list",method:"post"}),J=async a=>{try{await R.login({refresh:!0,change:!0},a),await s.push("/"),location.reload()}catch(i){console.log(i,"e")}};function D(){const a=[];for(const i in c.value){const y=c.value[i];y&&a.push({columnName:i,value:y})}T(a)}const q=()=>{c.value={}},G=a=>{b.value=JSON.parse(JSON.stringify(a)),b.value.isExtEnabled=a.isEnabled==="1",w.value=!0},L=a=>{n.value=a.id,g.value=!0},F=async()=>{try{ve(0).then(a=>{x.value=a.data.totalCount,d.value=a.data.verificatedCount,v.value=a.data.reviewingCount}).catch(a=>{console.error(a)})}catch(a){console.error(a)}},Z=a=>a.isVerificated!=="1"&&a["claim~kybVerificateType"];return ne(()=>{T(),F()}),ie(w,a=>{a||(T(),F())}),(a,i)=>{const y=u("el-form-item"),H=u("el-input"),N=u("el-button"),Q=u("el-form"),C=u("el-table-column"),W=u("el-pagination"),X=re("loading");return f(),h("div",null,[t("div",Se,[t("div",Ee,[Ie,t("div",Te,M(x.value),1)]),t("div",Ue,[De,t("div",Fe,M(d.value),1)]),t("div",Ne,[$e,t("div",je,M(v.value),1)]),Ae]),t("div",ze,[t("div",Be,[e(Q,{inline:!0,model:c.value,class:"demo-form-inline"},{default:l(()=>[e(y,null,{default:l(()=>[e(j,{placeholder:"全部认证状态",modelValue:c.value.isVerificated,"onUpdate:modelValue":i[0]||(i[0]=o=>c.value.isVerificated=o),type:"accountAuth"},null,8,["modelValue"])]),_:1}),e(y,null,{default:l(()=>[e(j,{placeholder:"全部账户状态",modelValue:c.value.isEnabled,"onUpdate:modelValue":i[1]||(i[1]=o=>c.value.isEnabled=o),type:"account"},null,8,["modelValue"])]),_:1}),e(y,null,{default:l(()=>[e(H,{modelValue:c.value.merchantName,"onUpdate:modelValue":i[2]||(i[2]=o=>c.value.merchantName=o),placeholder:"请输入商户名称",onKeyup:ce(D,["enter"]),maxlength:"30",clearable:""},null,8,["modelValue"])]),_:1}),e(y,null,{default:l(()=>[e(N,{onClick:q},{default:l(()=>[U("重置")]),_:1}),e(N,{type:"primary",onClick:D},{default:l(()=>[U("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),t("div",Ke,[de((f(),B(p(ge),{ref_key:"multipleTableRef",ref:S,data:p(I),style:{width:"100%"}},{empty:l(()=>[Oe]),default:l(()=>[e(C,{prop:"merchantName",label:"商户名称"}),e(C,{prop:"merchantAppCount",label:"站点数","min-width":"100"}),e(C,{prop:"isVerificated",label:"认证状态"},{default:l(o=>[o.row.isVerificated==="1"?(f(),h("div",Pe,"已认证")):(f(),h("div",Je,"未认证"))]),_:1}),e(C,{prop:"isEnabled",label:"账户状态"},{default:l(o=>[o.row.isEnabled==="1"?(f(),h("div",qe,"正常")):(f(),h("div",Ge,"禁用"))]),_:1}),e(C,{prop:"createdAt",label:"注册时间"},{default:l(o=>[t("div",null,M(p(fe)(o.row.createdAt)),1)]),_:1}),e(C,{prop:"action",label:"操作",fixed:"right",width:"250"},{default:l(o=>[t("div",Le,[t("div",{class:"action-btn cursor-pointer mr-20",onClick:$=>G(o.row)},"商户设置",8,Ze),t("div",{class:"action-btn cursor-pointer mr-20",onClick:$=>J(o.row.id)},"进入商户后台",8,He),Z(o.row)?(f(),h("div",{key:0,class:"action-btn cursor-pointer",onClick:$=>L(o.row)}," 审核 ",8,Qe)):o.row.isVerificated==="0"&&!o.row["claim~kybVerificateType"]?(f(),h("div",We," 未提交 ")):ue("",!0)])]),_:1})]),_:1},8,["data"])),[[X,p(r)]])]),t("div",Xe,[Ye,e(W,{background:"",layout:p(V).layout,"page-sizes":p(V).pageSizes,total:p(V).total,"page-size":p(V).pageSize,currentPage:p(V).currentPage,onCurrentChange:p(E)},null,8,["layout","page-sizes","total","page-size","currentPage","onCurrentChange"])]),e(Me,{modelValue:g.value,"onUpdate:modelValue":i[3]||(i[3]=o=>g.value=o),id:n.value},null,8,["modelValue","id"]),e(be,{modelValue:w.value,"onUpdate:modelValue":i[4]||(i[4]=o=>w.value=o),row:b.value},null,8,["modelValue","row"])])])}}}),bt=P(et,[["__scopeId","data-v-cad939d1"]]);export{bt as default};
