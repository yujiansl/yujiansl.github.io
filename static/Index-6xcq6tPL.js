import{_ as de}from"./empty-BiNgvBdS.js";import{b as ue,_ as re,g as me}from"./index-BcSIpPe0.js";import{F as pe}from"./Index-BU8kA-XB.js";import{f as K,e as P,J as _e,w as ve,R as fe,k as he,n as ge,o as be,_ as ye}from"./index-c78MVIZI.js";import{b as we}from"./validate-JA1bY0wI.js";import{E as k,n as Ve}from"./element-CD5rsoqi.js";import{r as v,Z as W,l as ke,d as xe,ah as b,ap as H,m as r,p as _,U as s,O as a,q as e,P as T,M as $,S as y,u,R as w,T as p,aF as Se,aG as Ae}from"./vue-C87Wc4A0.js";import{V as Ce}from"./index-BZHf1ii5.js";import{g as Ie}from"./index-Cwe4D9Ts.js";import{C as De,D as Ne}from"./Delete-BgrM9xes.js";import"./LIKU-logo-CHqxCLOK.js";import"//at.alicdn.com/t/c/font_4557022_0o7l3b0t8egq.js";import"./vxe-sm_XFqm0.js";import"./Index.vue_vue_type_script_setup_true_lang-BhDJDWBy.js";const Re=(f,c,i)=>{c===""?i(new Error("请输入密码")):we(c)?i():i(new Error("密码格式错误"))},Ue=(f,c,i)=>{c===""?i(new Error("请输入验证码")):i()},Te=(f,c,i)=>{c===""?i(new Error("请再次输入密码")):c!==I.password?i(new Error("两次输入的密码不一致")):i()},F=v(!1),Fe=K(),Pe=W({password:[{required:!0,validator:Re,trigger:"blur"}],rePass:[{required:!0,validator:Te,trigger:"blur"}],challengeResult:[{required:!0,validator:Ue,trigger:"blur"}]}),qe=v(),z=JSON.parse(P("user-info")||"{}"),I=W({email:z.name,name:z.name,password:"",rePass:"",challengeResult:""}),Oe=async f=>{f&&await f.validate(async(c,i)=>{if(c)try{const m=JSON.parse(P("user-info")||"{}"),D={merchantId:m.mer,passwordChanged:1,challengeResult:I.challengeResult,updatePassword:{userId:m.uid,password:I.password}};F.value=!0,await _e(D),k.success("保存成功"),setTimeout(()=>{Fe.logout()},1e3)}catch(m){k.error("修改密码失败，请稍后再试"),F.value=!1,console.log("submitPass",m)}else console.log("error submit!",i)})};function Ee(){return{passFormRef:qe,passForm:I,passRules:Pe,submitPass:Oe,passLoading:F}}const n=f=>(Se("data-v-c6d26111"),f=f(),Ae(),f),Ge={class:"setting base-box p-36 ml-40 mr-40 mt-20"},Be={class:"flex justify-end w-full mb-40"},Me={class:"table-wrapper"},Je=n(()=>e("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[e("span",null,[e("img",{src:de,alt:""})]),e("span",{class:"custom-empty-text"},"暂无数据")],-1)),Le={key:0},He={key:1},$e={class:"base-box detail-box"},ze=n(()=>e("div",{class:"flex-center w-full mt-30 settlement-account-detail-title"},"结算账户详情",-1)),Ke={key:0},We={class:"settlement-account-detail-line"},Qe=n(()=>e("span",{class:"settlement-account-field"},"结算币种：",-1)),Ze={class:"settlement-account-value item-value"},je={class:"settlement-account-detail-line"},Xe=n(()=>e("span",{class:"settlement-account-field"},"银行国家/地区：",-1)),Ye={class:"settlement-account-value item-value"},et={class:"settlement-account-detail-line"},tt={key:0,class:"settlement-account-field"},st={key:1,class:"settlement-account-field"},ot={key:2,class:"settlement-account-field"},at={class:"settlement-account-value item-value"},lt={key:0,class:"settlement-account-detail-line"},nt=n(()=>e("span",{class:"settlement-account-field"},"美元银行账号：",-1)),ct={class:"settlement-account-value item-value"},it={class:"settlement-account-detail-line"},dt=n(()=>e("span",{class:"settlement-account-field"},"结算账户名称：",-1)),ut={class:"settlement-account-value item-value"},rt={class:"settlement-account-detail-line"},mt=n(()=>e("span",{class:"settlement-account-field"},"收款人地址：",-1)),pt={class:"settlement-account-value item-value"},_t=n(()=>e("div",{class:"enterprise-label mb-30"},"企业信息",-1)),vt={class:"settlement-account-detail-line"},ft=n(()=>e("span",{class:"settlement-account-field"},"城市：",-1)),ht={class:"settlement-account-value item-value"},gt={class:"settlement-account-detail-line"},bt=n(()=>e("span",{class:"settlement-account-field"},"州/省：",-1)),yt={class:"settlement-account-value item-value"},wt={class:"settlement-account-detail-line"},Vt=n(()=>e("span",{class:"settlement-account-field"},"邮编：",-1)),kt={class:"settlement-account-value item-value"},xt={key:1},St={class:"settlement-account-detail-line"},At=n(()=>e("span",{class:"settlement-account-field"},"结算币种：",-1)),Ct={class:"settlement-account-value item-value"},It={class:"settlement-account-detail-line"},Dt=n(()=>e("span",{class:"settlement-account-field"},"USDT 钱包地址：",-1)),Nt={class:"settlement-account-value item-value"},Rt={class:"settlement-account-detail-line"},Ut=n(()=>e("span",{class:"settlement-account-field"},"钱包名称/备注：",-1)),Tt={class:"settlement-account-value item-value"},Ft={class:"flex-center w-full mt-30 settlement-account-return-btn"},Pt=n(()=>e("div",{class:"item-desc mt-14"},"如需修改登录邮箱，请联系客服",-1)),qt={class:"w-full flex"},Ot={key:0},Et=n(()=>e("div",{class:"bound-google mt-80"},[e("img",{src:re,class:"bound-google-img"}),e("div",{class:"bound-google-text ml-28"},[e("div",{class:"bound-google-title"},"已绑定谷歌验证器"),e("div",{class:"bound-google-tips mt-8 mb-50"},"使用谷歌验证器 (Google Authenticator) 获取谷歌验证码")])],-1)),Gt={class:"google-download flex ml-92"},Bt={key:1,style:{"max-width":"640px"}},Mt=n(()=>e("div",{class:"google-title mt-40"},"开启谷歌安全验证，将极大的保障您的账户安全",-1)),Jt=n(()=>e("div",{class:"google-text mt-30 mb-14"},"使用谷歌验证器 (Google Authenticator) 扫描二维码进行绑定",-1)),Lt={class:"google-download flex"},Ht={key:0,class:"auth-img mt-40 mb-50 ml-5"},$t=["src"],zt={key:1,class:"auth-img mt-40 mb-50 ml-5 flex-center"},Kt={class:"google-qrcode-loading"},Wt={class:"w-full mb-60"},Qt=n(()=>e("div",{class:"google-input-label mb-12 flex-1"},"谷歌验证码",-1)),Zt={class:""},jt={class:"flex"},Xt=ke({__name:"Index",setup(f){const c=JSON.parse(P("user-info")||"{}"),i=v(c["otp.enabled"]==="1"),m=v({otp:"",totpID:""}),D=K(),N=v("settlementAccount"),q=v("USD"),l=v({id:""}),O=v([]),R=v(!1),x=v(!1),S=v(!1),E=v(""),{passFormRef:G,passForm:g,passRules:Q,submitPass:Z,passLoading:j}=Ee(),X=async()=>{if(!m.value.otp){k.error("请输入谷歌验证码");return}const d={totpID:m.value.totpID,otp:m.value.otp};ue(d).then(()=>{k.success("绑定成功"),fe(JSON.stringify({...c,"otp.enabled":"1"}),"user-info"),i.value=!0}).catch(o=>{k.success("操作失败"),console.error(o)})},Y=async()=>{try{const d=await me({id:c.mer});m.value.totpID=d.data.totpId,m.value.qrcode=d.data.qrcode}catch(d){console.log("getOtpQr",d)}},ee=()=>{N.value==="google"&&!i.value&&Y()},B=()=>{const d=[];d.push({columnName:"luMerchant",value:c.mer}),Ie({searchItems:d,sorting:{columnNames:["createdAt"],direction:"desc"}}).then(h=>{O.value=he(h.data.rows)}).catch(h=>{console.error(h)})},te=d=>{q.value=d.currency,l.value=d,S.value=!0},se=()=>{S.value=!1},oe=()=>{R.value=!0},M=()=>{window.open("https://docs.likupay.com/google-authenticator","_blank")},ae=()=>{B()},le=async()=>{try{const d=await ge(c.mer);E.value=be(d.data||[],"kyb.companyName")}catch(d){console.error("getKybInfo",d)}};return xe(()=>{le(),B(),i.value=c["otp.enabled"]==="1"}),(d,o)=>{const h=b("el-button"),V=b("el-table-column"),U=b("el-tab-pane"),A=b("el-input"),C=b("el-form-item"),ne=b("el-form"),J=b("SvgIcon"),ce=b("el-tabs"),L=H("permission"),ie=H("loading");return r(),_("div",Ge,[s(ce,{modelValue:N.value,"onUpdate:modelValue":o[9]||(o[9]=t=>N.value=t),class:"page-tabs",onTabChange:ee},{default:a(()=>[s(U,{label:"结算账户",name:"settlementAccount"},{default:a(()=>[e("div",Be,[T((r(),$(h,{type:"primary",onClick:o[0]||(o[0]=t=>x.value=!0)},{default:a(()=>[y("新增结算账户 ")]),_:1})),[[L,["agent"]]]),u(D).merchantAuth==="1"?T((r(),$(h,{key:0,type:"primary",onClick:o[1]||(o[1]=t=>x.value=!0)},{default:a(()=>[y("新增结算账户 ")]),_:1})),[[L,["merchant"]]]):w("",!0)]),e("div",Me,[s(u(Ve),{data:O.value,style:{width:"100%"}},{empty:a(()=>[Je]),default:a(()=>[s(V,{prop:"accountName",label:"结算账户名称",width:"200"}),s(V,{prop:"currency",label:"账户币种"},{default:a(t=>[t.row.currency==="USD"?(r(),_("div",Le,"USD (美元)")):t.row.currency==="USDT"?(r(),_("div",He,"USDT (TRC20)")):w("",!0)]),_:1}),s(V,{prop:"account",label:"收款账户"},{default:a(t=>[e("div",null,p(t.row.account||t.row.bankAddress),1)]),_:1}),s(V,{prop:"createdAt",label:"创建时间",width:"200"},{default:a(t=>[e("div",null,p(u(ve)(t.row.createdAt)),1)]),_:1}),s(V,{label:"操作",width:"140",fixed:"right"},{default:a(t=>[s(h,{link:"",type:"primary",size:"default",onClick:Yt=>te(t.row)},{default:a(()=>[y(" 管理结算账户 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),s(pe,{modelValue:S.value,"onUpdate:modelValue":o[2]||(o[2]=t=>S.value=t)},{default:a(()=>[e("div",$e,[ze,q.value=="USD"?(r(),_("div",Ke,[e("div",We,[Qe,e("span",Ze,p(l.value.currency),1)]),e("div",je,[Xe,e("span",Ye,p(l.value.region),1)]),e("div",et,[l.value.bankName==="IBAN"?(r(),_("span",tt,"IBAN：")):w("",!0),l.value.bankName==="ACH"?(r(),_("span",st,"ACH 汇款路由号：")):w("",!0),l.value.bankName==="SWIFT"?(r(),_("span",ot,"SWIFT Code：")):w("",!0),e("span",at,p(l.value.bankAddress),1)]),l.value.bankName==="ACH"||l.value.bankName==="SWIFT"?(r(),_("div",lt,[nt,e("span",ct,p(l.value.account),1)])):w("",!0),e("div",it,[dt,e("span",ut,p(l.value.accountName),1)]),e("div",rt,[mt,e("span",pt,p(l.value.companyAddress),1)]),_t,e("div",vt,[ft,e("span",ht,p(l.value.city),1)]),e("div",gt,[bt,e("span",yt,p(l.value.province),1)]),e("div",wt,[Vt,e("span",kt,p(l.value.postCode),1)])])):(r(),_("div",xt,[e("div",St,[At,e("span",Ct,p(l.value.currency),1)]),e("div",It,[Dt,e("span",Nt,p(l.value.account),1)]),e("div",Rt,[Ut,e("span",Tt,p(l.value.accountName),1)])])),e("div",Ft,[s(h,{onClick:se},{default:a(()=>[y("返回")]),_:1})]),e("div",{class:"flex-center w-full del-btn cursor-pointer",onClick:oe}," 删除结算账户 ")])]),_:1},8,["modelValue"])]),_:1}),s(U,{label:"修改密码",name:"pass"},{default:a(()=>[s(ne,{style:{"max-width":"640px"},ref_key:"passFormRef",ref:G,"label-position":"top",model:u(g),rules:u(Q),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:a(()=>[s(C,{label:"登录邮箱",prop:"name"},{default:a(()=>[s(A,{modelValue:u(g).name,"onUpdate:modelValue":o[3]||(o[3]=t=>u(g).name=t),disabled:""},null,8,["modelValue"]),Pt]),_:1}),s(C,{label:"设置新密码",prop:"password"},{default:a(()=>[s(A,{modelValue:u(g).password,"onUpdate:modelValue":o[4]||(o[4]=t=>u(g).password=t),type:"password",placeholder:"请输入新密码",maxlength:"30"},null,8,["modelValue"])]),_:1}),s(C,{label:"确认新密码",prop:"rePass"},{default:a(()=>[s(A,{modelValue:u(g).rePass,"onUpdate:modelValue":o[5]||(o[5]=t=>u(g).rePass=t),type:"password",placeholder:"请再次输入新密码",maxlength:"30"},null,8,["modelValue"])]),_:1}),s(Ce,{label:"验证旧密码",placeholder:"请输入旧密码",modelValue:u(g).challengeResult,"onUpdate:modelValue":o[6]||(o[6]=t=>u(g).challengeResult=t)},null,8,["modelValue"]),s(C,null,{default:a(()=>[e("div",qt,[s(h,{type:"primary",loading:u(j),onClick:o[7]||(o[7]=t=>u(Z)(u(G)))},{default:a(()=>[y("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),s(U,{label:"谷歌验证器",name:"google"},{default:a(()=>[i.value?(r(),_("div",Ot,[Et,e("div",Gt,[e("div",{class:"cursor-pointer",onClick:M},[y(" 下载 Google Authenticator "),s(J,{name:"icon-xiazai",class:"ml-5"})])])])):(r(),_("div",Bt,[Mt,Jt,e("div",Lt,[e("div",{class:"cursor-pointer",onClick:M},[y(" 下载 Google Authenticator "),s(J,{name:"icon-xiazai",class:"ml-5"})])]),m.value.qrcode?(r(),_("div",Ht,[e("img",{src:"data:image/png;base64,"+m.value.qrcode,class:"google-auth-img"},null,8,$t)])):(r(),_("div",zt,[T(e("span",Kt,null,512),[[ie,!0]])])),e("div",Wt,[Qt,e("div",Zt,[s(A,{modelValue:m.value.otp,"onUpdate:modelValue":o[8]||(o[8]=t=>m.value.otp=t),placeholder:"请输入谷歌验证码",maxlength:"6"},null,8,["modelValue"])])]),e("div",jt,[s(h,{type:"primary",onClick:X},{default:a(()=>[y("绑定")]),_:1})])]))]),_:1})]),_:1},8,["modelValue"]),s(De,{modelValue:x.value,"onUpdate:modelValue":o[10]||(o[10]=t=>x.value=t),id:u(c).mer,role:"merchant","company-name":E.value,onRefresh:ae},null,8,["modelValue","id","company-name"]),s(Ne,{modelValue:R.value,"onUpdate:modelValue":o[11]||(o[11]=t=>R.value=t),id:l.value.id},null,8,["modelValue","id"])])}}}),_s=ye(Xt,[["__scopeId","data-v-c6d26111"]]);export{_s as default};
