import{l as M,aL as S,r as m,aK as z,b as k,ah as f,ap as I,m as p,p as g,U as x,O as T,a2 as V,P as q,M as E,R as N,S as P,T as B,I as D}from"./vue-C87Wc4A0.js";import{P as R,E as U,X as O,_ as A}from"./index-c78MVIZI.js";import{E as h}from"./element-CD5rsoqi.js";function K(c){return R({url:"/secruritytoken",method:"get",params:c})}const L={class:"w-full h-full"},W={key:1,class:"w-full h-full flex-center upload-text"},X=M({__name:"Index",props:S(["ext","id"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const i=c,s=m(""),_=m("image/png, image/jpeg"),t=m(),o=m(!1);let n="";const d=z(c,"modelValue"),C=e=>{if(o.value)return!1;const a=e.type;if(!(i.ext==="excel"&&(a.startsWith("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")||a==="application/vnd.ms-excel"))){if(!(i.ext==="img"&&["image/jpeg","image/png","image/gif","image/jpg"].includes(a)))return h.error("文件格式错误"),u(),!1}return e.size/1024/1024>2?(h.error("上传文件最大为2M"),!1):(t.value=e,!0)},w=async()=>{var a,r;o.value=!0;const e={role:"likustatics",action:"PutObject",fileName:t.value.name};try{const l=await K(e),v=(a=l.data)==null?void 0:a.url;return n=(r=l.data)==null?void 0:r.objectPath,O({url:v,method:"put",data:t.value})}catch(l){console.error(l),o.value=!1,h.error("上传失败，请重试")}},b=e=>{d.value=n,s.value=U(n),o.value=!1,console.log("success",e)},u=()=>{d.value="",s.value="",n="",t.value=void 0,o.value=!1};return k(()=>i.ext,e=>{_.value=e==="img"?"image/png, image/jpeg":".xls, .xlsx"},{immediate:!0}),k(()=>d.value,e=>{e?s.value=U(e):u()},{immediate:!0}),(e,a)=>{const r=f("SvgIcon"),l=f("el-image"),v=f("el-upload"),j=I("loading");return p(),g("div",L,[x(v,{accept:_.value,class:D(s.value&&i.ext==="img"?"":"upload"),"http-request":w,"show-file-list":!1,"on-success":b,"on-error":u,"before-upload":C},{default:T(()=>{var y;return[s.value&&i.ext==="img"?(p(),g("div",{key:0,onClick:a[0]||(a[0]=V(()=>{},["stop","prevent"])),class:"position-relative"},[x(r,{name:"icon-x-2",class:"close",style:{"z-index":"999"},color:"#9296A4",onClick:u,size:"20px"}),x(l,{style:{width:"100px",height:"100px"},src:s.value,fit:"cover","preview-src-list":[s.value],"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"initial-index":4},null,8,["src","preview-src-list"])])):q((p(),g("div",W,[t.value?N("",!0):(p(),E(r,{key:0,name:"icon-dianjishangchuan",class:"mr-10"})),P(" "+B(((y=t.value)==null?void 0:y.name)||"点击上传"),1)])),[[j,o.value]])]}),_:1},8,["accept","class"])])}}}),Q=A(X,[["__scopeId","data-v-f20e63d4"]]);export{Q as U};
