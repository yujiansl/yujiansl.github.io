import{b as be,_ as he,g as ye}from"./index-Dr7EymDI.js";import{F as Q}from"./Index-Di390-Cq.js";import{f as Ve,e as L,j as we,k as Ae,_ as Se}from"./index-Cfrc5ih1.js";import{b as ke}from"./validate-JA1bY0wI.js";import{m as Ue}from"./index-C7XNEq9c.js";import{E as w,n as xe}from"./element-BbMnn7tA.js";import{r as v,Z as R,l as Re,d as De,ah as h,ap as Ne,m as S,p as U,U as l,O as s,q as e,S as y,u as m,T as V,F as Ce,a7 as Te,M as Z,P as Fe,aF as Ie,aG as qe}from"./vue-BtEXIrqH.js";import{V as F}from"./index-BwQtaG9W.js";import{_ as Pe}from"./Index.vue_vue_type_script_setup_true_lang-TK6O32Dg.js";import{g as Oe,c as K,d as Ge}from"./index-BqctQlg1.js";import{a as $e}from"./commonFn-Ei0WKKhK.js";import"./LIKU-logo-BbnHVERV.js";import"//at.alicdn.com/t/c/font_4557022_266y8yxi6v9.js";import"./vxe-EK889JN8.js";const Le=(A,d,i)=>{d===""?i(new Error("请输入密码")):ke(d)?i():i(new Error("密码格式错误"))},Be=(A,d,i)=>{d===""?i(new Error("请输入验证码")):i()},Ee=(A,d,i)=>{d===""?i(new Error("请再次输入密码")):d!==I.password?i(new Error("两次输入的密码不一致")):i()},$=v(!1),Me=Ve(),Je=R({password:[{required:!0,validator:Le,trigger:"blur"}],rePass:[{required:!0,validator:Ee,trigger:"blur"}],challengeResult:[{required:!0,validator:Be,trigger:"blur"}]}),ze=v(),W=JSON.parse(L("user-info")||"{}"),I=R({email:W.name,name:W.name,password:"",rePass:"",challengeResult:""}),je=async A=>{A&&await A.validate(async(d,i)=>{if(d)try{const p=JSON.parse(L("user-info")||"{}"),q={merchantId:p.mer,passwordChanged:1,challengeResult:I.challengeResult,updatePassword:{userId:p.uid,password:I.password}};$.value=!0,await Ue(q),w.success("保存成功"),setTimeout(()=>{Me.logout()},1e3)}catch(p){w.error("修改密码失败，请稍后再试"),$.value=!1,console.log("submitPass",p)}else console.log("error submit!",i)})};function He(){return{passFormRef:ze,passForm:I,passRules:Je,submitPass:je,passLoading:$}}const u=A=>(Ie("data-v-75e1ac95"),A=A(),qe(),A),Qe={class:"order base-box p-36 ml-40 mr-40 mt-20"},Ze={class:"flex justify-end w-full mb-40"},Ke={class:"table-wrapper"},We={class:"base-box detail-box"},Xe=u(()=>e("div",{class:"flex-center w-full mt-30 settlement-account-detail-title"},"结算账户详情",-1)),Ye={key:0},et={class:"settlement-account-detail-line"},tt=u(()=>e("span",{class:"settlement-account-field"},"结算币种：",-1)),lt={class:"settlement-account-value"},ot={class:"settlement-account-detail-line"},st=u(()=>e("span",{class:"settlement-account-field"},"银行国家/地区：",-1)),at={class:"settlement-account-value"},nt={class:"settlement-account-detail-line"},ct=u(()=>e("span",{class:"settlement-account-field"},"银行名称：",-1)),ut={class:"settlement-account-value"},rt={class:"settlement-account-detail-line"},dt=u(()=>e("span",{class:"settlement-account-field"},"银行地址：",-1)),it={class:"settlement-account-value"},mt={class:"settlement-account-detail-line"},pt=u(()=>e("span",{class:"settlement-account-field"},"结算账户名称：",-1)),_t={class:"settlement-account-value"},vt={class:"settlement-account-detail-line"},ft=u(()=>e("span",{class:"settlement-account-field"},"银行账号：",-1)),gt={class:"settlement-account-value"},bt={class:"settlement-account-detail-line"},ht=u(()=>e("span",{class:"settlement-account-field"},"公司地址：",-1)),yt={class:"settlement-account-value"},Vt={key:1},wt={class:"settlement-account-detail-line"},At=u(()=>e("span",{class:"settlement-account-field"},"结算币种：",-1)),St={class:"settlement-account-value"},kt={class:"settlement-account-detail-line"},Ut=u(()=>e("span",{class:"settlement-account-field"},"USDT 钱包地址：",-1)),xt={class:"settlement-account-value"},Rt={class:"settlement-account-detail-line"},Dt=u(()=>e("span",{class:"settlement-account-field"},"钱包名称/备注：",-1)),Nt={class:"settlement-account-value"},Ct={class:"flex-center w-full mt-30 settlement-account-return-btn"},Tt={class:"detail-box"},Ft=u(()=>e("div",{class:"detail-title mb-50"},"新增结算收款账户",-1)),It=u(()=>e("div",{class:"select-currency"},[e("span",{class:"select-currency-flag"},"*"),e("span",{class:"select-currency-title"},"选择结算币种")],-1)),qt={class:"flex-center w-full mt-30"},Pt={class:"flex-center w-full mt-30"},Ot=u(()=>e("div",{class:"item-desc mt-14"},"如需修改登录邮箱，请联系客服",-1)),Gt={class:"w-full flex"},$t={key:0},Lt=u(()=>e("div",{class:"bound-google mt-80"},[e("img",{src:he,class:"bound-google-img"}),e("div",{class:"bound-google-text ml-28"},[e("div",{class:"bound-google-title"},"已绑定谷歌验证器"),e("div",{class:"bound-google-tips mt-8 mb-50"},"使用谷歌验证器 (Google Authenticator) 获取谷歌验证码")])],-1)),Bt={class:"google-download flex ml-92"},Et={key:1},Mt=u(()=>e("div",{class:"google-title mt-40"},"开启谷歌安全验证，将极大的保障您的账户安全",-1)),Jt=u(()=>e("div",{class:"google-text mt-30 mb-14"},"使用谷歌验证器 (Google Authenticator) 扫描二维码进行绑定",-1)),zt={class:"google-download flex"},jt={key:0,class:"auth-img mt-40 mb-50 ml-5"},Ht=["src"],Qt={key:1,class:"auth-img mt-40 mb-50 ml-5 flex-center"},Zt={class:"google-qrcode-loading"},Kt={class:"w-full mb-60"},Wt=u(()=>e("div",{class:"google-input-label mb-12 flex-1"},"谷歌验证码",-1)),Xt={class:""},Yt={class:"flex"},el=u(()=>e("div",{class:"delete-confirm-warning"}," 确定删除结算账户吗？ ",-1)),tl={class:"delete-google-otp"},ll={class:"delete-confirm-footer"},ol=Re({__name:"Index",setup(A){const d=JSON.parse(L("user-info")||"{}"),i=v(d["otp.enabled"]==="1"),p=v({otp:"",totpID:""}),q=[{value:"USD",label:"USD"},{value:"USDT",label:"USDT"}],n=R({id:"",role:"",currency:"USD",type:"10",region:"",bankName:"",bankAddress:"",account:"",accountName:"",companyAddress:"",remark:"",challengeResult:""}),g=R({id:"",role:"",currency:"USDT",type:"20",currency:"",account:"",accountName:"",challengeResult:""}),X=R({account:[{required:!0,message:"请输入USDT(TRC20)钱包地址",trigger:"blur"}],accountName:[{required:!0,message:"请输入钱包名称/备注",trigger:"blur"}]}),Y=R({region:[{required:!0,message:"请选择银行账户开户国家",trigger:"change"}],bankName:[{required:!0,message:"请输入银行名称",trigger:"blur"}],bankAddress:[{required:!0,message:"请输入银行地址",trigger:"blur"}],account:[{required:!0,message:"请输入完整的银行账号",trigger:"blur"}],accountName:[{required:!0,message:"请输入结算账户名称",trigger:"blur"}],companyAddress:[{required:!0,message:"请输入公司所在地址",trigger:"blur"}]}),D=R({id:"",challengeResult:""}),B=v(),E=v(),M=v();we();const P=v("settlementAccount"),x=v("USD"),f=v({}),J=v([]),N=v(!1),C=v(!1),O=v(!1),{passFormRef:z,passForm:k,passRules:ee,submitPass:te,passLoading:le}=He(),oe=async()=>{if(!p.value.otp){w.error("请输入谷歌验证码");return}const a={totpID:p.value.totpID,otp:p.value.otp};be(a).then(()=>{w.success("绑定成功"),Ae(JSON.stringify({...d,"otp.enabled":"1"}),"user-info"),i.value=!0}).catch(t=>{w.success("操作失败"),console.error(t)})},se=async()=>{try{const a=await ye({id:d.mer});p.value.totpID=a.data.totpId,p.value.qrcode=a.data.qrcode}catch(a){console.log("getOtpQr",a)}},ae=(a,t)=>{P.value==="google"&&!i.value&&se()},ne=()=>{const a=[];a.push({columnName:"luMerchant",value:d.mer}),Oe({searchItems:a}).then(c=>{J.value=c.data.rows}).catch(c=>{console.error(c)})},ce=async a=>{a&&await a.validate((t,c)=>{if(t)try{n.currency=x,n.role="merchant",n.id=d.mer,K(n).then(()=>{w.success("保存成功"),setTimeout(()=>{window.location.reload()},1e3)}).catch(r=>{w.error("操作失败"),console.error(r)})}catch(r){console.error(r)}else console.error("error submit!",c)})},ue=async a=>{a&&await a.validate((t,c)=>{if(t)try{g.currency=x,g.role="merchant",g.id=d.mer,K(g).then(()=>{w.success("保存成功"),setTimeout(()=>{window.location.reload()},1e3)}).catch(r=>{w.error("操作失败"),console.error(r)})}catch(r){console.error(r)}else console.error("error submit!",c)})},re=a=>{x.value=a.currency.value,f.value=a,C.value=!0},de=a=>{C.value=!1},ie=()=>{N.value=!0},me=async a=>{a&&await a.validate((t,c)=>{if(t)try{D.id=f.value.id.value,Ge(D).then(r=>{w.success("删除成功"),setTimeout(()=>{window.location.reload()},1e3)}).catch(r=>{w.error("操作失败"),console.log(r)})}catch(r){console.error(r)}else console.e("error submit!",c)})},j=()=>{window.open("https://docs.liku.io/google-authenticator","_blank")};return De(()=>{ne(),i.value=d["otp.enabled"]==="1"}),(a,t)=>{const c=h("el-button"),r=h("el-table-column"),pe=h("el-option"),_e=h("el-select"),_=h("el-form-item"),b=h("el-input"),T=h("el-form"),G=h("el-tab-pane"),H=h("SvgIcon"),ve=h("el-tabs"),fe=h("el-dialog"),ge=Ne("loading");return S(),U("div",Qe,[l(ve,{modelValue:P.value,"onUpdate:modelValue":t[22]||(t[22]=o=>P.value=o),class:"page-tabs",onTabChange:ae},{default:s(()=>[l(G,{label:"结算账户",name:"settlementAccount"},{default:s(()=>[e("div",Ze,[l(c,{type:"primary",onClick:t[0]||(t[0]=o=>O.value=!0)},{default:s(()=>[y("新增结算账户")]),_:1})]),e("div",Ke,[l(m(xe),{data:J.value,style:{width:"100%"}},{default:s(()=>[l(r,{prop:"accountName.value",label:"结算账户名称",width:"200"}),l(r,{prop:"currency.value",label:"账户币种",width:"200"}),l(r,{prop:"account.value",label:"收款账户",width:"260"}),l(r,{prop:"createdAt.value",label:"创建时间",width:"260"},{default:s(o=>[e("div",null,V(m($e)(o.row.createdAt.value)),1)]),_:1}),l(r,{label:"操作",width:"130"},{default:s(o=>[l(c,{link:"",type:"primary",size:"default",onClick:sl=>re(o.row)},{default:s(()=>[y(" 管理结算账户 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),l(Q,{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=o=>C.value=o)},{default:s(()=>[e("div",We,[Xe,x.value==="USD"?(S(),U("div",Ye,[e("div",et,[tt,e("span",lt,V(f.value.currency.value),1)]),e("div",ot,[st,e("span",at,V(f.value.region.value),1)]),e("div",nt,[ct,e("span",ut,V(f.value.bankName.value),1)]),e("div",rt,[dt,e("span",it,V(f.value.bankAddress.value),1)]),e("div",mt,[pt,e("span",_t,V(f.value.accountName.value),1)]),e("div",vt,[ft,e("span",gt,V(f.value.account.value),1)]),e("div",bt,[ht,e("span",yt,V(f.value.companyAddress.value),1)])])):(S(),U("div",Vt,[e("div",wt,[At,e("span",St,V(f.value.currency.value),1)]),e("div",kt,[Ut,e("span",xt,V(f.value.account.value),1)]),e("div",Rt,[Dt,e("span",Nt,V(f.value.accountName.value),1)])])),e("div",Ct,[l(c,{onClick:de},{default:s(()=>[y("返回")]),_:1})]),e("div",{class:"flex-center w-full del-btn cursor-pointer",onClick:ie}," 删除结算账户 ")])]),_:1},8,["modelValue"]),l(Q,{modelValue:O.value,"onUpdate:modelValue":t[15]||(t[15]=o=>O.value=o)},{default:s(()=>[e("div",Tt,[Ft,It,l(_e,{class:"select-currency-input",modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=o=>x.value=o)},{default:s(()=>[(S(),U(Ce,null,Te(q,o=>l(pe,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),x.value==="USD"?(S(),Z(T,{key:0,ref_key:"settlementAccountFormRef",ref:B,"label-position":"top",rules:Y,"label-width":"auto",model:n},{default:s(()=>[l(_,{prop:"region",label:"银行国家/地区"},{default:s(()=>[l(Pe,{modelValue:n.region,"onUpdate:modelValue":t[3]||(t[3]=o=>n.region=o),type:"region",placeholder:"请选择银行账户开户国家/地区"},null,8,["modelValue"])]),_:1}),l(_,{prop:"bankName",label:"银行名称"},{default:s(()=>[l(b,{modelValue:n.bankName,"onUpdate:modelValue":t[4]||(t[4]=o=>n.bankName=o),placeholder:"请输入银行名称",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(_,{prop:"bankAddress",label:"银行地址"},{default:s(()=>[l(b,{modelValue:n.bankAddress,"onUpdate:modelValue":t[5]||(t[5]=o=>n.bankAddress=o),placeholder:"请输入银行地址",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(_,{prop:"accountName",label:"结算账户名称"},{default:s(()=>[l(b,{modelValue:n.accountName,"onUpdate:modelValue":t[6]||(t[6]=o=>n.accountName=o),placeholder:"请输入结算账户名称",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(_,{prop:"account",label:"银行账号"},{default:s(()=>[l(b,{modelValue:n.account,"onUpdate:modelValue":t[7]||(t[7]=o=>n.account=o),placeholder:"请输入完整的银行账号",maxlength:"64"},null,8,["modelValue"])]),_:1}),l(_,{prop:"companyAddress",label:"公司地址"},{default:s(()=>[l(b,{modelValue:n.companyAddress,"onUpdate:modelValue":t[8]||(t[8]=o=>n.companyAddress=o),placeholder:"请输入公司所在地址",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(F,{modelValue:n.challengeResult,"onUpdate:modelValue":t[9]||(t[9]=o=>n.challengeResult=o)},null,8,["modelValue"]),l(_,null,{default:s(()=>[e("div",qt,[l(c,{type:"primary",onClick:t[10]||(t[10]=o=>ce(B.value))},{default:s(()=>[y("保存 ")]),_:1})])]),_:1})]),_:1},8,["rules","model"])):(S(),Z(T,{key:1,ref_key:"trcSettlementAccountFormRef",ref:E,"label-position":"top",rules:X,"label-width":"auto",model:g},{default:s(()=>[l(_,{prop:"account",label:"USDT钱包地址"},{default:s(()=>[l(b,{modelValue:g.account,"onUpdate:modelValue":t[11]||(t[11]=o=>g.account=o),placeholder:"请输入USDT(TRC20)钱包地址",maxlength:"64"},null,8,["modelValue"])]),_:1}),l(_,{prop:"accountName",label:"钱包名称/备注"},{default:s(()=>[l(b,{modelValue:g.accountName,"onUpdate:modelValue":t[12]||(t[12]=o=>g.accountName=o),placeholder:"请输入钱包名称备注",maxlength:"30"},null,8,["modelValue"])]),_:1}),l(F,{modelValue:g.challengeResult,"onUpdate:modelValue":t[13]||(t[13]=o=>g.challengeResult=o)},null,8,["modelValue"]),l(_,null,{default:s(()=>[e("div",Pt,[l(c,{type:"primary",onClick:t[14]||(t[14]=o=>ue(E.value))},{default:s(()=>[y("保存 ")]),_:1})])]),_:1})]),_:1},8,["rules","model"]))])]),_:1},8,["modelValue"])]),_:1}),l(G,{label:"修改密码",name:"pass"},{default:s(()=>[l(T,{ref_key:"passFormRef",ref:z,"label-position":"top",model:m(k),rules:m(ee),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:s(()=>[l(_,{label:"登录邮箱",prop:"name"},{default:s(()=>[l(b,{modelValue:m(k).name,"onUpdate:modelValue":t[16]||(t[16]=o=>m(k).name=o),disabled:""},null,8,["modelValue"]),Ot]),_:1}),l(_,{label:"新密码",prop:"password"},{default:s(()=>[l(b,{modelValue:m(k).password,"onUpdate:modelValue":t[17]||(t[17]=o=>m(k).password=o),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),l(_,{label:"确认新密码",prop:"rePass"},{default:s(()=>[l(b,{modelValue:m(k).rePass,"onUpdate:modelValue":t[18]||(t[18]=o=>m(k).rePass=o),type:"password",placeholder:"请输入确认密码"},null,8,["modelValue"])]),_:1}),l(F,{modelValue:m(k).challengeResult,"onUpdate:modelValue":t[19]||(t[19]=o=>m(k).challengeResult=o)},null,8,["modelValue"]),l(_,null,{default:s(()=>[e("div",Gt,[l(c,{type:"primary",loading:m(le),onClick:t[20]||(t[20]=o=>m(te)(m(z)))},{default:s(()=>[y("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),l(G,{label:"谷歌验证器",name:"google"},{default:s(()=>[i.value?(S(),U("div",$t,[Lt,e("div",Bt,[e("div",{class:"cursor-pointer",onClick:j},[y(" 下载 Google Authenticator "),l(H,{name:"icon-xiazai",class:"ml-5"})])])])):(S(),U("div",Et,[Mt,Jt,e("div",zt,[e("div",{class:"cursor-pointer",onClick:j},[y(" 下载 Google Authenticator "),l(H,{name:"icon-xiazai",class:"ml-5"})])]),p.value.qrcode?(S(),U("div",jt,[e("img",{src:"data:image/png;base64,"+p.value.qrcode,class:"google-auth-img"},null,8,Ht)])):(S(),U("div",Qt,[Fe(e("span",Zt,null,512),[[ge,!0]])])),e("div",Kt,[Wt,e("div",Xt,[l(b,{modelValue:p.value.otp,"onUpdate:modelValue":t[21]||(t[21]=o=>p.value.otp=o),placeholder:"请输入谷歌验证码"},null,8,["modelValue"])])]),e("div",Yt,[l(c,{type:"primary",onClick:oe},{default:s(()=>[y("绑定")]),_:1})])]))]),_:1})]),_:1},8,["modelValue"]),l(fe,{modelValue:N.value,"onUpdate:modelValue":t[26]||(t[26]=o=>N.value=o),center:"",style:{width:"480px"}},{footer:s(()=>[e("div",ll,[l(c,{type:"primary",onClick:t[24]||(t[24]=o=>me(M.value))},{default:s(()=>[y(" 确定删除 ")]),_:1}),l(c,{onClick:t[25]||(t[25]=o=>N.value=!1)},{default:s(()=>[y("取消")]),_:1})])]),default:s(()=>[el,e("div",tl,[l(T,{ref_key:"deleteSettlementAccountFormRef",ref:M,"label-position":"top","label-width":"auto",model:D},{default:s(()=>[l(F,{modelValue:D.challengeResult,"onUpdate:modelValue":t[23]||(t[23]=o=>D.challengeResult=o)},null,8,["modelValue"])]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}}),hl=Se(ol,[["__scopeId","data-v-75e1ac95"]]);export{hl as default};
