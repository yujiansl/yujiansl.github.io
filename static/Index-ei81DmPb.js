import{l as fe,r as u,Z as be,d as ye,ah as b,ap as xe,m as d,p as v,q as e,T as c,U as l,O as n,F as M,a7 as R,M as F,a8 as we,S as P,P as Se,u as s,I as Ce,R as U,aF as Ve,aG as Ae}from"./vue-C87Wc4A0.js";import{_ as ke}from"./empty-BiNgvBdS.js";import{u as Te}from"./useTable-CVQ-UVVt.js";import{f as Fe,e as Ne,B as H,q as h,w as z,C as De,E as K,i as Ie,x as Le,F as Me,G as Re,o as O,k as j,_ as Pe}from"./index-c78MVIZI.js";import{F as Ue}from"./Index-BU8kA-XB.js";import{V as ze}from"./index-BZHf1ii5.js";import{a as G}from"./index-Cap7k8T_.js";import{g as Ee}from"./index-Cwe4D9Ts.js";import{s as We,a as Be}from"./index-CKZZcXKM.js";import{g as Ye}from"./index-DYQLPh63.js";import{n as qe,E}from"./element-CD5rsoqi.js";import"//at.alicdn.com/t/c/font_4557022_0o7l3b0t8egq.js";import"./vxe-sm_XFqm0.js";import"./LIKU-logo-CHqxCLOK.js";const i=C=>(Ve("data-v-0a703a89"),C=C(),Ae(),C),He={class:"top-balance base-box flex flex-wrap ml-40 mr-40 mt-20"},Ke={class:"balance-item pr-80"},Oe=i(()=>e("div",{class:"item-title"},"可结算余额 （USD）",-1)),je={class:"item-price mt-10 mb-8"},Ge=i(()=>e("div",{class:"item-text"},"结算币种以美元结算",-1)),Ze={class:"balance-item"},Je=i(()=>e("div",{class:"item-title"},"账户余额 （USD）",-1)),$e={class:"item-price mt-10 mb-8"},Qe=i(()=>e("div",{class:"item-text"},"账户余额为预估汇率计算所得，以实际入账金额为准",-1)),Xe={class:"order base-box mt-20"},et={class:"top-search"},tt=i(()=>e("div",{class:"table-title mb-33"},"结算记录",-1)),at={class:"table-wrapper"},lt=i(()=>e("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[e("span",null,[e("img",{src:ke,alt:""})]),e("span",{class:"custom-empty-text"},"暂无数据")],-1)),st={key:0},ot={key:0},nt=["onClick"],rt={class:"pager-wrapper mt-32 flex justify-end"},ct={class:"base-box detail-box"},it=i(()=>e("div",{class:"detail-title mb-50"},"结算账单详情",-1)),dt={class:"mb-24 flex"},ut=i(()=>e("div",{class:"order-text"},"结算批次号：",-1)),mt={class:"order-value"},vt={class:"mb-24 flex"},_t=i(()=>e("div",{class:"order-text"},"结算状态：",-1)),pt={class:"order-value"},ht={class:"mb-24 flex"},gt=i(()=>e("div",{class:"order-text"},"结算金额：",-1)),ft={class:"order-value"},bt={class:"mb-24 flex"},yt=i(()=>e("div",{class:"order-text"},"订单币种金额：",-1)),xt={class:"order-value"},wt={class:"mb-24 flex"},St=i(()=>e("div",{class:"order-text"},"汇率：",-1)),Ct={class:"order-value"},Vt={class:"mb-24 flex"},At=i(()=>e("div",{class:"order-text"},"订单笔数：",-1)),kt={class:"order-value"},Tt={class:"mb-24 flex"},Ft=i(()=>e("div",{class:"order-text"},"收单手续费：",-1)),Nt={class:"order-value"},Dt=i(()=>e("div",{class:"mb-24 flex"},[e("div",{class:"order-text"},"结算手续费："),e("div",{class:"order-value"},"0")],-1)),It={class:"mb-24 flex"},Lt=i(()=>e("div",{class:"order-text"},"账单时间：",-1)),Mt={class:"order-value"},Rt=i(()=>e("div",{class:"order-line mt-42 mb-40"},null,-1)),Pt={class:"mb-24 flex"},Ut=i(()=>e("div",{class:"order-text"},"实际结算金额：",-1)),zt={key:0,class:"order-value"},Et={key:1,class:"order-value"},Wt={key:2,class:"order-value"},Bt={class:"flex-center mt-60"},Yt={key:1},qt={class:"mb-24 flex"},Ht=i(()=>e("div",{class:"order-text"},"结算收款账户：",-1)),Kt={class:"order-value"},Ot={class:"mb-24 flex"},jt=i(()=>e("div",{class:"order-text"},"申请结算时间：",-1)),Gt={class:"order-value"},Zt={key:0,class:"mb-24 flex"},Jt=i(()=>e("div",{class:"order-text"},"结算打款凭证：",-1)),$t={class:"order-value"},Qt=fe({__name:"Index",setup(C){const N=u(""),W=Fe(),Z=u([]),J=u(),_=u({payWay:"",channel:"",username:"",state:"",luVirtualMerchant:"",settlementProcessNo:""}),g=be({account:"",challengeResult:"",type:""}),x=u({}),D=u([]),f=u({}),B=[{label:"可结算",value:"10"},{label:"审核中",value:"20"},{label:"已结算",value:"30"}],Y=u([]),w=JSON.parse(Ne("user-info")||"{}"),$=u([]),Q=u([]),V=u(!1),A=u(!1),r=u({averageExchangeRate:"",createdAt:"",orderCount:"",orderCurrencyMultiply:"",orderTotal:"",settlementAmount:"",settlementCurrency:"",settlementProcessNo:"",orderCurrency:"",settlementServiceFee:"",settlementTotal:"",state:""}),I=u({settled:"0",onAir:"0"}),{paginationData:S,handleCurrentChange:X,tableData:ee,loadingRef:te,handSearch:ae}=Te({url:"/settlement/list?tableView=SettledSettlementView",method:"post"});function k(){const a=[];for(const o in _.value){let m=_.value[o];Array.isArray(m)&&(m=m.map(y=>Ie.utc(new Date(y)).format("YYYY-MM-DD HH:mm:ss")).toString()),m&&a.push({columnName:o,value:m})}a.push({columnName:N.value==="merchant"?"luMerchant":"luAgent",value:w.mer||w.agent}),ae(a)}const le=async()=>{try{const a=await Le();$.value=a.data.map(o=>({name:o.code+"站点",value:o.code}))}catch(a){console.log(a,"e")}},se=async()=>{try{const a=await Me();a.data&&a.data.length&&(Q.value=a.data)}catch(a){console.log(a,"e")}},oe=a=>{console.log(a,"val"),Z.value=a},ne=async()=>{if(!g.account){E.warning("请选择结算收款账户");return}if(!g.challengeResult){E.warning("请输入验证码");return}A.value=!0;try{const a={settlementAccount:g.account,challengeResult:g.challengeResult,settlementIds:[r.value.id]};await We(a),E.success("创建结算订单成功"),k(),A.value=!1,V.value=!1}catch{A.value=!1}},re=()=>{_.value={channel:"",payWay:"",username:""}},ce=async()=>{try{const a=await(N.value==="merchant"?Re:Ye)();I.value=a.data||{}}catch(a){console.log("getStaticsData",a)}},ie=a=>{r.value=a,a.state==="10"?(de("1544175232779000001"),ue()):me(a.luWithdraw),console.log(a,"rowValue"),V.value=!0},de=async a=>{try{const m=(await G({condition:{virtualMerchantID:a},paging:{pageNumber:1,pageSize:30}})).data.items[0]||{};x.value.settledSum=O(m.cliaims,"settledSum")||0,x.value.settledFee=O(m.cliaims,"settledFee")||0}catch{}},ue=async()=>{try{const a=await Ee({paging:{pageNumber:1,pageSize:30}});D.value=j(a.data.rows)||[]}catch{D.value=[]}},me=async a=>{try{const o=await Be({paging:{pageNumber:1,pageSize:30}},a);f.value=j(o.data.rows)[0]||{}}catch(o){console.log(o,"getWithdrawList")}},ve=async()=>{try{const a=await G({paging:{pageNumber:1,pageSize:200},condition:{[w.mer?"merchantID":"agentID"]:w.mer||w.agent}});Y.value=a.data.items}catch{}};return ye(()=>{N.value=W.roles.includes("merchant")?"merchant":W.roles.includes("agent")?"agent":"",ve(),k(),le(),se(),ce()}),(a,o)=>{const m=b("el-option"),T=b("el-select"),y=b("el-form-item"),_e=b("el-input"),L=b("el-button"),q=b("el-form"),p=b("el-table-column"),pe=b("el-pagination"),he=b("el-image"),ge=xe("loading");return d(),v("div",null,[e("div",He,[e("div",Ke,[Oe,e("div",je,c(I.value.settled||0),1),Ge]),e("div",Ze,[Je,e("div",$e,c(I.value.onAir||0),1),Qe])]),e("div",Xe,[e("div",et,[tt,l(q,{inline:!0,model:_.value,class:"demo-form-inline"},{default:n(()=>[l(y,null,{default:n(()=>[l(T,{modelValue:_.value.luVirtualMerchant,"onUpdate:modelValue":o[0]||(o[0]=t=>_.value.luVirtualMerchant=t),placeholder:"全部站点",clearable:""},{default:n(()=>[(d(!0),v(M,null,R(Y.value,t=>(d(),F(m,{key:t.virtualMerchantId,label:t.name,value:t.virtualMerchantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,null,{default:n(()=>[l(T,{modelValue:_.value.state,"onUpdate:modelValue":o[1]||(o[1]=t=>_.value.state=t),placeholder:"全部结算状态",clearable:""},{default:n(()=>[(d(),v(M,null,R(B,t=>l(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(y,null,{default:n(()=>[l(_e,{modelValue:_.value.settlementProcessNo,"onUpdate:modelValue":o[2]||(o[2]=t=>_.value.settlementProcessNo=t),placeholder:"请输入结算批次号搜寻",onKeyup:we(k,["enter"]),clearable:""},null,8,["modelValue"])]),_:1}),l(y,null,{default:n(()=>[l(L,{onClick:re},{default:n(()=>[P("重置")]),_:1}),l(L,{type:"primary",onClick:k},{default:n(()=>[P("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),e("div",at,[Se((d(),F(s(qe),{ref_key:"multipleTableRef",ref:J,data:s(ee),onSelectionChange:oe,style:{width:"100%"}},{empty:n(()=>[lt]),default:n(()=>[l(p,{type:"selection",width:"55"}),l(p,{prop:"settlementProcessNo",label:"结算批次号",width:"200"}),l(p,{prop:"state",label:"结算状态",width:"100"},{default:n(t=>[e("div",{class:Ce(s(H)(t.row.state).class)},c(s(H)(t.row.state).value),3)]),_:1}),l(p,{prop:"virtualMerchant~merchantName",label:"站点名称",width:"120"}),l(p,{prop:"settlementTotal",label:"结算金额",width:"180"},{default:n(t=>[s(h)(t.row.settlementTotal)?(d(),v("span",st,c(s(h)(t.row.settlementTotal)+" "+t.row.settlementCurrency),1)):U("",!0)]),_:1}),l(p,{prop:"orderTotal",label:"订单币种金额",width:"180"},{default:n(t=>[s(h)(t.row.orderTotal,t.row.orderCurrencyMultiply)?(d(),v("span",ot,c(s(h)(t.row.orderTotal,t.row.orderCurrencyMultiply)+" "+t.row.orderCurrency),1)):U("",!0)]),_:1}),l(p,{prop:"averageExchangeRate",label:"汇率",width:"220"},{default:n(t=>[e("div",null,c((+t.row.averageExchangeRate).toFixed(6)),1)]),_:1}),l(p,{prop:"orderCount",label:"订单笔数",width:"100"}),l(p,{prop:"createdAt",label:"账单时间",width:"180"},{default:n(t=>[e("div",null,c(s(z)(t.row.createdAt).substring(0,10)),1)]),_:1}),l(p,{prop:"action",label:"操作",fixed:"right"},{default:n(t=>[e("div",{class:"action-btn cursor-pointer",onClick:Xt=>ie(t.row)},"查看详情",8,nt)]),_:1})]),_:1},8,["data"])),[[ge,s(te)]])]),e("div",rt,[l(pe,{background:"",layout:s(S).layout,"page-sizes":s(S).pageSizes,total:s(S).total,"page-size":s(S).pageSize,currentPage:s(S).currentPage,onCurrentChange:s(X)},null,8,["layout","page-sizes","total","page-size","currentPage","onCurrentChange"])]),l(Ue,{modelValue:V.value,"onUpdate:modelValue":o[5]||(o[5]=t=>V.value=t)},{default:n(()=>[e("div",ct,[it,e("div",dt,[ut,e("div",mt,c(r.value.settlementProcessNo),1)]),e("div",vt,[_t,e("div",pt,c(s(De)(r.value.state,B)),1)]),e("div",ht,[gt,e("div",ft,c(s(h)(r.value.settlementTotal||"0")+r.value.settlementCurrency),1)]),e("div",bt,[yt,e("div",xt,c(s(h)(r.value.orderTotal||"0",r.value.orderCurrencyMultiply)+r.value.orderCurrency),1)]),e("div",wt,[St,e("div",Ct,c((+r.value.averageExchangeRate).toFixed(6)),1)]),e("div",Vt,[At,e("div",kt,c(r.value.orderCount),1)]),e("div",Tt,[Ft,e("div",Nt,c(s(h)(f.value.settlementFee||r.value.settlementServiceFee))+" USD ",1)]),Dt,e("div",It,[Lt,e("div",Mt,c(s(z)(r.value.createdAt).substring(0,10)),1)]),Rt,e("div",Pt,[Ut,f.value.settlementAmount?(d(),v("div",zt,c(s(h)(f.value.settlementAmount)+" "+f.value.settlementCurrency),1)):x.value.settledSum&&x.value.settledFee?(d(),v("div",Et,c(s(h)(x.value.settledSum>(r.value.settlementTotal||0)?(r.value.settlementTotal||0)-x.value.settledFee:r.value.settlementTotal||0))+" "+c(" "+r.value.settlementCurrency),1)):(d(),v("div",Wt,c(s(h)(r.value.settlementTotal||0)+r.value.settlementCurrency),1))]),e("div",null,[r.value.state==="10"?(d(),F(q,{key:0,"label-position":"top","label-width":"auto",model:g},{default:n(()=>[l(y,{label:"结算收款账户"},{default:n(()=>[l(T,{modelValue:g.account,"onUpdate:modelValue":o[3]||(o[3]=t=>g.account=t),placeholder:"请选择结算收款账户"},{default:n(()=>[(d(!0),v(M,null,R(D.value,t=>(d(),F(m,{key:t.id,label:t.accountName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ze,{modelValue:g.challengeResult,"onUpdate:modelValue":o[4]||(o[4]=t=>g.challengeResult=t)},null,8,["modelValue"]),e("div",Bt,[l(L,{type:"primary",loading:A.value,onClick:ne},{default:n(()=>[P("确认并申请结算")]),_:1},8,["loading"])])]),_:1},8,["model"])):(d(),v("div",Yt,[e("div",qt,[Ht,e("div",Kt,c(f.value["settlementAccount~accountName"]),1)]),e("div",Ot,[jt,e("div",Gt,c(s(z)(f.value.createdAt)),1)]),r.value.state==="30"?(d(),v("div",Zt,[Jt,e("div",$t,[l(he,{style:{width:"100px",height:"100px"},src:s(K)(f.value.documentFile),"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[s(K)(f.value.documentFile)],"initial-index":0,fit:"cover"},null,8,["src","preview-src-list"])])])):U("",!0)]))])])]),_:1},8,["modelValue"])])])}}}),_a=Pe(Qt,[["__scopeId","data-v-0a703a89"]]);export{_a as default};
