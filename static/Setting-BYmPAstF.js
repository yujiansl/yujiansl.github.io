import{Z as B,r as g,l as ve,aD as fe,z as be,d as Ve,ah as y,m as U,p as L,q as r,U as t,O as o,u as l,S as C,T as x,I as he,F as j,a7 as Q,M as W,aF as _e,aG as ye}from"./vue-BtEXIrqH.js";import{e as Re,_ as ke}from"./index-bEAPwbJM.js";import{b as p,c as Fe,t as Ie}from"./commonFn-DSVr4W-5.js";import{f as O,b as Ue,g as Se}from"./index-B3sZ9j6O.js";import{E}from"./element-BbMnn7tA.js";import{_ as S}from"./Index.vue_vue_type_script_setup_true_lang-CAnY41O0.js";import{V as P}from"./index-BauZgp7a.js";import{_ as X}from"./lodash-BUB0GWD5.js";import{c as Ce}from"./index-COelV0l7.js";import"//at.alicdn.com/t/c/font_4557022_266y8yxi6v9.js";import"./vxe-EK889JN8.js";const xe=B({name:[{required:!0,message:"请输入站点名称",trigger:"blur"}],websiteUrl:[{required:!0,message:"请输入业务/产品网址",trigger:"blur"}],category:[{required:!0,message:"请选择行业类别",trigger:"change"}],currency:[{required:!0,message:"请选择收款币种",trigger:"change"}],turnover:[{required:!0,message:"请选择单月营业额",trigger:"change"}],region:[{required:!0,message:"请选择业务分布地区",trigger:"change"}],callback:[{required:!0,message:"请输入回调地址",trigger:"change"}]}),De=g(),Te=JSON.parse(Re("user-info")||"{}"),D=!1,m=g({email:Te.name||"79026@qq.com",baseword:"",reAccount:"",code:"",challengeId:""}),qe=s=>{var V;m.value={name:s.name,websiteUrl:p(s.claims,"websiteUrl"),category:(V=p(s.claims,"category"))==null?void 0:V.split(","),region:p(s.claims,"region"),currency:p(s.claims,"currency"),turnover:p(s.claims,"turnover"),desc:p(s.claims,"desc"),callback:p(s.claims,"callback"),siteRemark:s.siteRemark,parentMerchantName:s.parentMerchantName,appId:s.appId,createdAt:s.createdAt,isVerificated:s.isVerificated,virtualMerchantId:s.virtualMerchantId}},Me=async s=>{s&&await s.validate(async(V,h)=>{if(V){D.value=!0;try{const f={claims:[{claimType:"category",claimValue:m.value.category.toString()},{claimType:"currency",claimValue:m.value.currency},{claimType:"turnover",claimValue:m.value.turnover},{claimType:"region",claimValue:m.value.region},{claimType:"callback",claimValue:m.value.callback},{claimType:"desc",claimValue:m.value.desc},{claimType:"siteRemark",claimValue:m.value.siteRemark},{claimType:"websiteUrl",claimValue:m.value.websiteUrl}],challengeId:m.value.challengeId,challengeResult:m.value.challengeResult,name:m.value.name,merchantId:m.value.virtualMerchantId};await O(f),E.success("修改成功"),D.value=!1}catch{D.value=!1}}else console.log("error submit!",h)})};function Ae(){return{baseFormRef:De,baseForm:m,baseRules:xe,submitBase:Me,setForm:qe,baseLoading:D}}const Ne=B({serviceFeePercent:[{required:!0,message:"请输入收单费率",trigger:"blur"}],settledDays:[{required:!0,message:"请选择选择周期",trigger:"change"}],ecomChannel:[{required:!0,message:"请选择支付通道",trigger:"change"}],challengeResult:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),we=g(),T=g(!1),b=g({serviceFeePercent:"",settledDays:"",ecomChannel:"",agentRate:""}),Le=s=>{b.value={settledDays:s.settledDays,serviceFeePercent:p(s.claims,"serviceFeePercent"),ecomChannel:p(s.claims,"ecomChannel"),agentId:s.agentID,agentRate:s.agentRate,virtualMerchantId:s.virtualMerchantId},console.log(b.value,"orderForm")},Pe=async s=>{s&&await s.validate(async(V,h)=>{if(V){T.value=!0;try{const f={claims:[{claimType:"serviceFeePercent",claimValue:b.value.serviceFeePercent},{claimType:"ecomChannel",claimValue:b.value.ecomChannel}],challengeId:b.value.challengeId,challengeResult:b.value.challengeResult,settledDays:b.value.settledDays,agentId:b.value.agentId,agentRate:b.value.agentRate,merchantId:b.value.virtualMerchantId};await O(f),E.success("修改成功"),T.value=!1}catch{T.value=!1}}else console.log("error submit!",h)})};function Be(){return{orderFormRef:we,orderForm:b,orderRules:Ne,submitOrder:Pe,setOrderForm:Le,orderLoading:T}}const Oe=g(),q=g(!1),_=g({}),Ee=B({settledSum:[{required:!0,message:"请输入最低结算金额",trigger:"blur"}],settledFee:[{required:!0,message:"请输入每笔结算手续费",trigger:"blur"}],challengeResult:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),Ge=s=>{_.value={settledSum:p(s.claims,"settledSum"),settledFee:p(s.claims,"settledFee"),isRisk:p(s.claims,"isRisk")==="1",riskAmount:p(s.claims,"riskAmount"),isEnabled:s.isEnabled==="1",virtualMerchantId:s.virtualMerchantId}},$e=async s=>{s&&await s.validate(async(V,h)=>{var f,k;if(V){q.value=!0;try{const F={claims:[{claimType:"settledSum",claimValue:_.value.settledSum},{claimType:"isRisk",claimValue:_.value.isRisk?"1":"0"},{claimType:"riskAmount",claimValue:_.value.riskAmount},{claimType:"settledFee",claimValue:_.value.settledFee}],challengeId:(f=_.value)==null?void 0:f.challengeId,challengeResult:(k=_.value)==null?void 0:k.challengeResult,isEnabled:_.value.isEnabled?"1":"0",merchantId:_.value.virtualMerchantId};await O(F),E.success("修改成功"),q.value=!1}catch{q.value=!1}}else console.log("error submit!",h)})};function ze(){return{riskFormRef:Oe,riskForm:_,riskRules:Ee,submitRisk:$e,riskLoading:q,setRiskForm:Ge}}const R=s=>(_e("data-v-9a00b1a1"),s=s(),ye(),s),Je={class:"mer-setting flex flex-col items-center"},Ze=R(()=>r("div",{class:"set-title mb-40"},"站点设置",-1)),He={class:"base-box setting"},Ke=R(()=>r("div",{class:"line mt-50 mb-50"},null,-1)),je={class:"flex-center mb-16"},Qe=R(()=>r("div",{class:"item-label flex-1"},"站点ID",-1)),We={class:"item-desc"},Xe={class:"item-desc"},Ye={class:"flex-center mb-16"},el=R(()=>r("div",{class:"item-label flex-1"},"加入时间",-1)),ll={class:"item-desc"},al={class:"item-desc"},tl={class:"flex-center mb-16"},sl=R(()=>r("div",{class:"item-label flex-1"},"认证状态",-1)),ol={class:"item-desc"},rl={class:"item-desc"},nl={class:"w-full flex-center"},ul={class:"w-full flex-center"},dl=R(()=>r("div",{class:"item-desc"},"当结算金额低于最低预设值，将收取每笔手续费",-1)),il={class:"w-full flex-center"},ml=R(()=>r("div",{class:"item-label"},"风险保证金（USD）",-1)),cl={class:"item-value"},pl=R(()=>r("div",{class:"item-desc"},"开启保证金后，会通知用户缴纳保证金。",-1)),gl={class:"w-full flex-center"},vl=R(()=>r("div",{class:"item-label"},"站点状态",-1)),fl={class:"item-value"},bl={class:"w-full flex-center"},Vl=ve({__name:"Setting",setup(s){const{query:V}=fe(),h=g(!1),f=g([]),k=g({}),{baseFormRef:F,baseForm:n,baseRules:Y,setForm:ee,submitBase:le,baseLoading:ae}=Ae(),{orderFormRef:G,orderForm:c,orderRules:te,setOrderForm:M,submitOrder:se,orderLoading:oe}=Be(),{riskFormRef:$,riskForm:i,riskRules:re,submitRisk:ne,setRiskForm:ue,riskLoading:de}=ze(),I=g("first"),z=g([]),ie=(d,e)=>{I.value==="third"&&ue(k.value),I.value==="second"&&M(k.value),I.value==="second"&&M(k.value)},me=async()=>{try{const d=await Ue();z.value=d.data.map(e=>({name:e.code+"通道",value:e.code}))}catch(d){console.log(d,"e")}},ce=async()=>{try{const d=V.virtualMerchantId,e=await Se(d)}catch{}},J=async d=>{try{const v=await Ce({paging:{pageNumber:1,pageSize:15},searchItems:[{columnName:"agentName",value:d}],sorting:{columnNames:["createdAt"],direction:"desc"}});f.value=Ie(v.data.rows)||[],h.value=!1}catch(e){h.value=!1,console.log(e,"queryAgentList")}},pe=d=>{d?(h.value=!0,X.throttle(()=>J(d),500)()):X.throttle(()=>J(""),500)()};return be(()=>{sessionStorage.removeItem("siteData")}),Ve(()=>{const d=JSON.parse(sessionStorage.getItem("siteData")||"{}");k.value=d,ee(d),M(d),ce(),me()}),(d,e)=>{const v=y("el-input"),u=y("el-form-item"),A=y("el-button"),N=y("el-form"),w=y("el-tab-pane"),Z=y("el-option"),H=y("el-select"),K=y("el-switch"),ge=y("el-tabs");return U(),L("div",Je,[Ze,r("div",He,[t(ge,{modelValue:I.value,"onUpdate:modelValue":e[28]||(e[28]=a=>I.value=a),class:"modal-tabs",onTabChange:ie},{default:o(()=>[t(w,{label:"业务信息",name:"first"},{default:o(()=>[t(N,{ref_key:"baseFormRef",ref:F,"label-position":"top",model:l(n),rules:l(Y),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(u,{label:"站点名称",prop:"name"},{default:o(()=>[t(v,{modelValue:l(n).name,"onUpdate:modelValue":e[0]||(e[0]=a=>l(n).name=a),placeholder:"请输入站点名称"},null,8,["modelValue"])]),_:1}),t(u,{label:"业务/产品网址",prop:"websiteUrl"},{default:o(()=>[t(v,{modelValue:l(n).websiteUrl,"onUpdate:modelValue":e[1]||(e[1]=a=>l(n).websiteUrl=a),placeholder:"请输入业务/产品网址"},null,8,["modelValue"])]),_:1}),t(u,{label:"行业类别",prop:"category"},{default:o(()=>[t(S,{type:"category",modelValue:l(n).category,"onUpdate:modelValue":e[2]||(e[2]=a=>l(n).category=a),placeholder:"请选择行业类别"},null,8,["modelValue"])]),_:1}),t(u,{label:"收款币种",prop:"currency"},{default:o(()=>[t(S,{type:"currency",modelValue:l(n).currency,"onUpdate:modelValue":e[3]||(e[3]=a=>l(n).currency=a),placeholder:"请选择收款币种"},null,8,["modelValue"])]),_:1}),t(u,{label:"单月营业额",prop:"turnover"},{default:o(()=>[t(S,{type:"turnover",modelValue:l(n).turnover,"onUpdate:modelValue":e[4]||(e[4]=a=>l(n).turnover=a),placeholder:"请选择单月营业额"},null,8,["modelValue"])]),_:1}),t(u,{label:"业务分布地区",prop:"region"},{default:o(()=>[t(S,{type:"region",modelValue:l(n).region,"onUpdate:modelValue":e[5]||(e[5]=a=>l(n).region=a),placeholder:"请选择业务分布地区"},null,8,["modelValue"])]),_:1}),t(u,{label:"回调地址",prop:"callback"},{default:o(()=>[t(v,{modelValue:l(n).callback,"onUpdate:modelValue":e[6]||(e[6]=a=>l(n).callback=a),placeholder:"请输入回调地址"},null,8,["modelValue"])]),_:1}),t(u,{label:"业务/产品描述（选填）",prop:"desc"},{default:o(()=>[t(v,{modelValue:l(n).desc,"onUpdate:modelValue":e[7]||(e[7]=a=>l(n).desc=a),placeholder:"请输入业务/产品描述"},null,8,["modelValue"])]),_:1}),Ke,t(u,{label:"所属商户",prop:"name"},{default:o(()=>[C(x(l(n).parentMerchantName),1)]),_:1}),t(u,{label:"站点备注（选填）",prop:"siteRemark"},{default:o(()=>[t(v,{modelValue:l(n).siteRemark,"onUpdate:modelValue":e[8]||(e[8]=a=>l(n).siteRemark=a),placeholder:"请输入站点备注"},null,8,["modelValue"])]),_:1}),r("div",je,[Qe,r("div",We,[r("div",Xe,x(l(n).appId),1)])]),r("div",Ye,[el,r("div",ll,[r("div",al,x(l(Fe)(l(n).createdAt)),1)])]),r("div",tl,[sl,r("div",ol,[r("div",rl,[r("div",{class:he(["item-value",l(n).isVerificated==="1"?"is-auth":"is-no-auth"])},x(l(n).isVerificated==="1"?"已认证":"未认证"),3)])])]),t(P,{class:"mt-30",modelValue:l(n).challengeResult,"onUpdate:modelValue":e[9]||(e[9]=a=>l(n).challengeResult=a),onGetChallengeId:e[10]||(e[10]=a=>d.processForm.challengeId=a)},null,8,["modelValue"]),t(u,null,{default:o(()=>[r("div",nl,[t(A,{type:"primary",loading:l(ae),onClick:e[11]||(e[11]=a=>l(le)(l(F)))},{default:o(()=>[C("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(w,{label:"收单设置",name:"second"},{default:o(()=>[t(N,{ref_key:"orderFormRef",ref:G,"label-position":"top",model:l(c),rules:l(te),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(u,{label:"收单费率",prop:"serviceFeePercent"},{default:o(()=>[t(v,{modelValue:l(c).serviceFeePercent,"onUpdate:modelValue":e[12]||(e[12]=a=>l(c).serviceFeePercent=a),placeholder:"请输入收单费率"},null,8,["modelValue"])]),_:1}),t(u,{label:"结算周期",prop:"settledDays"},{default:o(()=>[t(S,{type:"settledDays",modelValue:l(c).settledDays,"onUpdate:modelValue":e[13]||(e[13]=a=>l(c).settledDays=a),placeholder:"请选择选择周期"},null,8,["modelValue"])]),_:1}),t(u,{label:"支付通道",prop:"ecomChannel"},{default:o(()=>[t(H,{modelValue:l(c).ecomChannel,"onUpdate:modelValue":e[14]||(e[14]=a=>l(c).ecomChannel=a),placeholder:"请选择支付通道",clearable:""},{default:o(()=>[(U(!0),L(j,null,Q(z.value,a=>(U(),W(Z,{key:a.value,label:a.name,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"所属代理",prop:"agentId"},{default:o(()=>[t(H,{modelValue:l(c).agentId,"onUpdate:modelValue":e[15]||(e[15]=a=>l(c).agentId=a),filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入代理名称","remote-show-suffix":"","remote-method":pe,loading:h.value},{default:o(()=>[(U(!0),L(j,null,Q(f.value,a=>(U(),W(Z,{key:a.id,label:a.agentName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(u,{label:"代理返佣费率",prop:"agentRate"},{default:o(()=>[t(v,{modelValue:l(c).agentRate,"onUpdate:modelValue":e[16]||(e[16]=a=>l(c).agentRate=a),placeholder:"请输入代理返佣费率"},null,8,["modelValue"])]),_:1}),t(P,{class:"mt-30",modelValue:l(c).challengeResult,"onUpdate:modelValue":e[17]||(e[17]=a=>l(c).challengeResult=a),onGetChallengeId:e[18]||(e[18]=a=>d.processForm.challengeId=a)},null,8,["modelValue"]),t(u,null,{default:o(()=>[r("div",ul,[t(A,{type:"primary",loading:l(oe),onClick:e[19]||(e[19]=a=>l(se)(l(G)))},{default:o(()=>[C("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(w,{label:"风控设置",name:"third"},{default:o(()=>[t(N,{ref_key:"riskFormRef",ref:$,"label-position":"top",model:l(i),rules:l(re),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(u,{label:"最低结算金额（USD）",prop:"settledSum"},{default:o(()=>[t(v,{modelValue:l(i).settledSum,"onUpdate:modelValue":e[20]||(e[20]=a=>l(i).settledSum=a),placeholder:"请输入最低结算金额",maxlength:"10"},null,8,["modelValue"])]),_:1}),t(u,{label:"每笔结算手续费（USD）",prop:"settledFee"},{default:o(()=>[t(v,{modelValue:l(i).settledFee,"onUpdate:modelValue":e[21]||(e[21]=a=>l(i).settledFee=a),placeholder:"请输入每笔结算手续费",maxlength:"10"},null,8,["modelValue"]),dl]),_:1}),t(u,{prop:"isRisk"},{default:o(()=>[r("div",il,[ml,r("div",cl,[t(K,{modelValue:l(i).isRisk,"onUpdate:modelValue":e[22]||(e[22]=a=>l(i).isRisk=a)},null,8,["modelValue"])])])]),_:1}),t(u,{prop:"riskAmount"},{default:o(()=>[t(v,{modelValue:l(i).riskAmount,"onUpdate:modelValue":e[23]||(e[23]=a=>l(i).riskAmount=a),placeholder:"请输入风险保证金",maxlength:"10"},null,8,["modelValue"]),pl]),_:1}),t(u,{prop:"name"},{default:o(()=>[r("div",gl,[vl,r("div",fl,[t(K,{modelValue:l(i).isEnabled,"onUpdate:modelValue":e[24]||(e[24]=a=>l(i).isEnabled=a)},null,8,["modelValue"])])])]),_:1}),t(P,{class:"mt-30",modelValue:l(i).challengeResult,"onUpdate:modelValue":e[25]||(e[25]=a=>l(i).challengeResult=a),onGetChallengeId:e[26]||(e[26]=a=>l(i).challengeId=a)},null,8,["modelValue"]),t(u,null,{default:o(()=>[r("div",bl,[t(A,{type:"primary",loading:l(de),onClick:e[27]||(e[27]=a=>l(ne)(l($)))},{default:o(()=>[C("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])])])}}}),Dl=ke(Vl,[["__scopeId","data-v-9a00b1a1"]]);export{Dl as default};
