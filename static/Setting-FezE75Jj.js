import{Z as z,r as g,l as ge,aD as fe,aE as ve,d as _e,ah as v,m as k,p as M,q as d,U as t,O as o,u as l,S,T as D,I as be,F as G,a7 as H,M as K,aF as Ve,aG as he}from"./vue-C87Wc4A0.js";import{e as ye,o as p,w as Re,Q as ke,J as w,x as Ie,k as Fe,_ as Ue}from"./index-c78MVIZI.js";import{_ as h}from"./Index.vue_vue_type_script_setup_true_lang-BhDJDWBy.js";import{V as q}from"./index-BZHf1ii5.js";import{_ as Q}from"./lodash-CxrNlPE1.js";import{d as xe}from"./index-DYQLPh63.js";import{a as Se}from"./index-Cap7k8T_.js";import{E as C}from"./element-CD5rsoqi.js";import"//at.alicdn.com/t/c/font_4557022_0o7l3b0t8egq.js";import"./vxe-sm_XFqm0.js";const De=z({name:[{required:!0,message:"请输入站点名称",trigger:"blur"}],websiteUrl:[{required:!0,message:"请输入业务/产品网址",trigger:"blur"}],category:[{required:!0,message:"请选择行业类别",trigger:"change"}],currency:[{required:!0,message:"请选择收款币种",trigger:"change"}],turnover:[{required:!0,message:"请选择单月营业额",trigger:"change"}],region:[{required:!0,message:"请选择业务分布地区",trigger:"change"}],timezoneName:[{required:!0,message:"请选择站点时区",trigger:"change"}],callback:[{required:!0,message:"请输入回调地址",trigger:"change"}]}),Ce=g(),Ne=JSON.parse(ye("user-info")||"{}"),Te=g(!1),W=g({email:Ne.name||"",baseword:"",reAccount:"",code:"",type:""}),Ae=r=>{var _;W.value={name:r.name,websiteUrl:p(r.claims,"websiteUrl"),category:(_=p(r.claims,"category"))==null?void 0:_.split(","),region:p(r.claims,"region"),currency:p(r.claims,"currency"),turnover:p(r.claims,"turnover"),desc:p(r.claims,"desc"),callback:p(r.claims,"callback"),siteRemark:p(r.claims,"siteRemark"),timezoneName:p(r.claims,"timezoneName"),parentMerchantName:r.parentMerchantName,appId:r.appId,createdAt:r.createdAt,isVerificated:r.isVerificated,virtualMerchantId:r.virtualMerchantId}};function Me(){return{baseFormRef:Ce,baseForm:W,baseRules:De,setForm:Ae,baseLoading:Te}}const we=z({service_fee_percent:[{required:!0,message:"请输入收单费率",trigger:"blur"}],settledDays:[{required:!0,message:"请选择选择周期",trigger:"change"}],ecomChannel:[{required:!0,message:"请选择支付通道",trigger:"change"}],challengeResult:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),qe=g(),ze=g(!1),X=g({service_fee_percent:"",settledDays:"",ecomChannel:"",agentRate:""}),Le=r=>{X.value={settledDays:r.settledDays,service_fee_percent:p(r.claims,"service_fee_percent"),ecomChannel:p(r.claims,"ecomChannel"),agentId:r.agentID,agentRate:r.agentRate,virtualMerchantId:r.virtualMerchantId}};function Ee(){return{orderFormRef:qe,orderForm:X,orderRules:we,setOrderForm:Le,orderLoading:ze}}const Oe=g(),Be=g(!1),Y=g({}),$e=z({settledSum:[{required:!0,message:"请输入最低结算金额",trigger:"blur"}],settledFee:[{required:!0,message:"请输入每笔结算手续费",trigger:"blur"}],challengeResult:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),je=r=>{Y.value={settledSum:p(r.claims,"settledSum"),settledFee:p(r.claims,"settledFee"),isRisk:p(r.claims,"isRisk")==="1",riskAmount:p(r.claims,"riskAmount"),isEnabled:r.isEnabled==="1",virtualMerchantId:r.virtualMerchantId}};function Je(){return{riskFormRef:Oe,riskForm:Y,riskRules:$e,riskLoading:Be,setRiskForm:je}}const f=r=>(Ve("data-v-40d8d606"),r=r(),he(),r),Pe={class:"mer-setting ml-20 mr-20 pb-40 flex flex-col items-center"},Ze=f(()=>d("div",{class:"set-title mb-40"},"站点设置",-1)),Ge={class:"base-box detail-box"},He=f(()=>d("div",{class:"item-desc"},"请确保网址可以正常访问，否则将影响站点认证审核。",-1)),Ke=f(()=>d("div",{class:"line mt-50 mb-50"},null,-1)),Qe={class:"flex-center mb-16"},We=f(()=>d("div",{class:"item-label flex-1"},"站点ID",-1)),Xe={class:"item-desc"},Ye={class:"item-desc"},el={class:"flex-center mb-16"},ll=f(()=>d("div",{class:"item-label flex-1"},"加入时间",-1)),al={class:"item-desc"},tl={class:"item-desc"},sl={class:"flex-center mb-16"},ol=f(()=>d("div",{class:"item-label flex-1"},"认证状态",-1)),nl={class:"item-desc"},rl={class:"item-desc"},il={class:"w-full flex-center"},dl=f(()=>d("div",{class:"item-desc mt-4"},"例：千5 请输入 5",-1)),ul=f(()=>d("div",{class:"item-desc mt-4"},"例：千5 请输入 5",-1)),ml={class:"w-full flex-center"},cl=f(()=>d("div",{class:"item-desc"},"当结算金额低于最低预设值，将收取每笔手续费",-1)),pl={class:"w-full flex-center"},gl=f(()=>d("div",{class:"item-label"},"风险保证金（USD）",-1)),fl={class:"item-value"},vl=f(()=>d("div",{class:"item-desc"},"开启保证金后，会通知用户缴纳保证金。",-1)),_l={class:"w-full flex-center"},bl=f(()=>d("div",{class:"item-label"},"站点状态",-1)),Vl={class:"item-value"},hl={class:"w-full flex-center"},yl=ge({__name:"Setting",setup(r){let _={};const{query:ee}=fe(),le=ve(),I=g(!1),L=g([]),y=g({}),{baseFormRef:E,baseForm:s,baseRules:ae,setForm:te,baseLoading:F}=Me(),{orderFormRef:O,orderForm:c,orderRules:se,setOrderForm:N,orderLoading:U}=Ee(),{riskFormRef:B,riskForm:u,riskRules:oe,setRiskForm:ne,riskLoading:T}=Je(),R=g("first"),$=g([]),re=async m=>{m&&await m.validate(async(e,n)=>{if(e){F.value=!0;try{const i={..._,claims:[{claimType:"category",claimValue:s.value.category.toString()},{claimType:"currency",claimValue:s.value.currency},{claimType:"timezone",claimValue:ke(s.value.timezoneName)},{claimType:"timezoneName",claimValue:s.value.timezoneName},{claimType:"turnover",claimValue:s.value.turnover},{claimType:"region",claimValue:s.value.region},{claimType:"callback",claimValue:s.value.callback},{claimType:"desc",claimValue:s.value.desc},{claimType:"siteRemark",claimValue:s.value.siteRemark},{claimType:"websiteUrl",claimValue:s.value.websiteUrl}],challengeResult:s.value.challengeResult,name:s.value.name,merchantId:s.value.virtualMerchantId};await w(i),await x(),C.success("修改成功"),F.value=!1}catch{F.value=!1}}else console.log("error submit!",n)})},ie=async m=>{m&&await m.validate(async(e,n)=>{if(e){U.value=!0;try{const i={..._,claims:[{claimType:"service_fee_percent",claimValue:c.value.service_fee_percent},{claimType:"ecomChannel",claimValue:c.value.ecomChannel}],challengeResult:c.value.challengeResult,settledDays:c.value.settledDays,agentId:c.value.agentId,agentRate:c.value.agentRate,merchantId:c.value.virtualMerchantId};await w(i),C.success("修改成功"),await x(),U.value=!1}catch{U.value=!1}}else console.log("error submit!",n)})},de=async m=>{m&&await m.validate(async(e,n)=>{var i;if(e){if(console.log("okk"),u.value.isRisk&&!u.value.riskAmount){C.error("请输入风险保证金");return}try{const b={..._,claims:[{claimType:"settledSum",claimValue:u.value.settledSum.toString()},{claimType:"isRisk",claimValue:u.value.isRisk?"1":"0"},{claimType:"riskAmount",claimValue:u.value.riskAmount.toString()},{claimType:"settledFee",claimValue:u.value.settledFee.toString()}],challengeResult:(i=u.value)==null?void 0:i.challengeResult,isEnabled:u.value.isEnabled?"1":"0",merchantId:u.value.virtualMerchantId},V=p(y.value.claims,"isRisk");(!V||V==="0")&&u.value.isRisk&&(b.sendAppCashPledgeEmail=1),await w(b),C.success("修改成功"),await x(),T.value=!1}catch{T.value=!1}}else console.log("error submit!",n)})},ue=()=>{R.value==="third"&&ne(y.value),R.value==="second"&&N(y.value),R.value==="second"&&N(y.value)},me=async()=>{try{const m=await Ie();$.value=m.data.map(e=>({name:e.code+"通道",value:e.code}))}catch(m){console.log(m,"e")}},j=async m=>{try{const n=await xe({paging:{pageNumber:1,pageSize:15},searchItems:[{columnName:"agentName",value:m}],sorting:{columnNames:["createdAt"],direction:"desc"}});L.value=Fe(n.data.rows)||[],I.value=!1}catch(e){I.value=!1,console.log(e,"queryAgentList")}},x=async()=>{try{const m={paging:{pageNumber:1,pageSize:15},condition:{virtualMerchantID:ee.id}},e=await Se(m);if(e.data.items.length===0){le.back();return}const n=e.data.items[0]||{};y.value=n,_={agentID:n.agentID,agentRate:n.agentRate,challengeId:n.challengeId,challengeResult:n.challengeResult,isDefault:n.isDefault,isEnabled:n.isEnabled,isRejected:n.isRejected,isVerificated:n.isVerificated,merchantId:n.merchantId,name:n.name,passwordChanged:n.passwordChanged,remark:n.remark,settledDays:n.settledDays},te(n),N(n)}catch(m){console.log(m,"getAppdetail")}},ce=m=>{m?(I.value=!0,Q.throttle(()=>j(m),500)()):Q.throttle(()=>j(""),500)()};return _e(()=>{x(),me()}),(m,e)=>{const n=v("el-input"),i=v("el-form-item"),b=v("el-button"),V=v("el-form"),A=v("el-tab-pane"),J=v("el-option"),P=v("el-select"),Z=v("el-switch"),pe=v("el-tabs");return k(),M("div",Pe,[Ze,d("div",Ge,[t(pe,{modelValue:R.value,"onUpdate:modelValue":e[26]||(e[26]=a=>R.value=a),class:"modal-tabs",onTabChange:ue},{default:o(()=>[t(A,{label:"业务信息",name:"first"},{default:o(()=>[t(V,{ref_key:"baseFormRef",ref:E,"label-position":"top",model:l(s),rules:l(ae),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(i,{label:"站点名称",prop:"name"},{default:o(()=>[t(n,{modelValue:l(s).name,"onUpdate:modelValue":e[0]||(e[0]=a=>l(s).name=a),placeholder:"请输入站点名称",maxlength:"30"},null,8,["modelValue"])]),_:1}),t(i,{label:"业务/产品网址",prop:"websiteUrl"},{default:o(()=>[t(n,{modelValue:l(s).websiteUrl,"onUpdate:modelValue":e[1]||(e[1]=a=>l(s).websiteUrl=a),placeholder:"请输入业务/产品网址",maxlength:"150"},null,8,["modelValue"]),He]),_:1}),t(i,{label:"行业类别",prop:"category"},{default:o(()=>[t(h,{type:"category",modelValue:l(s).category,"onUpdate:modelValue":e[2]||(e[2]=a=>l(s).category=a),placeholder:"请选择行业类别"},null,8,["modelValue"])]),_:1}),t(i,{label:"收款币种",prop:"currency"},{default:o(()=>[t(h,{type:"currency",modelValue:l(s).currency,"onUpdate:modelValue":e[3]||(e[3]=a=>l(s).currency=a),placeholder:"请选择收款币种"},null,8,["modelValue"])]),_:1}),t(i,{label:"单月营业额",prop:"turnover"},{default:o(()=>[t(h,{type:"turnover",modelValue:l(s).turnover,"onUpdate:modelValue":e[4]||(e[4]=a=>l(s).turnover=a),placeholder:"请选择单月营业额"},null,8,["modelValue"])]),_:1}),t(i,{label:"业务分布地区",prop:"region"},{default:o(()=>[t(h,{type:"region",modelValue:l(s).region,"onUpdate:modelValue":e[5]||(e[5]=a=>l(s).region=a),placeholder:"请选择业务分布地区"},null,8,["modelValue"])]),_:1}),t(i,{prop:"timezoneName",label:"站点时区"},{default:o(()=>[t(h,{type:"timezone",modelValue:l(s).timezoneName,"onUpdate:modelValue":e[6]||(e[6]=a=>l(s).timezoneName=a),placeholder:"请选择站点时区"},null,8,["modelValue"])]),_:1}),t(i,{label:"回调地址",prop:"callback"},{default:o(()=>[t(n,{modelValue:l(s).callback,"onUpdate:modelValue":e[7]||(e[7]=a=>l(s).callback=a),placeholder:"请输入回调地址"},null,8,["modelValue"])]),_:1}),t(i,{label:"业务/产品描述（选填）",prop:"desc"},{default:o(()=>[t(n,{modelValue:l(s).desc,"onUpdate:modelValue":e[8]||(e[8]=a=>l(s).desc=a),type:"textarea",rows:3,placeholder:`请简单描述你的业务/产品。
举例：我们面向美国经营服装零售业务，售卖产品包括女装和童装。`,maxlength:"150"},null,8,["modelValue"])]),_:1}),Ke,t(i,{label:"所属商户",prop:"name"},{default:o(()=>[S(D(l(s).parentMerchantName),1)]),_:1}),t(i,{label:"站点备注（选填）",prop:"siteRemark"},{default:o(()=>[t(n,{modelValue:l(s).siteRemark,"onUpdate:modelValue":e[9]||(e[9]=a=>l(s).siteRemark=a),type:"textarea",rows:3,placeholder:"请输入站点备注",maxlength:"30"},null,8,["modelValue"])]),_:1}),d("div",Qe,[We,d("div",Xe,[d("div",Ye,D(l(s).appId),1)])]),d("div",el,[ll,d("div",al,[d("div",tl,D(l(Re)(l(s).createdAt)),1)])]),d("div",sl,[ol,d("div",nl,[d("div",rl,[d("div",{class:be(["item-value",l(s).isVerificated==="1"?"is-auth":"is-no-auth"])},D(l(s).isVerificated==="1"?"已认证":"未认证"),3)])])]),t(q,{class:"mt-30",modelValue:l(s).challengeResult,"onUpdate:modelValue":e[10]||(e[10]=a=>l(s).challengeResult=a)},null,8,["modelValue"]),t(i,null,{default:o(()=>[d("div",il,[t(b,{type:"primary",loading:l(F),onClick:e[11]||(e[11]=a=>re(l(E)))},{default:o(()=>[S("保存")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(A,{label:"收单设置",name:"second"},{default:o(()=>[t(V,{ref_key:"orderFormRef",ref:O,"label-position":"top",model:l(c),rules:l(se),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(i,{label:"收单费率",prop:"service_fee_percent"},{default:o(()=>[t(n,{modelValue:l(c).service_fee_percent,"onUpdate:modelValue":e[12]||(e[12]=a=>l(c).service_fee_percent=a),placeholder:"请输入收单费率",maxlength:"5"},null,8,["modelValue"]),dl]),_:1}),t(i,{label:"结算周期",prop:"settledDays"},{default:o(()=>[t(h,{type:"settledDays",modelValue:l(c).settledDays,"onUpdate:modelValue":e[13]||(e[13]=a=>l(c).settledDays=a),placeholder:"请选择选择周期"},null,8,["modelValue"])]),_:1}),t(i,{label:"支付通道",prop:"ecomChannel"},{default:o(()=>[t(P,{modelValue:l(c).ecomChannel,"onUpdate:modelValue":e[14]||(e[14]=a=>l(c).ecomChannel=a),placeholder:"请选择支付通道",clearable:""},{default:o(()=>[(k(!0),M(G,null,H($.value,a=>(k(),K(J,{key:a.value,label:a.name,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"所属代理",prop:"agentId"},{default:o(()=>[t(P,{modelValue:l(c).agentId,"onUpdate:modelValue":e[15]||(e[15]=a=>l(c).agentId=a),filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入代理名称","remote-show-suffix":"","remote-method":ce,loading:I.value},{default:o(()=>[(k(!0),M(G,null,H(L.value,a=>(k(),K(J,{key:a.id,label:a.agentName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(i,{label:"代理返佣费率",prop:"agentRate"},{default:o(()=>[t(n,{modelValue:l(c).agentRate,"onUpdate:modelValue":e[16]||(e[16]=a=>l(c).agentRate=a),placeholder:"请输入代理返佣费率",maxlength:"5"},null,8,["modelValue"]),ul]),_:1}),t(q,{class:"mt-30",modelValue:l(c).challengeResult,"onUpdate:modelValue":e[17]||(e[17]=a=>l(c).challengeResult=a)},null,8,["modelValue"]),t(i,null,{default:o(()=>[d("div",ml,[t(b,{type:"primary",loading:l(U),onClick:e[18]||(e[18]=a=>ie(l(O)))},{default:o(()=>[S("保存 ")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(A,{label:"风控设置",name:"third"},{default:o(()=>[t(V,{ref_key:"riskFormRef",ref:B,"label-position":"top",model:l(u),rules:l(oe),"label-width":"auto",class:"demo-ruleForm mt-40"},{default:o(()=>[t(i,{label:"最低结算金额（USD）",prop:"settledSum"},{default:o(()=>[t(n,{modelValue:l(u).settledSum,"onUpdate:modelValue":e[19]||(e[19]=a=>l(u).settledSum=a),modelModifiers:{number:!0},placeholder:"请输入最低结算金额"},null,8,["modelValue"])]),_:1}),t(i,{label:"每笔结算手续费（USD）",prop:"settledFee"},{default:o(()=>[t(n,{modelValue:l(u).settledFee,"onUpdate:modelValue":e[20]||(e[20]=a=>l(u).settledFee=a),modelModifiers:{number:!0},placeholder:"请输入每笔结算手续费"},null,8,["modelValue"]),cl]),_:1}),t(i,{prop:"isRisk"},{default:o(()=>[d("div",pl,[gl,d("div",fl,[t(Z,{modelValue:l(u).isRisk,"onUpdate:modelValue":e[21]||(e[21]=a=>l(u).isRisk=a)},null,8,["modelValue"])])])]),_:1}),t(i,{prop:"riskAmount"},{default:o(()=>[t(n,{modelValue:l(u).riskAmount,"onUpdate:modelValue":e[22]||(e[22]=a=>l(u).riskAmount=a),modelModifiers:{number:!0},placeholder:"请输入风险保证金",maxlength:"10"},null,8,["modelValue"]),vl]),_:1}),t(i,{prop:"name"},{default:o(()=>[d("div",_l,[bl,d("div",Vl,[t(Z,{modelValue:l(u).isEnabled,"onUpdate:modelValue":e[23]||(e[23]=a=>l(u).isEnabled=a)},null,8,["modelValue"])])])]),_:1}),t(q,{class:"mt-30",modelValue:l(u).challengeResult,"onUpdate:modelValue":e[24]||(e[24]=a=>l(u).challengeResult=a)},null,8,["modelValue"]),t(i,null,{default:o(()=>[d("div",hl,[t(b,{type:"primary",loading:l(T),onClick:e[25]||(e[25]=a=>de(l(B)))},{default:o(()=>[S("保存 ")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])])])}}}),Tl=Ue(yl,[["__scopeId","data-v-40d8d606"]]);export{Tl as default};
