import{u as be}from"./useTable-Br0VH9YA.js";import{b as fe,c as ye,e as we}from"./index-B3sZ9j6O.js";import{F as xe}from"./Index-BgrOBixy.js";import{f as Se,e as Ce,_ as Ve}from"./index-bEAPwbJM.js";import{g as Y,c as N,a as Ae,h as ke,b as q,t as H}from"./commonFn-DSVr4W-5.js";import{V as Ie}from"./index-BauZgp7a.js";import{a as O}from"./index-BmuQMldO.js";import{g as Te}from"./index-Cuh9gsAM.js";import{s as De,a as Le}from"./index-BK5Vxhfz.js";import{g as Ne}from"./index-COelV0l7.js";import{n as Fe,E as F}from"./element-BbMnn7tA.js";import{l as ze,r as d,Z as Re,d as Me,ah as g,ap as j,m as u,p as h,q as e,T as o,P as G,U as s,O as c,F as z,a7 as R,M as k,S as x,u as i,I as Pe,aF as Ue,aG as We}from"./vue-BtEXIrqH.js";import"./LIKU-logo-BbnHVERV.js";import"//at.alicdn.com/t/c/font_4557022_266y8yxi6v9.js";import"./vxe-EK889JN8.js";const r=S=>(Ue("data-v-cb250d0b"),S=S(),We(),S),Be={class:"top-balance base-box flex flex-wrap ml-40 mr-40 mt-20"},Ee={class:"balance-item pr-80"},Ye=r(()=>e("div",{class:"item-title"},"可结算余额 (USD)",-1)),qe={class:"item-price mt-10 mb-8"},He=r(()=>e("div",{class:"item-text"},"结算币种以美元结算",-1)),Oe={class:"balance-item"},je=r(()=>e("div",{class:"item-title"},"账户余额",-1)),Ge={class:"item-price mt-10 mb-8"},Ze={class:"order base-box p-36 ml-40 mr-40 mt-20"},Je={class:"top-search"},Ke=r(()=>e("div",{class:"table-title mb-33"},"结算记录",-1)),$e={class:"table-wrapper"},Qe=["onClick"],Xe={class:"pager-wrapper mt-32 flex justify-end"},et={class:"base-box detail-box"},tt=r(()=>e("div",{class:"detail-title mb-50"},"结算账单详情",-1)),at={class:"mb-24 flex"},lt=r(()=>e("div",{class:"order-text"},"结算批次号：",-1)),st={class:"order-value"},ot={class:"mb-24 flex"},nt=r(()=>e("div",{class:"order-text"},"结算状态：",-1)),ct={class:"order-value"},rt={class:"mb-24 flex"},it=r(()=>e("div",{class:"order-text"},"结算金额：",-1)),dt={class:"order-value"},ut={class:"mb-24 flex"},mt=r(()=>e("div",{class:"order-text"},"订单币种金额：",-1)),vt={class:"order-value"},_t={class:"mb-24 flex"},pt=r(()=>e("div",{class:"order-text"},"汇率：",-1)),ht={class:"order-value"},gt={class:"mb-24 flex"},bt=r(()=>e("div",{class:"order-text"},"订单笔数：",-1)),ft={class:"order-value"},yt={class:"mb-24 flex"},wt=r(()=>e("div",{class:"order-text"},"收单手续费：",-1)),xt={class:"order-value"},St={class:"mb-24 flex"},Ct=r(()=>e("div",{class:"order-text"},"结算手续费：",-1)),Vt={class:"order-value"},At={class:"mb-24 flex"},kt=r(()=>e("div",{class:"order-text"},"账单时间：",-1)),It={class:"order-value"},Tt=r(()=>e("div",{class:"order-line mt-42 mb-40"},null,-1)),Dt={class:"mb-24 flex"},Lt=r(()=>e("div",{class:"order-text"},"实际结算金额：",-1)),Nt={key:0,class:"order-value"},Ft={key:1,class:"order-value"},zt={key:2,class:"order-value"},Rt={class:"flex-center mt-60"},Mt={key:1},Pt={class:"mb-24 flex"},Ut=r(()=>e("div",{class:"order-text"},"结算收款账户：",-1)),Wt={class:"order-value"},Bt={class:"mb-24 flex"},Et=r(()=>e("div",{class:"order-text"},"申请结算时间：",-1)),Yt={class:"order-value"},qt=ze({__name:"Index",setup(S){const I=d(""),M=Se(),Z=d([]),J=d(),_=d({payWay:"",channel:"",username:""}),v=Re({account:"",challengeResult:"",challengeId:""}),y=d({}),P=d([]),b=d({}),U=[{label:"可结算",value:"10"},{label:"审核中",value:"20"},{label:"已结算",value:"30"}],W=d([]),B=JSON.parse(Ce("user-info")||"{}"),K=d([]),$=d([]),C=d(!1),V=d(!1),n=d({}),T=d({}),{paginationData:w,handleCurrentChange:Q,handleSizeChange:X,tableData:ee,queryTableData:Ht,loadingRef:te,handSearch:ae,reset:Ot}=be({searchData:{},url:"/settlement/list?tableView=SettledSettlementView",method:"post"});function D(){const t=[];for(const l in _.value){let m=_.value[l];Array.isArray(m)&&(m=m.map(f=>ke.utc(new Date(f)).format("YYYY-MM-DD HH:mm:ss")).toString()),m&&t.push({columnName:l,value:m})}t.push({columnName:I.value==="merchant"?"luMerchant":"luAgent",value:B.mer||B.agent}),ae(t)}const le=async()=>{try{const t=await fe();K.value=t.data.map(l=>({name:l.code+"站点",value:l.code}))}catch(t){console.log(t,"e")}},se=async()=>{try{const t=await ye();t.data&&t.data.length&&($.value=t.data)}catch(t){console.log(t,"e")}},oe=t=>{console.log(t,"val"),Z.value=t},ne=async()=>{if(!v.account){F.warning("请选择结算收款账户");return}if(!v.challengeResult){F.warning("请输入验证码");return}V.value=!0;try{const t={settlementAccount:v.account,challengeResult:v.challengeResult,challengeId:v.challengeId,settlementIds:[n.value.id]};await De(t),F.success("创建结算订单成功"),D(),V.value=!1,C.value=!1}catch{V.value=!1}},ce=()=>{_.value={}},re=async()=>{try{const t=await(I.value==="merchant"?we:Ne)();T.value=t.data||{}}catch(t){console.log("getStaticsData",t)}},ie=t=>{n.value=t,t.state==="10"?(de("1544175232779000001"),ue()):me(t.luWithdraw),console.log(t,"rowValue"),C.value=!0},de=async t=>{try{const m=(await O({condition:{virtualMerchantID:t},paging:{pageNumber:1,pageSize:30}})).data.items[0]||{};y.value.settledSum=q(m.cliaims,"settledSum")||0,y.value.settledFee=q(m.cliaims,"settledFee")||0}catch{}},ue=async()=>{try{const t=await Te({paging:{pageNumber:1,pageSize:30}});P.value=H(t.data.rows)||[]}catch{}},me=async t=>{try{const l=await Le({paging:{pageNumber:1,pageSize:30}},t);b.value=H(l.data.rows)[0]||{},console.log("getWithdrawList.value",l.daa)}catch(l){console.log(l,"getWithdrawList")}},ve=async()=>{try{const t=await O({paging:{pageNumber:1,pageSize:200}});W.value=t.data.items}catch{}};return Me(()=>{I.value=M.roles.includes("merchant")?"merchant":M.roles.includes("agent")?"agent":"",ve(),D(),le(),se(),re()}),(t,l)=>{const m=g("el-option"),A=g("el-select"),f=g("el-form-item"),_e=g("el-input"),L=g("el-button"),E=g("el-form"),p=g("el-table-column"),pe=g("el-pagination"),he=j("permission"),ge=j("loading");return u(),h("div",null,[e("div",Be,[e("div",Ee,[Ye,e("div",qe,o(T.value.settled||0),1),He]),G((u(),h("div",Oe,[je,e("div",Ge,o(T.value.onAir||0),1)])),[[he,["merchant"]]])]),e("div",Ze,[e("div",Je,[Ke,s(E,{inline:!0,model:_.value,class:"demo-form-inline"},{default:c(()=>[s(f,null,{default:c(()=>[s(A,{modelValue:_.value.luVirtualMerchant,"onUpdate:modelValue":l[0]||(l[0]=a=>_.value.luVirtualMerchant=a),placeholder:"全部站点",clearable:""},{default:c(()=>[(u(!0),h(z,null,R(W.value,a=>(u(),k(m,{key:a.virtualMerchantId,label:a.name,value:a.virtualMerchantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(f,null,{default:c(()=>[s(A,{modelValue:_.value.state,"onUpdate:modelValue":l[1]||(l[1]=a=>_.value.state=a),placeholder:"全部结算状态",clearable:""},{default:c(()=>[(u(),h(z,null,R(U,a=>s(m,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(f,null,{default:c(()=>[s(_e,{modelValue:_.value.settlementProcessNo,"onUpdate:modelValue":l[2]||(l[2]=a=>_.value.settlementProcessNo=a),placeholder:"请输入结算批次号搜寻",clearable:""},null,8,["modelValue"])]),_:1}),s(f,null,{default:c(()=>[s(L,{type:"primary",onClick:ce},{default:c(()=>[x("重置")]),_:1}),s(L,{type:"primary",onClick:D},{default:c(()=>[x("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),e("div",$e,[G((u(),k(i(Fe),{ref_key:"multipleTableRef",ref:J,data:i(ee),onSelectionChange:oe,style:{width:"100%"}},{default:c(()=>[s(p,{type:"selection",width:"55"}),s(p,{prop:"settlementProcessNo",label:"结算批次号",width:"200"}),s(p,{prop:"state",label:"结算状态",width:"100"},{default:c(a=>[e("div",{class:Pe(i(Y)(a.row.state).class)},o(i(Y)(a.row.state).value),3)]),_:1}),s(p,{prop:"virtualMerchant~merchantName",label:"站点名称",width:"120"}),s(p,{prop:"settlementTotal",label:"结算金额",width:"180"},{default:c(a=>[x(o((a.row.settlementTotal||0)+a.row.orderCurrency),1)]),_:1}),s(p,{prop:"orderTotal",label:"订单币种金额",width:"180"},{default:c(a=>[x(o((a.row.orderTotal||0)+a.row.orderCurrency),1)]),_:1}),s(p,{prop:"averageExchangeRate",label:"汇率",width:"220"}),s(p,{prop:"orderCount",label:"订单笔数",width:"100"}),s(p,{prop:"createdAt",label:"账单时间",width:"180"},{default:c(a=>[e("div",null,o(i(N)(a.row.createdAt)),1)]),_:1}),s(p,{prop:"action",label:"操作",fixed:"right"},{default:c(a=>[e("div",{class:"action-btn cursor-pointer",onClick:jt=>ie(a.row)},"查看详情",8,Qe)]),_:1})]),_:1},8,["data"])),[[ge,i(te)]])]),e("div",Xe,[s(pe,{background:"",layout:i(w).layout,"page-sizes":i(w).pageSizes,total:i(w).total,"page-size":i(w).pageSize,currentPage:i(w).currentPage,onSizeChange:i(X),onCurrentChange:i(Q)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])]),s(xe,{modelValue:C.value,"onUpdate:modelValue":l[6]||(l[6]=a=>C.value=a)},{default:c(()=>[e("div",et,[tt,e("div",at,[lt,e("div",st,o(n.value.settlementProcessNo),1)]),e("div",ot,[nt,e("div",ct,o(i(Ae)(n.value.state,U)),1)]),e("div",rt,[it,e("div",dt,o((n.value.settlementTotal||0)+n.value.settlementCurrency),1)]),e("div",ut,[mt,e("div",vt,o((n.value.orderTotal||0)+n.value.orderCurrency),1)]),e("div",_t,[pt,e("div",ht,o(n.value.averageExchangeRate),1)]),e("div",gt,[bt,e("div",ft,o(n.value.orderCount),1)]),e("div",yt,[wt,e("div",xt,o(n.value.orderServiceFee),1)]),e("div",St,[Ct,e("div",Vt,o(b.value.settlementFee||n.value.settlementServiceFee),1)]),e("div",At,[kt,e("div",It,o(i(N)(n.value.createdAt)),1)]),Tt,e("div",Dt,[Lt,b.value.settlementAmount?(u(),h("div",Nt,o(b.value.settlementAmount+" "+b.value.settlementCurrency),1)):y.value.settledSum&&y.value.settledFee?(u(),h("div",Ft,o(y.value.settledSum>(n.value.settlementTotal||0)?(n.value.settlementTotal||0)-y.value.settledFee:n.value.settlementTotal||0)+" "+o(" "+n.value.settlementCurrency),1)):(u(),h("div",zt,o((n.value.settlementTotal||0)+n.value.settlementCurrency),1))]),e("div",null,[n.value.state==="10"?(u(),k(E,{key:0,"label-position":"top","label-width":"auto",model:v},{default:c(()=>[s(f,{label:"结算收款账户"},{default:c(()=>[s(A,{modelValue:v.account,"onUpdate:modelValue":l[3]||(l[3]=a=>v.account=a),placeholder:"请选择结算收款账户"},{default:c(()=>[(u(!0),h(z,null,R(P.value,a=>(u(),k(m,{key:a.id,label:a.accountName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(Ie,{modelValue:v.challengeResult,"onUpdate:modelValue":l[4]||(l[4]=a=>v.challengeResult=a),onGetChallengeId:l[5]||(l[5]=a=>v.challengeId=a)},null,8,["modelValue"]),e("div",Rt,[s(L,{type:"primary",loading:V.value,onClick:ne},{default:c(()=>[x("确认并申请结算")]),_:1},8,["loading"])])]),_:1},8,["model"])):(u(),h("div",Mt,[e("div",Pt,[Ut,e("div",Wt,o(b.value["settlementAccount~accountName"]),1)]),e("div",Bt,[Et,e("div",Yt,o(i(N)(b.value.createdAt)),1)])]))])])]),_:1},8,["modelValue"])])])}}}),ra=Ve(qt,[["__scopeId","data-v-cb250d0b"]]);export{ra as default};
