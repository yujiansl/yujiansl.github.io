import{l as H,r as g,d as K,ah as u,ap as j,m,p as f,q as i,U as a,O as r,F as D,a7 as V,M as z,a8 as Z,S as y,P as E,u as n,I as G,T as p,R as T}from"./vue-C87Wc4A0.js";import{_ as J}from"./empty-BiNgvBdS.js";import{u as W}from"./useTable-CVQ-UVVt.js";import{e as Q,q as h,v as X,w as $,i as ee}from"./index-c78MVIZI.js";import{a as te}from"./index-DYQLPh63.js";import"./element-CD5rsoqi.js";import"//at.alicdn.com/t/c/font_4557022_0o7l3b0t8egq.js";import"./vxe-sm_XFqm0.js";const ae={class:"order base-box mt-20"},le={class:"top-search"},re={class:"table-wrapper"},ne=i("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[i("span",null,[i("img",{src:J,alt:""})]),i("span",{class:"custom-empty-text"},"暂无数据")],-1),oe={key:0},se={key:0},ue={class:"pager-wrapper mt-32 flex justify-end"},we=H({__name:"Index",setup(ie){const b=JSON.parse(Q("user-info")||"{}"),s=g({luAgent:b.agent,tradeState:"",payWay:"",merchantId:"",bizNo:""}),x=g([]);g([]);const C=[{label:"等待支付",value:"10"},{label:"支付成功",value:"20"},{label:"支付失败",value:"30"},{label:"取消支付",value:"40"},{label:"全额退款",value:"60"},{label:"部分退款",value:"61"}];g("first");const{paginationData:_,handleCurrentChange:M,handSearch:A,tableData:N,queryTableData:ce,loadingRef:I}=W({url:"/traderecord/list",method:"post"}),Y=()=>{s.value={luAgent:b.agent}};function w(){const l=[];for(const t in s.value){let o=s.value[t];Array.isArray(o)&&(o=o.map(c=>ee.utc(new Date(c)).format("YYYY-MM-DD HH:mm:ss")).toString()),o&&l.push({columnName:t,value:o})}A(l)}const B=[{text:"Last week",value:()=>{const l=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*7),[t,l]}},{text:"Last month",value:()=>{const l=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*30),[t,l]}},{text:"Last 3 months",value:()=>{const l=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*90),[t,l]}}],L=()=>{const l={agentId:b.agent,pageNo:1,pageSize:15},t=new URLSearchParams(Object.entries(l)).toString();te(t).then(o=>{o.data.results&&(x.value=o.data.results)}).catch(o=>{console.error(o)})},S=l=>{if(l==="10")return{class:"order-wait",text:"等待支付"};if(l==="20")return{class:"order-success",text:"支付成功"};if(l==="30")return{class:"order-fail",text:"支付失败"};if(l==="40")return{class:"order-cancel",text:"取消支付"};if(l==="60")return{class:"order-refund",text:"全额退款"};if(l==="61")return{class:"order-refund",text:"部分退款"}};return K(()=>{w(),L()}),(l,t)=>{const o=u("el-option"),v=u("el-select"),c=u("el-form-item"),q=u("el-date-picker"),P=u("el-input"),k=u("el-button"),U=u("el-form"),d=u("el-table-column"),O=u("el-table"),R=u("el-pagination"),F=j("loading");return m(),f("div",ae,[i("div",le,[a(U,{inline:!0,model:s.value,class:"demo-form-inline"},{default:r(()=>[a(c,null,{default:r(()=>[a(v,{modelValue:s.value.merchantId,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.merchantId=e),placeholder:"全部站点",clearable:""},{default:r(()=>[(m(!0),f(D,null,V(x.value,e=>(m(),z(o,{key:e.id,label:e.merchant,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,null,{default:r(()=>[a(v,{modelValue:s.value.tradeState,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.tradeState=e),placeholder:"全部订单状态",clearable:""},{default:r(()=>[(m(),f(D,null,V(C,e=>a(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(c,null,{default:r(()=>[a(q,{modelValue:s.value.createdAt,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.createdAt=e),type:"daterange","unlink-panels":"","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD",shortcuts:B,size:"default"},null,8,["modelValue"])]),_:1}),a(c,null,{default:r(()=>[a(P,{modelValue:s.value.bizNo,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.bizNo=e),placeholder:"请输入商户订单号",onKeyup:Z(w,["enter"]),clearable:""},null,8,["modelValue"])]),_:1}),a(c,null,{default:r(()=>[a(k,{onClick:Y},{default:r(()=>[y("重置")]),_:1}),a(k,{type:"primary",onClick:w},{default:r(()=>[y("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",re,[E((m(),z(O,{data:n(N),style:{width:"100%"}},{empty:r(()=>[ne]),default:r(()=>[a(d,{prop:"merchant~merchantName",label:"站点名称","min-width":"120"}),a(d,{prop:"bizNo",label:"商户订单号","min-width":"240"}),a(d,{prop:"tradeState",label:"订单状态","min-width":"120"},{default:r(e=>[i("div",{class:G(S(e.row.tradeState).class)},p(S(e.row.tradeState).text),3)]),_:1}),a(d,{prop:"price",label:"订单金额","min-width":"120"},{default:r(e=>[n(h)(e.row.price,e.row.currencyMultiply)?(m(),f("span",oe,p(n(h)(e.row.price,e.row.currencyMultiply)+" "+e.row.currency),1)):T("",!0)]),_:1}),a(d,{prop:"agentBrokerage",label:"佣金","min-width":"120"},{default:r(e=>[n(h)(e.row.agentBrokerage,e.row.currencyMultiply)?(m(),f("span",se,p(n(h)(e.row.agentBrokerage,e.row.currencyMultiply)+" "+e.row.currency),1)):T("",!0)]),_:1}),a(d,{prop:"createdAt",label:"下单时间(当地)","min-width":"240"},{default:r(e=>[i("div",null,p(n(X)(e.row.createdAt,e.row.timezone))+" ("+p(e.row.timezone)+")",1)]),_:1}),a(d,{prop:"createdAt",label:"下单时间(香港)","min-width":"180"},{default:r(e=>[y(p(n($)(e.row.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[F,n(I)]])]),i("div",ue,[a(R,{background:"",layout:n(_).layout,"page-sizes":n(_).pageSizes,total:n(_).total,"page-size":n(_).pageSize,currentPage:n(_).currentPage,onCurrentChange:n(M)},null,8,["layout","page-sizes","total","page-size","currentPage","onCurrentChange"])])])}}});export{we as default};
