import{l as J,r as h,aE as Q,d as W,ah as d,ap as X,m as u,p as f,q as r,U as a,O as o,a8 as M,F as U,a7 as C,M as V,S as L,P as $,u as i,T as x,aF as ee,aG as te}from"./vue-C87Wc4A0.js";import{_ as ae}from"./empty-BiNgvBdS.js";import{u as oe}from"./useTable-CVQ-UVVt.js";import{f as le,w as ne,k as z,V as re,_ as se}from"./index-c78MVIZI.js";import{m as de}from"./moment-C9JMj0Wb.js";import{d as ue}from"./index-DYQLPh63.js";import{_ as b}from"./lodash-CxrNlPE1.js";import{n as ie}from"./element-CD5rsoqi.js";import"//at.alicdn.com/t/c/font_4557022_0o7l3b0t8egq.js";import"./vxe-sm_XFqm0.js";const w=v=>(ee("data-v-d30e8d0f"),v=v(),te(),v),ce={class:"order base-box p-36 ml-40 mr-40 mt-20"},me={class:"top-search"},pe={class:"table-wrapper"},_e=w(()=>r("div",{class:"flex-center flex-col h-full",style:{height:"300px"}},[r("span",null,[r("img",{src:ae,alt:""})]),r("span",{class:"custom-empty-text"},"暂无数据")],-1)),fe={key:0},he={key:1},ge={key:2},ve={key:3},be={class:"httpbody-content"},we=w(()=>r("span",{class:"cursor-pointer httpbody-detail"},"内容",-1)),ye={class:"httpbody-content"},ke=w(()=>r("span",{class:"cursor-pointer httpbody-detail"},"客户端",-1)),Ve={class:"pager-wrapper mt-32 flex justify-between"},xe=w(()=>r("div",null,null,-1)),Ne=J({__name:"Index",setup(v){const R=h();le(),Q();const n=h({});h({});const N=h([]),D=h([]),c=h(!1),{paginationData:g,handleCurrentChange:Y,tableData:B,loadingRef:j,handSearch:A}=oe({searchData:{},url:"/systemlog/list",method:"post"}),F=[{text:"Last week",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,l]}},{text:"Last month",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,l]}},{text:"Last 3 months",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*90),[e,l]}}];function y(){const l=[];for(const e in n.value){let s=n.value[e];Array.isArray(s)&&(s=s.map(_=>de.utc(new Date(_)).format("YYYY-MM-DD HH:mm:ss")).toString()),s&&l.push({columnName:e,value:s})}A(l)}const I=async l=>{try{const s=await ue({paging:{pageNumber:1,pageSize:15},searchItems:[{columnName:"agentName",value:l}],sorting:{columnNames:["createdAt"],direction:"desc"}});N.value=z(s.data.rows)||[],c.value=!1}catch(e){c.value=!1,console.log(e,"queryAgentList")}},S=async l=>{try{const s=await re({paging:{pageNumber:1,pageSize:15},searchItems:[{columnName:"merchantName",value:l}],sorting:{columnNames:["createdAt"],direction:"desc"}});D.value=z(s.data.rows)||[],c.value=!1}catch(e){c.value=!1,console.log(e,"queryMerchantList")}},q=l=>{l?(c.value=!0,b.throttle(()=>I(l),500)()):b.throttle(()=>I(""),500)()},K=l=>{l?(c.value=!0,b.throttle(()=>S(l),500)()):b.throttle(()=>S(""),500)()},E=()=>{n.value={}};return W(()=>{A()}),(l,e)=>{const s=d("el-input"),m=d("el-form-item"),_=d("el-option"),k=d("el-select"),H=d("el-date-picker"),P=d("el-button"),G=d("el-form"),p=d("el-table-column"),T=d("el-tooltip"),O=d("el-pagination"),Z=X("loading");return u(),f("div",null,[r("div",ce,[r("div",me,[a(G,{inline:!0,model:n.value,class:"demo-form-inline"},{default:o(()=>[a(m,null,{default:o(()=>[a(s,{modelValue:n.value.occurredUserName,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.occurredUserName=t),placeholder:"请输入后台用户",onKeyup:M(y,["enter"]),maxlength:"30",clearable:""},null,8,["modelValue"])]),_:1}),a(m,null,{default:o(()=>[a(s,{modelValue:n.value.objectName,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.objectName=t),placeholder:"请输入表名",onKeyup:M(y,["enter"]),maxlength:"30",clearable:""},null,8,["modelValue"])]),_:1}),a(m,null,{default:o(()=>[a(k,{modelValue:n.value.tokenProfile,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.tokenProfile=t),placeholder:"请选择角色"},{default:o(()=>[a(_,{label:"merchant",value:"merchant"}),a(_,{label:"agent",value:"agent"}),a(_,{label:"admin",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:o(()=>[a(k,{modelValue:n.value.tokenAgentId,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.tokenAgentId=t),filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入代理名称","remote-show-suffix":"","remote-method":q,loading:c.value},{default:o(()=>[(u(!0),f(U,null,C(N.value,t=>(u(),V(_,{key:t.id,label:t.agentName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(m,null,{default:o(()=>[a(k,{modelValue:n.value.tokenMerchantId,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.tokenMerchantId=t),filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入商户名称","remote-show-suffix":"","remote-method":K,loading:c.value},{default:o(()=>[(u(!0),f(U,null,C(D.value,t=>(u(),V(_,{key:t.id,label:t.merchantName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(m,null,{default:o(()=>[a(H,{modelValue:n.value.occurredAt,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.occurredAt=t),type:"daterange","unlink-panels":"","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD",shortcuts:F,size:"default"},null,8,["modelValue"])]),_:1}),a(m,null,{default:o(()=>[a(P,{onClick:E},{default:o(()=>[L("重置")]),_:1}),a(P,{type:"primary",onClick:y},{default:o(()=>[L("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),r("div",pe,[$((u(),V(i(ie),{ref_key:"multipleTableRef",ref:R,data:i(B),style:{width:"100%"}},{empty:o(()=>[_e]),default:o(()=>[a(p,{prop:"objectId",label:"数据ID","min-width":"180"}),a(p,{prop:"occurredUserName",label:"操作用户","min-width":"140"}),a(p,{prop:"tokenProfile",label:"角色","min-width":"140"},{default:o(t=>[t.row.tokenProfile==="user,admin"||t.row.tokenProfile==="admin,user"?(u(),f("div",fe,"admin")):t.row.tokenProfile==="user,agent"||t.row.tokenProfile==="agent,user"?(u(),f("div",he,"agent")):t.row.tokenProfile==="user,merchant"||t.row.tokenProfile==="merchant,user"?(u(),f("div",ge,"merchant")):(u(),f("div",ve))]),_:1}),a(p,{prop:"objectName",label:"表名","min-width":"140"}),a(p,{prop:"httpBody",label:"内容","min-width":"140"},{default:o(t=>[a(T,{effect:"dark",placement:"top-start"},{content:o(()=>[r("div",be,x(t.row.httpBody),1)]),default:o(()=>[we]),_:2},1024)]),_:1}),a(p,{prop:"ipAddresses",label:"IP地址","min-width":"140"}),a(p,{prop:"httpUserAgent",label:"客户端","min-width":"140"},{default:o(t=>[a(T,{effect:"dark",placement:"top-start"},{content:o(()=>[r("div",ye,x(t.row.httpUserAgent),1)]),default:o(()=>[ke]),_:2},1024)]),_:1}),a(p,{prop:"occurredAt",label:"发生时间","min-width":"160"},{default:o(t=>[r("div",null,x(i(ne)(t.row.occurredAt)),1)]),_:1})]),_:1},8,["data"])),[[Z,i(j)]])]),r("div",Ve,[xe,a(O,{background:"",layout:i(g).layout,"page-sizes":i(g).pageSizes,total:i(g).total,"page-size":i(g).pageSize,currentPage:i(g).currentPage,onCurrentChange:i(Y)},null,8,["layout","page-sizes","total","page-size","currentPage","onCurrentChange"])])])])}}}),ze=se(Ne,[["__scopeId","data-v-d30e8d0f"]]);export{ze as default};
