import{l as Ue,r as _,aE as Fe,Z as Ne,d as Te,ah as f,ap as Ae,m as c,p as h,q as e,T as d,U as l,O as s,S as g,P as B,V as P,F as q,a7 as E,M as T,u as i,I as G,R as y,aF as Re,aG as De}from"./vue-BtEXIrqH.js";import{u as Ie}from"./useTable-B7hd0WvU.js";import{c as Le}from"./index-C7XNEq9c.js";import{F as H}from"./Index-Di390-Cq.js";import{U as ie}from"./Index-BrVI3k6U.js";import{c as Me,g as ze,a as Be}from"./index-DRaevwyq.js";import{V as re}from"./index-BwQtaG9W.js";import{b as K,c as W,a as A,i as ue,d as ce,f as Pe,t as qe}from"./commonFn-Ei0WKKhK.js";import{b as Ee,a as We}from"./index-DB6xQqCT.js";import{n as me,E as J}from"./element-BbMnn7tA.js";import{_ as $e}from"./index-Cfrc5ih1.js";import"./LIKU-logo-BbnHVERV.js";import"//at.alicdn.com/t/c/font_4557022_266y8yxi6v9.js";import"./vxe-EK889JN8.js";const n=R=>(Re("data-v-ea2b42b0"),R=R(),De(),R),je={class:"top-balance base-box flex flex-wrap ml-40 mr-40 mt-20 items-center"},Oe={class:"balance-item pr-80"},Ze=n(()=>e("div",{class:"item-title"},"系统未入账 (USD)",-1)),Ge={class:"item-price mt-10 mb-8"},He={class:"balance-item pr-80"},Ke=n(()=>e("div",{class:"item-title"},"商户未入账 (USD)",-1)),Je={class:"item-price mt-10 mb-8"},Qe={class:"balance-item pr-80"},Xe=n(()=>e("div",{class:"item-title"},"待审核金额 (USD)",-1)),Ye={class:"item-price mt-10 mb-8"},et={class:"balance-item"},tt=n(()=>e("div",{class:"item-title"},"已入账未结算 (USD)",-1)),lt={class:"item-price mt-10 mb-8"},at={class:"order base-box p-36 ml-40 mr-40 mt-20"},st={class:"top-search"},ot={class:"table-wrapper"},dt={key:0},nt={key:0},it={class:"flex"},rt=["onClick"],ut=["onClick"],ct=["onClick"],mt={class:"pager-wrapper mt-32 flex justify-between"},vt={class:"base-box detail-box"},_t=n(()=>e("div",{class:"detail-title mb-50"},"创建结算账单",-1)),pt={class:"flex-center mt-60"},ht={class:"base-box detail-box"},bt=n(()=>e("div",{class:"detail-title mb-50"},"结算账单详情",-1)),ft={class:"mb-24 flex"},gt=n(()=>e("div",{class:"order-text"},"结算批次号：",-1)),xt={class:"order-value"},wt={class:"mb-24 flex"},yt=n(()=>e("div",{class:"order-text"},"结算状态：",-1)),Vt={class:"order-value"},Ct={class:"mb-24 flex"},kt=n(()=>e("div",{class:"order-text"},"结算金额：",-1)),St={class:"order-value"},Ut={class:"mb-24 flex"},Ft=n(()=>e("div",{class:"order-text"},"订单笔数：",-1)),Nt={class:"order-value"},Tt={class:"mb-24 flex"},At=n(()=>e("div",{class:"order-text"},"结算手续费：",-1)),Rt={class:"order-value"},Dt={class:"mb-24 flex"},It=n(()=>e("div",{class:"order-text"},"账单时间：",-1)),Lt={class:"order-value"},Mt=n(()=>e("div",{class:"order-line mt-42 mb-40"},null,-1)),zt={key:0},Bt={class:"mb-24 flex"},Pt=n(()=>e("div",{class:"order-text"},"实际结算金额：",-1)),qt={class:"order-value"},Et={class:"mb-24 flex"},Wt=n(()=>e("div",{class:"order-text"},"结算收款账户：",-1)),$t={class:"order-value"},jt={class:"mb-24 flex"},Ot=n(()=>e("div",{class:"order-text"},"申请结算时间：",-1)),Zt={class:"order-value"},Gt={key:0,class:"mb-24 flex"},Ht=n(()=>e("div",{class:"order-text"},"结算打款凭证：",-1)),Kt={class:"order-value"},Jt=["src"],Qt=n(()=>e("div",{class:"order-line mt-42 mb-40"},null,-1)),Xt={key:1},Yt={class:"flex-center mt-60"},el={class:"base-box detail-box"},tl=n(()=>e("div",{class:"detail-title mb-50"},"结算账单",-1)),ll={class:"mb-24 flex"},al=n(()=>e("div",{class:"order-text"},"结算批次号：",-1)),sl={class:"order-value"},ol={class:"mb-24 flex"},dl=n(()=>e("div",{class:"order-text"},"结算状态：",-1)),nl={class:"order-value"},il={class:"mb-24 flex"},rl=n(()=>e("div",{class:"order-text"},"结算金额：",-1)),ul={class:"order-value"},cl={class:"mb-24 flex"},ml=n(()=>e("div",{class:"order-text"},"订单币种金额：",-1)),vl={class:"order-value"},_l={class:"mb-24 flex"},pl=n(()=>e("div",{class:"order-text"},"实际入账金额：",-1)),hl={class:"order-value"},bl={class:"mb-24 flex"},fl=n(()=>e("div",{class:"order-text"},"订单笔数：",-1)),gl={class:"order-value"},xl={class:"mb-24 flex"},wl=n(()=>e("div",{class:"order-text"},"收单手续费：",-1)),yl={class:"order-value"},Vl={class:"mb-24 flex"},Cl=n(()=>e("div",{class:"order-text"},"结算手续费：",-1)),kl={class:"order-value"},Sl={class:"mb-24 flex"},Ul=n(()=>e("div",{class:"order-text"},"账单时间：",-1)),Fl={class:"order-value"},Nl=n(()=>e("div",{class:"order-line mt-42 mb-40"},null,-1)),Tl={class:"mb-24 flex"},Al=n(()=>e("div",{class:"order-text"},"实际结算金额：",-1)),Rl={class:"order-value"},Dl={class:"flex-center mt-60"},Il=Ue({__name:"Index",setup(R){const w=_("first"),Q=_([]),V=_({}),ve=Fe(),m=_({channelCode:"",processNo:"",channel:"",username:""}),X=_(""),S=_({}),v=_({documentFile:"",challengeResult:"",type:"",remark:""}),_e=Ne({channelCode:[{required:!0,message:"请选择上游通道",trigger:"change"}],settlementTotal:[{required:!0,message:"请输入实际入账金额",trigger:"blur"}],challengeResult:[{required:!0,message:"请输入验证码",trigger:"change"}]}),$=_(!1),j=_(null),b=_({channelCode:"",settlementCurrency:"",settlementFile:"",settlementTotal:"",type:"",challengeResult:""}),O=_([]),D=_(!1),I=_(!1),Y=_(!1),L=_(!1),r=_({}),Z=[{label:"可结算",value:"10"},{label:"审核中",value:"20"},{label:"已结算",value:"30"}],{paginationData:U,handleCurrentChange:pe,tableData:ee,queryTableData:he,loadingRef:te,handSearch:be}=Ie({searchData:m.value,url:"/settlement/list",method:"post"});function F(){const o=[];for(const a in m.value){const C=m.value[a];C&&o.push({columnName:a,value:C})}be(o,w.value==="first"?"/settlement/list":"/settlementprocess/list")}const fe=async()=>{try{const o=await Le();O.value=o.data.map(a=>({name:a.code,value:a.code}))}catch(o){console.log(o,"e")}},le=()=>{m.value={}},ge=o=>{ve.push({name:"balanceConfirm",query:{processNo:o}})},ae=async()=>{try{L.value=!0;const o={documentFile:v.value.documentFile,challengeResult:v.value.challengeResult,remark:v.value.remark,state:"30"},a=await Ee(o,V.value.id);J.success("提交成功"),D.value=!1,L.value=!1,v.value={},F(),console.log(a,"res")}catch(o){L.value=!1,console.log(o,"createBalance")}},xe=async o=>{o&&await o.validate(async(a,C)=>{if(!b.value.settlementFile){J.error("请上传上游账单");return}if(a){$.value=!0;try{await Me(b.value),J.success("上传上游账单成功"),$.value=!1,I.value=!1,w.value="second",he("/settlementprocess/list")}catch{$.value=!1}}else console.log("error submit!",C)})},we=()=>{var o;(o=j.value)==null||o.resetFields(),I.value=!0},se=(o,a)=>{X.value=a,o.state!=="10"&&Ce(o.luWithdraw),r.value=o,D.value=!0},ye=async()=>{try{const o=await ze();S.value=o.data||{}}catch(o){console.log("getStaticsData",o)}},Ve=async()=>{try{const o=await Be({paging:{pageNumber:1,pageSize:200}});Q.value=o.data.items}catch{}},Ce=async o=>{try{const a=await We({paging:{pageNumber:1,pageSize:30}},o);V.value=qe(a.data.rows)[0]||{},console.log("getWithdrawList.value",a.data)}catch(a){console.log(a,"getWithdrawList")}};return Te(()=>{F(),Ve(),fe(),ye()}),(o,a)=>{const C=f("SvgIcon"),x=f("el-button"),oe=f("el-tab-pane"),ke=f("el-tabs"),M=f("el-option"),z=f("el-select"),p=f("el-form-item"),k=f("el-input"),N=f("el-form"),u=f("el-table-column"),Se=f("el-pagination"),de=Ae("loading");return c(),h("div",null,[e("div",je,[e("div",Oe,[Ze,e("div",Ge,d(S.value.onAir),1)]),e("div",He,[Ke,e("div",Je,d(S.value.merchantOnAir),1)]),e("div",Qe,[Xe,e("div",Ye,d(S.value.approving),1)]),e("div",et,[tt,e("div",lt,d(S.value.settled),1)]),l(x,{type:"primary",onClick:we,style:{height:"50px"},class:"flex-center"},{default:s(()=>[l(C,{class:"mr-8",name:"icon-tianjiaxinzhandian"}),g(" 创建结算账单 ")]),_:1})]),e("div",at,[l(ke,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=t=>w.value=t),class:"",onTabChange:F},{default:s(()=>[l(oe,{label:"结算账单记录",name:"first"}),l(oe,{label:"通道结算账单记录",name:"second"})]),_:1},8,["modelValue"]),e("div",st,[B(l(N,{inline:!0,model:m.value,class:"demo-form-inline"},{default:s(()=>[l(p,null,{default:s(()=>[l(z,{modelValue:m.value.luVirtualMerchant,"onUpdate:modelValue":a[1]||(a[1]=t=>m.value.luVirtualMerchant=t),placeholder:"全部站点",clearable:""},{default:s(()=>[(c(!0),h(q,null,E(Q.value,t=>(c(),T(M,{key:t.virtualMerchantId,label:t.name,value:t.virtualMerchantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:s(()=>[l(z,{modelValue:m.value.state,"onUpdate:modelValue":a[2]||(a[2]=t=>m.value.state=t),placeholder:"全部结算状态",clearable:""},{default:s(()=>[(c(),h(q,null,E(Z,t=>l(M,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:s(()=>[l(k,{modelValue:m.value.settlementProcessNo,"onUpdate:modelValue":a[3]||(a[3]=t=>m.value.settlementProcessNo=t),placeholder:"请输入结算批次号搜寻",clearable:""},null,8,["modelValue"])]),_:1}),l(p,null,{default:s(()=>[l(x,{type:"primary",onClick:le},{default:s(()=>[g("重置")]),_:1}),l(x,{type:"primary",onClick:F},{default:s(()=>[g("查询")]),_:1})]),_:1})]),_:1},8,["model"]),[[P,w.value==="first"]]),B(l(N,{inline:!0,model:m.value,class:"demo-form-inline"},{default:s(()=>[l(p,null,{default:s(()=>[l(z,{modelValue:m.value.channelCode,"onUpdate:modelValue":a[4]||(a[4]=t=>m.value.channelCode=t),placeholder:"通道名称",clearable:""},{default:s(()=>[(c(!0),h(q,null,E(O.value,t=>(c(),T(M,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:s(()=>[l(k,{modelValue:m.value.processNo,"onUpdate:modelValue":a[5]||(a[5]=t=>m.value.processNo=t),placeholder:"请输入结算批次号搜寻",clearable:""},null,8,["modelValue"])]),_:1}),l(p,null,{default:s(()=>[l(x,{type:"primary",onClick:le},{default:s(()=>[g("重置")]),_:1}),l(x,{type:"primary",onClick:F},{default:s(()=>[g("查询")]),_:1})]),_:1})]),_:1},8,["model"]),[[P,w.value==="second"]])]),e("div",ot,[B((c(),T(i(me),{data:i(ee),style:{width:"100%"}},{default:s(()=>[l(u,{prop:"settlementProcessNo",label:"结算批次号",width:"200"}),l(u,{prop:"state",label:"结算状态",width:"100"},{default:s(t=>[e("div",{class:G(i(K)(t.row.state).class)},d(i(K)(t.row.state).value),3)]),_:1}),l(u,{prop:"virtualMerchant~merchantName",label:"站点名称",width:"150"}),l(u,{prop:"merchant~merchantName",label:"商户名称",width:"150"}),l(u,{prop:"agent~agentName",label:"代理名称",width:"150"}),l(u,{prop:"settlementTotal",label:"结算金额",width:"200"},{default:s(t=>[i(W)(t.row.settlementTotal)?(c(),h("span",dt,d(i(W)(t.row.settlementTotal)+" "+t.row.settlementCurrency),1)):y("",!0)]),_:1}),l(u,{prop:"orderTotal",label:"订单币种金额",width:"200"},{default:s(t=>[i(W)(t.row.orderTotal,t.row.orderCurrencyMultiply)?(c(),h("span",nt,d(i(W)(t.row.orderTotal,t.row.orderCurrencyMultiply)+" "+t.row.orderCurrency),1)):y("",!0)]),_:1}),l(u,{prop:"averageExchangeRate",label:"汇率",width:"200"}),l(u,{prop:"orderCount",label:"订单笔数",width:"100"}),l(u,{prop:"createdAt",label:"账单时间",width:"200"},{default:s(t=>[e("div",null,d(i(A)(t.row.createdAt)),1)]),_:1}),l(u,{prop:"action",label:"操作",fixed:"right",width:"150"},{default:s(t=>[e("div",it,[t.row.state==="20"?(c(),h("div",{key:0,class:"action-btn cursor-pointer mr-20",onClick:ne=>se(t.row,"auth")}," 审核 ",8,rt)):y("",!0),e("div",{class:"action-btn cursor-pointer",onClick:ne=>se(t.row,"detail")},"查看详情",8,ut)])]),_:1})]),_:1},8,["data"])),[[P,w.value==="first"],[de,i(te)]]),B((c(),T(i(me),{data:i(ee),style:{width:"100%"}},{default:s(()=>[l(u,{prop:"processNo",label:"结算批次号",width:"200"}),l(u,{prop:"state",label:"状态",width:"100"},{default:s(t=>[e("div",{class:G(i(ue)(t.row.state).class)},d(i(ue)(t.row.state).value),3)]),_:1}),l(u,{prop:"channelCode",label:"通道名称",width:"200"},{default:s(t=>[g(d(t.row.channelCode+"通道"),1)]),_:1}),l(u,{prop:"settlementTotal",label:"结算金额",width:"200"},{default:s(t=>[g(d(((t.row.settlementTotal||0)/100).toFixed(2)+"USD"),1)]),_:1}),l(u,{prop:"createdAt",label:"结算日期",width:"200"},{default:s(t=>[g(d(i(A)(t.row.createdAt)),1)]),_:1}),l(u,{prop:"action",label:"操作",fixed:"right",width:"100"},{default:s(t=>[t.row.state.toString()==="20"?(c(),h("div",{key:0,class:"action-btn cursor-pointer",onClick:ne=>ge(t.row.processNo)}," 确认账单 ",8,ct)):y("",!0)]),_:1})]),_:1},8,["data"])),[[P,w.value==="second"],[de,i(te)]])]),e("div",mt,[l(Se,{background:"",layout:i(U).layout,"page-sizes":i(U).pageSizes,total:i(U).total,"page-size":i(U).pageSize,currentPage:i(U).currentPage,onCurrentChange:i(pe)},null,8,["layout","page-sizes","total","page-size","currentPage","onCurrentChange"])]),l(H,{modelValue:I.value,"onUpdate:modelValue":a[11]||(a[11]=t=>I.value=t)},{default:s(()=>[e("div",vt,[_t,l(N,{"label-position":"top","label-width":"auto",ref_key:"billFormRef",ref:j,rules:_e,model:b.value},{default:s(()=>[l(p,{label:"选择上游通道",prop:"channelCode"},{default:s(()=>[l(z,{modelValue:b.value.channelCode,"onUpdate:modelValue":a[6]||(a[6]=t=>b.value.channelCode=t),placeholder:"请选择上游通道"},{default:s(()=>[(c(!0),h(q,null,E(O.value,t=>(c(),T(M,{key:t.value,label:t.name+"通道",value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"上传上游账单",prop:"settlementFile"},{default:s(()=>[l(ie,{modelValue:b.value.settlementFile,"onUpdate:modelValue":a[7]||(a[7]=t=>b.value.settlementFile=t),id:"settlementFile",ext:"excel"},null,8,["modelValue"])]),_:1}),l(p,{label:"实际入账金额",prop:"settlementTotal"},{default:s(()=>[l(k,{modelValue:b.value.settlementTotal,"onUpdate:modelValue":a[8]||(a[8]=t=>b.value.settlementTotal=t),placeholder:"请输入实际入账金额"},null,8,["modelValue"])]),_:1}),l(re,{modelValue:b.value.challengeResult,"onUpdate:modelValue":a[9]||(a[9]=t=>b.value.challengeResult=t)},null,8,["modelValue"]),e("div",pt,[l(x,{type:"primary",onClick:a[10]||(a[10]=t=>xe(j.value))},{default:s(()=>[g("上传上游账单")]),_:1})])]),_:1},8,["rules","model"])])]),_:1},8,["modelValue"]),l(H,{modelValue:D.value,"onUpdate:modelValue":a[15]||(a[15]=t=>D.value=t)},{default:s(()=>[e("div",ht,[bt,e("div",ft,[gt,e("div",xt,d(r.value.settlementProcessNo),1)]),e("div",wt,[yt,e("div",Vt,[e("div",{class:G(i(K)(r.value.state).class)},d(i(ce)(r.value.state,Z)),3)])]),e("div",Ct,[kt,e("div",St,d(r.value.settlementTotal+" "+r.value.settlementCurrency),1)]),e("div",Ut,[Ft,e("div",Nt,d(r.value.orderCount),1)]),e("div",Tt,[At,e("div",Rt,d(r.value.createdAt),1)]),e("div",Dt,[It,e("div",Lt,d(i(A)(r.value.createdAt)),1)]),Mt,r.value.state!=="10"?(c(),h("div",zt,[e("div",Bt,[Pt,e("div",qt,d(V.value.settlementAmount||0),1)]),e("div",Et,[Wt,e("div",$t,d(V.value["settlementAccount~accountName"]||""),1)]),e("div",jt,[Ot,e("div",Zt,d(i(A)(V.value.createdAt||"")),1)]),r.value.state==="30"?(c(),h("div",Gt,[Ht,e("div",Kt,[e("img",{src:i(Pe)(V.value.documentFile),style:{width:"100px",height:"auto"},alt:""},null,8,Jt)])])):y("",!0),Qt])):y("",!0),r.value.state==="20"&&X.value==="auth"?(c(),h("div",Xt,[l(N,{"label-position":"top","label-width":"auto",model:v.value},{default:s(()=>[l(p,{label:"结算打款凭证"},{default:s(()=>[l(ie,{modelValue:v.value.documentFile,"onUpdate:modelValue":a[12]||(a[12]=t=>v.value.documentFile=t),id:"documentFile",ext:"img"},null,8,["modelValue"])]),_:1}),l(p,{label:"结算备注"},{default:s(()=>[l(k,{modelValue:v.value.remark,"onUpdate:modelValue":a[13]||(a[13]=t=>v.value.remark=t),placeholder:"请输入结算备注",maxlength:"50"},null,8,["modelValue"])]),_:1}),l(re,{modelValue:v.value.challengeResult,"onUpdate:modelValue":a[14]||(a[14]=t=>v.value.challengeResult=t)},null,8,["modelValue"]),e("div",Yt,[l(x,{type:"primary",loading:L.value,onClick:ae},{default:s(()=>[g("确认并申请结算")]),_:1},8,["loading"])])]),_:1},8,["model"])])):y("",!0)])]),_:1},8,["modelValue"]),l(H,{modelValue:Y.value,"onUpdate:modelValue":a[18]||(a[18]=t=>Y.value=t)},{default:s(()=>[e("div",el,[tl,e("div",ll,[al,e("div",sl,d(r.value.settlementProcessNo),1)]),e("div",ol,[dl,e("div",nl,d(i(ce)(r.value.state,Z)),1)]),e("div",il,[rl,e("div",ul,d(r.value.settlementTotal),1)]),e("div",cl,[ml,e("div",vl,d(r.value.orderTotal),1)]),e("div",_l,[pl,e("div",hl,d(r.value.createdAt),1)]),e("div",bl,[fl,e("div",gl,d(r.value.orderCount),1)]),e("div",xl,[wl,e("div",yl,d(r.value.accountName),1)]),e("div",Vl,[Cl,e("div",kl,d(r.value.accountName),1)]),e("div",Sl,[Ul,e("div",Fl,d(i(A)(r.value.createdAt)),1)]),Nl,e("div",Tl,[Al,e("div",Rl,d(r.value.accountName),1)]),e("div",null,[l(N,{"label-position":"top","label-width":"auto",model:v.value},{default:s(()=>[l(p,{label:"结算收款账户"},{default:s(()=>[l(k,{modelValue:v.value.account,"onUpdate:modelValue":a[16]||(a[16]=t=>v.value.account=t)},null,8,["modelValue"])]),_:1}),l(p,{label:"谷歌验证码"},{default:s(()=>[l(k,{modelValue:v.value.code,"onUpdate:modelValue":a[17]||(a[17]=t=>v.value.code=t)},null,8,["modelValue"])]),_:1}),e("div",Dl,[l(x,{type:"primary",onClick:ae},{default:s(()=>[g("确认并申请结算")]),_:1})])]),_:1},8,["model"])])])]),_:1},8,["modelValue"])])])}}}),Kl=$e(Il,[["__scopeId","data-v-ea2b42b0"]]);export{Kl as default};
